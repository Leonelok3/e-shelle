{% extends "visa_travail/base.html" %}

{% block title %}
  {% if is_edit %}Modifier une candidature{% else %}Nouvelle candidature{% endif %}
{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-xl-8">

    <div class="card card-dark card-dark-hover p-4 p-md-5 mb-4 fade-in-up">
      <span class="badge-soft mb-2 px-3 py-1">
        <i class="bi bi-clipboard-plus me-1"></i>
        {% if is_edit %}Modifier la candidature{% else %}Nouvelle candidature{% endif %}
      </span>

      <h1 class="h4 fw-bold mb-2">
        {% if is_edit %}Met à jour ta candidature{% else %}Ajoute une nouvelle candidature{% endif %}
      </h1>

      {% if offer %}
        <p class="text-secondary small mb-3">
          Cette candidature a été initialisée à partir de l’offre :
          <strong>{{ offer.titre }}</strong>
          {% if offer.entreprise %} chez {{ offer.entreprise }}{% endif %}
          ({{ offer.pays }}{% if offer.ville %}, {{ offer.ville }}{% endif %}).
        </p>
      {% elif profile %}
        <p class="text-secondary small mb-3">
          Candidature liée au profil :
          <strong>{{ profile.nom|default:"Profil" }}</strong>.
        </p>
      {% endif %}

      <form method="post" novalidate>
        {% csrf_token %}

        <div class="row">
          {% if form.user_profile %}
            <div class="col-12 mb-3">
              <label class="form-label">{{ form.user_profile.label }}</label>
              {{ form.user_profile }}
              <div class="form-text">
                Sélectionne le profil Visa Travail auquel associer cette candidature.
              </div>
            </div>
          {% endif %}
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">{{ form.titre_poste.label }} *</label>
            {{ form.titre_poste }}
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">{{ form.entreprise.label }}</label>
            {{ form.entreprise }}
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">{{ form.pays.label }}</label>
            {{ form.pays }}
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">{{ form.ville.label }}</label>
            {{ form.ville }}
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">{{ form.lien_offre.label }}</label>
          {{ form.lien_offre }}
        </div>

        <div class="mb-3">
          <label class="form-label">{{ form.source.label }}</label>
          {{ form.source }}
          <div class="form-text">
            Exemple : “LinkedIn”, “Indeed”, “Recommandation interne”, “Job board Visa Travail”… 
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">{{ form.statut.label }}</label>
            {{ form.statut }}
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">{{ form.date_candidature.label }}</label>
            {{ form.date_candidature }}
          </div>
        </div>

        <div class="mb-4">
          <label class="form-label">{{ form.commentaire.label }}</label>
          {{ form.commentaire }}
        </div>

        <div class="d-flex flex-wrap gap-2">
          <button type="submit" class="btn btn-primary">
            {% if is_edit %}
              <i class="bi bi-save me-1"></i> Enregistrer les modifications
            {% else %}
              <i class="bi bi-check2-circle me-1"></i> Enregistrer la candidature
            {% endif %}
          </button>

          {% if profile %}
            <a href="{% url 'visa_travail:job_list' profile.id %}" class="btn btn-outline-light">
              Annuler et retourner à la liste
            </a>
          {% else %}
            <a href="{% url 'visa_travail:job_offers_list' %}" class="btn btn-outline-light">
              Retour aux offres
            </a>
          {% endif %}
        </div>

      </form>
    </div>
  </div>
</div>
{% endblock %}
