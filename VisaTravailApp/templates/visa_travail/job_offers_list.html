{% extends "base.html" %}
{% load static %}

{% block body_class %}visa-travail{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/visa_travail.css' %}">
{% endblock %}

{% block content %}
<section class="vt-job-board">

  <div class="container">

    <!-- ================= HEADER ================= -->
    <header class="vt-card vt-fade-up">

      <span class="vt-badge">
        üíº Job board Visa Travail
      </span>

      <h1 class="vt-title">
        Offres d‚Äôemploi
        <span class="vt-gradient-primary">
          √† l‚Äôinternational
        </span>
      </h1>

      <p class="vt-subtle">
        Consulte des <strong>offres d‚Äôemploi compatibles visa travail l√©gal</strong>.
        Avec un profil Visa Travail actif, Immigration97 calcule un
        <strong>score de compatibilit√©</strong> selon ton m√©tier, ton exp√©rience
        et les pays cibl√©s.
      </p>

      {% if profile %}
        <div class="vt-info-box">
          <strong>Profil actif :</strong>
          {{ profile.nom|default:"Profil #"|add:profile.id }}<br>
          <span class="vt-subtle">
            Domaine : {{ profile.domaine_metier }}
          </span>
        </div>
      {% else %}
        <div class="vt-info-box">
          S√©lectionne ou cr√©e un
          <strong>profil Visa Travail</strong>
          pour activer l‚Äôanalyse automatique de compatibilit√©.
        </div>
      {% endif %}

    </header>

    <!-- ================= FILTRES ================= -->
    <section class="vt-card vt-fade-up">

      <h2 class="vt-section-title">
        Filtrer les offres
      </h2>

      <form method="get" class="vt-form-grid">

        {% if profile %}
          <input type="hidden" name="profile" value="{{ profile.id }}">
        {% endif %}

        <div class="vt-field">
          <label>Pays cibl√©</label>
          <input
            type="text"
            name="pays"
            value="{{ pays }}"
            class="vt-input"
            placeholder="Canada, Allemagne, Italie">
        </div>

        <div class="vt-field">
          <label>Domaine / m√©tier</label>
          <input
            type="text"
            name="domaine"
            value="{{ domaine }}"
            class="vt-input"
            placeholder="D√©veloppeur, infirmier, BTP">
        </div>

        <div class="vt-form-actions">
          <button type="submit" class="vt-btn-primary">
            üîç Filtrer les offres
          </button>

          <a href="{% if profile %}
                     {% url 'visa_travail:job_offers_list' %}?profile={{ profile.id }}
                   {% else %}
                     {% url 'visa_travail:job_offers_list' %}
                   {% endif %}"
             class="vt-btn-secondary">
            R√©initialiser
          </a>
        </div>

      </form>

    </section>

    <!-- ================= LISTE DES OFFRES ================= -->
    <section class="vt-card vt-fade-up">

      {% if offers %}
        <div class="vt-grid-3">

          {% for offer in offers %}
            <article class="vt-card vt-hover">

              <div class="vt-subtle">
                üìç {{ offer.pays }}{% if offer.ville %} ¬∑ {{ offer.ville }}{% endif %}
              </div>

              <h3 class="c-card__title">
                {{ offer.titre }}
              </h3>

              {% if offer.entreprise %}
                <p class="vt-subtle">
                  {{ offer.entreprise }}
                </p>
              {% endif %}

              {% if offer.domaine %}
                <p class="vt-subtle">
                  Domaine : {{ offer.domaine }}
                </p>
              {% endif %}

              {% if profile and offer.match_score %}
                <div class="vt-info-box">
                  <strong>Compatibilit√© :</strong>
                  {{ offer.match_score }} % ‚Äî {{ offer.match_label }}
                  {% if offer.match_pays_ok %}
                    <br><span class="vt-subtle">Pays conforme √† ton objectif</span>
                  {% endif %}
                </div>
              {% endif %}

              <div class="vt-cta-group">
                <a href="{% if profile %}
                           {% url 'visa_travail:job_offer_detail' offer.id %}?profile={{ profile.id }}
                         {% else %}
                           {% url 'visa_travail:job_offer_detail' offer.id %}
                         {% endif %}"
                   class="vt-btn-secondary">
                  Voir l‚Äôoffre
                </a>

                {% if profile %}
                  <a href="{% url 'visa_travail:job_create_from_offer' offer.id %}?profile={{ profile.id }}"
                     class="vt-btn-primary">
                    Ajouter √† mes candidatures
                  </a>
                {% endif %}
              </div>

            </article>
          {% endfor %}

        </div>

      {% else %}
        <div class="vt-alert-info">
          Aucune offre ne correspond √† tes crit√®res pour le moment.<br>
          Essaie un autre pays ou un domaine plus large.
          De nouvelles opportunit√©s sont ajout√©es r√©guli√®rement.
        </div>
      {% endif %}

    </section>

  </div>

</section>
{% endblock %}
