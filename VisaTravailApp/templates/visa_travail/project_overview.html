{% extends "base.html" %}
{% load static %}

{% block body_class %}visa-travail{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/visa_travail.css' %}">
{% endblock %}

{% block content %}
<section class="vt-overview">

  <div class="container">

    <!-- ==================================================
         HEADER â€” VUE STRATÃ‰GIQUE
    =================================================== -->
    <section class="vt-card vt-overview-header vt-fade-up">

      <div class="vt-overview-top">

        <!-- TEXTE -->
        <div class="vt-overview-intro">

          <span class="vt-badge">
            ðŸ§  Coach Immigration97 Â· Analyse stratÃ©gique
          </span>

          <h1 class="vt-title">
            Vue 360Â° de ton projet
            <span class="vt-gradient-primary">Visa Travail</span>
          </h1>

          <p class="vt-subtle">
            Cette vue globale te permet dâ€™Ã©valuer en un coup dâ€™Å“il :
            <strong>la soliditÃ© de ton profil</strong>,
            <strong>lâ€™avancement rÃ©el de ton plan dâ€™action</strong>
            et <strong>tes opportunitÃ©s dâ€™emploi compatibles Ã  lâ€™Ã©tranger</strong>.
          </p>

          <div class="vt-overview-meta">
            Profil :
            <strong>{{ profile.nom|default:"Profil #"|add:profile.id }}</strong>
            Â· Domaine :
            <strong>{{ profile.domaine_metier }}</strong>
            Â· Pays ciblÃ©s :
            <strong>{{ profile.pays_cibles|default:"Non dÃ©fini" }}</strong>
          </div>

        </div>

        <!-- SCORE GLOBAL -->
        <div class="vt-score-circle">

          <div class="vt-score-ring">
            <div class="vt-score-inner">
              <div class="vt-score-value">
                {{ global.global_score }}<span>/100</span>
              </div>
              <div class="vt-score-label">
                {{ global.label }}
              </div>
            </div>
          </div>

          <div class="vt-score-caption">
            Score global du projet Visa Travail
          </div>

        </div>

      </div>

    </section>

    <!-- ==================================================
         ANALYSE DÃ‰TAILLÃ‰E
    =================================================== -->
    <div class="vt-overview-grid">

      <!-- ================= PROFIL ================= -->
      <div class="vt-card vt-hover vt-fade-up">

        <header class="vt-card-header">
          <h2>Profil candidat</h2>
          <span class="vt-badge small">
            {{ global.profile_part.score }}/40
          </span>
        </header>

        <div class="vt-overview-item">
          <span>Pays de rÃ©sidence</span>
          <strong>{{ profile.pays_residence }}</strong>
        </div>

        <div class="vt-overview-item">
          <span>Niveau dâ€™Ã©tudes</span>
          <strong>{{ profile.get_niveau_etudes_display }}</strong>
        </div>

        <div class="vt-overview-item">
          <span>ExpÃ©rience professionnelle</span>
          <strong>{{ profile.annees_experience }} an(s)</strong>
        </div>

        <div class="vt-overview-item">
          <span>Langues</span>
          <strong>
            Anglais {{ profile.niveau_anglais }}
            Â· Langue locale {{ profile.niveau_langue_pays }}
          </strong>
        </div>

        <div class="vt-overview-note">
          {{ global.profile_part.level }}
        </div>

      </div>

      <!-- ================= PLAN ================= -->
      <div class="vt-card vt-hover vt-fade-up">

        <header class="vt-card-header">
          <h2>Plan dâ€™action</h2>
          <span class="vt-badge small">
            {{ progress_percent }}%
          </span>
        </header>

        <div class="vt-progress-text">
          {{ done_steps }} / {{ total_steps }}
          Ã©tapes complÃ©tÃ©es
        </div>

        <div class="vt-progress-bar">
          <span style="width: {{ progress_percent }}%"></span>
        </div>

        <a href="{% url 'visa_travail:plan_action' profile.id %}"
           class="vt-btn-secondary mt-3">
          Voir le plan dÃ©taillÃ©
        </a>

      </div>

      <!-- ================= MATCHING ================= -->
      <div class="vt-card vt-hover vt-fade-up">

        <header class="vt-card-header">
          <h2>CompatibilitÃ© offres</h2>
          <span class="vt-badge small">
            {{ global.matching_part.score }}/40
          </span>
        </header>

        <div class="vt-overview-item">
          <span>Offres analysÃ©es</span>
          <strong>{{ global.matching_part.count_offers }}</strong>
        </div>

        <div class="vt-overview-item">
          <span>CompatibilitÃ© moyenne</span>
          <strong>{{ global.matching_part.avg_match }}%</strong>
        </div>

        <a href="{% url 'visa_travail:job_offers_list' %}?profile={{ profile.id }}"
           class="vt-btn-secondary mt-3">
          Voir les offres compatibles
        </a>

      </div>

    </div>

    <!-- ==================================================
         CTA FINAL
    =================================================== -->
    <div class="vt-next-step vt-fade-up">

      <span class="vt-subtle">
        Ã‰tape suivante recommandÃ©e par le coach Immigration97
      </span>

      <div class="vt-cta-group">
        <a href="{% url 'visa_travail:plan_action' profile.id %}"
           class="vt-btn-primary">
          <i class="bi bi-list-check"></i>
          Finaliser mon plan dâ€™action
        </a>

        <a href="{% url 'billing:access' %}"
           class="vt-btn-premium">
          <i class="bi bi-stars"></i>
          AccÃ©der aux analyses Premium
        </a>
      </div>

    </div>

  </div>
</section>
{% endblock %}
