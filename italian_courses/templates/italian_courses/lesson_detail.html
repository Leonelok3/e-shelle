{% extends "italian_courses/base.html" %}

{% block title %}{{ lesson.title }} — Cours Italien{% endblock %}

{% block content %}
  <div class="card">
    <div class="row" style="justify-content:space-between; align-items:center;">
      <div>
        <p class="muted" style="margin:0;">
          <a href="{% url 'italian_courses:lesson_list' category_slug=category.slug %}">← Retour à la liste</a>
        </p>
        <h2 style="margin:10px 0 0 0;">{{ lesson.title }}</h2>
      </div>
    </div>

    {# ✅ AUDIO PLAYER #}
    {% if lesson.audio_file %}
      <div style="margin-top:16px;">
        <p class="muted" style="margin:0 0 6px 0;">Audio</p>
        <audio controls style="width:100%;">
          <source src="{{ lesson.audio_file.url }}" type="audio/mpeg">
          Ton navigateur ne supporte pas l’audio.
        </audio>
        <p class="muted" style="margin-top:6px; font-size:12px;">
          Si l’audio ne se lance pas, vérifie que le fichier est bien en .mp3.
        </p>
      </div>
    {% else %}
      <div style="margin-top:16px;">
        <p class="muted" style="margin:0;">Aucun audio pour cette leçon.</p>
      </div>
    {% endif %}

    {# ✅ CONTENU HTML (ton cours) #}
    {% if lesson.content_html %}
      <div style="margin-top:18px;">
        {{ lesson.content_html|safe }}
      </div>
    {% endif %}

    {# ✅ TRANSCRIPT #}
    {% if lesson.transcript %}
      <div class="card" style="margin-top:18px;">
        <h3 style="margin-top:0;">Transcript (italien)</h3>
        <pre style="white-space:pre-wrap; margin:0;">{{ lesson.transcript }}</pre>
      </div>
    {% endif %}

    {# ✅ QUIZZES #}
    {% if quizzes %}
      <div class="card" style="margin-top:18px;">
        <h3 style="margin-top:0;">Quiz</h3>
        <ul style="margin:0; padding-left:18px;">
          {% for quiz in quizzes %}
            <li style="margin:6px 0;">
              <a class="btn primary" href="{% url 'italian_courses:quiz_take' quiz_id=quiz.id %}">
                Faire le quiz : {{ quiz.title }}
              </a>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    {# ✅ MARQUER TERMINÉ (si connecté) #}
    <div style="margin-top:18px;">
      {% if user.is_authenticated %}
        <a class="btn primary"
           href="{% url 'italian_courses:lesson_complete' slug=lesson.slug %}">
          Marquer terminé
        </a>
      {% else %}
        <p class="muted">Connecte-toi pour enregistrer ta progression.</p>
      {% endif %}
    </div>
  </div>
{% endblock %}
