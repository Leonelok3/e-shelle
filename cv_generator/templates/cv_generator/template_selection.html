{% extends "base.html" %}
{% load static %}

{% block title %}
Choisissez votre mod√®le de CV optimis√© | Immigration97
{% endblock %}

{% block meta_description %}
Choisissez un mod√®le de CV optimis√© (Canada, Europe, Moderne, Professionnel)
avant de remplir l'√©diteur guid√©. Compatible ATS et immigration.
{% endblock %}

{% block body_class %}cv-generator{% endblock %}
{% block app_scope %}cv-generator{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/cv_generator.css' %}">

{% endblock %}

{% block content %}
<main class="cv-page-wrap">

  <!-- HEADER -->
  <header class="cv-page-header">
    <div>
      <div class="cv-page-brand">Immigration97 ¬∑ CV Generator</div>
      <div class="cv-badge-row">
        <span class="cv-badge cv-badge--accent">
          √âtape 1 ‚Äî Choisir un mod√®le
        </span>
        <span class="cv-badge">
          Compatible ATS ¬∑ Canada / Europe / USA
        </span>
      </div>
    </div>

    <a href="{% url 'cv_generator:cv_list' %}" class="cv-pill-link">
      üìÇ Voir mes CV existants
    </a>
  </header>

  <h1 class="cv-title">
    Choisissez le mod√®le de CV qui vous met le mieux en valeur
  </h1>

  <p class="cv-lead">
    S√©lectionnez un design adapt√© √† votre pays cible et √† votre objectif professionnel.
  </p>

  <!-- üî• DEBUG : Afficher si aucun template -->
  {% if total_templates == 0 %}
    <div class="cv-debug-banner">
      <div class="cv-debug-title">
        <span style="font-size: 32px;">‚ö†Ô∏è</span>
        <span>Aucun mod√®le de CV disponible</span>
      </div>
      
      <p class="cv-debug-text">
        Les templates de CV n'ont pas encore √©t√© cr√©√©s dans la base de donn√©es. 
        Vous devez d'abord cr√©er des templates avant de pouvoir g√©n√©rer des CV.
      </p>
      
      <div class="cv-debug-steps">
        <p style="color: #fbbf24; font-weight: bold; margin-bottom: 12px;">
          üîß Pour corriger ce probl√®me en 2 minutes :
        </p>
        
        <p style="margin-bottom: 12px; font-weight: bold;">
          OPTION 1 : Via l'admin Django (Recommand√©)
        </p>
        <ol>
          <li>Allez sur <a href="/admin" class="cv-debug-link" target="_blank">/admin</a></li>
          <li>Connectez-vous avec votre compte superuser</li>
          <li>Cliquez sur "<strong>Templates de CV</strong>"</li>
          <li>Cliquez sur "<strong>Ajouter Template de CV</strong>"</li>
          <li>Remplissez les champs :
            <ul style="margin-left: 20px; margin-top: 8px;">
              <li><strong>Nom</strong> : "Canada ATS Optimis√©"</li>
              <li><strong>Description</strong> : "Template optimis√© pour les syst√®mes ATS canadiens"</li>
              <li><strong>Template file</strong> : "cv_canada_ats.html"</li>
              <li>‚úÖ <strong>Actif</strong> : Coch√©</li>
              <li>‚ùå <strong>Premium</strong> : Non coch√©</li>
              <li><strong>Order</strong> : 1</li>
            </ul>
          </li>
          <li>Cliquez sur "Enregistrer"</li>
          <li>R√©p√©tez pour cr√©er d'autres templates</li>
        </ol>
        
        <div class="cv-section-divider"></div>
        
        <p style="margin: 12px 0; font-weight: bold;">
          OPTION 2 : Via le terminal (Automatique)
        </p>
        <ol>
          <li>Cr√©ez le dossier : <code>mkdir -p cv_generator/management/commands</code></li>
          <li>Cr√©ez les fichiers __init__.py</li>
          <li>Cr√©ez le script create_default_templates.py (voir la documentation)</li>
          <li>Ex√©cutez : <code>python manage.py create_default_templates</code></li>
        </ol>
      </div>
    </div>
  {% endif %}

  <!-- TEMPLATES GRATUITS -->
  {% if templates_free %}
    <section>
      <h2 class="cv-section-title" style="margin: 48px 0 24px 0; font-size: 28px; font-weight: bold; display: flex; align-items: center; gap: 12px;">
        <span style="font-size: 32px;">üÜì</span>
        <span>Mod√®les Gratuits</span>
      </h2>
      
      <div class="cv-grid">
        {% for t in templates_free %}
          <article class="cv-card">
            <div class="cv-thumb">
              {% if t.thumbnail %}
                <img src="{{ t.thumbnail.url }}" alt="Aper√ßu {{ t.name }}">
              {% else %}
                <!-- Placeholder avec ic√¥ne -->
                <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%); flex-direction: column; gap: 16px;">
                  <span style="font-size: 64px;">üìÑ</span>
                  <span style="font-size: 20px; font-weight: bold; color: white;">{{ t.name }}</span>
                </div>
              {% endif %}
            </div>

            <div class="cv-card-body">
              <h2 class="cv-card-title">{{ t.name }}</h2>

              <span class="cv-card-tag">
                {% if "canada" in t.name|lower or "ats" in t.name|lower %}
                  üá®üá¶ Canada / USA (ATS)
                {% elif "europe" in t.name|lower %}
                  üá™üá∫ Europe / UE
                {% elif "modern" in t.name|lower %}
                  ‚ú® Moderne
                {% elif "professional" in t.name|lower %}
                  üíº Professionnel
                {% else %}
                  üåç Usage universel
                {% endif %}
              </span>

              <p class="cv-card-desc">
                {{ t.description|default:"Mod√®le de CV optimis√© pour l'immigration et l'emploi." }}
              </p>
            </div>

            <div class="cv-card-actions">
              <a href="{% url 'cv_generator:choose_template' t.id %}" class="cv-btn">
                ‚úì Choisir ce mod√®le
              </a>
            </div>
          </article>
        {% endfor %}
      </div>
    </section>
  {% endif %}

  <!-- TEMPLATES PREMIUM -->
  {% if templates_premium %}
    <div class="cv-section-divider"></div>
    
    <section>
      <h2 class="cv-section-title" style="margin: 48px 0 24px 0; font-size: 28px; font-weight: bold; display: flex; align-items: center; gap: 12px;">
        <span style="font-size: 32px;">‚≠ê</span>
        <span>Mod√®les Premium</span>
      </h2>
      
      <div class="cv-grid">
        {% for t in templates_premium %}
          <article class="cv-card cv-card--premium">
            
            <!-- Badge Premium -->
            <div class="cv-premium-badge">
              ‚≠ê PREMIUM
            </div>
            
            <div class="cv-thumb">
              {% if t.thumbnail %}
                <img src="{{ t.thumbnail.url }}" alt="Aper√ßu {{ t.name }}">
              {% else %}
                <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #b45309 0%, #92400e 100%); flex-direction: column; gap: 16px;">
                  <span style="font-size: 64px;">üìÑ</span>
                  <span style="font-size: 20px; font-weight: bold; color: white;">{{ t.name }}</span>
                </div>
              {% endif %}
            </div>

            <div class="cv-card-body">
              <h2 class="cv-card-title">{{ t.name }}</h2>

              <span class="cv-card-tag" style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: #000;">
                ‚≠ê Premium
              </span>

              <p class="cv-card-desc">
                {{ t.description|default:"Mod√®le de CV premium pour se d√©marquer." }}
              </p>
            </div>

            <div class="cv-card-actions">
              <a href="{% url 'cv_generator:choose_template' t.id %}" 
                 class="cv-btn" 
                 style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: #000;">
                ‚≠ê Choisir Premium
              </a>
            </div>
          </article>
        {% endfor %}
      </div>
    </section>
  {% endif %}

  <!-- Message si vraiment aucun template (apr√®s debug banner) -->
  {% if total_templates == 0 %}
    <div class="cv-empty" style="margin-top: 32px; padding: 24px; background: rgba(255, 255, 255, 0.05); border-radius: 8px; text-align: center;">
      <p style="font-size: 18px; margin-bottom: 16px;">
        Une fois les templates cr√©√©s, rechargez cette page pour les voir appara√Ætre. üîÑ
      </p>
      <a href="{% url 'cv_generator:template_selection' %}" 
         class="cv-btn" 
         style="display: inline-block;">
        ‚Üª Recharger la page
      </a>
    </div>
  {% endif %}

</main>
{% endblock %}