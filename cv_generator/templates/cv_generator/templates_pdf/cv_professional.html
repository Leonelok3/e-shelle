<article class="cv-doc cv-pro" role="document" aria-label="CV Professionnel">
  <header class="cv-pro-header">
    <div>
      <h1 class="cv-pro-name">{{ cv.prenom }} {{ cv.nom }}</h1>
      {% if cv.titre_poste %}<p class="cv-pro-title">{{ cv.titre_poste }}</p>{% endif %}
    </div>
    <div class="cv-pro-contact">
      {% if cv.email %}<span>{{ cv.email }}</span>{% endif %}
      {% if cv.telephone %}<span>{{ cv.telephone }}</span>{% endif %}
      {% if cv.ville or cv.province %}<span>{{ cv.ville }}{% if cv.province %}, {{ cv.province }}{% endif %}</span>{% endif %}
      {% if cv.linkedin %}<span>{{ cv.linkedin }}</span>{% endif %}
    </div>
  </header>

  {% with profile=cv.summary|default:cv.resume_professionnel %}
    {% if profile %}
      <section class="cv-pro-section">
        <h2>Résumé</h2>
        <p>{{ profile }}</p>
      </section>
    {% endif %}
  {% endwith %}

  {% if experiences %}
    <section class="cv-pro-section">
      <h2>Expériences</h2>
      {% for exp in experiences %}
        <div class="cv-pro-item">
          <div class="cv-pro-top">
            <div class="cv-pro-role">
              <strong>{{ exp.title|default:exp.poste }}</strong>
              {% if exp.company or exp.entreprise %}
                <span class="cv-pro-company"> — {{ exp.company|default:exp.entreprise }}</span>
              {% endif %}
            </div>
            <div class="cv-pro-date">
              {% if exp.start_date %}{{ exp.start_date|date:"m/Y" }}{% endif %}
              {% if exp.start_date or exp.end_date %} - {% endif %}
              {% if exp.end_date %}{{ exp.end_date|date:"m/Y" }}{% else %}Présent{% endif %}
            </div>
          </div>

          {% with bullets=exp.description_ai|default:exp.description|default:exp.description_raw %}
            {% if bullets %}<div class="cv-pro-desc">{{ bullets|linebreaks }}</div>{% endif %}
          {% endwith %}
        </div>
      {% endfor %}
    </section>
  {% endif %}

  {% if formations %}
    <section class="cv-pro-section">
      <h2>Formation</h2>
      {% for edu in formations %}
        <div class="cv-pro-item">
          <div class="cv-pro-top">
            <div>
              <strong>{{ edu.diplome|default:edu.diploma }}</strong>
              {% if edu.etablissement or edu.institution %}
                <span class="cv-pro-company"> — {{ edu.etablissement|default:edu.institution }}</span>
              {% endif %}
            </div>
            <div class="cv-pro-date">
              {% if edu.start_date %}{{ edu.start_date|date:"Y" }}{% endif %}
              {% if edu.start_date and edu.end_date %} - {{ edu.end_date|date:"Y" }}{% endif %}
              {% if edu.start_date and not edu.end_date %} - Présent{% endif %}
              {% if not edu.start_date and edu.annee_obtention %}{{ edu.annee_obtention }}{% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </section>
  {% endif %}

  {% if competences %}
    <section class="cv-pro-section">
      <h2>Compétences</h2>
      <div class="cv-pro-skills">
        {% for c in competences %}<span class="cv-pro-pill">{{ c.nom }}</span>{% endfor %}
      </div>
    </section>
  {% endif %}

  {% if langues %}
    <section class="cv-pro-section">
      <h2>Langues</h2>
      <ul class="cv-pro-list">
        {% for l in langues %}<li><strong>{{ l.name }}</strong>{% if l.level %} — {{ l.level }}{% endif %}</li>{% endfor %}
      </ul>
    </section>
  {% endif %}
</article>
