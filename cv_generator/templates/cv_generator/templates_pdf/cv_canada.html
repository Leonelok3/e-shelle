{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>CV Cr√©atif ‚Äì Format Canada</title>
  <style>
    @page { size: A4; margin: 15mm; }
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "Poppins", "Segoe UI", Arial, sans-serif;
      font-size: 11pt;
      color: #222;
      background: #fff;
      line-height: 1.5;
    }

    .header {
      text-align: center;
      border-bottom: 4px solid #004AAD;
      padding-bottom: 12px;
      margin-bottom: 20px;
    }

    .name {
      font-size: 26pt;
      font-weight: 700;
      color: #004AAD;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .title {
      font-size: 13pt;
      color: #333;
      font-weight: 500;
      margin-top: 4px;
    }

    .meta {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px 20px;
      margin-top: 10px;
      font-size: 10pt;
      color: #555;
      line-height: 1.4;
    }

    .meta span {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .section {
      margin-top: 22px;
    }

    h2 {
      font-size: 12pt;
      color: #004AAD;
      text-transform: uppercase;
      border-bottom: 2px solid #004AAD;
      padding-bottom: 4px;
      margin-bottom: 12px;
      letter-spacing: 0.4px;
    }

    .summary {
      background: #f7faff;
      border-left: 3px solid #004AAD;
      padding: 10px 14px;
      text-align: justify;
      border-radius: 6px;
      font-size: 10.8pt;
    }

    .item {
      margin-bottom: 14px;
      page-break-inside: avoid;
    }

    .item-title {
      font-weight: 700;
      font-size: 11pt;
      color: #111;
    }

    .item-sub {
      color: #004AAD;
      font-weight: 600;
      font-size: 10.5pt;
    }

    .muted {
      color: #666;
      font-size: 9.6pt;
      font-style: italic;
      margin-top: 2px;
    }

    ul {
      margin: 5px 0 0 20px;
    }

    li {
      margin: 3px 0;
      text-align: justify;
    }

    /* --- Comp√©tences et langues sur plusieurs lignes --- */
    .tag-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 6px 10px;
      margin-top: 5px;
    }

    .tag {
      background: #e9f2ff;
      border-radius: 14px;
      padding: 4px 10px;
      font-size: 10pt;
      color: #004AAD;
      font-weight: 600;
      border: 1px solid #c6dcff;
    }

    .dual {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 20px;
    }

    .col {
      flex: 1 1 45%;
    }

    .footer-note {
      text-align: center;
      font-size: 9pt;
      color: #777;
      margin-top: 20px;
      border-top: 1px solid #ddd;
      padding-top: 6px;
    }

    @media print {
      body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    }
  </style>
</head>

<body>
  {% with pi=personal_info %}
  <div class="header">
    <div class="name">{{ pi.prenom|default:"" }} {{ pi.nom|default:"" }}</div>
    <div class="title">{{ pi.titre|default:cv.profession|default:"" }}</div>
    <div class="meta">
      {% if pi.email %}<span>üìß {{ pi.email }}</span>{% endif %} <br>
      {% if pi.telephone %}<span>üìû {{ pi.telephone }}</span>{% endif %}
      {% if pi.ville %}<span>üìç {{ pi.ville }}{% if pi.province %}, {{ pi.province }}{% endif %}</span>{% endif %}
      {% if pi.pays %}<span>{{ pi.pays }}</span>{% endif %}
      {% if pi.linkedin %}<span>üîó {{ pi.linkedin }}</span>{% endif %}
    </div>
  </div>
  {% endwith %}

  {% if summary %}
  <div class="section">
    <h2>R√©sum√© Professionnel</h2>
    <div class="summary">{{ summary|linebreaksbr }}</div>
  </div>
  {% endif %}

  {% if skills %}
  <div class="section">
    <h2>Comp√©tences</h2>
    <div class="tag-grid">
      {% for s in skills %}
        <p class="tag">{{ s.name|default:s.nom|default:"Comp√©tence" }}</p>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  {% if experiences %}
  <div class="section">
    <h2>Exp√©riences Professionnelles</h2>
    {% for e in experiences %}
      <div class="item">
        <div class="item-title">{{ e.title|default:e.titre_poste|default:"Poste" }}</div>
        {% if e.company or e.entreprise %}
          <div class="item-sub">{{ e.company|default:e.entreprise }}</div>
        {% endif %}
        <div class="muted">
          {% if e.start_date or e.date_debut %}{{ e.start_date|default:e.date_debut|date:"m/Y" }}{% endif %}
          {% if e.end_date or e.date_fin %} ‚Äì {{ e.end_date|default:e.date_fin|date:"m/Y" }}{% else %} ‚Äì Pr√©sent{% endif %}
          {% if e.location or e.lieu %} | {{ e.location|default:e.lieu }}{% endif %}
        </div>
        {% if e.bullets %}
          <ul>{% for ln in e.bullets %}{% if ln %}<li>{{ ln }}</li>{% endif %}{% endfor %}</ul>
        {% elif e.description %}
          <div style="margin-top:6px;">{{ e.description|linebreaksbr }}</div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
  {% endif %}

  {% if educations %}
  <div class="section">
    <h2>Formation</h2>
    {% for ed in educations %}
      <div class="item">
        <div class="item-title">{{ ed.degree|default:ed.diplome|default:"Dipl√¥me" }}</div>
        {% if ed.school or ed.ecole %}
          <div class="item-sub">{{ ed.school|default:ed.ecole }}</div>
        {% endif %}
        <div class="muted">
          {% if ed.start_date or ed.date_debut %}{{ ed.start_date|default:ed.date_debut|date:"m/Y" }}{% endif %}
          {% if ed.end_date or ed.date_fin %} ‚Äì {{ ed.end_date|default:ed.date_fin|date:"m/Y" }}{% endif %}
          {% if ed.location or ed.lieu %} | {{ ed.location|default:ed.lieu }}{% endif %}
        </div>
        {% if ed.description %}
          <div style="margin-top:4px;">{{ ed.description|linebreaksbr }}</div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
  {% endif %}

  {% if certifications or languages %}
  <div class="section dual">
    {% if certifications %}
    <div class="col">
      <h2>Certifications</h2>
      {% for c in certifications %}
        <div class="item">
          <div class="item-title">{{ c.name }}</div>
          <div class="muted">{{ c.organization }}{% if c.date_obtained %} ‚Äî {{ c.date_obtained|date:"m/Y" }}{% endif %}</div>
        </div>
      {% endfor %}
    </div>
    {% endif %}

    {% if languages %}
    <div class="col">
      <h2>Langues</h2>
      <div class="tag-grid">
        {% for l in languages %}
          <p class="tag">{{ l.name|default:l.langue }}{% if l.get_level_display %} ‚Äî {{ l.get_level_display }}{% endif %}</p>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>
  {% endif %}

  {% if projects %}
  <div class="section">
    <h2>Projets</h2>
    {% for p in projects %}
      <div class="item">
        <div class="item-title">{{ p.title|default:p.nom }}</div>
        <div class="muted">
          {% if p.start_date %}{{ p.start_date|date:"Y" }}{% endif %}
          {% if p.technologies %} ‚Äî {{ p.technologies }}{% endif %}
          {% if p.url %} ‚Äî {{ p.url }}{% endif %}
        </div>
        {% if p.description %}
          <div style="margin-top:4px;">{{ p.description|linebreaksbr }}</div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
  {% endif %}

  <div class="footer-note">
    <em>CV g√©n√©r√© automatiquement ‚Äî Mod√®le ‚ÄúModern Canada‚Äù ¬© 2025</em>
  </div>
</body>
</html>
