{% extends "base.html" %}
{% load static %}

{% block title %}Mes CVs - Tableau de Bord{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://kit.fontawesome.com/9d6b1b0b3f.js" crossorigin="anonymous"></script>

<div class="min-h-screen bg-gray-900 text-gray-100 p-6">
    <div class="max-w-6xl mx-auto">
        
        <header class="flex items-center justify-between mb-8">
            <div>
                <h1 class="text-3xl font-bold text-white">Mon Tableau de Bord CVs</h1>
                <p class="text-sm text-gray-400">Gérez vos CVs, reprenez l'édition ou exportez en PDF.</p>
            </div>
            <div class="flex items-center gap-3">
                <a href="{% url 'cv_generator:template_selection' %}" class="px-4 py-2 bg-indigo-600 rounded hover:bg-indigo-500 font-semibold shadow-md">
                    <i class="fas fa-plus mr-2"></i> Créer un nouveau CV
                </a>
            </div>
        </header>

        {% if cvs %}
            <div class="bg-gray-800 p-6 rounded-lg shadow-xl">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-700">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    Titre du CV / Profession
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    Pays Ciblé
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    Statut
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    Progression
                                </th>
                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    Actions
                                </th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-700">
                            {% for cv in cvs %}
                            <tr class="hover:bg-gray-700 transition duration-150">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-medium text-white">{{ cv.profession|default:"CV Sans Titre" }}</div>
                                    <div class="text-xs text-gray-400">Modifié le: {{ cv.date_modification|date:"d M Y" }}</div>
                                </td>
                                
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="text-sm text-gray-300">{{ cv.pays_cible|default:"Non Spécifié" }}</span>
                                </td>

                                <td class="px-6 py-4 whitespace-nowrap">
                                    {% if cv.is_completed %}
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-800 text-green-200">
                                            <i class="fas fa-check-circle mr-1"></i> Complété
                                        </span>
                                    {% else %}
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-800 text-yellow-200">
                                            <i class="fas fa-edit mr-1"></i> En Cours (Étape {{ cv.current_step }}/3)
                                        </span>
                                    {% endif %}
                                </td>
                                
                                <td class="px-6 py-4 whitespace-nowrap">
                                    {% with percentage=cv.get_completion_percentage %}
                                    <div class="flex items-center">
                                        <div class="w-20 bg-gray-600 rounded-full h-2.5">
                                            <div class="bg-indigo-500 h-2.5 rounded-full" style="width: {{ percentage }}%"></div>
                                        </div>
                                        <span class="ml-2 text-sm text-gray-300">{{ percentage }}%</span>
                                    </div>
                                    {% endwith %}
                                </td>

                                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
<a href="{% url 'cv_generator:create_cv' cv_id=cv.id %}" class="text-indigo-400 hover:text-indigo-300 mr-3">
                                        <i class="fas fa-pencil-alt"></i> Éditer
                                    </a>
                                    {% if cv.is_completed %}
                                        <a href="{% url 'cv_generator:export_pdf' cv_id=cv.id %}" target="_blank" class="text-green-400 hover:text-green-300">
                                            <i class="fas fa-download"></i> PDF
                                        </a>
                                    {% else %}
                                        <span class="text-gray-500 cursor-not-allowed" title="Finalisez le CV pour exporter">
                                            <i class="fas fa-download"></i> PDF
                                        </span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        {% else %}
            <div class="text-center py-12 bg-gray-800 rounded-lg shadow-xl">
                <i class="fas fa-clipboard-list fa-3x text-gray-500 mb-4"></i>
                <h3 class="text-xl font-semibold text-white mb-2">Vous n'avez pas encore créé de CV.</h3>
                <p class="text-gray-400 mb-4">Commencez dès maintenant pour générer votre CV optimisé par l'IA.</p>
                <a href="{% url 'cv_generator:template_selection' %}" class="px-6 py-3 bg-indigo-600 rounded hover:bg-indigo-500 font-semibold shadow-lg">
                    Démarrer la création de CV
                </a>
            </div>
        {% endif %}

    </div>
</div>
{% endblock %}