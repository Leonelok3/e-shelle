{% extends "base.html" %}
{% load static %}

{% block body_class %}cv-generator{% endblock %}
{% block app_scope %}cv-generator{% endblock %}

{% block title %}Mes CV ‚Äî Tableau de bord ¬∑ Immigration97{% endblock %}

{% block meta_description %}
G√©rez vos CV Immigration97 : √©dition, suivi par √©tapes, export PDF
optimis√© ATS pour Canada, Europe, USA et Afrique francophone.
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/cv_generator.css' %}">
{% endblock %}

{% block content %}
<main class="app-main cv-generator">
  <div class="cv-dashboard">

    <header class="cv-header">
      <div>
        <h1>Mes CV ‚Äî Tableau de bord</h1>
        <p class="cv-header-lead">
          Suivez la progression de vos CV et exportez des PDF
          <strong>pr√™ts pour les candidatures internationales</strong>.
        </p>
      </div>

      <div class="cv-header-actions">
        <a href="{% url 'cv_generator:template_selection' %}" class="btn-main">
          ‚ûï Cr√©er un nouveau CV
        </a>
        <a href="{% url 'billing:access' %}" class="btn-ghost">
          üöÄ Acc√®s complet Immigration97
        </a>
      </div>
    </header>

    <div class="cv-upsell-strip">
      üí° Multipliez vos chances en utilisant <strong>plusieurs CV adapt√©s par pays</strong>
      (Canada, Europe, USA).
      <a href="{% url 'billing:access' %}">Voir les acc√®s Pro</a>
    </div>

    {% if cvs %}
      <section class="cv-panel">
        <div class="cv-table-wrapper">
          <table class="cv-table">
            <thead>
              <tr>
                <th>CV / Profession</th>
                <th>Pays</th>
                <th>Statut</th>
                <th>Progression</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for cv in cvs %}
              <tr>
                <td>
                  <div class="cv-main-title">
                    {{ cv.profession|default:"CV sans titre" }}
                  </div>
                  <div class="cv-submeta">
                    Cr√©√© le {{ cv.created_at|date:"d M Y" }}
                  </div>
                </td>

                <td>{{ cv.pays_cible|default:"‚Äî" }}</td>

                <td>
                  {% if cv.is_completed %}
                    <span class="tag-status done">‚úî Compl√©t√©</span>
                  {% else %}
                    <span class="tag-status pending">
                      En cours ({{ cv.current_step }}/3)
                    </span>
                  {% endif %}
                </td>

                <td>
                  {% with p=cv.get_completion_percentage %}
                  <div class="progress">
                    <div class="bar">
                      <span style="width:{{ p }}%"></span>
                    </div>
                    <small>{{ p }}%</small>
                  </div>
                  {% endwith %}
                </td>

                <td class="cv-actions">
                  <a href="{% url 'cv_generator:edit_cv' cv.id %}">‚úèÔ∏è √âditer</a>
                  {% if cv.is_completed %}
                    <a href="{% url 'cv_generator:export_pdf' cv.id %}" target="_blank">üìÑ PDF</a>
                  {% else %}
                    <span class="disabled">üìÑ PDF</span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>
    {% else %}
      <section class="cv-empty">
        <h3>Aucun CV cr√©√©</h3>
        <p>
          Commencez avec un mod√®le optimis√© pour
          <strong>Canada, Europe et immigration</strong>.
        </p>
        <a href="{% url 'cv_generator:template_selection' %}" class="btn-main">
          D√©marrer mon premier CV
        </a>
      </section>
    {% endif %}

  </div>
</main>
{% endblock %}
