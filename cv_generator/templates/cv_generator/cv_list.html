{% extends "base.html" %}
{% load static %}

{% block body_class %}cv-generator{% endblock %}
{% block app_scope %}cv-generator{% endblock %}

{% block title %}Mes CV â€” Tableau de bord Â· Immigration97{% endblock %}

{% block meta_description %}GÃ©rez vos CV Immigration97 : Ã©dition, suivi par Ã©tapes, export PDF optimisÃ© ATS pour Canada, Europe, USA et Afrique francophone.{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/cv_generator.css' %}">
{% endblock %}

{% block content %}
<div class="cv-dashboard">

  <header class="cv-header">
    <div>
      <h1>Mes CV â€” Tableau de bord</h1>
      <p class="cv-header-lead">
        Suivez la progression de vos CV et exportez des PDF
        <strong>prÃªts pour les candidatures internationales</strong>.
      </p>
    </div>

    <div class="cv-header-actions">
      <a href="{% url 'cv_generator:template_selection' %}" class="btn-primary">
        âž• CrÃ©er un nouveau CV
      </a>
      <a href="{% url 'billing:access' %}" class="btn-ghost">
        ðŸš€ AccÃ¨s complet Immigration97
      </a>
    </div>
  </header>

  <div class="cv-upsell-strip">
    ðŸ’¡ Multipliez vos chances en utilisant <strong>plusieurs CV adaptÃ©s par pays</strong>
    (Canada, Europe, USA).
    <a href="{% url 'billing:access' %}">Voir les accÃ¨s Pro</a>
  </div>

  {% if cvs %}
    <section class="cv-panel">
      <div class="cv-table-wrapper">
        <table class="cv-table">
          <thead>
            <tr>
              <th>CV / Profession</th>
              <th>Pays</th>
              <th>Statut</th>
              <th>Progression</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for cv in cvs %}
            <tr>
              <td>
                <div class="cv-main-title">
                  {{ cv.profession|default:"CV sans titre" }}
                </div>
                <div class="cv-submeta">
                  CrÃ©Ã© le {{ cv.created_at|date:"d M Y" }}
                </div>
              </td>

              <td>{{ cv.pays_cible|default:"â€”" }}</td>

              <td>
                {% if cv.is_completed %}
                  <span class="tag-status tag-status--done">âœ” ComplÃ©tÃ©</span>
                {% else %}
                  <span class="tag-status tag-status--pending">
                    En cours ({{ cv.current_step }}/3)
                  </span>
                {% endif %}
              </td>

              <td>
                {% with p=cv.get_completion_percentage %}
                <div class="progress" data-progress="{{ p }}">
                  <div class="bar"><span></span></div>
                  <small>{{ p }}%</small>
                </div>
                {% endwith %}
              </td>

              <td class="cv-actions">
                <a href="{% url 'cv_generator:edit_cv' cv.id %}">Modifier</a>

                {% if cv.is_completed %}
                  <a href="{% url 'cv_generator:export_pdf' cv.id %}" target="_blank">ðŸ“„ PDF</a>
                {% else %}
                  <span class="disabled">ðŸ“„ PDF</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </section>
  {% else %}
    <section class="cv-empty">
      <h3>Aucun CV crÃ©Ã©</h3>
      <p>
        Commencez avec un modÃ¨le optimisÃ© pour
        <strong>Canada, Europe et immigration</strong>.
      </p>
      <a href="{% url 'cv_generator:template_selection' %}" class="btn-primary">
        DÃ©marrer mon premier CV
      </a>
    </section>
  {% endif %}

</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/cv_progress.js' %}" defer></script>
{% endblock %}
