{% extends "base.html" %}
{% load static %}

{# ==== SEO ==== #}
{% block title %}Mes CV ‚Äî Tableau de bord ¬∑ Immigration97{% endblock %}

{% block meta_description %}
  G√©rez vos CV cr√©√©s avec Immigration97 : reprise d‚Äô√©dition, suivi de progression par √©tape,
  export PDF pr√™t pour les candidatures (Canada, Europe, USA, UK) et acc√®s aux mod√®les optimis√©s ATS.
{% endblock %}

{% block head_extra %}
  <style>
    .cv-dashboard{
      min-height:calc(100vh - 140px);
      padding:26px 0 40px;
    }
    .cv-dashboard-inner{
      max-width:1100px;
      margin:0 auto;
    }
    .cv-header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:1rem;
      margin-bottom:16px;
      flex-wrap:wrap;
    }
    .cv-header h1{
      margin:0;
      font-size:1.6rem;
      font-weight:750;
      color:#f9fafb;
    }
    .cv-header-lead{
      font-size:.9rem;
      color:#94a3b8;
      margin-top:4px;
    }
    .cv-header-lead strong{
      color:#22c55e;
      font-weight:600;
    }

    .cv-header-actions{
      display:flex;
      flex-wrap:wrap;
      gap:.5rem;
      align-items:center;
    }

    .btn-main{
      display:inline-flex;
      align-items:center;
      gap:.4rem;
      padding:9px 16px;
      border-radius:999px;
      border:2px solid transparent;
      background:linear-gradient(120deg,#4ade80,#22c55e,#22c55e,#a855f7);
      background-size:220% 220%;
      color:#020617;
      font-size:.9rem;
      font-weight:700;
      text-decoration:none;
      box-shadow:0 14px 32px rgba(15,23,42,0.9);
      transition:all .2s ease-out;
    }
    .btn-main:hover{
      background-position:100% 0;
      transform:translateY(-1px);
      box-shadow:0 18px 46px rgba(15,23,42,0.96);
    }

    .btn-ghost{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      padding:8px 14px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.6);
      background:rgba(15,23,42,0.95);
      color:#e5e7eb;
      font-size:.82rem;
      text-decoration:none;
      transition:all .18s ease-out;
      box-shadow:0 12px 28px rgba(15,23,42,0.9);
    }
    .btn-ghost:hover{
      border-color:rgba(148,163,184,0.95);
      transform:translateY(-1px);
      background:radial-gradient(circle at top left,rgba(56,189,248,0.24),rgba(15,23,42,0.98));
    }

    .cv-upsell-strip{
      margin-bottom:16px;
      padding:10px 12px;
      border-radius:16px;
      border:1px solid rgba(34,197,94,0.35);
      background:radial-gradient(circle at top left,rgba(34,197,94,0.18),transparent 55%);
      font-size:.85rem;
      color:#bbf7d0;
      display:flex;
      gap:.6rem;
      align-items:flex-start;
    }
    .cv-upsell-strip .emoji{font-size:1.1rem;}
    .cv-upsell-strip a{
      color:#a5b4fc;
      text-decoration:underline;
      text-decoration-thickness:1px;
    }

    .cv-panel{
      background:rgba(15,23,42,0.96);
      border-radius:18px;
      border:1px solid rgba(30,64,175,0.5);
      padding:16px 14px 18px;
      box-shadow:0 18px 40px rgba(15,23,42,0.9);
    }

    .cv-table-wrapper{
      overflow-x:auto;
    }

    table.cv-table{
      width:100%;
      border-collapse:collapse;
      font-size:.88rem;
    }
    .cv-table thead{
      background:rgba(15,23,42,0.98);
    }
    .cv-table th,
    .cv-table td{
      padding:10px 10px;
      text-align:left;
      white-space:nowrap;
    }
    .cv-table th{
      font-size:.75rem;
      text-transform:uppercase;
      letter-spacing:.06em;
      color:#9ca3af;
      border-bottom:1px solid rgba(30,64,175,0.8);
    }
    .cv-table tbody tr{
      border-bottom:1px solid rgba(30,64,175,0.4);
      transition:background .16s ease-out;
    }
    .cv-table tbody tr:hover{
      background:rgba(15,23,42,0.92);
    }

    .cv-main-title{
      font-size:.95rem;
      font-weight:600;
      color:#e5e7eb;
    }
    .cv-submeta{
      font-size:.78rem;
      color:#9ca3af;
      margin-top:2px;
    }

    .tag-status{
      display:inline-flex;
      align-items:center;
      gap:.25rem;
      padding:3px 9px;
      border-radius:999px;
      font-size:.74rem;
      font-weight:600;
    }
    .tag-status--done{
      background:rgba(22,163,74,0.16);
      color:#bbf7d0;
      border:1px solid rgba(22,163,74,0.8);
    }
    .tag-status--pending{
      background:rgba(202,138,4,0.18);
      color:#facc15;
      border:1px solid rgba(202,138,4,0.85);
    }

    .progress-bar{
      width:90px;
      height:6px;
      border-radius:999px;
      background:#1e293b;
      overflow:hidden;
    }
    .progress-bar-fill{
      height:100%;
      border-radius:999px;
      background:linear-gradient(90deg,#4f46e5,#38bdf8);
    }
    .progress-label{
      margin-left:6px;
      font-size:.78rem;
      color:#e5e7eb;
    }

    .cv-actions{
      display:flex;
      justify-content:flex-end;
      gap:.75rem;
      font-size:.82rem;
    }
    .cv-link{
      color:#a5b4fc;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:.25rem;
    }
    .cv-link:hover{color:#c7d2fe;}
    .cv-link--muted{
      color:#4b5563;
      cursor:not-allowed;
    }

    .cv-empty{
      text-align:center;
      padding:40px 20px;
      background:rgba(15,23,42,0.96);
      border-radius:18px;
      border:1px solid rgba(30,64,175,0.65);
      box-shadow:0 18px 40px rgba(15,23,42,0.9);
    }
    .cv-empty-icon{
      font-size:2.4rem;
      color:#4b5563;
      margin-bottom:8px;
    }
    .cv-empty h3{
      margin:0 0 6px;
      font-size:1.1rem;
      color:#f9fafb;
    }
    .cv-empty p{
      margin:0 0 12px;
      font-size:.9rem;
      color:#9ca3af;
    }

    .cv-small-note{
      margin-top:8px;
      font-size:.78rem;
      color:#64748b;
    }
    .cv-small-note strong{color:#22c55e;}

    @media (max-width: 768px){
      .cv-header{
        flex-direction:column;
        align-items:flex-start;
      }
      .cv-actions{
        flex-direction:column;
        align-items:flex-end;
      }
      .cv-table th,
      .cv-table td{
        padding:8px 8px;
      }
    }
  </style>
{% endblock %}

{% block content %}
<main class="cv-dashboard">
  <div class="cv-dashboard-inner">

    <header class="cv-header">
      <div>
        <h1>Mes CV ‚Äî Tableau de bord</h1>
        <p class="cv-header-lead">
          Suis la progression de chaque CV, reprends l‚Äô√©dition en un clic et exporte un PDF
          <strong>pr√™t pour les candidatures internationales</strong>.
        </p>
      </div>

      <div class="cv-header-actions">
        <a href="{% url 'cv_generator:template_selection' %}" class="btn-main">
          <i class="fas fa-plus"></i>
          Cr√©er un nouveau CV
        </a>
        <a href="{% url 'billing:access' %}" class="btn-ghost">
          <i class="fas fa-rocket"></i>
          D√©bloquer tous les mod√®les & modules
        </a>
      </div>
    </header>

    <div class="cv-upsell-strip">
      <span class="emoji">üí°</span>
      <div>
        En combinant <strong>plusieurs CV adapt√©s par pays</strong> (Canada, Europe, USA, UK) avec les autres modules
        Immigration97 (lettres, visa, tests de langue), tu maximises tes chances de r√©ponse.
        <br>
        <a href="{% url 'billing:access' %}">Voir les acc√®s Pro & cr√©dits</a>
      </div>
    </div>

    {% if cvs %}
      <section class="cv-panel" aria-label="Liste de vos CV">
        <div class="cv-table-wrapper">
          <table class="cv-table">
            <thead>
              <tr>
                <th>Titre du CV / Profession</th>
                <th>Pays cibl√©</th>
                <th>Statut</th>
                <th>Progression</th>
                <th style="text-align:right;">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for cv in cvs %}
                <tr>
                  <td>
                    <div class="cv-main-title">
                      {{ cv.profession|default:"CV sans titre" }}
                    </div>
                    <div class="cv-submeta">
                      Modifi√© le&nbsp;: {{ cv.date_modification|date:"d M Y" }}
                    </div>
                  </td>

                  <td>
                    <span class="cv-submeta">
                      {{ cv.pays_cible|default:"Non sp√©cifi√©" }}
                    </span>
                  </td>

                  <td>
                    {% if cv.is_completed %}
                      <span class="tag-status tag-status--done">
                        <i class="fas fa-check-circle"></i>
                        Compl√©t√©
                      </span>
                    {% else %}
                      <span class="tag-status tag-status--pending">
                        <i class="fas fa-edit"></i>
                        En cours (√âtape {{ cv.current_step }}/3)
                      </span>
                    {% endif %}
                  </td>

                  <td>
                    {% with percentage=cv.get_completion_percentage %}
                      <div style="display:flex;align-items:center;">
                        <div class="progress-bar">
                          <div class="progress-bar-fill" style="width: {{ percentage }}%;"></div>
                        </div>
                        <span class="progress-label">{{ percentage }}%</span>
                      </div>
                    {% endwith %}
                  </td>

                  <td>
                    <div class="cv-actions">
                      <a href="{% url 'cv_generator:create_cv' cv_id=cv.id %}" class="cv-link">
                        <i class="fas fa-pencil-alt"></i>
                        √âditer
                      </a>

                      {% if cv.is_completed %}
                        <a href="{% url 'cv_generator:export_pdf' cv_id=cv.id %}" target="_blank" class="cv-link">
                          <i class="fas fa-download"></i>
                          PDF
                        </a>
                      {% else %}
                        <span class="cv-link cv-link--muted" title="Finalisez le CV pour exporter">
                          <i class="fas fa-download"></i>
                          PDF
                        </span>
                      {% endif %}
                    </div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <p class="cv-small-note">
          Conseil : vise au moins <strong>90&nbsp;% de compl√©tion</strong> par CV avant d‚Äôenvoyer aux recruteurs.
        </p>
      </section>
    {% else %}
      <section class="cv-empty" aria-label="Aucun CV cr√©√©">
        <div class="cv-empty-icon">
          <i class="fas fa-clipboard-list"></i>
        </div>
        <h3>Tu n‚Äôas pas encore cr√©√© de CV.</h3>
        <p>
          Commence avec un mod√®le optimis√© par Immigration97 pour les candidatures
          <strong>Canada, Europe, USA, UK</strong> et les dossiers d‚Äôimmigration.
        </p>
        <a href="{% url 'cv_generator:template_selection' %}" class="btn-main" style="margin-top:4px;">
          D√©marrer mon premier CV
        </a>
        <p class="cv-small-note">
          Tu peux ensuite ajouter des lettres de motivation, guides visa et pr√©paration aux tests de langue
          directement depuis ton espace Immigration97.
        </p>
      </section>
    {% endif %}

  </div>
</main>
{% endblock %}
