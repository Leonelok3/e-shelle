<!DOCTYPE html>
<html lang="fr">
<head>
  {% load static %}
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- ================= SEO ================= -->
  <title>{% block title %}Immigration97 — Immigration & Visa Premium{% endblock %}</title>

  <meta name="description"
        content="{% block meta_description %}
        Plateforme premium d’assistance immigration : visas, résidence permanente,
        tests de langue, CV IA et accompagnement international.
        {% endblock %}">

  <link rel="canonical" href="{{ request.build_absolute_uri }}">
  <meta name="robots" content="index, follow">
  <meta name="theme-color" content="#0b1220">

  <!-- ================= FAVICON ================= -->
  <link rel="icon" href="{% static 'img/LOGOIMM97.png' %}" type="image/png">

  <!-- ================= OPEN GRAPH ================= -->
  <meta property="og:site_name" content="Immigration97">
  <meta property="og:title"
        content="{% block og_title %}Immigration97 — Plateforme Immigration Premium{% endblock %}">
  <meta property="og:description"
        content="{% block og_description %}
        Visas, résidence permanente, tests de langue, CV IA et guides officiels.
        {% endblock %}">
  <meta property="og:type" content="website">
  <meta property="og:image" content="{% static 'img/LOGOIMM97.png' %}">

  <!-- ================= TWITTER ================= -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title"
        content="{% block twitter_title %}Immigration97{% endblock %}">
  <meta name="twitter:description"
        content="{% block twitter_description %}
        Votre plateforme premium d’immigration et de mobilité internationale.
        {% endblock %}">
  <meta name="twitter:image" content="{% static 'img/LOGOIMM97.png' %}">

  <!-- ================= CSS GLOBAL ================= -->
  {% if not is_pdf %}
    <link rel="stylesheet" href="{% static 'css/tokens.css' %}">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="stylesheet" href="{% static 'css/components.css' %}">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/mobile.css' %}">

    <!-- ✅ CSS Newsletter Global (scopé, safe) -->
    <link rel="stylesheet" href="{% static 'css/components/newsletter-global.css' %}">
  {% endif %}

  <!-- ================= CSS APP / PAGE ================= -->
  {% block extra_css %}{% endblock %}

  <!-- ================= adsence ================= -->
  <script async
  src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8153544065381730"
  crossorigin="anonymous">
</script>

</head>

<body class="app {% block body_class %}{% endblock %}">

<!-- ======================================================
     NAVBAR — DESIGN SYSTEM COMPLIANT
====================================================== -->
<header class="c-navbar">
  <div class="c-navbar__container">

    <!-- Brand -->
    <a href="/" class="c-navbar__brand" aria-label="Accueil Immigration97">
      <img src="{% static 'img/LOGOIMM97.png' %}" alt="Immigration97 Logo">
    </a>

    <!-- Toggle mobile -->
    <button class="c-navbar__toggle"
            aria-label="Ouvrir le menu"
            aria-expanded="false">
      ☰
    </button>

    <!-- Navigation -->
    <nav class="c-navbar__nav">
      <a href="/" class="c-nav-link">Accueil</a>
      <a href="/prep/" class="c-nav-link">Tests de langue</a>
      <a href="/visa-travail/" class="c-nav-link">Visa Travail</a>
      <a href="/visa-etudes/" class="c-nav-link">Visa Études</a>
      <a href="/residence-permanente/" class="c-nav-link">Résidence Permanente</a>

      {% if user.is_authenticated %}
        <a href="/profiles/" class="c-btn c-btn--outline">Mon espace</a>
        <a href="/logout/" class="c-btn c-btn--primary">
          Se déconnecter
        </a>
      {% else %}
        <a href="{% url 'authentification:login' %}" class="c-btn c-btn--outline">
          Se connecter
        </a>
        <a href="{% url 'billing:access' %}" class="c-btn c-btn--primary">
          Accès Premium
        </a>
      {% endif %}
    </nav>
  </div>
</header>

<!-- ======================================================
     MAIN CONTENT — WRAPPER GLOBAL STABLE
====================================================== -->
<main class="app-main {% block app_scope %}{% endblock %}">
  <div class="app-container">
    {% block content %}{% endblock %}
  </div>
</main>

<!-- ======================================================
     FOOTER — DESIGN SYSTEM COMPLIANT
====================================================== -->
<footer class="c-footer">
  <div class="c-footer__container">

    <div>
      <img src="{% static 'img/LOGOIMM97.png' %}" alt="Immigration97" width="140" loading="lazy">
      <p>
        Plateforme premium d’assistance visa, immigration
        et carrière internationale.
      </p>
    </div>

    <div>
      <h4>Modules</h4>
      <ul>
        <li><a href="/visa-photo/">Visa Photo</a></li>
        <li><a href="/cv-generator/">CV IA</a></li>
        <li><a href="/prep/">Tests de langue</a></li>
        <li><a href="/residence-permanente/">Résidence Permanente</a></li>
      </ul>
    </div>

    <div>
      <h4>Aide</h4>
      <ul>
        <li><a href="/faq/">FAQ</a></li>
        <li><a href="/guides/">Guides</a></li>
        <li><a href="/contact/">Support</a></li>
      </ul>
    </div>

    <div>
      <h4>Accès Premium</h4>
      <p>Débloquez toutes les fonctionnalités Immigration97.</p>
      <a href="{% url 'billing:access' %}" class="c-btn c-btn--primary">
        Activer mon accès
      </a>
    </div>

  </div>

  <div class="c-footer__bottom">
    © {% now "Y" %} Immigration97 — Tous droits réservés.
  </div>
</footer>

<!-- ======================================================
     ✅ NEWSLETTER GLOBAL (visible partout)
     - Style via newsletter-global.css (scopé .nl-global)
     - Apparition après un scroll léger (non agressif)
     - Fermeture mémorisée (localStorage)
     - Animation sortie (classe is-closing)
====================================================== -->
{% if not is_pdf %}
<div class="nl-global is-hidden" id="nl-global" aria-hidden="true">
  <div class="nl-global__card" role="region" aria-label="Newsletter Immigration97">
    <div class="nl-global__top">
      <div class="nl-global__badge">
        <span class="nl-global__dot"></span>
        Alertes immigration officielles
      </div>
      <button class="nl-global__close" id="nl-close" type="button" aria-label="Fermer">✕</button>
    </div>

    <div class="nl-global__body">
      <div>
        <h3 class="nl-global__title">
          Reçois les <span>ouvertures & alertes</span> (USA • Canada • Europe)
        </h3>
        <p class="nl-global__text">
          DV Lottery, dates, quotas, lois, opportunités : une alerte claire, rapide et vérifiée.
        </p>
        <div class="nl-global__hint">
          ✅ Gratuit • Tu peux te désinscrire à tout moment.
        </div>
      </div>

      <form class="nl-global__form" method="post" action="{% url 'actualite:newsletter_subscribe' %}">
        {% csrf_token %}
        <input class="nl-global__input"
               type="email"
               name="email"
               placeholder="Ton email (ex: nom@gmail.com)"
               required>

        <!-- utile pour ton modèle NewsletterSubscriber -->
        <input type="hidden" name="source_page" value="{% block newsletter_source %}global{% endblock %}">

        <!-- On garde ton design system -->
        <button class="c-btn c-btn--primary nl-global__btn" type="submit">
          M’inscrire
        </button>
      </form>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const wrap = document.getElementById("nl-global");
  const closeBtn = document.getElementById("nl-close");
  if (!wrap || !closeBtn) return;

  const KEY = "imm97_newsletter_closed_v1";

  // Déjà fermé avant => ne pas afficher
  if (localStorage.getItem(KEY) === "1") {
    wrap.classList.add("is-hidden");
    wrap.setAttribute("aria-hidden", "true");
    return;
  }

  // Montre après un scroll léger (UX premium)
  let shown = false;
  const show = () => {
    wrap.classList.remove("is-hidden");
    wrap.setAttribute("aria-hidden", "false");
  };

  window.addEventListener("scroll", function () {
    if (shown) return;
    const sc = window.scrollY || document.documentElement.scrollTop || 0;
    if (sc > 220) {
      shown = true;
      show();
    }
  }, { passive: true });

  closeBtn.addEventListener("click", function () {
    localStorage.setItem(KEY, "1");
    wrap.classList.add("is-closing");
    setTimeout(() => {
      wrap.classList.add("is-hidden");
      wrap.setAttribute("aria-hidden", "true");
    }, 360);
  });
});
</script>
{% endif %}

<!-- ================= JS GLOBAL ================= -->
<script src="{% static 'js/main.js' %}" defer></script>

<!-- ================= JS APP / PAGE ================= -->
{% block extra_js %}{% endblock %}

</body>
</html>
