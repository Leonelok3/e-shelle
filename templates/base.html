<!DOCTYPE html>
<html lang="fr">
<head>
  {% load static %} 

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  {# Title & Meta (Optimisé SEO pour le module CV) #}
  <title>{% block title %}CV Builder · Immigration97{% endblock %}</title>
  <meta name="description" content="{% block meta_description %}Générez votre CV optimisé par IA, conforme aux standards RH locaux (Canada, Europe, USA).{% endblock %}">

  {# Canonical & Robots #}
  <link rel="canonical" href="{{ request.build_absolute_uri }}">
  <meta name="robots" content="index, follow">

  {# CSRF token exposé pour JS (Bonne Pratique) #}
  <meta name="csrf-token" content="{{ csrf_token }}">

  {# ------------------------------------------------------------- #}
  {# OPTIMISATION 1 : Stylesheets locaux et Tailwind pour l'uniformité #}
  {# ------------------------------------------------------------- #}
  
  {# Tailwind CSS CDN (Doit être chargé en premier pour que vos sous-templates fonctionnent) #}
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  
  {# Preload et Stylesheets locaux #}
  <link rel="preload" href="{% static 'css/tokens.css' %}" as="style">
  <link rel="preload" href="{% static 'css/main.css' %}" as="style">
  <link rel="stylesheet" href="{% static 'css/tokens.css' %}">
  <link rel="stylesheet" href="{% static 'css/main.css' %}">
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
  <meta name="description" content="E-SHELLE - Ton Futur sans Limite">


  {# Styles d'accessibilité #}
  <style>
    .skip-link {
      position: absolute;
      left: -999px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
    .skip-link:focus {
      left: 1rem;
      top: 1rem;
      width: auto;
      height: auto;
      background: #003366;
      color: #fff;
      padding: 0.5rem 0.75rem;
      z-index: 9999;
      border-radius: 4px;
    }
  </style>

  {# Extra head content injection #}
  {% block head_extra %}{% endblock %}

</head>
<body class="app">

  <a class="skip-link" href="#main-content">Aller au contenu</a>

  <header class="topbar" role="banner">
    <div class="container row">
        {# CORRECTION CRITIQUE: Utilise l'URL 'index' qui est la base non protégée du module CV #}
      <a href="{% url 'cv_generator:index' %}" class="brand">Immigration97</a> 
      <nav class="nav" role="navigation" aria-label="Menu principal">
        {# Lien vers le tableau de bord du CV #}
        <a class="chip" href="{% url 'cv_generator:cv_list' %}">Mon CV</a> 
        {# Lien existant pour les autres modules #}
        <a class="chip active" href="{% url 'photos:index' %}">Visa Photo</a>
      </nav>
    </div>
  </header>

  <main id="main-content" class="container page" role="main">
    {% block content %}{% endblock %}
  </main>

  <footer class="footer" role="contentinfo">
    <div class="container">
      <div class="foot-grid">
        <div>
          <div class="brand">Immigration97</div>
          <p class="muted">Outil rapide pour générer des photos conformes aux demandes de visa.</p>
        </div>
        <div>
          <div class="foot-title">Confiance</div>
          <ul class="foot-list">
            <li>Vie privée : jamais de revente d’images</li>
            <li>Suppression automatique possible (24&nbsp;h)</li>
            <li>Contrôles techniques à chaque étape</li>
          </ul>
        </div>
        <div>
          <div class="foot-title">Aide</div>
          <ul class="foot-list">
            <li>FAQ en bas de page</li>
            <li>Support sous 24&nbsp;h ouvrées</li>
          </ul>
        </div>
        <div>
          <div class="foot-title">Autre Module</div>
          <ul class="foot-list">
            <li><a href="{% url 'cv_generator:index' %}">Générateur de CV</a></li>
            <li><a href="{% url 'photos:index' %}">Visa Photo</a></li>
          </ul>
        </div>
      </div>
      <div class="foot-bottom muted">© {% now "Y" %} Immigration97 — Tous droits réservés.</div>
    </div>
  </footer>

  <noscript>
    <div style="padding:1rem;background:#fff3cd;color:#856404;text-align:center;">
      JavaScript est nécessaire pour une expérience complète sur ce site. Activez JavaScript pour utiliser tous les outils.
    </div>
  </noscript>

  {# ------------------------------------------------------------- #}
  {# OPTIMISATION 2 : Scripts JS en fin de BODY pour le chargement rapide #}
  {# ------------------------------------------------------------- #}
  
  {# JS Scripts en defer (déjà bien fait, conservé) #}
  <script src="{% static 'js/csrf.js' %}" defer></script>
  <script src="{% static 'js/fetch_helpers.js' %}" defer></script>
  <script src="{% static 'js/i18n.js' %}" defer></script>
  <script src="{% static 'js/main.js' %}" defer></script>

  {# Font Awesome : Déplacé ici pour ne pas bloquer le rendu de la page (si vous l'utilisez) #}
  <script src="https://kit.fontawesome.com/9d6b1b0b3f.js" crossorigin="anonymous" defer></script>

  {% block body_end %}{% endblock %}
</body>
</html>