FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\agents\__init__.py
LINE: 3
import json

from ai_engine.agents.co_agent import generate_co_content
from ai_engine.agents.ce_agent import generate_ce_content
from ai_engine.agents.eo_agent import generate_eo_content
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\agents\__init__.py
LINE: 4

from ai_engine.agents.co_agent import generate_co_content
from ai_engine.agents.ce_agent import generate_ce_content
from ai_engine.agents.eo_agent import generate_eo_content
from ai_engine.agents.ee_agent import generate_ee_content
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\agents\__init__.py
LINE: 5
from ai_engine.agents.co_agent import generate_co_content
from ai_engine.agents.ce_agent import generate_ce_content
from ai_engine.agents.eo_agent import generate_eo_content
from ai_engine.agents.ee_agent import generate_ee_content

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\agents\__init__.py
LINE: 6
from ai_engine.agents.ce_agent import generate_ce_content
from ai_engine.agents.eo_agent import generate_eo_content
from ai_engine.agents.ee_agent import generate_ee_content


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\agents\__init__.py
LINE: 74
        return self._generator(language=language, level=level)

    def generate_lesson(self, language: str = "fr", level: str = "A1", **kwargs):
        raw = self._generator(language=language, level=level)
        return _to_legacy_result(raw, self._skill)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\agents\ce_agent.py
LINE: 5
from json import JSONDecodeError

from ai_engine.prompts.ce_prompt import CE_SYSTEM_PROMPT
from ai_engine.services.llm_service import call_llm
from ai_engine.validators.ce_validator import validate_ce_json
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\agents\ce_agent.py
LINE: 6

from ai_engine.prompts.ce_prompt import CE_SYSTEM_PROMPT
from ai_engine.services.llm_service import call_llm
from ai_engine.validators.ce_validator import validate_ce_json

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\agents\ce_agent.py
LINE: 7
from ai_engine.prompts.ce_prompt import CE_SYSTEM_PROMPT
from ai_engine.services.llm_service import call_llm
from ai_engine.validators.ce_validator import validate_ce_json


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\agents\co_agent.py
LINE: 6
from json import JSONDecodeError

from ai_engine.prompts.co_prompt import CO_SYSTEM_PROMPT
from ai_engine.services.llm_service import call_llm
from ai_engine.validators.co_validator import validate_co_json
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\agents\co_agent.py
LINE: 7

from ai_engine.prompts.co_prompt import CO_SYSTEM_PROMPT
from ai_engine.services.llm_service import call_llm
from ai_engine.validators.co_validator import validate_co_json

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\agents\co_agent.py
LINE: 8
from ai_engine.prompts.co_prompt import CO_SYSTEM_PROMPT
from ai_engine.services.llm_service import call_llm
from ai_engine.validators.co_validator import validate_co_json

logger = logging.getLogger(__name__)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\agents\ee_agent.py
LINE: 5
from json import JSONDecodeError

from ai_engine.prompts.ee_prompt import EE_SYSTEM_PROMPT
from ai_engine.services.llm_service import call_llm
from ai_engine.validators.ee_validator import validate_ee_json
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\agents\ee_agent.py
LINE: 6

from ai_engine.prompts.ee_prompt import EE_SYSTEM_PROMPT
from ai_engine.services.llm_service import call_llm
from ai_engine.validators.ee_validator import validate_ee_json

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\agents\ee_agent.py
LINE: 7
from ai_engine.prompts.ee_prompt import EE_SYSTEM_PROMPT
from ai_engine.services.llm_service import call_llm
from ai_engine.validators.ee_validator import validate_ee_json


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\agents\eo_agent.py
LINE: 5
from json import JSONDecodeError

from ai_engine.prompts.eo_prompt import EO_SYSTEM_PROMPT
from ai_engine.services.llm_service import call_llm
from ai_engine.validators.eo_validator import validate_eo_json
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\agents\eo_agent.py
LINE: 6

from ai_engine.prompts.eo_prompt import EO_SYSTEM_PROMPT
from ai_engine.services.llm_service import call_llm
from ai_engine.validators.eo_validator import validate_eo_json

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\agents\eo_agent.py
LINE: 7
from ai_engine.prompts.eo_prompt import EO_SYSTEM_PROMPT
from ai_engine.services.llm_service import call_llm
from ai_engine.validators.eo_validator import validate_eo_json


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\management\commands\generate_co_content.py
LINE: 3
import time
from django.core.management.base import BaseCommand
from ai_engine.agents.co_agent import generate_co_content
from ai_engine.services.tts_service import generate_audio
from ai_engine.services.insertion_service import insert_co_content
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\management\commands\generate_co_content.py
LINE: 4
from django.core.management.base import BaseCommand
from ai_engine.agents.co_agent import generate_co_content
from ai_engine.services.tts_service import generate_audio
from ai_engine.services.insertion_service import insert_co_content

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\management\commands\generate_co_content.py
LINE: 5
from ai_engine.agents.co_agent import generate_co_content
from ai_engine.services.tts_service import generate_audio
from ai_engine.services.insertion_service import insert_co_content

LEVELS = ["A1", "A2", "B1", "B2", "C1", "C2"]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\management\commands\generate_co_content.py
LINE: 13

    def add_arguments(self, parser):
        parser.add_argument("--exam_id", type=int, required=True)
        parser.add_argument("--language", type=str, required=True)
        parser.add_argument("--lessons", type=int, default=1)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\management\commands\generate_co_content.py
LINE: 15
        parser.add_argument("--exam_id", type=int, required=True)
        parser.add_argument("--language", type=str, required=True)
        parser.add_argument("--lessons", type=int, default=1)

    def handle(self, *args, **options):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\management\commands\generate_co_content.py
LINE: 19
    def handle(self, *args, **options):
        for level in LEVELS:
            for _ in range(options["lessons"]):
                data = generate_co_content(options["language"], level)
                audio_path = generate_audio(data["audio_script"], options["language"])
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\management\commands\generate_co_content.py
LINE: 23
                audio_path = generate_audio(data["audio_script"], options["language"])
                insert_co_content(
                    options["exam_id"],
                    level,
                    options["language"],
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\prompts\co_prompt.py
LINE: 3
CO_SYSTEM_PROMPT = """
Tu es un expert officiel en évaluation linguistique basé sur le CECR (A1 à C2),
spécialisé dans la COMPRÉHENSION ORALE pour des examens de langue.

OBJECTIF :
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\prompts\co_prompt.py
LINE: 19
- AUCUNE explication
- Le niveau CECR doit être respecté avec rigueur
- Le contenu doit être réaliste et proche d’un examen officiel

FORMAT JSON OBLIGATOIRE :
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\prompts\co_prompt.py
LINE: 24

{
  "audio_script": "Texte naturel destiné à être lu à voix haute (style examen)",
  "questions": [
    {
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\ce_insertion_service.py
LINE: 1

from ai_engine.services.skill_insertion_base import insert_standard_payload


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\ee_insertion_service.py
LINE: 1

from ai_engine.services.skill_insertion_base import insert_standard_payload


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\eo_insertion_service.py
LINE: 1

from ai_engine.services.skill_insertion_base import insert_standard_payload


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\generation_orchestrator.py
LINE: 3
from typing import Callable, Any

from ai_engine.agents.co_agent import generate_co_content
from ai_engine.agents.ce_agent import generate_ce_content
from ai_engine.agents.eo_agent import generate_eo_content
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\generation_orchestrator.py
LINE: 4

from ai_engine.agents.co_agent import generate_co_content
from ai_engine.agents.ce_agent import generate_ce_content
from ai_engine.agents.eo_agent import generate_eo_content
from ai_engine.agents.ee_agent import generate_ee_content
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\generation_orchestrator.py
LINE: 5
from ai_engine.agents.co_agent import generate_co_content
from ai_engine.agents.ce_agent import generate_ce_content
from ai_engine.agents.eo_agent import generate_eo_content
from ai_engine.agents.ee_agent import generate_ee_content

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\generation_orchestrator.py
LINE: 6
from ai_engine.agents.ce_agent import generate_ce_content
from ai_engine.agents.eo_agent import generate_eo_content
from ai_engine.agents.ee_agent import generate_ee_content

from ai_engine.services.ce_insertion_service import insert_ce_content
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\generation_orchestrator.py
LINE: 8
from ai_engine.agents.ee_agent import generate_ee_content

from ai_engine.services.ce_insertion_service import insert_ce_content
from ai_engine.services.eo_insertion_service import insert_eo_content
from ai_engine.services.ee_insertion_service import insert_ee_content
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\generation_orchestrator.py
LINE: 9

from ai_engine.services.ce_insertion_service import insert_ce_content
from ai_engine.services.eo_insertion_service import insert_eo_content
from ai_engine.services.ee_insertion_service import insert_ee_content
from ai_engine.services.skill_insertion_base import insert_standard_payload
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\generation_orchestrator.py
LINE: 10
from ai_engine.services.ce_insertion_service import insert_ce_content
from ai_engine.services.eo_insertion_service import insert_eo_content
from ai_engine.services.ee_insertion_service import insert_ee_content
from ai_engine.services.skill_insertion_base import insert_standard_payload
from ai_engine.services.content_normalizer import normalize_agent_payload
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\generation_orchestrator.py
LINE: 11
from ai_engine.services.eo_insertion_service import insert_eo_content
from ai_engine.services.ee_insertion_service import insert_ee_content
from ai_engine.services.skill_insertion_base import insert_standard_payload
from ai_engine.services.content_normalizer import normalize_agent_payload

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\generation_orchestrator.py
LINE: 12
from ai_engine.services.ee_insertion_service import insert_ee_content
from ai_engine.services.skill_insertion_base import insert_standard_payload
from ai_engine.services.content_normalizer import normalize_agent_payload


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\insertion_service.py
LINE: 4
from json import JSONDecodeError

from django.db import transaction
from preparation_tests.models import CourseLesson, CourseExercise, Asset, Exam

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\insertion_service.py
LINE: 5

from django.db import transaction
from preparation_tests.models import CourseLesson, CourseExercise, Asset, Exam


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\insertion_service.py
LINE: 8


def insert_co_content(exam_id, level, language, co_data, audio_path):
    if not exam_id:
        raise ValueError("exam_id is required.")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\insertion_service.py
LINE: 9

def insert_co_content(exam_id, level, language, co_data, audio_path):
    if not exam_id:
        raise ValueError("exam_id is required.")
    if not audio_path:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\insertion_service.py
LINE: 10
def insert_co_content(exam_id, level, language, co_data, audio_path):
    if not exam_id:
        raise ValueError("exam_id is required.")
    if not audio_path:
        raise ValueError("audio_path is required.")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\insertion_service.py
LINE: 35
    lvl = (level or "").strip().upper()

    with transaction.atomic():
        exam = Exam.objects.get(id=exam_id)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\insertion_service.py
LINE: 36

    with transaction.atomic():
        exam = Exam.objects.get(id=exam_id)

        asset = Asset.objects.create(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\insertion_service.py
LINE: 43
        )

        lesson = CourseLesson.objects.create(
            exam=exam,
            section="co",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\insertion_service.py
LINE: 44

        lesson = CourseLesson.objects.create(
            exam=exam,
            section="co",
            level=lvl,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\insertion_service.py
LINE: 51
        )

        exercises = []
        for i, q in enumerate(questions, start=1):
            if not isinstance(q, dict):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\insertion_service.py
LINE: 67
                raise ValueError(f"Question #{i}: 'correct_answer' is required.")

            exercises.append(
                CourseExercise(
                    lesson=lesson,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\insertion_service.py
LINE: 68

            exercises.append(
                CourseExercise(
                    lesson=lesson,
                    question=question,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\insertion_service.py
LINE: 69
            exercises.append(
                CourseExercise(
                    lesson=lesson,
                    question=question,
                    choices=choices,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\insertion_service.py
LINE: 77
            )

        CourseExercise.objects.bulk_create(exercises)
        return lesson
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\insertion_service.py
LINE: 78

        CourseExercise.objects.bulk_create(exercises)
        return lesson

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\services\tts_service.py
LINE: 31
        _tts_cache[lang] = TTS(
            model_name=TTS_MODELS[lang],
            progress_bar=False,
            gpu=False,
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_ce_agent.py
LINE: 5
from django.test import SimpleTestCase

from ai_engine.agents.ce_agent import generate_ce_content


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_ce_agent.py
LINE: 9

class CEAgentTests(SimpleTestCase):
    @patch("ai_engine.agents.ce_agent.validate_ce_json")
    @patch("ai_engine.agents.ce_agent.call_llm")
    def test_generate_ce_content_success_first_try(self, call_llm_mock, validate_mock):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_ce_agent.py
LINE: 10
class CEAgentTests(SimpleTestCase):
    @patch("ai_engine.agents.ce_agent.validate_ce_json")
    @patch("ai_engine.agents.ce_agent.call_llm")
    def test_generate_ce_content_success_first_try(self, call_llm_mock, validate_mock):
        call_llm_mock.return_value = """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_co_agent.py
LINE: 4
from unittest.mock import patch

from ai_engine.agents.co_agent import generate_co_content


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_co_agent.py
LINE: 8

class COAgentTests(SimpleTestCase):
    @patch("ai_engine.agents.co_agent.validate_co_json")
    @patch("ai_engine.agents.co_agent.call_llm")
    def test_generate_co_content_success_first_try(self, call_llm_mock, validate_mock):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_co_agent.py
LINE: 9
class COAgentTests(SimpleTestCase):
    @patch("ai_engine.agents.co_agent.validate_co_json")
    @patch("ai_engine.agents.co_agent.call_llm")
    def test_generate_co_content_success_first_try(self, call_llm_mock, validate_mock):
        call_llm_mock.return_value = """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_ee_agent.py
LINE: 5
from django.test import SimpleTestCase

from ai_engine.agents.ee_agent import generate_ee_content


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_ee_agent.py
LINE: 9

class EEAgentTests(SimpleTestCase):
    @patch("ai_engine.agents.ee_agent.validate_ee_json")
    @patch("ai_engine.agents.ee_agent.call_llm")
    def test_generate_ee_content_success_first_try(self, call_llm_mock, validate_mock):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_ee_agent.py
LINE: 10
class EEAgentTests(SimpleTestCase):
    @patch("ai_engine.agents.ee_agent.validate_ee_json")
    @patch("ai_engine.agents.ee_agent.call_llm")
    def test_generate_ee_content_success_first_try(self, call_llm_mock, validate_mock):
        call_llm_mock.return_value = """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_eo_agent.py
LINE: 5
from django.test import SimpleTestCase

from ai_engine.agents.eo_agent import generate_eo_content


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_eo_agent.py
LINE: 9

class EOAgentTests(SimpleTestCase):
    @patch("ai_engine.agents.eo_agent.validate_eo_json")
    @patch("ai_engine.agents.eo_agent.call_llm")
    def test_generate_eo_content_success_first_try(self, call_llm_mock, validate_mock):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_eo_agent.py
LINE: 10
class EOAgentTests(SimpleTestCase):
    @patch("ai_engine.agents.eo_agent.validate_eo_json")
    @patch("ai_engine.agents.eo_agent.call_llm")
    def test_generate_eo_content_success_first_try(self, call_llm_mock, validate_mock):
        call_llm_mock.return_value = """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_generate_api.py
LINE: 8

class GenerateApiTests(SimpleTestCase):
    @patch("ai_engine.api_views.generate_and_insert")
    def test_generate_api_success(self, orchestrator_mock):
        orchestrator_mock.return_value = {"inserted": False, "skill": "CE"}
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_generation_orchestrator.py
LINE: 4
from django.test import SimpleTestCase

from ai_engine.services.generation_orchestrator import generate_and_insert


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_generation_orchestrator.py
LINE: 8

class GenerationOrchestratorTests(SimpleTestCase):
    @patch("ai_engine.services.generation_orchestrator.generate_ce_content")
    def test_generate_and_insert_ce(self, gen_mock):
        gen_mock.return_value = {
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 6

from django.test import SimpleTestCase
from ai_engine.services.insertion_service import insert_co_content


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 10

class InsertCOContentTests(SimpleTestCase):
    @patch("ai_engine.services.insertion_service.transaction.atomic", return_value=nullcontext())
    def test_invalid_json_string_raises_explicit_error(self, _atomic):
        bad_json = '{"audio_script":"Bonjour", "questions":[}'  # JSON invalide
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 16
        with self.assertRaises(ValueError) as ctx:
            insert_co_content(
                exam_id=1,
                level="A1",
                language="fr",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 25
        self.assertIn("Invalid JSON for co_data", str(ctx.exception))

    @patch("ai_engine.services.insertion_service.transaction.atomic", return_value=nullcontext())
    @patch("ai_engine.services.insertion_service.CourseExercise")
    @patch("ai_engine.services.insertion_service.CourseLesson")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 26

    @patch("ai_engine.services.insertion_service.transaction.atomic", return_value=nullcontext())
    @patch("ai_engine.services.insertion_service.CourseExercise")
    @patch("ai_engine.services.insertion_service.CourseLesson")
    @patch("ai_engine.services.insertion_service.Asset")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 27
    @patch("ai_engine.services.insertion_service.transaction.atomic", return_value=nullcontext())
    @patch("ai_engine.services.insertion_service.CourseExercise")
    @patch("ai_engine.services.insertion_service.CourseLesson")
    @patch("ai_engine.services.insertion_service.Asset")
    @patch("ai_engine.services.insertion_service.Exam")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 28
    @patch("ai_engine.services.insertion_service.CourseExercise")
    @patch("ai_engine.services.insertion_service.CourseLesson")
    @patch("ai_engine.services.insertion_service.Asset")
    @patch("ai_engine.services.insertion_service.Exam")
    def test_valid_json_string_creates_lesson_and_exercises(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 29
    @patch("ai_engine.services.insertion_service.CourseLesson")
    @patch("ai_engine.services.insertion_service.Asset")
    @patch("ai_engine.services.insertion_service.Exam")
    def test_valid_json_string_creates_lesson_and_exercises(
        self, ExamMock, AssetMock, CourseLessonMock, CourseExerciseMock, _atomic
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 30
    @patch("ai_engine.services.insertion_service.Asset")
    @patch("ai_engine.services.insertion_service.Exam")
    def test_valid_json_string_creates_lesson_and_exercises(
        self, ExamMock, AssetMock, CourseLessonMock, CourseExerciseMock, _atomic
    ):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 31
    @patch("ai_engine.services.insertion_service.Exam")
    def test_valid_json_string_creates_lesson_and_exercises(
        self, ExamMock, AssetMock, CourseLessonMock, CourseExerciseMock, _atomic
    ):
        ExamMock.objects.get.return_value = SimpleNamespace(id=1)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 33
        self, ExamMock, AssetMock, CourseLessonMock, CourseExerciseMock, _atomic
    ):
        ExamMock.objects.get.return_value = SimpleNamespace(id=1)
        AssetMock.objects.create.return_value = SimpleNamespace(id=10)
        lesson_obj = SimpleNamespace(id=20)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 35
        ExamMock.objects.get.return_value = SimpleNamespace(id=1)
        AssetMock.objects.create.return_value = SimpleNamespace(id=10)
        lesson_obj = SimpleNamespace(id=20)
        CourseLessonMock.objects.create.return_value = lesson_obj
        CourseExerciseMock.side_effect = lambda **kwargs: SimpleNamespace(**kwargs)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 36
        AssetMock.objects.create.return_value = SimpleNamespace(id=10)
        lesson_obj = SimpleNamespace(id=20)
        CourseLessonMock.objects.create.return_value = lesson_obj
        CourseExerciseMock.side_effect = lambda **kwargs: SimpleNamespace(**kwargs)
        CourseExerciseMock.objects = MagicMock()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 37
        lesson_obj = SimpleNamespace(id=20)
        CourseLessonMock.objects.create.return_value = lesson_obj
        CourseExerciseMock.side_effect = lambda **kwargs: SimpleNamespace(**kwargs)
        CourseExerciseMock.objects = MagicMock()

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 38
        CourseLessonMock.objects.create.return_value = lesson_obj
        CourseExerciseMock.side_effect = lambda **kwargs: SimpleNamespace(**kwargs)
        CourseExerciseMock.objects = MagicMock()

        good_json = """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 51

        result = insert_co_content(
            exam_id=1,
            level="a1",
            language="FR",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 58
        )

        self.assertEqual(result, lesson_obj)
        ExamMock.objects.get.assert_called_once_with(id=1)
        AssetMock.objects.create.assert_called_once()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 59

        self.assertEqual(result, lesson_obj)
        ExamMock.objects.get.assert_called_once_with(id=1)
        AssetMock.objects.create.assert_called_once()
        CourseLessonMock.objects.create.assert_called_once()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 61
        ExamMock.objects.get.assert_called_once_with(id=1)
        AssetMock.objects.create.assert_called_once()
        CourseLessonMock.objects.create.assert_called_once()
        CourseExerciseMock.objects.bulk_create.assert_called_once()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_insertion_service.py
LINE: 62
        AssetMock.objects.create.assert_called_once()
        CourseLessonMock.objects.create.assert_called_once()
        CourseExerciseMock.objects.bulk_create.assert_called_once()

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_tts_service.py
LINE: 7
from django.test import SimpleTestCase, override_settings

from ai_engine.services import tts_service


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_tts_service.py
LINE: 24
        self.assertEqual(str(ctx.exception), "Text is empty.")

    @patch("ai_engine.services.tts_service.uuid.uuid4", return_value="fixed-id")
    def test_generate_audio_calls_tts_and_returns_relative_path(self, _uuid_mock):
        fake_tts = Mock()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\tests\test_tts_service.py
LINE: 29
        with tempfile.TemporaryDirectory() as tmpdir:
            with override_settings(MEDIA_ROOT=tmpdir):
                with patch("ai_engine.services.tts_service.get_tts", return_value=fake_tts) as get_tts_mock:
                    result = tts_service.generate_audio("  Bonjour test  ", "FR")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\api_views.py
LINE: 8
from django.views.decorators.csrf import csrf_exempt

from ai_engine.services.generation_orchestrator import generate_and_insert


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\api_views.py
LINE: 18
                "ok": True,
                "message": "Use POST with JSON body: skill, language, level.",
                "example": {"skill": "CE", "language": "fr", "level": "A1"},
            },
            status=200,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\apps.py
LINE: 6
class AiEngineConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'ai_engine'

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\legacy_agents.py
LINE: 23
        self.model = model or "default"

    def generate_lesson(self, level: str, skill: str, topic: str) -> AgentResult:
        """Return a dict with lesson content (title, html, exercises).

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\legacy_agents.py
LINE: 24

    def generate_lesson(self, level: str, skill: str, topic: str) -> AgentResult:
        """Return a dict with lesson content (title, html, exercises).

        This implementation is a local deterministic stub for tests.
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\legacy_agents.py
LINE: 31
        title = f"{level} — {skill} — {topic} (exemple)"
        html = f"<h1>{title}</h1><p>Contenu pédagogique généré pour {level}.</p>"
        exercises = [
            {"question": "Que veut dire ...?", "choices": ["A", "B", "C"], "answer": "A"}
        ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\legacy_agents.py
LINE: 35
        ]

        return AgentResult(success=True, data={"title": title, "html": html, "exercises": exercises})


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\ai_engine\urls.py
LINE: 3
from django.urls import path

from ai_engine.api_views import generate_content_api

urlpatterns = [
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\management\commands\test_complete_tx.py
LINE: 7
from django.contrib.auth import get_user_model

from billing.models import Transaction, SubscriptionPlan

User = get_user_model()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\management\commands\test_complete_tx.py
LINE: 12

class Command(BaseCommand):
    help = "Crée une transaction factice et appelle Transaction.complete() pour tester la création d'abonnement/commission."

    def add_arguments(self, parser):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\management\commands\test_complete_tx.py
LINE: 34
            return

        tx = Transaction.objects.create(
            user=user,
            plan=plan,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\management\commands\test_complete_tx.py
LINE: 41
            type='CREDIT',
            status='PENDING',
            description='Transaction de test via management command',
            external_transaction_id=f"TEST-{timezone.now().strftime('%Y%m%d%H%M%S')}"
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\management\commands\test_complete_tx.py
LINE: 42
            status='PENDING',
            description='Transaction de test via management command',
            external_transaction_id=f"TEST-{timezone.now().strftime('%Y%m%d%H%M%S')}"
        )
        self.stdout.write(self.style.SUCCESS(f"Transaction créée id={tx.id}, status={tx.status}"))
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\management\commands\test_complete_tx.py
LINE: 44
            external_transaction_id=f"TEST-{timezone.now().strftime('%Y%m%d%H%M%S')}"
        )
        self.stdout.write(self.style.SUCCESS(f"Transaction créée id={tx.id}, status={tx.status}"))

        # Appel de la méthode complete()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\management\commands\test_complete_tx.py
LINE: 49
        tx.complete()
        tx.refresh_from_db()
        self.stdout.write(self.style.SUCCESS(f"Transaction id={tx.id} après complete() => status={tx.status}"))
        if tx.related_subscription:
            self.stdout.write(self.style.SUCCESS(f"Subscription créée id={tx.related_subscription.id} expires_at={tx.related_subscription.expires_at}"))
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0001_initial.py
LINE: 99
        ),
        migrations.CreateModel(
            name='Transaction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0001_initial.py
LINE: 108
                ('payment_method', models.CharField(blank=True, choices=[('MOBILE_MONEY', 'Mobile Money'), ('CARD', 'Carte bancaire'), ('CODE', 'Code prépayé'), ('MANUAL', 'Manuel')], max_length=20, null=True)),
                ('description', models.CharField(blank=True, max_length=255)),
                ('external_transaction_id', models.CharField(blank=True, max_length=255, null=True)),
                ('metadata', models.JSONField(blank=True, default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0001_initial.py
LINE: 113
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('plan', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='billing.subscriptionplan')),
                ('referred_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='referred_transactions', to='billing.affiliate', verbose_name='Transaction via affilié')),
                ('related_code', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='billing.creditcode')),
                ('related_subscription', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='billing.subscription')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0001_initial.py
LINE: 114
                ('plan', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='billing.subscriptionplan')),
                ('referred_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='referred_transactions', to='billing.affiliate', verbose_name='Transaction via affilié')),
                ('related_code', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='billing.creditcode')),
                ('related_subscription', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='billing.subscription')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='transactions', to=settings.AUTH_USER_MODEL)),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0001_initial.py
LINE: 115
                ('referred_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='referred_transactions', to='billing.affiliate', verbose_name='Transaction via affilié')),
                ('related_code', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='billing.creditcode')),
                ('related_subscription', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='billing.subscription')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='transactions', to=settings.AUTH_USER_MODEL)),
            ],
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0001_initial.py
LINE: 116
                ('related_code', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='billing.creditcode')),
                ('related_subscription', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='billing.subscription')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='transactions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0001_initial.py
LINE: 119
            ],
            options={
                'verbose_name': 'Transaction',
                'verbose_name_plural': 'Transactions',
                'ordering': ['-created_at'],
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0001_initial.py
LINE: 120
            options={
                'verbose_name': 'Transaction',
                'verbose_name_plural': 'Transactions',
                'ordering': ['-created_at'],
            },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0001_initial.py
LINE: 136
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('affiliate', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='commissions', to='billing.affiliate', verbose_name='Affilié')),
                ('transaction', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='commissions', to='billing.transaction', verbose_name='Transaction')),
            ],
            options={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0002_alter_affiliate_total_earned_alter_commission_amount_and_more.py
LINE: 38
        ),
        migrations.AlterField(
            model_name='transaction',
            name='amount',
            field=models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))]),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0002_alter_affiliate_total_earned_alter_commission_amount_and_more.py
LINE: 43
        ),
        migrations.AlterField(
            model_name='transaction',
            name='external_transaction_id',
            field=models.CharField(blank=True, db_index=True, max_length=255, null=True),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0002_alter_affiliate_total_earned_alter_commission_amount_and_more.py
LINE: 44
        migrations.AlterField(
            model_name='transaction',
            name='external_transaction_id',
            field=models.CharField(blank=True, db_index=True, max_length=255, null=True),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0002_alter_affiliate_total_earned_alter_commission_amount_and_more.py
LINE: 68
        ),
        migrations.AddIndex(
            model_name='transaction',
            index=models.Index(fields=['status', 'created_at'], name='billing_tra_status_312567_idx'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0002_alter_affiliate_total_earned_alter_commission_amount_and_more.py
LINE: 72
        ),
        migrations.AddIndex(
            model_name='transaction',
            index=models.Index(fields=['external_transaction_id'], name='billing_tra_externa_cd4e8d_idx'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0002_alter_affiliate_total_earned_alter_commission_amount_and_more.py
LINE: 73
        migrations.AddIndex(
            model_name='transaction',
            index=models.Index(fields=['external_transaction_id'], name='billing_tra_externa_cd4e8d_idx'),
        ),
    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0003_creditcode_batch_id_creditcode_created_by_staff_and_more.py
LINE: 52
        migrations.AddConstraint(
            model_name='commission',
            constraint=models.UniqueConstraint(fields=('transaction',), name='uniq_commission_per_transaction'),
        ),
    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0004_affiliateprofile_referral_remove_affiliate_user_and_more.py
LINE: 39
        ),
        migrations.RemoveField(
            model_name='transaction',
            name='referred_by',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0004_affiliateprofile_referral_remove_affiliate_user_and_more.py
LINE: 67
        ),
        migrations.AlterModelOptions(
            name='transaction',
            options={},
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0004_affiliateprofile_referral_remove_affiliate_user_and_more.py
LINE: 91
        ),
        migrations.RemoveIndex(
            model_name='transaction',
            name='billing_tra_status_312567_idx',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0004_affiliateprofile_referral_remove_affiliate_user_and_more.py
LINE: 95
        ),
        migrations.RemoveIndex(
            model_name='transaction',
            name='billing_tra_externa_cd4e8d_idx',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0004_affiliateprofile_referral_remove_affiliate_user_and_more.py
LINE: 131
        ),
        migrations.RemoveField(
            model_name='transaction',
            name='external_transaction_id',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0004_affiliateprofile_referral_remove_affiliate_user_and_more.py
LINE: 132
        migrations.RemoveField(
            model_name='transaction',
            name='external_transaction_id',
        ),
        migrations.RemoveField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0004_affiliateprofile_referral_remove_affiliate_user_and_more.py
LINE: 135
        ),
        migrations.RemoveField(
            model_name='transaction',
            name='updated_at',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0004_affiliateprofile_referral_remove_affiliate_user_and_more.py
LINE: 165
        migrations.AlterField(
            model_name='commission',
            name='transaction',
            field=models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='commission', to='billing.transaction'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0004_affiliateprofile_referral_remove_affiliate_user_and_more.py
LINE: 166
            model_name='commission',
            name='transaction',
            field=models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='commission', to='billing.transaction'),
        ),
        migrations.AlterField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0004_affiliateprofile_referral_remove_affiliate_user_and_more.py
LINE: 239
        ),
        migrations.AlterField(
            model_name='transaction',
            name='amount',
            field=models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0004_affiliateprofile_referral_remove_affiliate_user_and_more.py
LINE: 244
        ),
        migrations.AlterField(
            model_name='transaction',
            name='description',
            field=models.CharField(blank=True, default='', max_length=255),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0004_affiliateprofile_referral_remove_affiliate_user_and_more.py
LINE: 249
        ),
        migrations.AlterField(
            model_name='transaction',
            name='payment_method',
            field=models.CharField(choices=[('CODE', 'CODE'), ('CARD', 'CARD'), ('MOBILE_MONEY', 'MOBILE_MONEY'), ('WALLET_TOPUP', 'WALLET_TOPUP'), ('OTHER', 'OTHER')], default='OTHER', max_length=32),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0004_affiliateprofile_referral_remove_affiliate_user_and_more.py
LINE: 254
        ),
        migrations.AlterField(
            model_name='transaction',
            name='plan',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='billing.subscriptionplan'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0004_affiliateprofile_referral_remove_affiliate_user_and_more.py
LINE: 256
            model_name='transaction',
            name='plan',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='billing.subscriptionplan'),
        ),
        migrations.AlterField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0004_affiliateprofile_referral_remove_affiliate_user_and_more.py
LINE: 259
        ),
        migrations.AlterField(
            model_name='transaction',
            name='status',
            field=models.CharField(choices=[('PENDING', 'PENDING'), ('COMPLETED', 'COMPLETED'), ('FAILED', 'FAILED'), ('CANCELED', 'CANCELED')], default='PENDING', max_length=16),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0004_affiliateprofile_referral_remove_affiliate_user_and_more.py
LINE: 264
        ),
        migrations.AlterField(
            model_name='transaction',
            name='type',
            field=models.CharField(choices=[('CREDIT', 'CREDIT'), ('DEBIT', 'DEBIT')], default='CREDIT', max_length=16),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\migrations\0005_receipt.py
LINE: 28
                ('currency', models.CharField(default='XAF', max_length=8)),
                ('payment_method', models.CharField(blank=True, max_length=64, null=True)),
                ('transaction_id', models.CharField(blank=True, max_length=128, null=True)),
                ('status', models.CharField(choices=[('paid', 'Payé'), ('pending', 'En attente'), ('failed', 'Échoué')], default='paid', max_length=16)),
                ('issued_at', models.DateTimeField(default=django.utils.timezone.now)),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\models\core.py
LINE: 207


class Transaction(models.Model):
    TYPE_CHOICES = (
        ("CREDIT", "CREDIT"),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\models\core.py
LINE: 227
    )

    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name="transactions")
    plan = models.ForeignKey(SubscriptionPlan, null=True, blank=True, on_delete=models.SET_NULL, related_name="transactions")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\models\core.py
LINE: 228

    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name="transactions")
    plan = models.ForeignKey(SubscriptionPlan, null=True, blank=True, on_delete=models.SET_NULL, related_name="transactions")

    amount = models.DecimalField(max_digits=12, decimal_places=2, default=Decimal("0.00"))
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\models\core.py
LINE: 240
    metadata = models.JSONField(blank=True, default=dict)

    related_code = models.ForeignKey(CreditCode, null=True, blank=True, on_delete=models.SET_NULL, related_name="transactions")
    related_subscription = models.ForeignKey(Subscription, null=True, blank=True, on_delete=models.SET_NULL, related_name="transactions")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\models\core.py
LINE: 241

    related_code = models.ForeignKey(CreditCode, null=True, blank=True, on_delete=models.SET_NULL, related_name="transactions")
    related_subscription = models.ForeignKey(Subscription, null=True, blank=True, on_delete=models.SET_NULL, related_name="transactions")

    created_at = models.DateTimeField(auto_now_add=True)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\models\core.py
LINE: 295
class Commission(models.Model):
    """
    Commission sur une transaction COMPLETED.
    - Unique par transaction => évite double paiement commission
    """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\models\core.py
LINE: 296
    """
    Commission sur une transaction COMPLETED.
    - Unique par transaction => évite double paiement commission
    """
    STATUS_CHOICES = (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\models\core.py
LINE: 304
    )

    transaction = models.OneToOneField(Transaction, on_delete=models.CASCADE, related_name="commission")
    affiliate = models.ForeignKey(AffiliateProfile, on_delete=models.CASCADE, related_name="commissions")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\models\core.py
LINE: 316
    class Meta:
        constraints = [
            models.UniqueConstraint(fields=["transaction"], name="uniq_commission_per_transaction"),
        ]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\models\receipt.py
LINE: 27

    payment_method = models.CharField(max_length=64, blank=True, null=True)
    transaction_id = models.CharField(max_length=128, blank=True, null=True)

    status = models.CharField(max_length=16, choices=STATUS_CHOICES, default="paid")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\admin.py
LINE: 16
    Subscription,
    CreditCode,
    Transaction,
    AffiliateProfile,
    Referral,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\admin.py
LINE: 41


@admin.register(Transaction)
class TransactionAdmin(admin.ModelAdmin):
    list_display = ("id", "user", "type", "amount", "currency", "status", "payment_method", "created_at", "plan")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\admin.py
LINE: 42

@admin.register(Transaction)
class TransactionAdmin(admin.ModelAdmin):
    list_display = ("id", "user", "type", "amount", "currency", "status", "payment_method", "created_at", "plan")
    list_filter = ("type", "status", "currency", "payment_method")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\admin.py
LINE: 128
@admin.register(Commission)
class CommissionAdmin(admin.ModelAdmin):
    list_display = ("transaction", "affiliate", "amount", "currency", "rate", "status", "created_at")
    list_filter = ("status", "currency")
    search_fields = ("affiliate__ref_code", "transaction__user__username", "transaction__user__email")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\admin.py
LINE: 130
    list_display = ("transaction", "affiliate", "amount", "currency", "rate", "status", "created_at")
    list_filter = ("status", "currency")
    search_fields = ("affiliate__ref_code", "transaction__user__username", "transaction__user__email")
    readonly_fields = ("created_at",)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\admin.py
LINE: 137
class ReceiptAdmin(admin.ModelAdmin):
    list_display = ("receipt_number", "client_full_name", "service_name", "amount", "currency", "status", "issued_at", "pdf_link")
    search_fields = ("receipt_number", "client_full_name", "client_email", "client_phone", "transaction_id")
    list_filter = ("status", "currency", "issued_at")
    readonly_fields = ("receipt_number", "created_at")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\affiliates.py
LINE: 3
# billing/affiliates.py
from decimal import Decimal
from django.db import transaction as db_transaction
from django.utils import timezone

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\affiliates.py
LINE: 6
from django.utils import timezone

from .models import AffiliateProfile, Referral, Commission, Transaction
from .services import has_active_access

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\affiliates.py
LINE: 70


def _commission_base_for_transaction(tx: Transaction) -> Decimal:
    """
    Commission base:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\affiliates.py
LINE: 94


@db_transaction.atomic
def create_commission_for_transaction(tx: Transaction) -> Commission | None:
    """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\affiliates.py
LINE: 95

@db_transaction.atomic
def create_commission_for_transaction(tx: Transaction) -> Commission | None:
    """
    Crée la commission (si applicable) pour une transaction COMPLETED.
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\affiliates.py
LINE: 97
def create_commission_for_transaction(tx: Transaction) -> Commission | None:
    """
    Crée la commission (si applicable) pour une transaction COMPLETED.
    Idempotent: si commission déjà existante => retourne.
    """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\affiliates.py
LINE: 104

    # Déjà créée ?
    existing = Commission.objects.filter(transaction=tx).first()
    if existing:
        return existing
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\affiliates.py
LINE: 123

    rate = affiliate.rate if affiliate.rate is not None else DEFAULT_AFFILIATE_RATE
    base = _commission_base_for_transaction(tx)
    if base <= 0:
        return None
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\affiliates.py
LINE: 131
    return Commission.objects.create(
        affiliate=affiliate,
        transaction=tx,
        amount=amount,
        currency=tx.currency or "USD",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\cinetpay_service.py
LINE: 13


def initiate_cinetpay_payment(transaction_id, amount, currency="XAF", customer_name="", customer_email=""):
    """
    Initie un paiement avec Cinetpay
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\cinetpay_service.py
LINE: 18
    
    Args:
        transaction_id: ID unique de la transaction
        amount: Montant à payer
        currency: Devise (XAF par défaut)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\cinetpay_service.py
LINE: 30
        "apikey": CINETPAY_API_KEY,
        "site_id": CINETPAY_SITE_ID,
        "transaction_id": str(transaction_id),
        "amount": int(amount),
        "currency": currency,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\cinetpay_service.py
LINE: 33
        "amount": int(amount),
        "currency": currency,
        "description": f"Paiement Immigration97 - Transaction #{transaction_id}",
        "customer_name": customer_name,
        "customer_surname": customer_name,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\cinetpay_service.py
LINE: 71


def verify_cinetpay_payment(transaction_id):
    """
    Vérifie le statut d'un paiement Cinetpay
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\cinetpay_service.py
LINE: 76
    
    Args:
        transaction_id: ID de la transaction
    
    Returns:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\cinetpay_service.py
LINE: 84
        "apikey": CINETPAY_API_KEY,
        "site_id": CINETPAY_SITE_ID,
        "transaction_id": str(transaction_id),
    }
    
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\models_old.py
LINE: 32

    payment_method = models.CharField(max_length=64, blank=True, null=True)  # Orange Money, MTN, CB...
    transaction_id = models.CharField(max_length=128, blank=True, null=True)

    status = models.CharField(max_length=16, choices=STATUS_CHOICES, default="paid")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\pdf.py
LINE: 125
        y -= 6 * mm

    if receipt.transaction_id:
        c.drawString(20 * mm, y, f"Transaction ID : {receipt.transaction_id}")
        y -= 6 * mm
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\pdf.py
LINE: 126

    if receipt.transaction_id:
        c.drawString(20 * mm, y, f"Transaction ID : {receipt.transaction_id}")
        y -= 6 * mm

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\services_affiliate.py
LINE: 5

from decimal import Decimal
from django.db import IntegrityError, transaction
from django.utils import timezone

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\services_affiliate.py
LINE: 8
from django.utils import timezone

from .models import AffiliateProfile, Referral, Commission, Transaction
from .services import has_active_access

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\services_affiliate.py
LINE: 63


def compute_commission_base_amount(tx: Transaction) -> Decimal:
    """
    Commission sur:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\services_affiliate.py
LINE: 75


def create_commission_for_transaction(tx: Transaction) -> Commission | None:
    """
    Crée une commission si:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\services_affiliate.py
LINE: 103

    try:
        with transaction.atomic():
            return Commission.objects.create(
                transaction=tx,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\services_affiliate.py
LINE: 105
        with transaction.atomic():
            return Commission.objects.create(
                transaction=tx,
                affiliate=affiliate,
                amount=amount,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\services.py
LINE: 5
from django.utils import timezone

from .models import Subscription, SubscriptionPlan, CreditCode, Transaction


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\services.py
LINE: 38
    sub.save()

    Transaction.objects.create(
        user=user,
        amount=plan.price_usd,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\signals.py
LINE: 5
from django.dispatch import receiver

from .models import Transaction
from .services_affiliate import create_commission_for_transaction

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\signals.py
LINE: 6

from .models import Transaction
from .services_affiliate import create_commission_for_transaction


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\signals.py
LINE: 9


@receiver(post_save, sender=Transaction)
def create_commission_on_transaction_completed(sender, instance: Transaction, created, **kwargs):
    # On tente à chaque save, mais la contrainte unique empêche les doublons
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\signals.py
LINE: 10

@receiver(post_save, sender=Transaction)
def create_commission_on_transaction_completed(sender, instance: Transaction, created, **kwargs):
    # On tente à chaque save, mais la contrainte unique empêche les doublons
    if instance.status == "COMPLETED":
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\signals.py
LINE: 13
    # On tente à chaque save, mais la contrainte unique empêche les doublons
    if instance.status == "COMPLETED":
        create_commission_for_transaction(instance)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\stripe_service.py
LINE: 11


def create_stripe_checkout_session(amount_usd, plan_name, user_email, success_url, cancel_url, transaction_id):
    """
    Crée une session Stripe Checkout
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\stripe_service.py
LINE: 21
        success_url: URL de retour après succès
        cancel_url: URL de retour après annulation
        transaction_id: ID de la transaction
    
    Returns:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\stripe_service.py
LINE: 41
            }],
            mode='payment',
            success_url=success_url + f'?session_id={{CHECKOUT_SESSION_ID}}&transaction_id={transaction_id}',
            cancel_url=cancel_url + f'?transaction_id={transaction_id}',
            customer_email=user_email,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\stripe_service.py
LINE: 42
            mode='payment',
            success_url=success_url + f'?session_id={{CHECKOUT_SESSION_ID}}&transaction_id={transaction_id}',
            cancel_url=cancel_url + f'?transaction_id={transaction_id}',
            customer_email=user_email,
            metadata={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\stripe_service.py
LINE: 45
            customer_email=user_email,
            metadata={
                'transaction_id': str(transaction_id),
            }
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\tests.py
LINE: 10
from django.utils import timezone

from billing.models import SubscriptionPlan, CreditCode, Subscription, Transaction

User = get_user_model()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\tests.py
LINE: 112
        )

    def test_redeem_creates_subscription_and_transaction(self):
        self.client.force_login(self.user)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\tests.py
LINE: 124
        self.assertEqual(sub.plan_id, self.plan_7.id)

        tx = Transaction.objects.filter(user=self.user, related_code=self.cc_7).first()
        self.assertIsNotNone(tx)
        self.assertEqual(tx.status, "COMPLETED")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\urls.py
LINE: 17

    path("buy/<slug:plan_slug>/", views.buy_plan, name="buy_plan"),
    path("payment/initiate/<int:transaction_id>/", views.initiate_payment, name="initiate_payment"),

    # ✅ referral
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\views_affiliate.py
LINE: 81


def commission_base_from_transaction(tx):
    """
    Base commission:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\views.py
LINE: 15

from .forms import WalletReloadForm
from .models import SubscriptionPlan, CreditCode, Subscription, Transaction
from .services import (
    activate_pass,  # garde si tu l'utilises ailleurs
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\views.py
LINE: 25
# ✅ Parrainage / Commissions (affiliate)
# Si ce fichier n'existe pas encore, crée-le (je peux te le renvoyer).
from .affiliates import create_commission_for_transaction


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\views.py
LINE: 199

            # ✅ TX COMPLETED (base commission = prix plan même si amount=0)
            tx = Transaction.objects.create(
                user=request.user,
                plan=cc.plan,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\views.py
LINE: 220

            # ✅ Commission si le user a été parrainé
            create_commission_for_transaction(tx)

            messages.success(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\views.py
LINE: 258
    )

    transactions = (
        Transaction.objects
        .filter(user=request.user)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\views.py
LINE: 259

    transactions = (
        Transaction.objects
        .filter(user=request.user)
        .select_related("plan")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\views.py
LINE: 275
        "active_subscription": active_sub,
        "subscriptions": subscriptions,
        "transactions": transactions,
        "codes_used": codes_used,
        "has_access": active_sub is not None,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\views.py
LINE: 291
    plan = get_object_or_404(SubscriptionPlan, slug=plan_slug, is_active=True)

    tx = Transaction.objects.create(
        user=request.user,
        plan=plan,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\views.py
LINE: 304
    return render(request, "billing/buy_plan.html", {
        "plan": plan,
        "transaction": tx,
        "cinetpay_available": False,
        "stripe_available": False,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\views.py
LINE: 312

@login_required
def initiate_payment(request, transaction_id):
    tx = get_object_or_404(Transaction, id=transaction_id, user=request.user)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\views.py
LINE: 313
@login_required
def initiate_payment(request, transaction_id):
    tx = get_object_or_404(Transaction, id=transaction_id, user=request.user)

    if tx.status != "PENDING":
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\views.py
LINE: 316

    if tx.status != "PENDING":
        messages.error(request, "Cette transaction a déjà été traitée.")
        return redirect("billing:wallet")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\views.py
LINE: 326
        # ⚠️ Ici tu feras le redirect vers CinetPay/Stripe.
        # Quand tu recevras la confirmation (webhook), tu feras:
        # tx.status = "COMPLETED"; tx.save(); create_commission_for_transaction(tx)

        messages.info(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\views.py
LINE: 353
            note = form.cleaned_data.get("note") or ""

            tx = Transaction.objects.create(
                user=request.user,
                plan=None,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\billing\views.py
LINE: 371
            # ✅ Optionnel : commission si tu veux récompenser aussi les recharges
            # Si tu ne veux PAS de commission sur wallet, supprime la ligne suivante.
            create_commission_for_transaction(tx)

            messages.success(request, f"✅ Recharge enregistrée : +{amount} USD (DEMO).")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\config\settings.py
LINE: 135
    "VisaTourismeApp",
    "DocumentsApp",
    "ai_engine",
    "actualite.apps.ActualiteConfig",
    "accounts.apps.AccountsConfig",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\config\urls.py
LINE: 100
    path("services/", services_page, name="services"),
    path("protected-media/", include("mediafiles.urls")),
    path("api/ai/", include("ai_engine.urls")),

    
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\cv_generator\admin.py
LINE: 62
        ("Résumé", {"fields": ("summary", "resume_professionnel")}),
        ("Paramètres", {"fields": ("language", "profession", "pays_cible", "is_published")}),
        ("Progression", {
            "fields": (
                "current_step", "step1_completed", "step2_completed",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\cv_generator\models.py
LINE: 105
    profession = models.CharField(max_length=200, blank=True, default="", verbose_name="Profession/Secteur")

    # Progress wizard
    current_step = models.PositiveSmallIntegerField(default=1, verbose_name="Étape actuelle")
    is_completed = models.BooleanField(default=False, verbose_name="CV complété")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\migrations\0001_initial.py
LINE: 23
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('exam_type', models.CharField(choices=[('GENERAL', 'Général anglais'), ('IELTS', 'IELTS'), ('TOEFL', 'TOEFL'), ('TOEIC', 'TOEIC')], default='GENERAL', max_length=20)),
                ('level', models.CharField(choices=[('A1', 'A1 Débutant'), ('A2', 'A2 Élémentaire'), ('B1', 'B1 Intermédiaire'), ('B2', 'B2 Intermédiaire avancé'), ('C1', 'C1 Avancé'), ('C2', 'C2 Maîtrise')], default='B1', max_length=2)),
                ('duration_minutes', models.PositiveIntegerField(default=30)),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\migrations\0005_englishlesson_englishexercise.py
LINE: 15
    operations = [
        migrations.CreateModel(
            name='EnglishLesson',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\migrations\0005_englishlesson_englishexercise.py
LINE: 26
                ('video_url', models.URLField(blank=True)),
                ('order', models.PositiveIntegerField(default=0)),
                ('test', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lessons', to='EnglishPrepApp.englishtest')),
            ],
            options={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\migrations\0005_englishlesson_englishexercise.py
LINE: 33
        ),
        migrations.CreateModel(
            name='EnglishExercise',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\migrations\0005_englishlesson_englishexercise.py
LINE: 42
                ('external_url', models.URLField(blank=True, help_text='Lien vers vidéo, doc, Google Drive, etc. (optionnel).')),
                ('order', models.PositiveIntegerField(default=0)),
                ('lesson', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='exercises', to='EnglishPrepApp.englishlesson')),
            ],
            options={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\migrations\0005_englishlesson_englishexercise.py
LINE: 45
            ],
            options={
                'ordering': ['lesson', 'order', 'title'],
            },
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\migrations\0006_usertestsession_duration_seconds.py
LINE: 9

    dependencies = [
        ('EnglishPrepApp', '0005_englishlesson_englishexercise'),
    ]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 8
    UserAnswer,
    EnglishUserProfile,
    EnglishLesson,
    EnglishExercise,
)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 9
    EnglishUserProfile,
    EnglishLesson,
    EnglishExercise,
)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 26
@admin.register(EnglishTest)
class EnglishTestAdmin(admin.ModelAdmin):
    list_display = ("name", "exam_type", "level", "duration_minutes", "is_active")
    list_filter = ("exam_type", "level", "is_active")
    search_fields = ("name", "description")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 27
class EnglishTestAdmin(admin.ModelAdmin):
    list_display = ("name", "exam_type", "level", "duration_minutes", "is_active")
    list_filter = ("exam_type", "level", "is_active")
    search_fields = ("name", "description")
    ordering = ("exam_type", "level", "name")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 29
    list_filter = ("exam_type", "level", "is_active")
    search_fields = ("name", "description")
    ordering = ("exam_type", "level", "name")
    inlines = [EnglishQuestionInline]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 41

    list_display = ("test", "skill", "short_question", "correct_option")
    list_filter = ("skill", "test__exam_type", "test__level")
    search_fields = ("question_text",)
    autocomplete_fields = ("test",)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 62
        "finished_at",
    )
    list_filter = ("test__exam_type", "test__level", "started_at")
    search_fields = ("user__username", "user__email", "test__name")
    date_hierarchy = "started_at"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 72
class UserAnswerAdmin(admin.ModelAdmin):
    list_display = ("session", "question", "selected_option", "is_correct")
    list_filter = ("is_correct", "question__skill", "session__test__exam_type")
    search_fields = ("session__user__username", "question__question_text")
    autocomplete_fields = ("session", "question")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 84


class EnglishExerciseInline(admin.TabularInline):
    model = EnglishExercise
    extra = 1
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 85

class EnglishExerciseInline(admin.TabularInline):
    model = EnglishExercise
    extra = 1
    fields = ("title", "difficulty", "order", "external_url")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 90


@admin.register(EnglishLesson)
class EnglishLessonAdmin(admin.ModelAdmin):
    list_display = ("title", "test", "skill", "goal", "level", "order")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 91

@admin.register(EnglishLesson)
class EnglishLessonAdmin(admin.ModelAdmin):
    list_display = ("title", "test", "skill", "goal", "level", "order")
    list_filter = ("skill", "goal", "level", "test__exam_type")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 93
class EnglishLessonAdmin(admin.ModelAdmin):
    list_display = ("title", "test", "skill", "goal", "level", "order")
    list_filter = ("skill", "goal", "level", "test__exam_type")
    search_fields = ("title", "short_description", "content")
    autocomplete_fields = ("test",)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 97
    autocomplete_fields = ("test",)
    ordering = ("skill", "order", "title")
    inlines = [EnglishExerciseInline]


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 100


@admin.register(EnglishExercise)
class EnglishExerciseAdmin(admin.ModelAdmin):
    list_display = ("title", "lesson", "difficulty", "order")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 101

@admin.register(EnglishExercise)
class EnglishExerciseAdmin(admin.ModelAdmin):
    list_display = ("title", "lesson", "difficulty", "order")
    list_filter = ("difficulty", "lesson__skill")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 102
@admin.register(EnglishExercise)
class EnglishExerciseAdmin(admin.ModelAdmin):
    list_display = ("title", "lesson", "difficulty", "order")
    list_filter = ("difficulty", "lesson__skill")
    search_fields = ("title", "description", "content")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 103
class EnglishExerciseAdmin(admin.ModelAdmin):
    list_display = ("title", "lesson", "difficulty", "order")
    list_filter = ("difficulty", "lesson__skill")
    search_fields = ("title", "description", "content")
    autocomplete_fields = ("lesson",)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 105
    list_filter = ("difficulty", "lesson__skill")
    search_fields = ("title", "description", "content")
    autocomplete_fields = ("lesson",)
    ordering = ("lesson", "order", "title")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\admin.py
LINE: 106
    search_fields = ("title", "description", "content")
    autocomplete_fields = ("lesson",)
    ordering = ("lesson", "order", "title")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 12

class EnglishTest(models.Model):
    EXAM_CHOICES = [
        ('GENERAL', 'Général anglais'),
        ('IELTS', 'IELTS'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 30
    name = models.CharField(max_length=255)
    description = models.TextField(blank=True)
    exam_type = models.CharField(max_length=20, choices=EXAM_CHOICES, default='GENERAL')
    level = models.CharField(max_length=2, choices=LEVEL_CHOICES, default='B1')
    duration_minutes = models.PositiveIntegerField(default=30)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 115
]

# Facteur de difficulté selon le type d'examen
EXAM_XP_FACTOR = {
    "GENERAL": 1.0,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 116

# Facteur de difficulté selon le type d'examen
EXAM_XP_FACTOR = {
    "GENERAL": 1.0,
    "IELTS": 1.2,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 141
            break

    # Progression continue après le dernier palier
    max_level, max_xp = LEVEL_THRESHOLDS[-1]
    if xp <= max_xp:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 157
    badges: list[str] = []

    # Progression générale
    if profile.total_tests >= 1:
        badges.append("Premier test ✅")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 197
        return f"Profil anglais de {self.user}"

    def add_result(self, score: float, questions_count: int, exam_type: str | None = None):
        """
        Mise à jour du profil après un test.
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 203
        - score : pourcentage 0–100
        - questions_count : nombre de questions du test
        - exam_type : 'IELTS', 'TOEFL', 'TOEIC' ou 'GENERAL'
        """

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 218
        base_xp = (score / 100.0) * questions_count * 10  # 10 = facteur de base

        # 2) Pondération par type d'examen
        exam_type = (exam_type or "GENERAL").upper()
        factor = EXAM_XP_FACTOR.get(exam_type, 1.0)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 219

        # 2) Pondération par type d'examen
        exam_type = (exam_type or "GENERAL").upper()
        factor = EXAM_XP_FACTOR.get(exam_type, 1.0)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 220
        # 2) Pondération par type d'examen
        exam_type = (exam_type or "GENERAL").upper()
        factor = EXAM_XP_FACTOR.get(exam_type, 1.0)

        gained_xp = int(base_xp * factor)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 251


class EnglishLesson(models.Model):
    """
    Leçon liée à un examen précis (IELTS, TOEFL, etc.)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 253
class EnglishLesson(models.Model):
    """
    Leçon liée à un examen précis (IELTS, TOEFL, etc.)
    Exemple : 'CO – Stratégies Listening pour IELTS B2'
    """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 259
        "EnglishTest",
        on_delete=models.CASCADE,
        related_name="lessons",
    )
    title = models.CharField(max_length=200)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 292


class EnglishExercise(models.Model):
    """
    Exercice rattaché à une leçon (drills, fiches, lien externe, etc.)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 301
        HARD = "HARD", "Avancé"

    lesson = models.ForeignKey(
        EnglishLesson,
        on_delete=models.CASCADE,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 302

    lesson = models.ForeignKey(
        EnglishLesson,
        on_delete=models.CASCADE,
        related_name="exercises",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 304
        EnglishLesson,
        on_delete=models.CASCADE,
        related_name="exercises",
    )
    title = models.CharField(max_length=200)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\models.py
LINE: 324

    class Meta:
        ordering = ["lesson", "order", "title"]

    def __str__(self):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\urls.py
LINE: 10
    path("", views.dashboard, name="dashboard"),

    # Liste des tests (deux noms : test_list + exam_list)
    path("tests/", views.test_list, name="test_list"),
    path("examens/", views.test_list, name="exam_list"),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\urls.py
LINE: 12
    # Liste des tests (deux noms : test_list + exam_list)
    path("tests/", views.test_list, name="test_list"),
    path("examens/", views.test_list, name="exam_list"),

    # Passation d’un test + résultat
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\urls.py
LINE: 37
    # Hub IELTS / TOEFL / TOEIC
    path(
        "hub-examens/",
        views.english_exam_hub,
        name="exam_hub",              # nouveau nom "moderne"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\urls.py
LINE: 38
    path(
        "hub-examens/",
        views.english_exam_hub,
        name="exam_hub",              # nouveau nom "moderne"
    ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\urls.py
LINE: 39
        "hub-examens/",
        views.english_exam_hub,
        name="exam_hub",              # nouveau nom "moderne"
    ),
    path(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\urls.py
LINE: 42
    ),
    path(
        "hub-examens/legacy/",
        views.english_exam_hub,
        name="english_exam_hub",      # alias pour les vieux templates
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\urls.py
LINE: 43
    path(
        "hub-examens/legacy/",
        views.english_exam_hub,
        name="english_exam_hub",      # alias pour les vieux templates
    ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\urls.py
LINE: 44
        "hub-examens/legacy/",
        views.english_exam_hub,
        name="english_exam_hub",      # alias pour les vieux templates
    ),

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\urls.py
LINE: 50
    path(
        "test/<int:test_id>/cours-exercices/",
        views.exam_learning_path,
        name="exam_learning_path",
    ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\urls.py
LINE: 51
        "test/<int:test_id>/cours-exercices/",
        views.exam_learning_path,
        name="exam_learning_path",
    ),

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\urls.py
LINE: 54
    ),

    # Profil / progression anglais
    path("profil/", views.english_profile, name="profile"),
    path("profil/progression/", views.english_profile, name="profile_progress"),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\urls.py
LINE: 56
    # Profil / progression anglais
    path("profil/", views.english_profile, name="profile"),
    path("profil/progression/", views.english_profile, name="profile_progress"),

    # Coach IA (page + API JSON)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 22
    UserAnswer,
    EnglishUserProfile,
    EnglishLesson,
    LEVEL_THRESHOLDS,
)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 45


def _compute_exam_stats(user):
    """
    Stats par type d'examen (GENERAL, IELTS, TOEFL, TOEIC) :
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 47
def _compute_exam_stats(user):
    """
    Stats par type d'examen (GENERAL, IELTS, TOEFL, TOEIC) :
    - nombre de tests
    - meilleur score
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 60
    stats = {}

    for exam_code, exam_label in EnglishTest.EXAM_CHOICES:
        sub = qs.filter(test__exam_type=exam_code)
        if not sub.exists():
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 61

    for exam_code, exam_label in EnglishTest.EXAM_CHOICES:
        sub = qs.filter(test__exam_type=exam_code)
        if not sub.exists():
            continue
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 70
        )

        stats[exam_code] = {
            "label": exam_label,
            "count": sub.count(),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 71

        stats[exam_code] = {
            "label": exam_label,
            "count": sub.count(),
            "best": round(agg["best"] or 0.0, 1),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 81

# =========================
#  PROFIL / PROGRESSION ANGLAIS
# =========================

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 87
def english_profile(request):
    """
    Page Profil / progression anglais :
    - XP, niveau, progression vers le prochain niveau
    - Badges
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 88
    """
    Page Profil / progression anglais :
    - XP, niveau, progression vers le prochain niveau
    - Badges
    - Stats par type d'examen
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 90
    - XP, niveau, progression vers le prochain niveau
    - Badges
    - Stats par type d'examen
    - Derniers tests
    - Recommandation dynamique
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 105
    )

    # Stats par type d'examen
    exam_stats = _compute_exam_stats(request.user)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 106

    # Stats par type d'examen
    exam_stats = _compute_exam_stats(request.user)

    # ---------- Progression niveau ----------
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 108
    exam_stats = _compute_exam_stats(request.user)

    # ---------- Progression niveau ----------
    xp = profile.xp or 0
    current_level = profile.level or 1
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 135
    xp_in_level = max(0, xp - current_min_xp)
    xp_needed = max(1, next_level_xp - current_min_xp)
    level_progress_pct = int(round(100 * min(xp_in_level / xp_needed, 1)))

    # ---------- Recommandation dynamique ----------
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 138

    # ---------- Recommandation dynamique ----------
    exam_with_lowest_avg = None
    if exam_stats:
        exam_with_lowest_avg = min(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 139
    # ---------- Recommandation dynamique ----------
    exam_with_lowest_avg = None
    if exam_stats:
        exam_with_lowest_avg = min(
            exam_stats.values(),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 140
    exam_with_lowest_avg = None
    if exam_stats:
        exam_with_lowest_avg = min(
            exam_stats.values(),
            key=lambda s: s["avg"]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 141
    if exam_stats:
        exam_with_lowest_avg = min(
            exam_stats.values(),
            key=lambda s: s["avg"]
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 151
        )
    elif profile.best_score < 60:
        if exam_with_lowest_avg:
            next_step = (
                f"Ton point faible actuel semble être {exam_with_lowest_avg['label']} "
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 153
        if exam_with_lowest_avg:
            next_step = (
                f"Ton point faible actuel semble être {exam_with_lowest_avg['label']} "
                f"(moyenne ≈ {exam_with_lowest_avg['avg']} %). "
                "Refais un test dans cette catégorie et concentre-toi sur la compréhension des corrections."
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 154
            next_step = (
                f"Ton point faible actuel semble être {exam_with_lowest_avg['label']} "
                f"(moyenne ≈ {exam_with_lowest_avg['avg']} %). "
                "Refais un test dans cette catégorie et concentre-toi sur la compréhension des corrections."
            )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 163
            )
    elif profile.best_score < 80:
        if exam_with_lowest_avg:
            next_step = (
                f"Tu as déjà une base correcte. Travaille maintenant {exam_with_lowest_avg['label']} "
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 165
        if exam_with_lowest_avg:
            next_step = (
                f"Tu as déjà une base correcte. Travaille maintenant {exam_with_lowest_avg['label']} "
                "pour stabiliser tes scores au-dessus de 75 %."
            )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 186
        f"- Nombre de tests: {profile.total_tests}\n"
    )
    if exam_with_lowest_avg:
        coach_preset += (
            f"- Point faible probable: {exam_with_lowest_avg['label']} "
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 188
    if exam_with_lowest_avg:
        coach_preset += (
            f"- Point faible probable: {exam_with_lowest_avg['label']} "
            f"(moyenne ≈ {exam_with_lowest_avg['avg']} %)\n"
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 189
        coach_preset += (
            f"- Point faible probable: {exam_with_lowest_avg['label']} "
            f"(moyenne ≈ {exam_with_lowest_avg['avg']} %)\n"
        )
    coach_preset += (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 201
        "profile": profile,
        "sessions": sessions,
        "exam_stats": exam_stats,
        "level_progress_pct": level_progress_pct,
        "next_level": next_level,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 202
        "sessions": sessions,
        "exam_stats": exam_stats,
        "level_progress_pct": level_progress_pct,
        "next_level": next_level,
        "current_min_xp": current_min_xp,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 277
        EnglishTest.objects
        .filter(is_active=True)
        .order_by("exam_type", "level", "name")
    )
    return render(request, "english/test_list.html", {"tests": tests})
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 355
            score_percent,
            total_questions,
            exam_type=test.exam_type,
        )
        request.session["last_english_xp_gain"] = gained_xp
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 576

@login_required
def english_exam_hub(request):
    """
    Hub marketing IELTS / TOEFL / TOEIC + liens rapides vers les tests.
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 579
    """
    Hub marketing IELTS / TOEFL / TOEIC + liens rapides vers les tests.
    Utilise EnglishTest.exam_type (GENERAL / IELTS / TOEFL / TOEIC).
    """
    profile = _get_or_create_profile(request.user)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 591
    )

    ielts_tests = EnglishTest.objects.filter(is_active=True, exam_type="IELTS")
    toefl_tests = EnglishTest.objects.filter(is_active=True, exam_type="TOEFL")
    toeic_tests = EnglishTest.objects.filter(is_active=True, exam_type="TOEIC")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 592

    ielts_tests = EnglishTest.objects.filter(is_active=True, exam_type="IELTS")
    toefl_tests = EnglishTest.objects.filter(is_active=True, exam_type="TOEFL")
    toeic_tests = EnglishTest.objects.filter(is_active=True, exam_type="TOEIC")
    general_tests = EnglishTest.objects.filter(is_active=True, exam_type="GENERAL")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 593
    ielts_tests = EnglishTest.objects.filter(is_active=True, exam_type="IELTS")
    toefl_tests = EnglishTest.objects.filter(is_active=True, exam_type="TOEFL")
    toeic_tests = EnglishTest.objects.filter(is_active=True, exam_type="TOEIC")
    general_tests = EnglishTest.objects.filter(is_active=True, exam_type="GENERAL")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 594
    toefl_tests = EnglishTest.objects.filter(is_active=True, exam_type="TOEFL")
    toeic_tests = EnglishTest.objects.filter(is_active=True, exam_type="TOEIC")
    general_tests = EnglishTest.objects.filter(is_active=True, exam_type="GENERAL")

    context = {
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 600
        "total_sessions": total_sessions,
        "last_sessions": last_sessions,
        "ielts_exams": ielts_tests,
        "toefl_exams": toefl_tests,
        "toeic_exams": toeic_tests,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 601
        "last_sessions": last_sessions,
        "ielts_exams": ielts_tests,
        "toefl_exams": toefl_tests,
        "toeic_exams": toeic_tests,
        "general_exams": general_tests,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 602
        "ielts_exams": ielts_tests,
        "toefl_exams": toefl_tests,
        "toeic_exams": toeic_tests,
        "general_exams": general_tests,
    }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 603
        "toefl_exams": toefl_tests,
        "toeic_exams": toeic_tests,
        "general_exams": general_tests,
    }
    return render(request, "english/english_exam_hub.html", context)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 605
        "general_exams": general_tests,
    }
    return render(request, "english/english_exam_hub.html", context)


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 613

@login_required
def exam_learning_path(request, test_id):
    """
    Page 'Cours & exercices' pour un examen donné.
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 615
def exam_learning_path(request, test_id):
    """
    Page 'Cours & exercices' pour un examen donné.
    Regroupe les leçons par compétence (CO / CE / EO / EE / Grammaire).
    """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 619
    """
    test = get_object_or_404(EnglishTest, pk=test_id)
    lessons = (
        EnglishLesson.objects.filter(test=test)
        .prefetch_related("exercises")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 620
    test = get_object_or_404(EnglishTest, pk=test_id)
    lessons = (
        EnglishLesson.objects.filter(test=test)
        .prefetch_related("exercises")
        .order_by("skill", "order", "title")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 621
    lessons = (
        EnglishLesson.objects.filter(test=test)
        .prefetch_related("exercises")
        .order_by("skill", "order", "title")
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 627
    context = {
        "test": test,
        "lessons": lessons,
    }
    return render(request, "english/exam_learning_path.html", context)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 629
        "lessons": lessons,
    }
    return render(request, "english/exam_learning_path.html", context)


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 716
        last_test_text = (
            f"Dernier test: {last_session.test.name} "
            f"(type: {last_session.test.exam_type}, niveau: {last_session.test.level}), "
            f"score: {last_session.score}%."
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\EnglishPrepApp\views.py
LINE: 725
        "(IELTS, TOEFL, TOEIC ou tests généraux) pour l'immigration, les études ou le travail. "
        "Tu expliques de façon claire, bienveillante, concrète, avec beaucoup d'exemples simples. "
        "Tu peux proposer : mini-exercices, phrases à compléter, correction d'erreurs, stratégies d'examen. "
        "Toujours :\n"
        "- t'adapter au niveau indiqué,\n"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\migrations\0001_initial.py
LINE: 18
    operations = [
        migrations.CreateModel(
            name='GermanExam',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\migrations\0001_initial.py
LINE: 25
                ('short_description', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('exam_type', models.CharField(choices=[('GOETHE', 'Goethe-Zertifikat'), ('TELC', 'telc Deutsch'), ('TESTDAF', 'TestDaF'), ('DSH', 'DSH'), ('GENERAL', 'Général / Visa')], default='GENERAL', max_length=20)),
                ('level', models.CharField(choices=[('A1', 'A1'), ('A2', 'A2'), ('B1', 'B1'), ('B2', 'B2'), ('C1', 'C1'), ('C2', 'C2')], max_length=2)),
                ('is_active', models.BooleanField(default=True)),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\migrations\0001_initial.py
LINE: 31
        ),
        migrations.CreateModel(
            name='GermanLesson',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\migrations\0001_initial.py
LINE: 39
                ('intro', models.TextField(blank=True)),
                ('content', models.TextField(help_text='Contenu de la leçon (texte, explications, exemples). Tu peux mettre du HTML simple ou du Markdown.')),
                ('exam', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lessons', to='GermanPrepApp.germanexam')),
            ],
            options={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\migrations\0001_initial.py
LINE: 42
            ],
            options={
                'ordering': ['exam', 'order'],
            },
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\migrations\0001_initial.py
LINE: 46
        ),
        migrations.CreateModel(
            name='GermanExercise',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\migrations\0001_initial.py
LINE: 56
                ('correct_option', models.CharField(choices=[('A', 'Option A'), ('B', 'Option B'), ('C', 'Option C'), ('D', 'Option D')], max_length=1)),
                ('explanation', models.TextField(blank=True)),
                ('lesson', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='exercises', to='GermanPrepApp.germanlesson')),
            ],
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\migrations\0001_initial.py
LINE: 68
                ('total_questions', models.PositiveIntegerField(default=0)),
                ('correct_answers', models.PositiveIntegerField(default=0)),
                ('exam', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sessions', to='GermanPrepApp.germanexam')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='german_test_sessions', to=settings.AUTH_USER_MODEL)),
            ],
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\migrations\0001_initial.py
LINE: 78
                ('selected_option', models.CharField(choices=[('A', 'Option A'), ('B', 'Option B'), ('C', 'Option C'), ('D', 'Option D')], max_length=1)),
                ('is_correct', models.BooleanField(default=False)),
                ('exercise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='GermanPrepApp.germanexercise')),
                ('session', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='answers', to='GermanPrepApp.germantestsession')),
            ],
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\migrations\0002_germanplacementquestion_and_more.py
LINE: 49
                ('description', models.TextField(blank=True)),
                ('url', models.URLField(help_text='Lien vers le PDF / vidéo / ressource (Drive, YouTube, site externe...).')),
                ('exam', models.ForeignKey(blank=True, help_text='Laisse vide si la ressource ne dépend que de la leçon.', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='resources', to='GermanPrepApp.germanexam')),
                ('lesson', models.ForeignKey(blank=True, help_text='Optionnel. Pour lier une ressource à une leçon précise.', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='resources', to='GermanPrepApp.germanlesson')),
            ],
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\migrations\0002_germanplacementquestion_and_more.py
LINE: 50
                ('url', models.URLField(help_text='Lien vers le PDF / vidéo / ressource (Drive, YouTube, site externe...).')),
                ('exam', models.ForeignKey(blank=True, help_text='Laisse vide si la ressource ne dépend que de la leçon.', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='resources', to='GermanPrepApp.germanexam')),
                ('lesson', models.ForeignKey(blank=True, help_text='Optionnel. Pour lier une ressource à une leçon précise.', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='resources', to='GermanPrepApp.germanlesson')),
            ],
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 3
from django.contrib import admin
from .models import (
    GermanExam,
    GermanLesson,
    GermanExercise,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 4
from .models import (
    GermanExam,
    GermanLesson,
    GermanExercise,
    GermanResource,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 5
    GermanExam,
    GermanLesson,
    GermanExercise,
    GermanResource,
    GermanPlacementQuestion,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 14


@admin.register(GermanExam)
class GermanExamAdmin(admin.ModelAdmin):
    list_display = ("title", "exam_type", "level", "is_active")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 15

@admin.register(GermanExam)
class GermanExamAdmin(admin.ModelAdmin):
    list_display = ("title", "exam_type", "level", "is_active")
    list_filter = ("exam_type", "level", "is_active")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 16
@admin.register(GermanExam)
class GermanExamAdmin(admin.ModelAdmin):
    list_display = ("title", "exam_type", "level", "is_active")
    list_filter = ("exam_type", "level", "is_active")
    prepopulated_fields = {"slug": ("title",)}
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 17
class GermanExamAdmin(admin.ModelAdmin):
    list_display = ("title", "exam_type", "level", "is_active")
    list_filter = ("exam_type", "level", "is_active")
    prepopulated_fields = {"slug": ("title",)}

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 21


@admin.register(GermanLesson)
class GermanLessonAdmin(admin.ModelAdmin):
    list_display = ("title", "exam", "skill", "order")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 22

@admin.register(GermanLesson)
class GermanLessonAdmin(admin.ModelAdmin):
    list_display = ("title", "exam", "skill", "order")
    list_filter = ("exam", "skill")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 23
@admin.register(GermanLesson)
class GermanLessonAdmin(admin.ModelAdmin):
    list_display = ("title", "exam", "skill", "order")
    list_filter = ("exam", "skill")
    search_fields = ("title", "intro", "content")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 24
class GermanLessonAdmin(admin.ModelAdmin):
    list_display = ("title", "exam", "skill", "order")
    list_filter = ("exam", "skill")
    search_fields = ("title", "intro", "content")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 28


@admin.register(GermanExercise)
class GermanExerciseAdmin(admin.ModelAdmin):
    list_display = ("id", "lesson", "question_text")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 29

@admin.register(GermanExercise)
class GermanExerciseAdmin(admin.ModelAdmin):
    list_display = ("id", "lesson", "question_text")
    search_fields = ("question_text",)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 30
@admin.register(GermanExercise)
class GermanExerciseAdmin(admin.ModelAdmin):
    list_display = ("id", "lesson", "question_text")
    search_fields = ("question_text",)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 36
@admin.register(GermanResource)
class GermanResourceAdmin(admin.ModelAdmin):
    list_display = ("title", "resource_type", "exam", "lesson")
    list_filter = ("resource_type", "exam")
    search_fields = ("title", "description", "url")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 37
class GermanResourceAdmin(admin.ModelAdmin):
    list_display = ("title", "resource_type", "exam", "lesson")
    list_filter = ("resource_type", "exam")
    search_fields = ("title", "description", "url")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 50
@admin.register(GermanTestSession)
class GermanTestSessionAdmin(admin.ModelAdmin):
    list_display = ("id", "user", "exam", "score", "started_at", "finished_at")
    list_filter = ("exam", "started_at")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 51
class GermanTestSessionAdmin(admin.ModelAdmin):
    list_display = ("id", "user", "exam", "score", "started_at", "finished_at")
    list_filter = ("exam", "started_at")


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\admin.py
LINE: 56
@admin.register(GermanUserAnswer)
class GermanUserAnswerAdmin(admin.ModelAdmin):
    list_display = ("session", "exercise", "selected_option", "is_correct")


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 16


class GermanExam(models.Model):
    """
    Parcours / examen d'allemand :
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 18
class GermanExam(models.Model):
    """
    Parcours / examen d'allemand :
    - Goethe, telc, TestDaF, DSH, général / visa...
    - associé à un niveau CECR (A1–C2).
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 22
    - associé à un niveau CECR (A1–C2).
    """
    EXAM_TYPES = [
        ("GOETHE", "Goethe-Zertifikat"),
        ("TELC", "telc Deutsch"),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 34
    short_description = models.CharField(max_length=255)
    description = models.TextField(blank=True)
    exam_type = models.CharField(max_length=20, choices=EXAM_TYPES, default="GENERAL")
    level = models.CharField(max_length=2, choices=GERMAN_LEVEL_CHOICES)
    is_active = models.BooleanField(default=True)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 42


class GermanLesson(models.Model):
    """
    Leçon de cours pour un examen donné.
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 44
class GermanLesson(models.Model):
    """
    Leçon de cours pour un examen donné.
    """
    SKILL_CHOICES = [
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 55
    ]

    exam = models.ForeignKey(
        GermanExam,
        on_delete=models.CASCADE,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 56

    exam = models.ForeignKey(
        GermanExam,
        on_delete=models.CASCADE,
        related_name="lessons",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 58
        GermanExam,
        on_delete=models.CASCADE,
        related_name="lessons",
    )
    title = models.CharField(max_length=255)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 70

    class Meta:
        ordering = ["exam", "order"]

    def __str__(self):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 73

    def __str__(self):
        return f"{self.exam.title} – {self.title}"


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 76


class GermanExercise(models.Model):
    """
    Exercice type QCM lié à une leçon.
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 80
    Exercice type QCM lié à une leçon.
    """
    lesson = models.ForeignKey(
        GermanLesson,
        on_delete=models.CASCADE,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 81
    """
    lesson = models.ForeignKey(
        GermanLesson,
        on_delete=models.CASCADE,
        related_name="exercises",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 83
        GermanLesson,
        on_delete=models.CASCADE,
        related_name="exercises",
    )
    question_text = models.TextField()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 103

    def __str__(self):
        return f"Exercice {self.id} – {self.lesson.title}"


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 108
class GermanResource(models.Model):
    """
    Ressource associée à un examen ou une leçon :
    - PDF (cours / exercices corrigés)
    - vidéo YouTube
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 121
    ]

    exam = models.ForeignKey(
        GermanExam,
        on_delete=models.CASCADE,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 122

    exam = models.ForeignKey(
        GermanExam,
        on_delete=models.CASCADE,
        related_name="resources",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 129
        help_text="Laisse vide si la ressource ne dépend que de la leçon.",
    )
    lesson = models.ForeignKey(
        GermanLesson,
        on_delete=models.CASCADE,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 130
    )
    lesson = models.ForeignKey(
        GermanLesson,
        on_delete=models.CASCADE,
        related_name="resources",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 178
class GermanTestSession(models.Model):
    """
    Une simulation d'examen allemand pour un utilisateur.
    """
    user = models.ForeignKey(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 185
        related_name="german_test_sessions",
    )
    exam = models.ForeignKey(
        GermanExam,
        on_delete=models.CASCADE,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 186
    )
    exam = models.ForeignKey(
        GermanExam,
        on_delete=models.CASCADE,
        related_name="sessions",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 197

    def __str__(self):
        return f"DE Session {self.id} – {self.user} – {self.exam} ({self.score}%)"
    duration_seconds = models.PositiveIntegerField(
    default=0,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 206
class GermanUserAnswer(models.Model):
    """
    Réponse d'un utilisateur dans une session d'examen.
    """
    session = models.ForeignKey(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 213
        related_name="answers",
    )
    exercise = models.ForeignKey(GermanExercise, on_delete=models.CASCADE)
    selected_option = models.CharField(
        max_length=1,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 216
    selected_option = models.CharField(
        max_length=1,
        choices=GermanExercise.CORRECT_CHOICES,
    )
    is_correct = models.BooleanField(default=False)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\models.py
LINE: 221

    def __str__(self):
        return f"{self.session.user} – Ex {self.exercise.id}"


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\urls.py
LINE: 14
    path("niveau/<str:level_code>/", views.level_detail, name="level_detail"),

    # Hub examens allemands
    path("exam-hub/", views.german_exam_hub, name="exam_hub"),

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\urls.py
LINE: 15

    # Hub examens allemands
    path("exam-hub/", views.german_exam_hub, name="exam_hub"),

    # Examens / cours / tests
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\urls.py
LINE: 17
    path("exam-hub/", views.german_exam_hub, name="exam_hub"),

    # Examens / cours / tests
    path("examens/<slug:exam_slug>/", views.exam_detail, name="exam_detail"),
    path(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\urls.py
LINE: 18

    # Examens / cours / tests
    path("examens/<slug:exam_slug>/", views.exam_detail, name="exam_detail"),
    path(
        "examens/<slug:exam_slug>/lecon/<int:lesson_id>/",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\urls.py
LINE: 20
    path("examens/<slug:exam_slug>/", views.exam_detail, name="exam_detail"),
    path(
        "examens/<slug:exam_slug>/lecon/<int:lesson_id>/",
        views.lesson_detail,
        name="lesson_detail",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\urls.py
LINE: 21
    path(
        "examens/<slug:exam_slug>/lecon/<int:lesson_id>/",
        views.lesson_detail,
        name="lesson_detail",
    ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\urls.py
LINE: 22
        "examens/<slug:exam_slug>/lecon/<int:lesson_id>/",
        views.lesson_detail,
        name="lesson_detail",
    ),
    path(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\urls.py
LINE: 25
    ),
    path(
        "examens/<slug:exam_slug>/parcours/",
        views.german_exam_learning_path,
        name="exam_learning_path",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\urls.py
LINE: 26
    path(
        "examens/<slug:exam_slug>/parcours/",
        views.german_exam_learning_path,
        name="exam_learning_path",
    ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\urls.py
LINE: 27
        "examens/<slug:exam_slug>/parcours/",
        views.german_exam_learning_path,
        name="exam_learning_path",
    ),
    path("examens/<int:exam_id>/test/", views.take_practice_test, name="take_practice_test"),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\urls.py
LINE: 29
        name="exam_learning_path",
    ),
    path("examens/<int:exam_id>/test/", views.take_practice_test, name="take_practice_test"),

    # Résultats & analyse
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\urls.py
LINE: 37

    # Tableau de bord global
    path("progression/", views.progress_dashboard, name="progress_dashboard"),

    # 🔹 COACH IA ALLEMAND
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 14

from .models import (
    GermanExam,
    GermanLesson,
    GermanExercise,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 15
from .models import (
    GermanExam,
    GermanLesson,
    GermanExercise,
    GermanResource,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 16
    GermanExam,
    GermanLesson,
    GermanExercise,
    GermanResource,
    GermanPlacementQuestion,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 61
    profile = _get_or_create_profile(request.user)

    exams = (
        GermanExam.objects
        .filter(is_active=True)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 62

    exams = (
        GermanExam.objects
        .filter(is_active=True)
        .order_by("level", "exam_type", "title")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 64
        GermanExam.objects
        .filter(is_active=True)
        .order_by("level", "exam_type", "title")
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 68

    levels = ["A1", "A2", "B1", "B2", "C1", "C2"]
    exams_by_level = {lvl: [] for lvl in levels}
    for exam in exams:
        exams_by_level[exam.level].append(exam)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 69
    levels = ["A1", "A2", "B1", "B2", "C1", "C2"]
    exams_by_level = {lvl: [] for lvl in levels}
    for exam in exams:
        exams_by_level[exam.level].append(exam)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 70
    exams_by_level = {lvl: [] for lvl in levels}
    for exam in exams:
        exams_by_level[exam.level].append(exam)

    last_sessions = (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 75
        GermanTestSession.objects
        .filter(user=request.user)
        .select_related("exam")
        .order_by("-started_at")[:5]
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 81
    context = {
        "profile": profile,
        "exams_by_level": exams_by_level,
        "last_sessions": last_sessions,
    }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 114
    """
    Page 'Niveau B1' etc.
    Affiche tous les examens, leçons, ressources et simulations liés à ce niveau.
    """
    level_code = level_code.upper()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 123
    profile = _get_or_create_profile(request.user)

    exams = GermanExam.objects.filter(level=level_code, is_active=True)
    lessons = GermanLesson.objects.filter(exam__level=level_code).select_related("exam")
    resources = GermanResource.objects.filter(exam__level=level_code).select_related("exam", "lesson")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 124

    exams = GermanExam.objects.filter(level=level_code, is_active=True)
    lessons = GermanLesson.objects.filter(exam__level=level_code).select_related("exam")
    resources = GermanResource.objects.filter(exam__level=level_code).select_related("exam", "lesson")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 125
    exams = GermanExam.objects.filter(level=level_code, is_active=True)
    lessons = GermanLesson.objects.filter(exam__level=level_code).select_related("exam")
    resources = GermanResource.objects.filter(exam__level=level_code).select_related("exam", "lesson")

    # Derniers tests pour ce niveau
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 130
    sessions = (
        GermanTestSession.objects
        .filter(user=request.user, exam__level=level_code)
        .select_related("exam")
        .order_by("-started_at")[:5]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 131
        GermanTestSession.objects
        .filter(user=request.user, exam__level=level_code)
        .select_related("exam")
        .order_by("-started_at")[:5]
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 140
        "level_description": LEVEL_DESCRIPTIONS[level_code],
        "profile": profile,
        "exams": exams,
        "lessons": lessons,
        "resources": resources,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 141
        "profile": profile,
        "exams": exams,
        "lessons": lessons,
        "resources": resources,
        "sessions": sessions,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 193

# =========================
#  DÉTAIL D'UN EXAMEN = ESPACE DE COURS
# =========================

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 197

@login_required
def exam_detail(request, exam_slug):
    exam = get_object_or_404(GermanExam, slug=exam_slug, is_active=True)
    profile = _get_or_create_profile(request.user)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 198
@login_required
def exam_detail(request, exam_slug):
    exam = get_object_or_404(GermanExam, slug=exam_slug, is_active=True)
    profile = _get_or_create_profile(request.user)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 201
    profile = _get_or_create_profile(request.user)

    lessons = exam.lessons.all()
    exam_resources = exam.resources.filter(lesson__isnull=True)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 202

    lessons = exam.lessons.all()
    exam_resources = exam.resources.filter(lesson__isnull=True)

    last_session = (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 206
    last_session = (
        GermanTestSession.objects
        .filter(user=request.user, exam=exam)
        .order_by("-started_at")
        .first()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 212

    context = {
        "exam": exam,
        "lessons": lessons,
        "exam_resources": exam_resources,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 213
    context = {
        "exam": exam,
        "lessons": lessons,
        "exam_resources": exam_resources,
        "profile": profile,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 214
        "exam": exam,
        "lessons": lessons,
        "exam_resources": exam_resources,
        "profile": profile,
        "last_session": last_session,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 218
        "last_session": last_session,
    }
    return render(request, "german/exam_detail.html", context)


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 226

@login_required
def lesson_detail(request, exam_slug, lesson_id):
    exam = get_object_or_404(GermanExam, slug=exam_slug, is_active=True)
    lesson = get_object_or_404(GermanLesson, id=lesson_id, exam=exam)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 227
@login_required
def lesson_detail(request, exam_slug, lesson_id):
    exam = get_object_or_404(GermanExam, slug=exam_slug, is_active=True)
    lesson = get_object_or_404(GermanLesson, id=lesson_id, exam=exam)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 228
def lesson_detail(request, exam_slug, lesson_id):
    exam = get_object_or_404(GermanExam, slug=exam_slug, is_active=True)
    lesson = get_object_or_404(GermanLesson, id=lesson_id, exam=exam)

    resources = lesson.resources.all()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 230
    lesson = get_object_or_404(GermanLesson, id=lesson_id, exam=exam)

    resources = lesson.resources.all()
    exercises = lesson.exercises.all()

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 231

    resources = lesson.resources.all()
    exercises = lesson.exercises.all()

    context = {
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 234

    context = {
        "exam": exam,
        "lesson": lesson,
        "resources": resources,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 235
    context = {
        "exam": exam,
        "lesson": lesson,
        "resources": resources,
        "exercises": exercises,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 237
        "lesson": lesson,
        "resources": resources,
        "exercises": exercises,
    }
    return render(request, "german/lesson_detail.html", context)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 239
        "exercises": exercises,
    }
    return render(request, "german/lesson_detail.html", context)


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 243

# =========================
#  SIMULATION D'EXAMEN
# =========================

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 247

@login_required
def take_practice_test(request, exam_id):
    """
    Simulation type examen pour un GermanExam donné.
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 249
def take_practice_test(request, exam_id):
    """
    Simulation type examen pour un GermanExam donné.
    - utilise les GermanExercise liés aux leçons de cet examen
    - crée une GermanTestSession
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 250
    """
    Simulation type examen pour un GermanExam donné.
    - utilise les GermanExercise liés aux leçons de cet examen
    - crée une GermanTestSession
    - enregistre les réponses GermanUserAnswer (LIÉES À LA SESSION)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 257
    """
    from .models import (
        GermanExam,
        GermanExercise,
        GermanTestSession,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 258
    from .models import (
        GermanExam,
        GermanExercise,
        GermanTestSession,
        GermanUserAnswer,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 263
    )

    exam = get_object_or_404(GermanExam, id=exam_id, is_active=True)
    exercises = GermanExercise.objects.filter(
        lesson__exam=exam
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 264

    exam = get_object_or_404(GermanExam, id=exam_id, is_active=True)
    exercises = GermanExercise.objects.filter(
        lesson__exam=exam
    ).order_by("id")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 265
    exam = get_object_or_404(GermanExam, id=exam_id, is_active=True)
    exercises = GermanExercise.objects.filter(
        lesson__exam=exam
    ).order_by("id")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 274
        session = GermanTestSession.objects.create(
            user=request.user,
            exam=exam,
        )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 278

        correct_count = 0
        total = exercises.count()

        # -------------------------
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 283
        # 2️⃣ Parcours des réponses
        # -------------------------
        for ex in exercises:
            selected = request.POST.get(f"exercise_{ex.id}")
            if not selected:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 284
        # -------------------------
        for ex in exercises:
            selected = request.POST.get(f"exercise_{ex.id}")
            if not selected:
                continue
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 295
            GermanUserAnswer.objects.create(
                session=session,
                exercise=ex,
                selected_option=selected,
                is_correct=is_correct,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 344
    # -------------------------
    context = {
        "exam": exam,
        "exercises": exercises,
    }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 345
    context = {
        "exam": exam,
        "exercises": exercises,
    }
    return render(request, "german/take_practice_test.html", context)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 355
def german_test_result(request, session_id):
    """
    Résultat détaillé d'une session d'examen allemand :
    - score global
    - bonnes / mauvaises réponses
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 361
    - XP gagnée
    """
    from .models import GermanTestSession, GermanExercise

    session = get_object_or_404(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 368
        user=request.user,
    )
    exam = session.exam

    answers = session.answers.select_related("exercise")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 370
    exam = session.exam

    answers = session.answers.select_related("exercise")
    total = answers.count()
    correct_answers = answers.filter(is_correct=True).count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 400
    # Stats par compétence
    skill_stats = {}
    label_map = dict(getattr(GermanExercise, "SKILL_CHOICES", []))

    for ans in answers:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 403

    for ans in answers:
        skill = ans.exercise.skill
        stat = skill_stats.setdefault(skill, {"total": 0, "correct": 0})
        stat["total"] += 1
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 419
    context = {
        "session": session,
        "exam": exam,
        "answers": answers,
        "total": total,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 445
        user=request.user,
    )
    exam = session.exam

    answers = session.answers.select_related("exercise")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 447
    exam = session.exam

    answers = session.answers.select_related("exercise")
    incorrect_answers = answers.filter(is_correct=False)
    total = answers.count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 461
    context = {
        "session": session,
        "exam": exam,
        "incorrect_answers": incorrect_answers,
        "incorrect_count": incorrect_count,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 478
    - mini recommandations texte
    """
    from .models import GermanTestSession, GermanExercise

    session = get_object_or_404(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 487
    answers = (
        session.answers
        .select_related("exercise")
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 496
            "Lance une nouvelle simulation pour générer des statistiques.",
        )
        return redirect("germanprep:progress_dashboard")

    skill_stats = {}
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 499

    skill_stats = {}
    label_map = dict(getattr(GermanExercise, "SKILL_CHOICES", []))

    for ans in answers:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 502

    for ans in answers:
        skill = ans.exercise.skill
        data = skill_stats.setdefault(skill, {"total": 0, "correct": 0})
        data["total"] += 1
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 560
    context = {
        "session": session,
        "exam": session.exam,
        "skills": ordered_skills,
        "global_total": global_total,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 577

@login_required
def progress_dashboard(request):
    profile = _get_or_create_profile(request.user)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 583
        GermanTestSession.objects
        .filter(user=request.user)
        .select_related("exam")
        .order_by("-started_at")
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 589
    stats_by_level = {}
    for s in sessions:
        lvl = s.exam.level
        stat = stats_by_level.setdefault(
            lvl,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 655
        coach_plan.append(
            "1) Fais le test de niveau pour obtenir une recommandation A1–C2, "
            "puis lance un examen correspondant à ce niveau."
        )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 660
    if weakest_level:
        coach_plan.append(
            f"2) Choisis un examen de niveau {weakest_level} dans le hub allemand et "
            "fais une simulation complète tous les 2–3 jours."
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 665
    else:
        coach_plan.append(
            "2) Choisis un examen A1 ou A2 et fais une première simulation pour créer ta base de données."
        )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 674
    coach_plan.append(
        "4) Utilise au moins 1 PDF complet et 1 vidéo par semaine dans la section Ressources "
        "de ton niveau pour t’habituer au format réel des examens allemands."
    )
    coach_plan.append(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 687
        "coach_plan": coach_plan,
    }
    return render(request, "german/progress_dashboard.html", context)


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 712
    - score moyen
    """
    from .models import GermanExam, GermanTestSession  # éviter les imports circulaires

    qs = (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 717
        GermanTestSession.objects
        .filter(user=user, score__isnull=False)
        .select_related("exam")
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 722
    stats = {}

    # On boucle sur les niveaux définis dans GermanExam.LEVEL_CHOICES
    for level_code, level_label in getattr(GermanExam, "LEVEL_CHOICES", []):
        sub = qs.filter(exam__level=level_code)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 723

    # On boucle sur les niveaux définis dans GermanExam.LEVEL_CHOICES
    for level_code, level_label in getattr(GermanExam, "LEVEL_CHOICES", []):
        sub = qs.filter(exam__level=level_code)
        if not sub.exists():
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 724
    # On boucle sur les niveaux définis dans GermanExam.LEVEL_CHOICES
    for level_code, level_label in getattr(GermanExam, "LEVEL_CHOICES", []):
        sub = qs.filter(exam__level=level_code)
        if not sub.exists():
            continue
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 747
def german_profile(request):
    """
    Page Profil / progression allemand :
    - XP, niveau, progression vers le prochain niveau
    - Badges
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 748
    """
    Page Profil / progression allemand :
    - XP, niveau, progression vers le prochain niveau
    - Badges
    - Stats par niveau (A1–C2)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 762
        GermanTestSession.objects
        .filter(user=request.user)
        .select_related("exam")
        .order_by("-started_at")[:10]
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 769
    level_stats = _compute_german_level_stats(request.user)

    # ---------- Progression niveau ----------
    xp = profile.xp or 0
    current_level = profile.level or 1
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 797
    xp_in_level = max(0, xp - current_min_xp)
    xp_needed = max(1, next_level_xp - current_min_xp)
    level_progress_pct = int(round(100 * min(xp_in_level / xp_needed, 1)))

    # ---------- Recommandation dynamique ----------
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 864
        "sessions": sessions,
        "level_stats": level_stats,
        "level_progress_pct": level_progress_pct,
        "next_level": next_level,
        "current_min_xp": current_min_xp,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 876

@login_required
def german_exam_hub(request):
    """
    Hub marketing exam d’allemand :
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 878
def german_exam_hub(request):
    """
    Hub marketing exam d’allemand :
    - Goethe / telc / TestDaF / DSH / Intégration
    - liens rapides vers les examens et simulations
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 880
    Hub marketing exam d’allemand :
    - Goethe / telc / TestDaF / DSH / Intégration
    - liens rapides vers les examens et simulations
    """
    from .models import GermanExam, GermanTestSession
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 882
    - liens rapides vers les examens et simulations
    """
    from .models import GermanExam, GermanTestSession

    profile = _get_or_create_profile(request.user)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 890
        GermanTestSession.objects
        .filter(user=request.user)
        .select_related("exam")
        .order_by("-started_at")[:5]
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 894
    )

    goethe_exams = GermanExam.objects.filter(is_active=True, exam_type="GOETHE")
    telc_exams = GermanExam.objects.filter(is_active=True, exam_type="TELC")
    testdaf_exams = GermanExam.objects.filter(is_active=True, exam_type="TESTDAF")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 895

    goethe_exams = GermanExam.objects.filter(is_active=True, exam_type="GOETHE")
    telc_exams = GermanExam.objects.filter(is_active=True, exam_type="TELC")
    testdaf_exams = GermanExam.objects.filter(is_active=True, exam_type="TESTDAF")
    dsh_exams = GermanExam.objects.filter(is_active=True, exam_type="DSH")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 896
    goethe_exams = GermanExam.objects.filter(is_active=True, exam_type="GOETHE")
    telc_exams = GermanExam.objects.filter(is_active=True, exam_type="TELC")
    testdaf_exams = GermanExam.objects.filter(is_active=True, exam_type="TESTDAF")
    dsh_exams = GermanExam.objects.filter(is_active=True, exam_type="DSH")
    integration_exams = GermanExam.objects.filter(is_active=True, exam_type="INTEGRATION")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 897
    telc_exams = GermanExam.objects.filter(is_active=True, exam_type="TELC")
    testdaf_exams = GermanExam.objects.filter(is_active=True, exam_type="TESTDAF")
    dsh_exams = GermanExam.objects.filter(is_active=True, exam_type="DSH")
    integration_exams = GermanExam.objects.filter(is_active=True, exam_type="INTEGRATION")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 898
    testdaf_exams = GermanExam.objects.filter(is_active=True, exam_type="TESTDAF")
    dsh_exams = GermanExam.objects.filter(is_active=True, exam_type="DSH")
    integration_exams = GermanExam.objects.filter(is_active=True, exam_type="INTEGRATION")

    context = {
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 904
        "total_sessions": total_sessions,
        "last_sessions": last_sessions,
        "goethe_exams": goethe_exams,
        "telc_exams": telc_exams,
        "testdaf_exams": testdaf_exams,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 905
        "last_sessions": last_sessions,
        "goethe_exams": goethe_exams,
        "telc_exams": telc_exams,
        "testdaf_exams": testdaf_exams,
        "dsh_exams": dsh_exams,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 906
        "goethe_exams": goethe_exams,
        "telc_exams": telc_exams,
        "testdaf_exams": testdaf_exams,
        "dsh_exams": dsh_exams,
        "integration_exams": integration_exams,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 907
        "telc_exams": telc_exams,
        "testdaf_exams": testdaf_exams,
        "dsh_exams": dsh_exams,
        "integration_exams": integration_exams,
    }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 908
        "testdaf_exams": testdaf_exams,
        "dsh_exams": dsh_exams,
        "integration_exams": integration_exams,
    }
    return render(request, "german/german_exam_hub.html", context)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 910
        "integration_exams": integration_exams,
    }
    return render(request, "german/german_exam_hub.html", context)


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 914

@login_required
def german_exam_learning_path(request, exam_slug):
    """
    Page 'Cours & exercices' pour un examen d’allemand donné.
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 916
def german_exam_learning_path(request, exam_slug):
    """
    Page 'Cours & exercices' pour un examen d’allemand donné.
    Affiche toutes les leçons (GermanLesson) + exercices associés,
    idéal pour suivre un parcours structuré par skills.
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 917
    """
    Page 'Cours & exercices' pour un examen d’allemand donné.
    Affiche toutes les leçons (GermanLesson) + exercices associés,
    idéal pour suivre un parcours structuré par skills.
    """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 920
    idéal pour suivre un parcours structuré par skills.
    """
    from .models import GermanExam, GermanLesson

    exam = get_object_or_404(GermanExam, slug=exam_slug, is_active=True)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 922
    from .models import GermanExam, GermanLesson

    exam = get_object_or_404(GermanExam, slug=exam_slug, is_active=True)

    lessons = (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 924
    exam = get_object_or_404(GermanExam, slug=exam_slug, is_active=True)

    lessons = (
        GermanLesson.objects
        .filter(exam=exam)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 925

    lessons = (
        GermanLesson.objects
        .filter(exam=exam)
        .prefetch_related("exercises", "resources")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 926
    lessons = (
        GermanLesson.objects
        .filter(exam=exam)
        .prefetch_related("exercises", "resources")
        .order_by("skill", "order", "title")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 927
        GermanLesson.objects
        .filter(exam=exam)
        .prefetch_related("exercises", "resources")
        .order_by("skill", "order", "title")
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 932

    context = {
        "exam": exam,
        "lessons": lessons,
    }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 933
    context = {
        "exam": exam,
        "lessons": lessons,
    }
    return render(request, "german/exam_learning_path.html", context)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 935
        "lessons": lessons,
    }
    return render(request, "german/exam_learning_path.html", context)


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 939

@login_required
def german_exam_hub(request):
    """
    Hub marketing exam d’allemand :
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 941
def german_exam_hub(request):
    """
    Hub marketing exam d’allemand :
    - Goethe / telc / TestDaF / DSH / Intégration
    - liens rapides vers les examens et simulations
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 943
    Hub marketing exam d’allemand :
    - Goethe / telc / TestDaF / DSH / Intégration
    - liens rapides vers les examens et simulations
    """
    from .models import GermanExam, GermanTestSession
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 945
    - liens rapides vers les examens et simulations
    """
    from .models import GermanExam, GermanTestSession

    profile = _get_or_create_profile(request.user)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 953
        GermanTestSession.objects
        .filter(user=request.user)
        .select_related("exam")
        .order_by("-started_at")[:5]
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 957
    )

    goethe_exams = GermanExam.objects.filter(is_active=True, exam_type="GOETHE")
    telc_exams = GermanExam.objects.filter(is_active=True, exam_type="TELC")
    testdaf_exams = GermanExam.objects.filter(is_active=True, exam_type="TESTDAF")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 958

    goethe_exams = GermanExam.objects.filter(is_active=True, exam_type="GOETHE")
    telc_exams = GermanExam.objects.filter(is_active=True, exam_type="TELC")
    testdaf_exams = GermanExam.objects.filter(is_active=True, exam_type="TESTDAF")
    dsh_exams = GermanExam.objects.filter(is_active=True, exam_type="DSH")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 959
    goethe_exams = GermanExam.objects.filter(is_active=True, exam_type="GOETHE")
    telc_exams = GermanExam.objects.filter(is_active=True, exam_type="TELC")
    testdaf_exams = GermanExam.objects.filter(is_active=True, exam_type="TESTDAF")
    dsh_exams = GermanExam.objects.filter(is_active=True, exam_type="DSH")
    integration_exams = GermanExam.objects.filter(is_active=True, exam_type="INTEGRATION")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 960
    telc_exams = GermanExam.objects.filter(is_active=True, exam_type="TELC")
    testdaf_exams = GermanExam.objects.filter(is_active=True, exam_type="TESTDAF")
    dsh_exams = GermanExam.objects.filter(is_active=True, exam_type="DSH")
    integration_exams = GermanExam.objects.filter(is_active=True, exam_type="INTEGRATION")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 961
    testdaf_exams = GermanExam.objects.filter(is_active=True, exam_type="TESTDAF")
    dsh_exams = GermanExam.objects.filter(is_active=True, exam_type="DSH")
    integration_exams = GermanExam.objects.filter(is_active=True, exam_type="INTEGRATION")

    context = {
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 967
        "total_sessions": total_sessions,
        "last_sessions": last_sessions,
        "goethe_exams": goethe_exams,
        "telc_exams": telc_exams,
        "testdaf_exams": testdaf_exams,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 968
        "last_sessions": last_sessions,
        "goethe_exams": goethe_exams,
        "telc_exams": telc_exams,
        "testdaf_exams": testdaf_exams,
        "dsh_exams": dsh_exams,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 969
        "goethe_exams": goethe_exams,
        "telc_exams": telc_exams,
        "testdaf_exams": testdaf_exams,
        "dsh_exams": dsh_exams,
        "integration_exams": integration_exams,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 970
        "telc_exams": telc_exams,
        "testdaf_exams": testdaf_exams,
        "dsh_exams": dsh_exams,
        "integration_exams": integration_exams,
    }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 971
        "testdaf_exams": testdaf_exams,
        "dsh_exams": dsh_exams,
        "integration_exams": integration_exams,
    }
    return render(request, "german/german_exam_hub.html", context)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 973
        "integration_exams": integration_exams,
    }
    return render(request, "german/german_exam_hub.html", context)
@login_required
def german_exam_learning_path(request, exam_slug):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 975
    return render(request, "german/german_exam_hub.html", context)
@login_required
def german_exam_learning_path(request, exam_slug):
    """
    Page 'Cours & exercices' pour un examen d’allemand donné.
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 977
def german_exam_learning_path(request, exam_slug):
    """
    Page 'Cours & exercices' pour un examen d’allemand donné.
    Affiche toutes les leçons (GermanLesson) + exercices associés,
    idéal pour suivre un parcours structuré par skills.
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 978
    """
    Page 'Cours & exercices' pour un examen d’allemand donné.
    Affiche toutes les leçons (GermanLesson) + exercices associés,
    idéal pour suivre un parcours structuré par skills.
    """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 981
    idéal pour suivre un parcours structuré par skills.
    """
    from .models import GermanExam, GermanLesson

    exam = get_object_or_404(GermanExam, slug=exam_slug, is_active=True)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 983
    from .models import GermanExam, GermanLesson

    exam = get_object_or_404(GermanExam, slug=exam_slug, is_active=True)

    lessons = (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 985
    exam = get_object_or_404(GermanExam, slug=exam_slug, is_active=True)

    lessons = (
        GermanLesson.objects
        .filter(exam=exam)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 986

    lessons = (
        GermanLesson.objects
        .filter(exam=exam)
        .prefetch_related("exercises", "resources")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 987
    lessons = (
        GermanLesson.objects
        .filter(exam=exam)
        .prefetch_related("exercises", "resources")
        .order_by("skill", "order", "title")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 988
        GermanLesson.objects
        .filter(exam=exam)
        .prefetch_related("exercises", "resources")
        .order_by("skill", "order", "title")
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 993

    context = {
        "exam": exam,
        "lessons": lessons,
    }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 994
    context = {
        "exam": exam,
        "lessons": lessons,
    }
    return render(request, "german/exam_learning_path.html", context)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 996
        "lessons": lessons,
    }
    return render(request, "german/exam_learning_path.html", context)


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 1013
        GermanTestSession.objects
        .filter(user=request.user)
        .select_related("exam")
        .order_by("-started_at")
        .first()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 1023
    if not preset:
        preset = (
            "Je prépare les examens d’allemand sur Immigration97 (Goethe, telc, TestDaF, DSH).\n"
            "Voici mon profil :\n"
            f"- Niveau interne: {profile.level}\n"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 1033
            preset += f"- Niveau conseillé par le test de niveau: {profile.placement_level}\n"
        preset += (
            "\nPropose-moi un plan concret sur 7 jours pour progresser, avec des exercices simples et "
            "des conseils spécifiques pour les examens officiels (Goethe / telc / TestDaF / DSH)."
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 1034
        preset += (
            "\nPropose-moi un plan concret sur 7 jours pour progresser, avec des exercices simples et "
            "des conseils spécifiques pour les examens officiels (Goethe / telc / TestDaF / DSH)."
        )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 1082
        GermanTestSession.objects
        .filter(user=request.user)
        .select_related("exam")
        .order_by("-started_at")
        .first()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 1106
    if last_session:
        last_test_text = (
            f"Dernier test: {last_session.exam.title} "
            f"(type: {last_session.exam.exam_type}, niveau: {last_session.exam.level}), "
            f"score: {last_session.score:.1f}%."
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\GermanPrepApp\views.py
LINE: 1107
        last_test_text = (
            f"Dernier test: {last_session.exam.title} "
            f"(type: {last_session.exam.exam_type}, niveau: {last_session.exam.level}), "
            f"score: {last_session.score:.1f}%."
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\api\serializers.py
LINE: 8
    serializers = None

from italian_courses.models import CourseCategory, Lesson, Quiz, Question, Choice

if serializers:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\api\serializers.py
LINE: 16
            fields = ["id", "name", "slug"]

    class LessonSerializer(serializers.ModelSerializer):
        category = CourseCategorySerializer()

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\api\serializers.py
LINE: 20

        class Meta:
            model = Lesson
            fields = [
                "id", "title", "slug", "excerpt", "level", "order_index",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\api\urls.py
LINE: 10
    path("health/", views.health, name="health"),
    path("categories/", views.categories, name="categories"),
    path("lessons/", views.lessons, name="lessons"),
]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\api\views.py
LINE: 5
from django.http import JsonResponse, HttpResponse
from django.views.decorators.http import require_GET
from italian_courses.models import CourseCategory, Lesson

# DRF endpoints (optional)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\api\views.py
LINE: 25

@require_GET
def lessons(request):
    # Simple JSON API without DRF (works always)
    category = request.GET.get("category")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\api\views.py
LINE: 28
    # Simple JSON API without DRF (works always)
    category = request.GET.get("category")
    qs = Lesson.objects.filter(is_published=True).select_related("category")
    if category:
        qs = qs.filter(category__slug=category)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\management\commands\import_lessons.py
LINE: 3
import json
from django.core.management.base import BaseCommand, CommandError
from italian_courses.models import CourseCategory, Lesson, Quiz, Question, Choice
from italian_courses.sanitizer import sanitize_html

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\management\commands\import_lessons.py
LINE: 7

class Command(BaseCommand):
    help = "Import categories/lessons (+ optional quizzes) from a JSON file."

    def add_arguments(self, parser):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\management\commands\import_lessons.py
LINE: 21

        categories = data.get("categories", [])
        lessons = data.get("lessons", [])

        cat_map = {}
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\management\commands\import_lessons.py
LINE: 34

        created = updated = 0
        for l in lessons:
            cat_slug = l["category_slug"]
            if cat_slug not in cat_map:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\management\commands\import_lessons.py
LINE: 41
            cleaned = sanitize_html(l.get("content_html", ""))

            obj, is_created = Lesson.objects.update_or_create(
                slug=l.get("slug") or None,
                defaults={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\management\commands\import_lessons.py
LINE: 62
            if quiz_data:
                quiz, _ = Quiz.objects.update_or_create(
                    lesson=obj,
                    defaults={"title": quiz_data.get("title", "Quiz"), "is_active": bool(quiz_data.get("is_active", True))}
                )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0001_initial.py
LINE: 44
        ),
        migrations.CreateModel(
            name='Lesson',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0001_initial.py
LINE: 52
                ('level', models.CharField(choices=[('A0', 'A0 (Débutant total)'), ('A1', 'A1 (Débutant)'), ('A2', 'A2 (Élémentaire)')], default='A0', max_length=2)),
                ('order_index', models.PositiveIntegerField(default=1)),
                ('cover_image', models.ImageField(blank=True, null=True, upload_to='courses/lessons/')),
                ('content_html', models.TextField(help_text='Contenu HTML (sera nettoyé côté serveur).')),
                ('is_published', models.BooleanField(default=False)),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0001_initial.py
LINE: 57
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('category', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='lessons', to='italian_courses.coursecategory')),
            ],
            options={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0001_initial.py
LINE: 66
        ),
        migrations.CreateModel(
            name='LessonProgress',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0001_initial.py
LINE: 72
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('lesson', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='progress_entries', to='italian_courses.lesson')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='italian_course_progress', related_query_name='italian_course_progress', to=settings.AUTH_USER_MODEL)),
            ],
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0001_initial.py
LINE: 73
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('lesson', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='progress_entries', to='italian_courses.lesson')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='italian_course_progress', related_query_name='italian_course_progress', to=settings.AUTH_USER_MODEL)),
            ],
            options={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0001_initial.py
LINE: 76
            ],
            options={
                'verbose_name': 'Progression',
                'verbose_name_plural': 'Progressions',
            },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0001_initial.py
LINE: 77
            options={
                'verbose_name': 'Progression',
                'verbose_name_plural': 'Progressions',
            },
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0001_initial.py
LINE: 99
                ('title', models.CharField(default='Quiz', max_length=200)),
                ('is_active', models.BooleanField(default=True)),
                ('lesson', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='quiz', to='italian_courses.lesson')),
            ],
            options={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0001_initial.py
LINE: 112
        ),
        migrations.AddIndex(
            model_name='lesson',
            index=models.Index(fields=['is_published', 'category', 'order_index'], name='italian_cou_is_publ_f65b79_idx'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0001_initial.py
LINE: 116
        ),
        migrations.AddIndex(
            model_name='lessonprogress',
            index=models.Index(fields=['user', 'is_completed'], name='italian_cou_user_id_750fa9_idx'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0001_initial.py
LINE: 120
        ),
        migrations.AlterUniqueTogether(
            name='lessonprogress',
            unique_together={('user', 'lesson')},
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0001_initial.py
LINE: 121
        migrations.AlterUniqueTogether(
            name='lessonprogress',
            unique_together={('user', 'lesson')},
        ),
    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0002_repair_missing_tables.py
LINE: 20
                CREATE TABLE italian_courses_quiz (
                    id BIGSERIAL PRIMARY KEY,
                    lesson_id BIGINT UNIQUE NOT NULL
                        REFERENCES italian_courses_lesson(id)
                        DEFERRABLE INITIALLY DEFERRED,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0002_repair_missing_tables.py
LINE: 21
                    id BIGSERIAL PRIMARY KEY,
                    lesson_id BIGINT UNIQUE NOT NULL
                        REFERENCES italian_courses_lesson(id)
                        DEFERRABLE INITIALLY DEFERRED,
                    title varchar(200) NOT NULL,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0002_repair_missing_tables.py
LINE: 62
            """)

        # LESSON PROGRESS
        if "italian_courses_lessonprogress" not in existing:
            c.execute(f"""
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0002_repair_missing_tables.py
LINE: 63

        # LESSON PROGRESS
        if "italian_courses_lessonprogress" not in existing:
            c.execute(f"""
                CREATE TABLE italian_courses_lessonprogress (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0002_repair_missing_tables.py
LINE: 65
        if "italian_courses_lessonprogress" not in existing:
            c.execute(f"""
                CREATE TABLE italian_courses_lessonprogress (
                    id BIGSERIAL PRIMARY KEY,
                    user_id BIGINT NOT NULL
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0002_repair_missing_tables.py
LINE: 70
                        REFERENCES {user_table}(id)
                        DEFERRABLE INITIALLY DEFERRED,
                    lesson_id BIGINT NOT NULL
                        REFERENCES italian_courses_lesson(id)
                        DEFERRABLE INITIALLY DEFERRED,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0002_repair_missing_tables.py
LINE: 71
                        DEFERRABLE INITIALLY DEFERRED,
                    lesson_id BIGINT NOT NULL
                        REFERENCES italian_courses_lesson(id)
                        DEFERRABLE INITIALLY DEFERRED,
                    is_completed boolean NOT NULL DEFAULT false,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0002_repair_missing_tables.py
LINE: 76
                    completed_at timestamptz NULL,
                    updated_at timestamptz NOT NULL DEFAULT NOW(),
                    CONSTRAINT italian_courses_lessonprogress_unique
                        UNIQUE (user_id, lesson_id)
                );
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0002_repair_missing_tables.py
LINE: 77
                    updated_at timestamptz NOT NULL DEFAULT NOW(),
                    CONSTRAINT italian_courses_lessonprogress_unique
                        UNIQUE (user_id, lesson_id)
                );
            """)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0002_repair_missing_tables.py
LINE: 81
            """)
            c.execute("""
                CREATE INDEX italian_courses_lessonprogress_user_id_idx
                ON italian_courses_lessonprogress(user_id);
            """)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0002_repair_missing_tables.py
LINE: 82
            c.execute("""
                CREATE INDEX italian_courses_lessonprogress_user_id_idx
                ON italian_courses_lessonprogress(user_id);
            """)
            c.execute("""
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0002_repair_missing_tables.py
LINE: 85
            """)
            c.execute("""
                CREATE INDEX italian_courses_lessonprogress_lesson_id_idx
                ON italian_courses_lessonprogress(lesson_id);
            """)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0002_repair_missing_tables.py
LINE: 86
            c.execute("""
                CREATE INDEX italian_courses_lessonprogress_lesson_id_idx
                ON italian_courses_lessonprogress(lesson_id);
            """)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0003_alter_lesson_cover_image.py
LINE: 14
    operations = [
        migrations.AlterField(
            model_name='lesson',
            name='cover_image',
            field=models.ImageField(blank=True, null=True, upload_to='...'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0004_add_cover_image_column.py
LINE: 5
class Migration(migrations.Migration):
    dependencies = [
        ("italian_courses", "0003_alter_lesson_cover_image"),
    ]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0004_add_cover_image_column.py
LINE: 11
        migrations.RunSQL(
            sql="""
            ALTER TABLE italian_courses_lesson
            ADD COLUMN IF NOT EXISTS cover_image varchar(100);
            """,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0004_add_cover_image_column.py
LINE: 15
            """,
            reverse_sql="""
            ALTER TABLE italian_courses_lesson
            DROP COLUMN IF EXISTS cover_image;
            """,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 26
        ),
        migrations.AlterModelOptions(
            name='lesson',
            options={'ordering': ('category__order', 'category__name', 'order', 'title'), 'verbose_name': 'Lesson', 'verbose_name_plural': 'Lessons'},
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 27
        migrations.AlterModelOptions(
            name='lesson',
            options={'ordering': ('category__order', 'category__name', 'order', 'title'), 'verbose_name': 'Lesson', 'verbose_name_plural': 'Lessons'},
        ),
        migrations.AlterModelOptions(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 30
        ),
        migrations.AlterModelOptions(
            name='lessonprogress',
            options={'ordering': ('-last_accessed_at',), 'verbose_name': 'Lesson progress', 'verbose_name_plural': 'Lesson progress'},
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 31
        migrations.AlterModelOptions(
            name='lessonprogress',
            options={'ordering': ('-last_accessed_at',), 'verbose_name': 'Lesson progress', 'verbose_name_plural': 'Lesson progress'},
        ),
        migrations.AlterModelOptions(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 39
        migrations.AlterModelOptions(
            name='quiz',
            options={'ordering': ('lesson__order', 'order', 'title'), 'verbose_name': 'Quiz', 'verbose_name_plural': 'Quizzes'},
        ),
        migrations.RemoveIndex(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 42
        ),
        migrations.RemoveIndex(
            model_name='lesson',
            name='italian_cou_is_publ_f65b79_idx',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 46
        ),
        migrations.RemoveIndex(
            model_name='lessonprogress',
            name='italian_cou_user_id_750fa9_idx',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 50
        ),
        migrations.RenameField(
            model_name='lessonprogress',
            old_name='is_completed',
            new_name='completed',
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 55
        ),
        migrations.RenameField(
            model_name='lessonprogress',
            old_name='updated_at',
            new_name='last_accessed_at',
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 60
        ),
        migrations.AlterUniqueTogether(
            name='lessonprogress',
            unique_together=set(),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 64
        ),
        migrations.RemoveField(
            model_name='lesson',
            name='cover_image',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 68
        ),
        migrations.RemoveField(
            model_name='lesson',
            name='excerpt',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 72
        ),
        migrations.RemoveField(
            model_name='lesson',
            name='level',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 76
        ),
        migrations.RemoveField(
            model_name='lesson',
            name='order_index',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 126
        ),
        migrations.AddField(
            model_name='lesson',
            name='audio_file',
            field=models.FileField(blank=True, null=True, upload_to='italian_courses/audio/'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 131
        ),
        migrations.AddField(
            model_name='lesson',
            name='estimated_minutes',
            field=models.PositiveIntegerField(default=0),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 136
        ),
        migrations.AddField(
            model_name='lesson',
            name='order',
            field=models.PositiveIntegerField(default=0),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 141
        ),
        migrations.AddField(
            model_name='lesson',
            name='transcript',
            field=models.TextField(blank=True),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 146
        ),
        migrations.AddField(
            model_name='lessonprogress',
            name='last_position_seconds',
            field=models.PositiveIntegerField(default=0),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 151
        ),
        migrations.AddField(
            model_name='lessonprogress',
            name='progress_percent',
            field=models.DecimalField(decimal_places=2, default=0.0, help_text='Pourcentage entre 0.00 et 100.00', max_digits=5),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 152
        migrations.AddField(
            model_name='lessonprogress',
            name='progress_percent',
            field=models.DecimalField(decimal_places=2, default=0.0, help_text='Pourcentage entre 0.00 et 100.00', max_digits=5),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 156
        ),
        migrations.AddField(
            model_name='lessonprogress',
            name='started_at',
            field=models.DateTimeField(default=django.utils.timezone.now),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 208
        ),
        migrations.AlterField(
            model_name='lesson',
            name='content_html',
            field=models.TextField(blank=True),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 213
        ),
        migrations.AlterField(
            model_name='lesson',
            name='slug',
            field=models.SlugField(max_length=220),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 218
        ),
        migrations.AlterField(
            model_name='lessonprogress',
            name='lesson',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='progress_records', to='italian_courses.lesson'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 219
        migrations.AlterField(
            model_name='lessonprogress',
            name='lesson',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='progress_records', to='italian_courses.lesson'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 220
            model_name='lessonprogress',
            name='lesson',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='progress_records', to='italian_courses.lesson'),
        ),
        migrations.AlterField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 223
        ),
        migrations.AlterField(
            model_name='lessonprogress',
            name='user',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='italian_lesson_progress', to=settings.AUTH_USER_MODEL),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 225
            model_name='lessonprogress',
            name='user',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='italian_lesson_progress', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AlterField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 229
        migrations.AlterField(
            model_name='quiz',
            name='lesson',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='quizzes', to='italian_courses.lesson'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 230
            model_name='quiz',
            name='lesson',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='quizzes', to='italian_courses.lesson'),
        ),
        migrations.AlterField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 238
        ),
        migrations.AddIndex(
            model_name='lessonprogress',
            index=models.Index(fields=['user', 'lesson'], name='italian_cou_user_id_f78943_idx'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 239
        migrations.AddIndex(
            model_name='lessonprogress',
            index=models.Index(fields=['user', 'lesson'], name='italian_cou_user_id_f78943_idx'),
        ),
        migrations.AddIndex(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 242
        ),
        migrations.AddIndex(
            model_name='lessonprogress',
            index=models.Index(fields=['lesson', 'completed'], name='italian_cou_lesson__2fbfda_idx'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 243
        migrations.AddIndex(
            model_name='lessonprogress',
            index=models.Index(fields=['lesson', 'completed'], name='italian_cou_lesson__2fbfda_idx'),
        ),
        migrations.AddConstraint(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 246
        ),
        migrations.AddConstraint(
            model_name='lesson',
            constraint=models.UniqueConstraint(fields=('category', 'slug'), name='uniq_lesson_slug_per_category'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 247
        migrations.AddConstraint(
            model_name='lesson',
            constraint=models.UniqueConstraint(fields=('category', 'slug'), name='uniq_lesson_slug_per_category'),
        ),
        migrations.AddConstraint(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 250
        ),
        migrations.AddConstraint(
            model_name='lessonprogress',
            constraint=models.UniqueConstraint(fields=('user', 'lesson'), name='uniq_progress_per_user_lesson'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\migrations\0005_alter_choice_options_alter_coursecategory_options_and_more.py
LINE: 251
        migrations.AddConstraint(
            model_name='lessonprogress',
            constraint=models.UniqueConstraint(fields=('user', 'lesson'), name='uniq_progress_per_user_lesson'),
        ),
    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 6
from .models import (
    CourseCategory,
    Lesson,
    LessonProgress,
    Quiz,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 7
    CourseCategory,
    Lesson,
    LessonProgress,
    Quiz,
    Question,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 13
)

# Si tu as un LessonAdminForm, il doit exister réellement.
# Sinon, commente la ligne ci-dessous et l'attribut form dans LessonAdmin.
try:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 14

# Si tu as un LessonAdminForm, il doit exister réellement.
# Sinon, commente la ligne ci-dessous et l'attribut form dans LessonAdmin.
try:
    from .forms import LessonAdminForm
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 16
# Sinon, commente la ligne ci-dessous et l'attribut form dans LessonAdmin.
try:
    from .forms import LessonAdminForm
except Exception:
    LessonAdminForm = None
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 18
    from .forms import LessonAdminForm
except Exception:
    LessonAdminForm = None


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 47
@admin.register(Quiz)
class QuizAdmin(admin.ModelAdmin):
    list_display = ("lesson", "title", "is_active", "order", "created_at")
    list_filter = ("is_active", "lesson__category")
    search_fields = ("lesson__title", "title", "lesson__category__name")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 48
class QuizAdmin(admin.ModelAdmin):
    list_display = ("lesson", "title", "is_active", "order", "created_at")
    list_filter = ("is_active", "lesson__category")
    search_fields = ("lesson__title", "title", "lesson__category__name")
    ordering = ("lesson", "order", "title")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 49
    list_display = ("lesson", "title", "is_active", "order", "created_at")
    list_filter = ("is_active", "lesson__category")
    search_fields = ("lesson__title", "title", "lesson__category__name")
    ordering = ("lesson", "order", "title")
    inlines = [QuestionInline]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 50
    list_filter = ("is_active", "lesson__category")
    search_fields = ("lesson__title", "title", "lesson__category__name")
    ordering = ("lesson", "order", "title")
    inlines = [QuestionInline]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 68


@admin.register(Lesson)
class LessonAdmin(admin.ModelAdmin):
    form = LessonAdminForm if LessonAdminForm else None
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 69

@admin.register(Lesson)
class LessonAdmin(admin.ModelAdmin):
    form = LessonAdminForm if LessonAdminForm else None

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 70
@admin.register(Lesson)
class LessonAdmin(admin.ModelAdmin):
    form = LessonAdminForm if LessonAdminForm else None

    list_display = (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 95

    @admin.display(boolean=True, description="Audio")
    def has_audio(self, obj: Lesson) -> bool:
        return bool(obj.audio_file)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 99


@admin.register(LessonProgress)
class LessonProgressAdmin(admin.ModelAdmin):
    list_display = (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 100

@admin.register(LessonProgress)
class LessonProgressAdmin(admin.ModelAdmin):
    list_display = (
        "user",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 103
    list_display = (
        "user",
        "lesson",
        "completed",
        "progress_percent",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 105
        "lesson",
        "completed",
        "progress_percent",
        "last_accessed_at",
        "completed_at",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 110
    )
    list_filter = ("completed", "last_accessed_at")
    search_fields = ("user__username", "user__email", "lesson__title")
    readonly_fields = ("started_at", "last_accessed_at")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 114

    fieldsets = (
        (None, {"fields": ("user", "lesson")}),
        ("Progress", {"fields": ("progress_percent", "completed", "last_position_seconds")}),
        ("Dates", {"fields": ("started_at", "last_accessed_at", "completed_at")}),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\admin.py
LINE: 115
    fieldsets = (
        (None, {"fields": ("user", "lesson")}),
        ("Progress", {"fields": ("progress_percent", "completed", "last_position_seconds")}),
        ("Dates", {"fields": ("started_at", "last_accessed_at", "completed_at")}),
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\forms.py
LINE: 2
from django import forms
from .models import Lesson
from .sanitizer import sanitize_html

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\forms.py
LINE: 23
    return forms.Textarea(attrs={"cols": 80, "rows": 25})

class LessonAdminForm(forms.ModelForm):
    class Meta:
        model = Lesson
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\forms.py
LINE: 25
class LessonAdminForm(forms.ModelForm):
    class Meta:
        model = Lesson
        fields = "__all__"
        widgets = {
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 30


class Lesson(models.Model):
    """
    Une seule classe Lesson (non abstract).
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 32
class Lesson(models.Model):
    """
    Une seule classe Lesson (non abstract).
    Supporte contenu HTML + audio + transcript.
    """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 38
        CourseCategory,
        on_delete=models.PROTECT,
        related_name="lessons",
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 71
            models.UniqueConstraint(
                fields=["category", "slug"],
                name="uniq_lesson_slug_per_category",
            )
        ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 74
            )
        ]
        verbose_name = "Lesson"
        verbose_name_plural = "Lessons"

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 75
        ]
        verbose_name = "Lesson"
        verbose_name_plural = "Lessons"

    def __str__(self) -> str:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 83
class Quiz(models.Model):
    """
    Un quiz attaché à une Lesson (ForeignKey clair vers Lesson).
    """
    lesson = models.ForeignKey(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 85
    Un quiz attaché à une Lesson (ForeignKey clair vers Lesson).
    """
    lesson = models.ForeignKey(
        Lesson,
        on_delete=models.CASCADE,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 86
    """
    lesson = models.ForeignKey(
        Lesson,
        on_delete=models.CASCADE,
        related_name="quizzes",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 101

    class Meta:
        ordering = ("lesson__order", "order", "title")
        verbose_name = "Quiz"
        verbose_name_plural = "Quizzes"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 106

    def __str__(self) -> str:
        return f"{self.lesson.title} — {self.title}"


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 163


class LessonProgress(models.Model):
    """
    Suivi de progression d’un utilisateur sur une leçon.
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 165
class LessonProgress(models.Model):
    """
    Suivi de progression d’un utilisateur sur une leçon.
    """
    user = models.ForeignKey(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 170
        settings.AUTH_USER_MODEL,
        on_delete=models.CASCADE,
        related_name="italian_lesson_progress",
    )
    lesson = models.ForeignKey(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 172
        related_name="italian_lesson_progress",
    )
    lesson = models.ForeignKey(
        Lesson,
        on_delete=models.CASCADE,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 173
    )
    lesson = models.ForeignKey(
        Lesson,
        on_delete=models.CASCADE,
        related_name="progress_records",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 175
        Lesson,
        on_delete=models.CASCADE,
        related_name="progress_records",
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 178
    )

    # Progression simple
    progress_percent = models.DecimalField(
        max_digits=5,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 179

    # Progression simple
    progress_percent = models.DecimalField(
        max_digits=5,
        decimal_places=2,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 198
        constraints = [
            models.UniqueConstraint(
                fields=["user", "lesson"],
                name="uniq_progress_per_user_lesson",
            )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 199
            models.UniqueConstraint(
                fields=["user", "lesson"],
                name="uniq_progress_per_user_lesson",
            )
        ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 203
        ]
        indexes = [
            models.Index(fields=["user", "lesson"]),
            models.Index(fields=["lesson", "completed"]),
        ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 204
        indexes = [
            models.Index(fields=["user", "lesson"]),
            models.Index(fields=["lesson", "completed"]),
        ]
        verbose_name = "Lesson progress"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 206
            models.Index(fields=["lesson", "completed"]),
        ]
        verbose_name = "Lesson progress"
        verbose_name_plural = "Lesson progress"

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 207
        ]
        verbose_name = "Lesson progress"
        verbose_name_plural = "Lesson progress"

    def __str__(self) -> str:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 210

    def __str__(self) -> str:
        return f"{self.user} — {self.lesson} ({self.progress_percent}%)"

    def mark_completed(self) -> None:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\models.py
LINE: 214
    def mark_completed(self) -> None:
        self.completed = True
        self.progress_percent = 100.00
        if self.completed_at is None:
            self.completed_at = timezone.now()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\services.py
LINE: 5
from django.utils import timezone
from django.contrib.auth import get_user_model
from .models import Lesson, LessonProgress

def mark_completed(user, lesson: Lesson) -> LessonProgress:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\services.py
LINE: 7
from .models import Lesson, LessonProgress

def mark_completed(user, lesson: Lesson) -> LessonProgress:
    prog, _ = LessonProgress.objects.get_or_create(user=user, lesson=lesson)
    prog.is_completed = True
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\services.py
LINE: 8

def mark_completed(user, lesson: Lesson) -> LessonProgress:
    prog, _ = LessonProgress.objects.get_or_create(user=user, lesson=lesson)
    prog.is_completed = True
    prog.completed_at = prog.completed_at or timezone.now()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\urls.py
LINE: 12

    # /italien/cours/<category_slug>/
    path("cours/<slug:category_slug>/", views.lesson_list, name="lesson_list"),

    # /italien/cours/<category_slug>/<lesson_slug>/
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\urls.py
LINE: 14
    path("cours/<slug:category_slug>/", views.lesson_list, name="lesson_list"),

    # /italien/cours/<category_slug>/<lesson_slug>/
    path(
        "cours/<slug:category_slug>/<slug:lesson_slug>/",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\urls.py
LINE: 16
    # /italien/cours/<category_slug>/<lesson_slug>/
    path(
        "cours/<slug:category_slug>/<slug:lesson_slug>/",
        views.lesson_detail,
        name="lesson_detail",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\urls.py
LINE: 17
    path(
        "cours/<slug:category_slug>/<slug:lesson_slug>/",
        views.lesson_detail,
        name="lesson_detail",
    ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\urls.py
LINE: 18
        "cours/<slug:category_slug>/<slug:lesson_slug>/",
        views.lesson_detail,
        name="lesson_detail",
    ),

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\urls.py
LINE: 24
    path(
        "cours/<slug:category_slug>/<slug:slug>/terminer/",
        views.mark_lesson_completed,
        name="lesson_complete",
    ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\urls.py
LINE: 25
        "cours/<slug:category_slug>/<slug:slug>/terminer/",
        views.mark_lesson_completed,
        name="lesson_complete",
    ),

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 6
from django.urls import reverse

from .models import CourseCategory, Lesson, LessonProgress, Quiz


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 18


def lesson_list(request, category_slug):
    category = get_object_or_404(CourseCategory, slug=category_slug, is_active=True)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 21
    category = get_object_or_404(CourseCategory, slug=category_slug, is_active=True)

    qs = Lesson.objects.filter(category=category, is_published=True)

    # ✅ Important : dans ton modèle c’est "order" (pas order_index)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 24

    # ✅ Important : dans ton modèle c’est "order" (pas order_index)
    lessons = list(qs.order_by("order", "title"))

    progress_by_lesson_id = {}
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 26
    lessons = list(qs.order_by("order", "title"))

    progress_by_lesson_id = {}
    if request.user.is_authenticated:
        progress_qs = LessonProgress.objects.filter(user=request.user, lesson__in=lessons)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 28
    progress_by_lesson_id = {}
    if request.user.is_authenticated:
        progress_qs = LessonProgress.objects.filter(user=request.user, lesson__in=lessons)
        progress_by_lesson_id = {p.lesson_id: p for p in progress_qs}

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 29
    if request.user.is_authenticated:
        progress_qs = LessonProgress.objects.filter(user=request.user, lesson__in=lessons)
        progress_by_lesson_id = {p.lesson_id: p for p in progress_qs}

    return render(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 33
    return render(
        request,
        "italian_courses/lesson_list.html",
        {
            "category": category,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 36
        {
            "category": category,
            "lessons": lessons,
            "progress_by_lesson_id": progress_by_lesson_id,
        },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 37
            "category": category,
            "lessons": lessons,
            "progress_by_lesson_id": progress_by_lesson_id,
        },
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 42


def lesson_detail(request, category_slug, lesson_slug):
    category = get_object_or_404(CourseCategory, slug=category_slug, is_active=True)
    lesson = get_object_or_404(Lesson, category=category, slug=lesson_slug, is_published=True)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 44
def lesson_detail(request, category_slug, lesson_slug):
    category = get_object_or_404(CourseCategory, slug=category_slug, is_active=True)
    lesson = get_object_or_404(Lesson, category=category, slug=lesson_slug, is_published=True)

    quizzes = Quiz.objects.filter(lesson=lesson, is_active=True).order_by("order", "id")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 46
    lesson = get_object_or_404(Lesson, category=category, slug=lesson_slug, is_published=True)

    quizzes = Quiz.objects.filter(lesson=lesson, is_active=True).order_by("order", "id")

    progress = None
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 48
    quizzes = Quiz.objects.filter(lesson=lesson, is_active=True).order_by("order", "id")

    progress = None
    if request.user.is_authenticated:
        progress, _ = LessonProgress.objects.get_or_create(user=request.user, lesson=lesson)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 50
    progress = None
    if request.user.is_authenticated:
        progress, _ = LessonProgress.objects.get_or_create(user=request.user, lesson=lesson)

    return render(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 54
    return render(
        request,
        "italian_courses/lesson_detail.html",
        {
            "category": category,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 57
        {
            "category": category,
            "lesson": lesson,
            "quizzes": quizzes,
            "progress": progress,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 59
            "lesson": lesson,
            "quizzes": quizzes,
            "progress": progress,
        },
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 65

@login_required
def mark_lesson_completed(request, category_slug, slug):
    """
    ✅ Correction : on récupère la leçon par (category + slug).
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 71
    """
    category = get_object_or_404(CourseCategory, slug=category_slug, is_active=True)
    lesson = get_object_or_404(Lesson, category=category, slug=slug, is_published=True)

    LessonProgress.objects.update_or_create(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 73
    lesson = get_object_or_404(Lesson, category=category, slug=slug, is_published=True)

    LessonProgress.objects.update_or_create(
        user=request.user,
        lesson=lesson,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 75
    LessonProgress.objects.update_or_create(
        user=request.user,
        lesson=lesson,
        defaults={"completed": True},
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 81
    return redirect(
        reverse(
            "italian_courses:lesson_detail",
            kwargs={"category_slug": category.slug, "lesson_slug": lesson.slug},
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 82
        reverse(
            "italian_courses:lesson_detail",
            kwargs={"category_slug": category.slug, "lesson_slug": lesson.slug},
        )
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 108

        if request.user.is_authenticated:
            LessonProgress.objects.update_or_create(
                user=request.user,
                lesson=quiz.lesson,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\italian_courses\views.py
LINE: 110
            LessonProgress.objects.update_or_create(
                user=request.user,
                lesson=quiz.lesson,
                defaults={"completed": True},
            )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\job_agent\urls.py
LINE: 45
    path(
        "offres-publiques/<int:offer_id>/importer/",
        views.import_public_offer,
        name="import_public_offer",
    ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\job_agent\urls.py
LINE: 46
        "offres-publiques/<int:offer_id>/importer/",
        views.import_public_offer,
        name="import_public_offer",
    ),

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\job_agent\views.py
LINE: 10
from django.core.exceptions import ValidationError
from django.core.validators import validate_email
from django.db import IntegrityError, transaction
from django.shortcuts import get_object_or_404, redirect, render
from django.urls import reverse  # ✅ AJOUT (safe)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\job_agent\views.py
LINE: 423
from django.shortcuts import render, get_object_or_404, redirect
from django.contrib.auth.decorators import login_required
from django.db import transaction
from django.utils import timezone
from datetime import timedelta
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\job_agent\views.py
LINE: 431

@login_required
@transaction.atomic
def lead_detail(request, lead_id: int):
    lead = get_object_or_404(JobLead, id=lead_id, user=request.user)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\job_agent\views.py
LINE: 648

@login_required
@transaction.atomic
def import_public_offer(request, offer_id: int):
    offer = get_object_or_404(PublicJobOffer, id=offer_id, is_active=True)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\job_agent\views.py
LINE: 649
@login_required
@transaction.atomic
def import_public_offer(request, offer_id: int):
    offer = get_object_or_404(PublicJobOffer, id=offer_id, is_active=True)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\job_agent\views.py
LINE: 676
# ======================================================
@login_required
@transaction.atomic
def lead_bulk_add(request):
    """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\job_agent\views.py
LINE: 795

@login_required
@transaction.atomic
def kanban_move(request, lead_id: int):
    lead = get_object_or_404(JobLead, id=lead_id, user=request.user)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\job_agent\views.py
LINE: 816

@login_required
@transaction.atomic
def apply_wizard(request, lead_id: int):
    lead = get_object_or_404(JobLead, id=lead_id, user=request.user)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\migrations\0001_initial.py
LINE: 44
                ('title', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('status', models.CharField(choices=[('todo', 'À faire'), ('in_progress', 'En cours'), ('done', 'Terminé')], default='todo', max_length=20)),
                ('profile', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='steps', to='permanent_residence.prprofile')),
            ],
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\migrations\0002_alter_prplanstep_options_prprofile_english_exam_and_more.py
LINE: 19
        migrations.AddField(
            model_name='prprofile',
            name='english_exam',
            field=models.CharField(choices=[('none', 'Aucun test pour l’instant'), ('ielts_general', 'IELTS General Training'), ('celpip_general', 'CELPIP General'), ('pte_core', 'PTE Core'), ('toefl', 'TOEFL iBT (info seulement)')], default='none', max_length=30),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\migrations\0002_alter_prplanstep_options_prprofile_english_exam_and_more.py
LINE: 24
        migrations.AddField(
            model_name='prprofile',
            name='french_exam',
            field=models.CharField(choices=[('none', 'Aucun test pour l’instant'), ('tef_canada', 'TEF Canada'), ('tcf_canada', 'TCF Canada'), ('tefaq', 'TEFAQ'), ('tcf_other', 'TCF autre / DELF / DALF')], default='none', max_length=30),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\migrations\0003_prprofile_english_ce_prprofile_english_co_and_more.py
LINE: 9

    dependencies = [
        ('permanent_residence', '0002_alter_prplanstep_options_prprofile_english_exam_and_more'),
    ]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\migrations\0003_prprofile_english_ce_prprofile_english_co_and_more.py
LINE: 60
        migrations.AlterField(
            model_name='prprofile',
            name='english_exam',
            field=models.CharField(choices=[('none', 'Aucun test pour l’instant'), ('ielts_general', 'IELTS General Training'), ('celpip_general', 'CELPIP General'), ('pte_core', 'PTE Core'), ('toefl', 'TOEFL iBT (info)')], default='none', max_length=30, verbose_name='Test d’anglais'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\migrations\0003_prprofile_english_ce_prprofile_english_co_and_more.py
LINE: 70
        migrations.AlterField(
            model_name='prprofile',
            name='french_exam',
            field=models.CharField(choices=[('none', 'Aucun test pour l’instant'), ('tef_canada', 'TEF Canada'), ('tcf_canada', 'TCF Canada'), ('tefaq', 'TEFAQ'), ('tcf_other', 'TCF / DELF / DALF (autre)')], default='none', max_length=30, verbose_name='Test de français'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\forms.py
LINE: 14
            "education_level",

            "french_exam",
            "french_level",
            "french_co",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\forms.py
LINE: 21
            "french_ee",

            "english_exam",
            "english_level",
            "english_co",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\forms.py
LINE: 41
            "education_level": "Niveau d’études",

            "french_exam": "Test de français",
            "french_level": "Niveau global de français",
            "french_co": "Français – CO (compréhension orale)",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\forms.py
LINE: 48
            "french_ee": "Français – EE (expression écrite)",

            "english_exam": "Test d’anglais",
            "english_level": "Niveau global d’anglais",
            "english_co": "Anglais – Listening (CO)",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\models.py
LINE: 21
    ]

    FRENCH_EXAM_CHOICES = [
        ("none", "Aucun test pour l’instant"),
        ("tef_canada", "TEF Canada"),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\models.py
LINE: 29
    ]

    ENGLISH_EXAM_CHOICES = [
        ("none", "Aucun test pour l’instant"),
        ("ielts_general", "IELTS General Training"),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\models.py
LINE: 73

    # --------- FRANÇAIS --------- #
    french_exam = models.CharField(
        "Test de français",
        max_length=30,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\models.py
LINE: 76
        "Test de français",
        max_length=30,
        choices=FRENCH_EXAM_CHOICES,
        default="none",
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\models.py
LINE: 111

    # --------- ANGLAIS --------- #
    english_exam = models.CharField(
        "Test d’anglais",
        max_length=30,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\models.py
LINE: 114
        "Test d’anglais",
        max_length=30,
        choices=ENGLISH_EXAM_CHOICES,
        default="none",
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\models.py
LINE: 176
    STATUS_CHOICES = [
        ("todo", "À faire"),
        ("in_progress", "En cours"),
        ("done", "Terminé"),
    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\views.py
LINE: 174
    - calcule l'évaluation générale
    - calcule les programmes possibles
    - calcule la progression (plan d'action)
    """
    profile = get_object_or_404(PRProfile, pk=profile_id, user=request.user)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\views.py
LINE: 187
    program_results = evaluate_profile(profile)

    # Progression globale du plan (pour la barre en %)
    all_steps = list(profile.steps.all())
    total_steps = len(all_steps)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\views.py
LINE: 191
    total_steps = len(all_steps)
    done_steps = len([s for s in all_steps if s.status == "done"])
    progress_percent = int(done_steps * 100 / total_steps) if total_steps > 0 else 0

    return render(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\views.py
LINE: 200
            "evaluation": evaluation,
            "program_results": program_results,
            "progress_percent": progress_percent,
        },
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\views.py
LINE: 331
        steps = [s for s in all_steps if getattr(s, "category", None) == category]

    # Progression globale
    total_steps = len(all_steps)
    done_steps = len([s for s in all_steps if s.status == "done"])
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\views.py
LINE: 334
    total_steps = len(all_steps)
    done_steps = len([s for s in all_steps if s.status == "done"])
    progress_pct = int(done_steps * 100 / total_steps) if total_steps > 0 else 0

    context = {
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\views.py
LINE: 340
        "steps": steps,
        "category": category,
        "progress_pct": progress_pct,
    }
    return render(request, "permanent_residence/plan.html", context)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\views.py
LINE: 536


def _compute_plan_progress(profile: PRProfile) -> int:
    """
    Pourcentage d'étapes de plan déjà terminées.
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\views.py
LINE: 597
    Renvoie les prochaines actions à partir du plan RP.
    """
    pending = profile.steps.filter(status__in=["todo", "in_progress"]).order_by("order")
    return list(pending[:max_items])

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\views.py
LINE: 668
        "slug": "etudes_vers_rp",
        "label": "Études + expérience locale → Résidence permanente",
        "tag": "Voie progressive",
        "color": "violet",
        "summary": (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\views.py
LINE: 736

    profile_completion = _compute_profile_completion(profile)
    plan_progress = _compute_plan_progress(profile)
    language_score = _compute_language_score(profile)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\views.py
LINE: 742
    readiness_score = int(
        profile_completion * 0.4
        + plan_progress * 0.4
        + language_score * 0.2
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\permanent_residence\views.py
LINE: 754
        "readiness_score": readiness_score,
        "profile_completion": profile_completion,
        "plan_progress": plan_progress,
        "language_score": language_score,
        "next_actions": next_actions,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\generate_exercise_audio.py
LINE: 7
import uuid

from preparation_tests.models import CourseExercise, Asset


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\generate_exercise_audio.py
LINE: 14

    def handle(self, *args, **options):
        exercises = CourseExercise.objects.filter(audio__isnull=True)

        if not exercises.exists():
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\generate_exercise_audio.py
LINE: 16
        exercises = CourseExercise.objects.filter(audio__isnull=True)

        if not exercises.exists():
            self.stdout.write(self.style.SUCCESS("✅ Aucun exercice à traiter"))
            return
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\generate_exercise_audio.py
LINE: 25
        model_path = Path(settings.BASE_DIR) / "tts_engine/voices/fr_FR-upmc-medium.onnx"

        for ex in exercises:
            text = ex.question_text.strip()
            if not text:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\generate_exercise_audio.py
LINE: 30
                continue

            filename = f"exercise_{ex.id}_{uuid.uuid4().hex}.wav"
            output_path = audio_dir / filename

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 4
# -*- coding: utf-8 -*-
"""
Management command pour importer les examens de compréhension orale
depuis un fichier JSON vers les modèles Exam, ExamSection, Question, Choice, Explanation.

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 5
"""
Management command pour importer les examens de compréhension orale
depuis un fichier JSON vers les modèles Exam, ExamSection, Question, Choice, Explanation.

Usage:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 8

Usage:
    python manage.py import_exams --file ai_engine/learning_content/exams_listening_fr.json
    python manage.py import_exams --file <path> --level A1 --language fr --clear
"""
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 9
Usage:
    python manage.py import_exams --file ai_engine/learning_content/exams_listening_fr.json
    python manage.py import_exams --file <path> --level A1 --language fr --clear
"""

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 18

from django.core.management.base import BaseCommand, CommandError
from django.db import transaction

from preparation_tests.models import (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 21

from preparation_tests.models import (
    Exam,
    ExamSection,
    Question,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 22
from preparation_tests.models import (
    Exam,
    ExamSection,
    Question,
    Choice,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 30

class Command(BaseCommand):
    help = "Importe les examens de compréhension orale dans Exam & ExamSection & Question"

    def add_arguments(self, parser):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 54
            "--clear",
            action="store_true",
            help="Supprime les examens existants avant import",
        )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 57
        )

    @transaction.atomic
    def handle(self, *args, **options):
        file_path = options["file"]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 81

        # Valider la structure
        if "exams" not in data or not isinstance(data["exams"], list):
            raise CommandError("❌ Structure JSON invalide: 'exams' manquant")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 82
        # Valider la structure
        if "exams" not in data or not isinstance(data["exams"], list):
            raise CommandError("❌ Structure JSON invalide: 'exams' manquant")

        # Supprimer les examens existants si --clear
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 84
            raise CommandError("❌ Structure JSON invalide: 'exams' manquant")

        # Supprimer les examens existants si --clear
        if clear_existing:
            if level_filter:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 87
        if clear_existing:
            if level_filter:
                Exam.objects.filter(code__contains=f"CO_{level_filter}").delete()
                self.stdout.write(
                    self.style.WARNING(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 90
                self.stdout.write(
                    self.style.WARNING(
                        f"🗑️  Examens {level_filter} existants supprimés"
                    )
                )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 94
                )
            else:
                Exam.objects.filter(code__startswith="CO_").delete()
                self.stdout.write(
                    self.style.WARNING(f"🗑️  Tous les examens CO supprimés")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 96
                Exam.objects.filter(code__startswith="CO_").delete()
                self.stdout.write(
                    self.style.WARNING(f"🗑️  Tous les examens CO supprimés")
                )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 100

        # Compteurs
        exam_count = 0
        section_count = 0
        question_count = 0
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 105
        choice_count = 0

        # Importer les examens
        for exam_data in data["exams"]:
            exam_code = exam_data.get("exam_code", "")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 106

        # Importer les examens
        for exam_data in data["exams"]:
            exam_code = exam_data.get("exam_code", "")
            exam_name = exam_data.get("exam_name", "")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 107
        # Importer les examens
        for exam_data in data["exams"]:
            exam_code = exam_data.get("exam_code", "")
            exam_name = exam_data.get("exam_name", "")
            exam_level = exam_data.get("level", "A1")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 108
        for exam_data in data["exams"]:
            exam_code = exam_data.get("exam_code", "")
            exam_name = exam_data.get("exam_name", "")
            exam_level = exam_data.get("level", "A1")
            exam_language = exam_data.get("language", language)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 109
            exam_code = exam_data.get("exam_code", "")
            exam_name = exam_data.get("exam_name", "")
            exam_level = exam_data.get("level", "A1")
            exam_language = exam_data.get("language", language)
            description = exam_data.get("description", "")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 110
            exam_name = exam_data.get("exam_name", "")
            exam_level = exam_data.get("level", "A1")
            exam_language = exam_data.get("language", language)
            description = exam_data.get("description", "")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 111
            exam_level = exam_data.get("level", "A1")
            exam_language = exam_data.get("language", language)
            description = exam_data.get("description", "")

            # Filtrer par niveau si spécifié
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 114

            # Filtrer par niveau si spécifié
            if level_filter and exam_level != level_filter:
                continue

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 118

            try:
                # Créer l'examen
                exam, exam_created = Exam.objects.get_or_create(
                    code=exam_code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 119
            try:
                # Créer l'examen
                exam, exam_created = Exam.objects.get_or_create(
                    code=exam_code,
                    defaults={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 120
                # Créer l'examen
                exam, exam_created = Exam.objects.get_or_create(
                    code=exam_code,
                    defaults={
                        "name": exam_name,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 122
                    code=exam_code,
                    defaults={
                        "name": exam_name,
                        "language": exam_language,
                        "description": description,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 123
                    defaults={
                        "name": exam_name,
                        "language": exam_language,
                        "description": description,
                    },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 128
                )

                if exam_created:
                    self.stdout.write(
                        self.style.SUCCESS(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 131
                    self.stdout.write(
                        self.style.SUCCESS(
                            f"  ✅ Examen: {exam_name} ({exam_code}) créé"
                        )
                    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 134
                        )
                    )
                    exam_count += 1
                else:
                    self.stdout.write(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 138
                    self.stdout.write(
                        self.style.WARNING(
                            f"  ⚠️  Examen: {exam_name} ({exam_code}) existant"
                        )
                    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 143

                # Importer les sections
                sections = exam_data.get("sections", [])

                for section_data in sections:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 153
                    try:
                        # Créer ou récupérer la section
                        section, sec_created = ExamSection.objects.get_or_create(
                            exam=exam,
                            code=section_code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 154
                        # Créer ou récupérer la section
                        section, sec_created = ExamSection.objects.get_or_create(
                            exam=exam,
                            code=section_code,
                            defaults={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 257

            except Exception as e:
                self.stdout.write(self.style.ERROR(f"❌ Erreur examen {exam_code}: {e}"))

        # Résumé
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 263
        self.stdout.write(self.style.SUCCESS(f"📊 RÉSUMÉ DE L'IMPORT"))
        self.stdout.write(self.style.SUCCESS("=" * 60))
        self.stdout.write(self.style.SUCCESS(f"✅ Examens créés: {exam_count}"))
        self.stdout.write(self.style.SUCCESS(f"✅ Sections créées: {section_count}"))
        self.stdout.write(self.style.SUCCESS(f"✅ Questions créées: {question_count}"))
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_exams.py
LINE: 273
        self.stdout.write(
            self.style.SUCCESS(
                "\n🎯 Import réussi! Les examens sont prêts pour les étudiants.\n"
            )
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 4
# -*- coding: utf-8 -*-
"""
Management command pour importer le curriculum de compréhension orale
depuis un fichier JSON vers les CourseLesson et CourseExercise.

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 5
"""
Management command pour importer le curriculum de compréhension orale
depuis un fichier JSON vers les CourseLesson et CourseExercise.

Usage:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 8

Usage:
    python manage.py import_listening_curriculum --file ai_engine/learning_content/listening_curriculum_A1_fr.json
    python manage.py import_listening_curriculum --file <path> --level A1 --language fr --clear
"""
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 9
Usage:
    python manage.py import_listening_curriculum --file ai_engine/learning_content/listening_curriculum_A1_fr.json
    python manage.py import_listening_curriculum --file <path> --level A1 --language fr --clear
"""

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 18

from django.core.management.base import BaseCommand, CommandError
from django.db import transaction

from preparation_tests.models import CourseLesson, CourseExercise
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 20
from django.db import transaction

from preparation_tests.models import CourseLesson, CourseExercise


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 24

class Command(BaseCommand):
    help = "Importe un curriculum de compréhension orale dans CourseLesson & CourseExercise"

    def add_arguments(self, parser):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 51
        )

    @transaction.atomic
    def handle(self, *args, **options):
        file_path = options["file"]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 75

        # Valider la structure
        if "lessons" not in data or not isinstance(data["lessons"], list):
            raise CommandError("❌ Structure JSON invalide: 'lessons' manquant")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 76
        # Valider la structure
        if "lessons" not in data or not isinstance(data["lessons"], list):
            raise CommandError("❌ Structure JSON invalide: 'lessons' manquant")

        # Supprimer les leçons existantes si --clear
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 80
        # Supprimer les leçons existantes si --clear
        if clear_existing:
            CourseLesson.objects.filter(level=level, locale=language).delete()
            self.stdout.write(self.style.WARNING(f"🗑️  Leçons existantes supprimées"))

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 84

        # Compteurs
        lesson_count = 0
        exercise_count = 0

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 85
        # Compteurs
        lesson_count = 0
        exercise_count = 0

        # Importer les leçons
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 88

        # Importer les leçons
        for lesson_data in data["lessons"]:
            lesson_number = lesson_data.get("lesson_number", 0)
            lesson_title = lesson_data.get("title", "")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 89
        # Importer les leçons
        for lesson_data in data["lessons"]:
            lesson_number = lesson_data.get("lesson_number", 0)
            lesson_title = lesson_data.get("title", "")
            lesson_obj = lesson_data.get("objective", "")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 90
        for lesson_data in data["lessons"]:
            lesson_number = lesson_data.get("lesson_number", 0)
            lesson_title = lesson_data.get("title", "")
            lesson_obj = lesson_data.get("objective", "")
            vocab_focus = lesson_data.get("vocabulary_focus", [])
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 91
            lesson_number = lesson_data.get("lesson_number", 0)
            lesson_title = lesson_data.get("title", "")
            lesson_obj = lesson_data.get("objective", "")
            vocab_focus = lesson_data.get("vocabulary_focus", [])

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 92
            lesson_title = lesson_data.get("title", "")
            lesson_obj = lesson_data.get("objective", "")
            vocab_focus = lesson_data.get("vocabulary_focus", [])

            try:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 96
            try:
                # Créer la leçon
                slug = slugify(f"{level}-lecon-{lesson_number}-{lesson_title}")
                
                # Générer un HTML simple pour le contenu
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 100
                # Générer un HTML simple pour le contenu
                content_html = f"""
                <h2>{lesson_title}</h2>
                <p><strong>Objectif:</strong> {lesson_obj}</p>
                <p><strong>Vocabulaire:</strong> {', '.join(vocab_focus)}</p>
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 101
                content_html = f"""
                <h2>{lesson_title}</h2>
                <p><strong>Objectif:</strong> {lesson_obj}</p>
                <p><strong>Vocabulaire:</strong> {', '.join(vocab_focus)}</p>
                """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 105
                """

                lesson, created = CourseLesson.objects.get_or_create(
                    slug=slug,
                    defaults={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 108
                    slug=slug,
                    defaults={
                        "title": lesson_title,
                        "level": level,
                        "section": "co",  # Compréhension Orale
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 113
                        "locale": language,
                        "content_html": content_html,
                        "order": lesson_number,
                        "is_published": True,
                    },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 121
                    self.stdout.write(
                        self.style.SUCCESS(
                            f"  ✅ Leçon {lesson_number}: {lesson_title} créée"
                        )
                    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 127
                    self.stdout.write(
                        self.style.WARNING(
                            f"  ⚠️  Leçon {lesson_number}: {lesson_title} existante"
                        )
                    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 131
                    )

                lesson_count += 1

                # Importer les exercices
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 134

                # Importer les exercices
                exercises = lesson_data.get("exercises", [])

                for exercise_data in exercises:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 136
                exercises = lesson_data.get("exercises", [])

                for exercise_data in exercises:
                    try:
                        exercise_number = exercise_data.get("exercise_number", 0)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 138
                for exercise_data in exercises:
                    try:
                        exercise_number = exercise_data.get("exercise_number", 0)
                        question_text = exercise_data.get("question", "")
                        audio_script = exercise_data.get("audio_script", "")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 139
                    try:
                        exercise_number = exercise_data.get("exercise_number", 0)
                        question_text = exercise_data.get("question", "")
                        audio_script = exercise_data.get("audio_script", "")
                        exercise_type = exercise_data.get("type", "multiple_choice")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 140
                        exercise_number = exercise_data.get("exercise_number", 0)
                        question_text = exercise_data.get("question", "")
                        audio_script = exercise_data.get("audio_script", "")
                        exercise_type = exercise_data.get("type", "multiple_choice")
                        options = exercise_data.get("options", {})
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 141
                        question_text = exercise_data.get("question", "")
                        audio_script = exercise_data.get("audio_script", "")
                        exercise_type = exercise_data.get("type", "multiple_choice")
                        options = exercise_data.get("options", {})
                        correct_answer = exercise_data.get("correct_answer", "")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 142
                        audio_script = exercise_data.get("audio_script", "")
                        exercise_type = exercise_data.get("type", "multiple_choice")
                        options = exercise_data.get("options", {})
                        correct_answer = exercise_data.get("correct_answer", "")
                        explanation = exercise_data.get("explanation", "")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 143
                        exercise_type = exercise_data.get("type", "multiple_choice")
                        options = exercise_data.get("options", {})
                        correct_answer = exercise_data.get("correct_answer", "")
                        explanation = exercise_data.get("explanation", "")
                        difficulty_prog = exercise_data.get("difficulty_progression", 5)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 144
                        options = exercise_data.get("options", {})
                        correct_answer = exercise_data.get("correct_answer", "")
                        explanation = exercise_data.get("explanation", "")
                        difficulty_prog = exercise_data.get("difficulty_progression", 5)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 145
                        correct_answer = exercise_data.get("correct_answer", "")
                        explanation = exercise_data.get("explanation", "")
                        difficulty_prog = exercise_data.get("difficulty_progression", 5)

                        # Mapper les options A, B, C, D
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 149
                        # Mapper les options A, B, C, D
                        # Gérer les exercices vrai/faux en les convertissant en A/B
                        if exercise_type == "vrai_faux":
                            option_a = "Vrai"
                            option_b = "Faux"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 163

                        # Créer l'exercice
                        exercise, ex_created = CourseExercise.objects.get_or_create(
                            lesson=lesson,
                            title=f"Exercice {exercise_number}",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 164
                        # Créer l'exercice
                        exercise, ex_created = CourseExercise.objects.get_or_create(
                            lesson=lesson,
                            title=f"Exercice {exercise_number}",
                            defaults={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 165
                        exercise, ex_created = CourseExercise.objects.get_or_create(
                            lesson=lesson,
                            title=f"Exercice {exercise_number}",
                            defaults={
                                "instruction": audio_script,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 175
                                "correct_option": correct_answer,
                                "summary": explanation,
                                "order": exercise_number,
                                "is_active": True,
                            },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 181

                        if ex_created:
                            exercise_count += 1

                    except Exception as e:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 186
                        self.stdout.write(
                            self.style.ERROR(
                                f"    ❌ Erreur exercice {exercise_number}: {e}"
                            )
                        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 192
                self.stdout.write(
                    self.style.SUCCESS(
                        f"    📝 {len(exercises)} exercices importés pour leçon {lesson_number}"
                    )
                )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 199
                self.stdout.write(
                    self.style.ERROR(
                        f"❌ Erreur leçon {lesson_number}: {e}"
                    )
                )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 207
        self.stdout.write(self.style.SUCCESS(f"📊 RÉSUMÉ DE L'IMPORT"))
        self.stdout.write(self.style.SUCCESS("=" * 60))
        self.stdout.write(self.style.SUCCESS(f"✅ Leçons créées: {lesson_count}"))
        self.stdout.write(self.style.SUCCESS(f"✅ Exercices créés: {exercise_count}"))
        self.stdout.write(self.style.SUCCESS(f"✅ Niveau: {level} ({language})"))
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 208
        self.stdout.write(self.style.SUCCESS("=" * 60))
        self.stdout.write(self.style.SUCCESS(f"✅ Leçons créées: {lesson_count}"))
        self.stdout.write(self.style.SUCCESS(f"✅ Exercices créés: {exercise_count}"))
        self.stdout.write(self.style.SUCCESS(f"✅ Niveau: {level} ({language})"))
        self.stdout.write(self.style.SUCCESS(f"✅ Section: Compréhension Orale"))
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_listening_curriculum.py
LINE: 214
        self.stdout.write(
            self.style.SUCCESS(
                "\n🎯 Import réussi! Les leçons sont prêtes pour les examens.\n"
            )
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 4
# -*- coding: utf-8 -*-
"""
Management command pour importer le curriculum de compréhension écrite (CE)
depuis un fichier JSON vers les CourseLesson et CourseExercise.

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 5
"""
Management command pour importer le curriculum de compréhension écrite (CE)
depuis un fichier JSON vers les CourseLesson et CourseExercise.

Usage:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 8

Usage:
    python manage.py import_reading_curriculum --file ai_engine/learning_content/reading_curriculum_A1_fr.json
"""

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 17

from django.core.management.base import BaseCommand, CommandError
from django.db import transaction

from preparation_tests.models import CourseLesson, CourseExercise
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 19
from django.db import transaction

from preparation_tests.models import CourseLesson, CourseExercise


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 23

class Command(BaseCommand):
    help = "Importe un curriculum de compréhension écrite dans CourseLesson & CourseExercise"

    def add_arguments(self, parser):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 50
        )

    @transaction.atomic
    def handle(self, *args, **options):
        file_path = options["file"]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 73

        # Valider la structure
        if "lessons" not in data or not isinstance(data["lessons"], list):
            raise CommandError("❌ Structure JSON invalide: 'lessons' manquant")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 74
        # Valider la structure
        if "lessons" not in data or not isinstance(data["lessons"], list):
            raise CommandError("❌ Structure JSON invalide: 'lessons' manquant")

        level = data.get("level", "A1")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 80
        # Supprimer les leçons existantes si --clear
        if clear_existing:
            CourseLesson.objects.filter(level=level, locale=language, section="ce").delete()
            self.stdout.write(self.style.WARNING(f"🗑️  Leçons CE existantes supprimées"))

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 84

        # Compteurs
        lesson_count = 0
        exercise_count = 0

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 85
        # Compteurs
        lesson_count = 0
        exercise_count = 0

        # Importer les leçons
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 88

        # Importer les leçons
        for lesson_data in data["lessons"]:
            lesson_number = lesson_data.get("lesson_number", 0)
            lesson_title = lesson_data.get("title", "")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 89
        # Importer les leçons
        for lesson_data in data["lessons"]:
            lesson_number = lesson_data.get("lesson_number", 0)
            lesson_title = lesson_data.get("title", "")
            lesson_obj = lesson_data.get("objective", "")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 90
        for lesson_data in data["lessons"]:
            lesson_number = lesson_data.get("lesson_number", 0)
            lesson_title = lesson_data.get("title", "")
            lesson_obj = lesson_data.get("objective", "")
            vocab_focus = lesson_data.get("vocabulary_focus", [])
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 91
            lesson_number = lesson_data.get("lesson_number", 0)
            lesson_title = lesson_data.get("title", "")
            lesson_obj = lesson_data.get("objective", "")
            vocab_focus = lesson_data.get("vocabulary_focus", [])

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 92
            lesson_title = lesson_data.get("title", "")
            lesson_obj = lesson_data.get("objective", "")
            vocab_focus = lesson_data.get("vocabulary_focus", [])

            try:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 96
            try:
                # Créer la leçon
                slug = slugify(f"{level}-lecon-{lesson_number}-{lesson_title}")
                
                # Générer un HTML simple pour le contenu
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 100
                # Générer un HTML simple pour le contenu
                content_html = f"""
                <h2>{lesson_title}</h2>
                <p><strong>Objectif:</strong> {lesson_obj}</p>
                <p><strong>Vocabulaire:</strong> {', '.join(vocab_focus)}</p>
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 101
                content_html = f"""
                <h2>{lesson_title}</h2>
                <p><strong>Objectif:</strong> {lesson_obj}</p>
                <p><strong>Vocabulaire:</strong> {', '.join(vocab_focus)}</p>
                """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 105
                """

                lesson, created = CourseLesson.objects.get_or_create(
                    slug=slug,
                    defaults={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 108
                    slug=slug,
                    defaults={
                        "title": lesson_title,
                        "level": level,
                        "section": "ce",  # Compréhension Écrite
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 113
                        "locale": language,
                        "content_html": content_html,
                        "order": lesson_number,
                        "is_published": True,
                    },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 121
                    self.stdout.write(
                        self.style.SUCCESS(
                            f"  ✅ Leçon {lesson_number}: {lesson_title} créée"
                        )
                    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 127
                    self.stdout.write(
                        self.style.WARNING(
                            f"  ⚠️  Leçon {lesson_number}: {lesson_title} existante"
                        )
                    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 131
                    )

                lesson_count += 1

                # Importer les exercices
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 134

                # Importer les exercices
                exercises = lesson_data.get("exercises", [])

                for exercise_data in exercises:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 136
                exercises = lesson_data.get("exercises", [])

                for exercise_data in exercises:
                    try:
                        exercise_number = exercise_data.get("exercise_number", 0)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 138
                for exercise_data in exercises:
                    try:
                        exercise_number = exercise_data.get("exercise_number", 0)
                        question_text = exercise_data.get("question", "")
                        passage_text = exercise_data.get("passage_text", "")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 139
                    try:
                        exercise_number = exercise_data.get("exercise_number", 0)
                        question_text = exercise_data.get("question", "")
                        passage_text = exercise_data.get("passage_text", "")
                        exercise_type = exercise_data.get("type", "multiple_choice")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 140
                        exercise_number = exercise_data.get("exercise_number", 0)
                        question_text = exercise_data.get("question", "")
                        passage_text = exercise_data.get("passage_text", "")
                        exercise_type = exercise_data.get("type", "multiple_choice")
                        options = exercise_data.get("options", {})
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 141
                        question_text = exercise_data.get("question", "")
                        passage_text = exercise_data.get("passage_text", "")
                        exercise_type = exercise_data.get("type", "multiple_choice")
                        options = exercise_data.get("options", {})
                        correct_answer = exercise_data.get("correct_answer", "")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 142
                        passage_text = exercise_data.get("passage_text", "")
                        exercise_type = exercise_data.get("type", "multiple_choice")
                        options = exercise_data.get("options", {})
                        correct_answer = exercise_data.get("correct_answer", "")
                        explanation = exercise_data.get("explanation", "")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 143
                        exercise_type = exercise_data.get("type", "multiple_choice")
                        options = exercise_data.get("options", {})
                        correct_answer = exercise_data.get("correct_answer", "")
                        explanation = exercise_data.get("explanation", "")
                        difficulty_prog = exercise_data.get("difficulty_progression", 1)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 144
                        options = exercise_data.get("options", {})
                        correct_answer = exercise_data.get("correct_answer", "")
                        explanation = exercise_data.get("explanation", "")
                        difficulty_prog = exercise_data.get("difficulty_progression", 1)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 145
                        correct_answer = exercise_data.get("correct_answer", "")
                        explanation = exercise_data.get("explanation", "")
                        difficulty_prog = exercise_data.get("difficulty_progression", 1)

                        # Mapper les options A, B, C, D
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 148

                        # Mapper les options A, B, C, D
                        if exercise_type == "vrai_faux":
                            option_a = "Vrai"
                            option_b = "Faux"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 161

                        # Créer l'exercice
                        exercise, ex_created = CourseExercise.objects.get_or_create(
                            lesson=lesson,
                            title=f"Exercice {exercise_number}",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 162
                        # Créer l'exercice
                        exercise, ex_created = CourseExercise.objects.get_or_create(
                            lesson=lesson,
                            title=f"Exercice {exercise_number}",
                            defaults={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 163
                        exercise, ex_created = CourseExercise.objects.get_or_create(
                            lesson=lesson,
                            title=f"Exercice {exercise_number}",
                            defaults={
                                "instruction": passage_text,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 173
                                "correct_option": correct_answer,
                                "summary": explanation,
                                "order": exercise_number,
                                "is_active": True,
                            },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 179

                        if ex_created:
                            exercise_count += 1

                    except Exception as e:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 184
                        self.stdout.write(
                            self.style.ERROR(
                                f"    ❌ Erreur exercice {exercise_number}: {e}"
                            )
                        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 190
                self.stdout.write(
                    self.style.SUCCESS(
                        f"    📝 {len(exercises)} exercices importés pour leçon {lesson_number}"
                    )
                )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 197
                self.stdout.write(
                    self.style.ERROR(
                        f"❌ Erreur leçon {lesson_number}: {e}"
                    )
                )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 205
        self.stdout.write(self.style.SUCCESS(f"📊 RÉSUMÉ DE L'IMPORT CE"))
        self.stdout.write(self.style.SUCCESS("=" * 60))
        self.stdout.write(self.style.SUCCESS(f"✅ Leçons créées: {lesson_count}"))
        self.stdout.write(self.style.SUCCESS(f"✅ Exercices créés: {exercise_count}"))
        self.stdout.write(self.style.SUCCESS(f"✅ Niveau: {level}"))
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 206
        self.stdout.write(self.style.SUCCESS("=" * 60))
        self.stdout.write(self.style.SUCCESS(f"✅ Leçons créées: {lesson_count}"))
        self.stdout.write(self.style.SUCCESS(f"✅ Exercices créés: {exercise_count}"))
        self.stdout.write(self.style.SUCCESS(f"✅ Niveau: {level}"))
        self.stdout.write(self.style.SUCCESS(f"✅ Section: Compréhension Écrite (CE)"))
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_curriculum.py
LINE: 213
        self.stdout.write(
            self.style.SUCCESS(
                "\n✨ Import réussi! Le curriculum CE est prêt pour les étudiants.\n"
            )
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 4
# -*- coding: utf-8 -*-
"""
Management command pour importer les exams de compréhension écrite (CE)
depuis un fichier JSON vers les modèles Exam, ExamSection, Passage, Question, Choice, Explanation.

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 5
"""
Management command pour importer les exams de compréhension écrite (CE)
depuis un fichier JSON vers les modèles Exam, ExamSection, Passage, Question, Choice, Explanation.

Usage:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 8

Usage:
    python manage.py import_reading_exams --file ai_engine/learning_content/exams_reading_a_b_fr.json
"""

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 17

from django.core.management.base import BaseCommand, CommandError
from django.db import transaction

from preparation_tests.models import (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 20

from preparation_tests.models import (
    Exam,
    ExamSection,
    Question,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 21
from preparation_tests.models import (
    Exam,
    ExamSection,
    Question,
    Choice,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 30

class Command(BaseCommand):
    help = "Importe les exams de compréhension écrite dans Exam & ExamSection & Question & Passage"

    def add_arguments(self, parser):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 54
            "--clear",
            action="store_true",
            help="Supprime les exams existants avant import",
        )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 57
        )

    @transaction.atomic
    def handle(self, *args, **options):
        file_path = options["file"]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 81

        # Valider la structure
        if "exams" not in data or not isinstance(data["exams"], list):
            raise CommandError("❌ Structure JSON invalide: 'exams' manquant")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 82
        # Valider la structure
        if "exams" not in data or not isinstance(data["exams"], list):
            raise CommandError("❌ Structure JSON invalide: 'exams' manquant")

        # Supprimer les exams existants si --clear
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 84
            raise CommandError("❌ Structure JSON invalide: 'exams' manquant")

        # Supprimer les exams existants si --clear
        if clear_existing:
            if level_filter:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 87
        if clear_existing:
            if level_filter:
                Exam.objects.filter(code__contains=f"CE_{level_filter}").delete()
                self.stdout.write(
                    self.style.WARNING(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 90
                self.stdout.write(
                    self.style.WARNING(
                        f"🗑️  Exams CE {level_filter} existants supprimés"
                    )
                )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 94
                )
            else:
                Exam.objects.filter(code__startswith="CE_").delete()
                self.stdout.write(
                    self.style.WARNING(f"🗑️  Tous les exams CE supprimés")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 96
                Exam.objects.filter(code__startswith="CE_").delete()
                self.stdout.write(
                    self.style.WARNING(f"🗑️  Tous les exams CE supprimés")
                )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 100

        # Compteurs
        exam_count = 0
        section_count = 0
        passage_count = 0
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 106
        choice_count = 0

        # Importer les exams
        for exam_data in data["exams"]:
            exam_code = exam_data.get("exam_code", "")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 107

        # Importer les exams
        for exam_data in data["exams"]:
            exam_code = exam_data.get("exam_code", "")
            exam_name = exam_data.get("exam_name", "")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 108
        # Importer les exams
        for exam_data in data["exams"]:
            exam_code = exam_data.get("exam_code", "")
            exam_name = exam_data.get("exam_name", "")
            exam_level = exam_data.get("level", "A1")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 109
        for exam_data in data["exams"]:
            exam_code = exam_data.get("exam_code", "")
            exam_name = exam_data.get("exam_name", "")
            exam_level = exam_data.get("level", "A1")
            exam_language = exam_data.get("language", language)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 110
            exam_code = exam_data.get("exam_code", "")
            exam_name = exam_data.get("exam_name", "")
            exam_level = exam_data.get("level", "A1")
            exam_language = exam_data.get("language", language)
            description = exam_data.get("description", "")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 111
            exam_name = exam_data.get("exam_name", "")
            exam_level = exam_data.get("level", "A1")
            exam_language = exam_data.get("language", language)
            description = exam_data.get("description", "")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 112
            exam_level = exam_data.get("level", "A1")
            exam_language = exam_data.get("language", language)
            description = exam_data.get("description", "")

            # Filtrer par niveau si spécifié
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 115

            # Filtrer par niveau si spécifié
            if level_filter and exam_level != level_filter:
                continue

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 119

            try:
                # Créer l'examen
                exam, exam_created = Exam.objects.get_or_create(
                    code=exam_code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 120
            try:
                # Créer l'examen
                exam, exam_created = Exam.objects.get_or_create(
                    code=exam_code,
                    defaults={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 121
                # Créer l'examen
                exam, exam_created = Exam.objects.get_or_create(
                    code=exam_code,
                    defaults={
                        "name": exam_name,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 123
                    code=exam_code,
                    defaults={
                        "name": exam_name,
                        "language": exam_language,
                        "description": description,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 124
                    defaults={
                        "name": exam_name,
                        "language": exam_language,
                        "description": description,
                    },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 129
                )

                if exam_created:
                    self.stdout.write(
                        self.style.SUCCESS(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 132
                    self.stdout.write(
                        self.style.SUCCESS(
                            f"  ✅ Examen: {exam_name} ({exam_code}) créé"
                        )
                    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 135
                        )
                    )
                    exam_count += 1
                else:
                    self.stdout.write(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 139
                    self.stdout.write(
                        self.style.WARNING(
                            f"  ⚠️  Examen: {exam_name} ({exam_code}) existant"
                        )
                    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 144

                # Importer les sections
                sections = exam_data.get("sections", [])

                for section_data in sections:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 154
                    try:
                        # Créer ou récupérer la section
                        section, sec_created = ExamSection.objects.get_or_create(
                            exam=exam,
                            code=section_code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 155
                        # Créer ou récupérer la section
                        section, sec_created = ExamSection.objects.get_or_create(
                            exam=exam,
                            code=section_code,
                            defaults={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 285

            except Exception as e:
                self.stdout.write(self.style.ERROR(f"❌ Erreur examen {exam_code}: {e}"))

        # Résumé
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 289
        # Résumé
        self.stdout.write(self.style.SUCCESS("\n" + "=" * 60))
        self.stdout.write(self.style.SUCCESS(f"📊 RÉSUMÉ DE L'IMPORT EXAMS CE"))
        self.stdout.write(self.style.SUCCESS("=" * 60))
        self.stdout.write(self.style.SUCCESS(f"✅ Exams créés: {exam_count}"))
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 291
        self.stdout.write(self.style.SUCCESS(f"📊 RÉSUMÉ DE L'IMPORT EXAMS CE"))
        self.stdout.write(self.style.SUCCESS("=" * 60))
        self.stdout.write(self.style.SUCCESS(f"✅ Exams créés: {exam_count}"))
        self.stdout.write(self.style.SUCCESS(f"✅ Sections créées: {section_count}"))
        self.stdout.write(self.style.SUCCESS(f"✅ Passages créés: {passage_count}"))
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_reading_exams.py
LINE: 303
        self.stdout.write(
            self.style.SUCCESS(
                "\n✨ Import réussi! Les exams CE sont prêts pour les étudiants.\n"
            )
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 2
"""
Management command: import_writing_curriculum
Importe le curriculum Expression Écrite (EE) depuis JSON
"""
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 3
"""
Management command: import_writing_curriculum
Importe le curriculum Expression Écrite (EE) depuis JSON
"""

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 8
import json
from django.core.management.base import BaseCommand
from django.db import transaction
from preparation_tests.models import CourseLesson, CourseExercise

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 9
from django.core.management.base import BaseCommand
from django.db import transaction
from preparation_tests.models import CourseLesson, CourseExercise


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 13

class Command(BaseCommand):
    help = "Importe le curriculum EE (Expression Écrite) depuis JSON"

    def add_arguments(self, parser):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 20
            type=str,
            required=True,
            help="Chemin vers le fichier JSON du curriculum EE",
        )
        parser.add_argument(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 40
        )

    @transaction.atomic
    def handle(self, *args, **options):
        file_path = options["file"]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 61
        level = data.get("level", "").upper()
        section = data.get("section", "ee")
        lessons_data = data.get("lessons", [])

        # Supprimer les leçons EE si demandé
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 65
        # Supprimer les leçons EE si demandé
        if clear:
            self.stdout.write("[ACTION] Clearing existing EE lessons...")
            CourseLesson.objects.filter(section="ee").delete()
            self.stdout.write("[OK] EE lessons cleared")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 66
        if clear:
            self.stdout.write("[ACTION] Clearing existing EE lessons...")
            CourseLesson.objects.filter(section="ee").delete()
            self.stdout.write("[OK] EE lessons cleared")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 67
            self.stdout.write("[ACTION] Clearing existing EE lessons...")
            CourseLesson.objects.filter(section="ee").delete()
            self.stdout.write("[OK] EE lessons cleared")

        # Importer les leçons et exercices
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 70

        # Importer les leçons et exercices
        lessons_created = 0
        exercises_created = 0

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 71
        # Importer les leçons et exercices
        lessons_created = 0
        exercises_created = 0

        for lesson_data in lessons_data:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 73
        exercises_created = 0

        for lesson_data in lessons_data:
            lesson_num = lesson_data.get("lesson_number", 0)
            title = lesson_data.get("title", f"Lesson {lesson_num}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 74

        for lesson_data in lessons_data:
            lesson_num = lesson_data.get("lesson_number", 0)
            title = lesson_data.get("title", f"Lesson {lesson_num}")
            slug = lesson_data.get("slug", f"ee-{level.lower()}-lesson-{lesson_num}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 75
        for lesson_data in lessons_data:
            lesson_num = lesson_data.get("lesson_number", 0)
            title = lesson_data.get("title", f"Lesson {lesson_num}")
            slug = lesson_data.get("slug", f"ee-{level.lower()}-lesson-{lesson_num}")
            objective = lesson_data.get("objective", title)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 76
            lesson_num = lesson_data.get("lesson_number", 0)
            title = lesson_data.get("title", f"Lesson {lesson_num}")
            slug = lesson_data.get("slug", f"ee-{level.lower()}-lesson-{lesson_num}")
            objective = lesson_data.get("objective", title)
            vocabulary = lesson_data.get("vocabulary_focus", [])
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 77
            title = lesson_data.get("title", f"Lesson {lesson_num}")
            slug = lesson_data.get("slug", f"ee-{level.lower()}-lesson-{lesson_num}")
            objective = lesson_data.get("objective", title)
            vocabulary = lesson_data.get("vocabulary_focus", [])

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 78
            slug = lesson_data.get("slug", f"ee-{level.lower()}-lesson-{lesson_num}")
            objective = lesson_data.get("objective", title)
            vocabulary = lesson_data.get("vocabulary_focus", [])

            # Créer ou obtenir la leçon
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 81

            # Créer ou obtenir la leçon
            lesson, created = CourseLesson.objects.get_or_create(
                section=section,
                level_code=level,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 84
                section=section,
                level_code=level,
                lesson_number=lesson_num,
                defaults={
                    "title": title,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 95

            status = "[OK]" if created else "[EXISTS]"
            self.stdout.write(f"  {status} Lesson {lesson_num}: {title}")

            # Importer les exercices
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 98

            # Importer les exercices
            exercises_data = lesson_data.get("exercises", [])
            for exercise_data in exercises_data:
                ex = exercise_data.get("exercise", {})
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 99
            # Importer les exercices
            exercises_data = lesson_data.get("exercises", [])
            for exercise_data in exercises_data:
                ex = exercise_data.get("exercise", {})
                ex_num = ex.get("exercise_number", 0)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 100
            exercises_data = lesson_data.get("exercises", [])
            for exercise_data in exercises_data:
                ex = exercise_data.get("exercise", {})
                ex_num = ex.get("exercise_number", 0)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 101
            for exercise_data in exercises_data:
                ex = exercise_data.get("exercise", {})
                ex_num = ex.get("exercise_number", 0)

                exercise, _ = CourseExercise.objects.get_or_create(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 103
                ex_num = ex.get("exercise_number", 0)

                exercise, _ = CourseExercise.objects.get_or_create(
                    lesson=lesson,
                    exercise_number=ex_num,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 104

                exercise, _ = CourseExercise.objects.get_or_create(
                    lesson=lesson,
                    exercise_number=ex_num,
                    defaults={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 105
                exercise, _ = CourseExercise.objects.get_or_create(
                    lesson=lesson,
                    exercise_number=ex_num,
                    defaults={
                        "objective": ex.get("objective", f"Exercise {ex_num}"),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 107
                    exercise_number=ex_num,
                    defaults={
                        "objective": ex.get("objective", f"Exercise {ex_num}"),
                        "prompt": ex.get("prompt", ""),
                        "word_count_min": ex.get("word_count_min", 50),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 112
                        "word_count_max": ex.get("word_count_max", 150),
                        "context_info": ex.get("context", ""),
                        "example_answer": ex.get("example_answer", ""),
                        "evaluation_criteria": ex.get("evaluation_criteria", {}),
                        "difficulty_level": ex.get("difficulty_level", level),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 118
                    },
                )
                exercises_created += 1

            self.stdout.write(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 121

            self.stdout.write(
                f"    [IMPORT] {exercises_created} exercises for lesson {lesson_num}"
            )
            lessons_created += 1
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 123
                f"    [IMPORT] {exercises_created} exercises for lesson {lesson_num}"
            )
            lessons_created += 1

        # Résumé
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 127
        # Résumé
        self.stdout.write("\n" + "=" * 60)
        self.stdout.write("[SUMMARY] EE Curriculum Import")
        self.stdout.write("=" * 60)
        self.stdout.write(f"[STAT] Lessons created: {lessons_created}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 129
        self.stdout.write("[SUMMARY] EE Curriculum Import")
        self.stdout.write("=" * 60)
        self.stdout.write(f"[STAT] Lessons created: {lessons_created}")
        self.stdout.write(f"[STAT] Exercises created: {exercises_created}")
        self.stdout.write(f"[STAT] Level: {level}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 130
        self.stdout.write("=" * 60)
        self.stdout.write(f"[STAT] Lessons created: {lessons_created}")
        self.stdout.write(f"[STAT] Exercises created: {exercises_created}")
        self.stdout.write(f"[STAT] Level: {level}")
        self.stdout.write(f"[STAT] Section: Expression Écrite (EE)")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_curriculum.py
LINE: 135
        self.stdout.write(f"[STAT] Language: {language}")
        self.stdout.write("=" * 60)
        self.stdout.write("\n[SUCCESS] EE curriculum ready for students!")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 2
"""
Management command: import_writing_exams
Importe les exams Expression Écrite (EE) depuis JSON
"""
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 3
"""
Management command: import_writing_exams
Importe les exams Expression Écrite (EE) depuis JSON
"""

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 8
import json
from django.core.management.base import BaseCommand
from django.db import transaction
from exam.models import Exam, ExamSection, Passage, Question, Choice, Explanation

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 9
from django.core.management.base import BaseCommand
from django.db import transaction
from exam.models import Exam, ExamSection, Passage, Question, Choice, Explanation


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 13

class Command(BaseCommand):
    help = "Importe les exams EE (Expression Écrite) depuis JSON"

    def add_arguments(self, parser):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 20
            type=str,
            required=True,
            help="Chemin vers le fichier JSON des exams EE",
        )
        parser.add_argument(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 26
            type=str,
            default=None,
            help="Niveau de l'exam (A1-C2)",
        )
        parser.add_argument(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 37
            "--clear",
            action="store_true",
            help="Supprime les exams EE existants avant import",
        )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 40
        )

    @transaction.atomic
    def handle(self, *args, **options):
        file_path = options["file"]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 59
            return

        # Supprimer les exams EE si demandé
        if clear:
            self.stdout.write("[ACTION] Clearing existing EE exams...")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 61
        # Supprimer les exams EE si demandé
        if clear:
            self.stdout.write("[ACTION] Clearing existing EE exams...")
            Exam.objects.filter(code__startswith="EE_").delete()
            self.stdout.write("[OK] EE exams cleared")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 62
        if clear:
            self.stdout.write("[ACTION] Clearing existing EE exams...")
            Exam.objects.filter(code__startswith="EE_").delete()
            self.stdout.write("[OK] EE exams cleared")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 63
            self.stdout.write("[ACTION] Clearing existing EE exams...")
            Exam.objects.filter(code__startswith="EE_").delete()
            self.stdout.write("[OK] EE exams cleared")

        exams_created = 0
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 65
            self.stdout.write("[OK] EE exams cleared")

        exams_created = 0
        sections_created = 0
        passages_created = 0
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 71
        choices_created = 0

        # Importer les exams
        exams_data = data.get("exams", [])
        for exam_data in exams_data:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 72

        # Importer les exams
        exams_data = data.get("exams", [])
        for exam_data in exams_data:
            exam_code = exam_data.get("exam_code", f"EE_A1_FR")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 73
        # Importer les exams
        exams_data = data.get("exams", [])
        for exam_data in exams_data:
            exam_code = exam_data.get("exam_code", f"EE_A1_FR")
            exam_name = exam_data.get("exam_name", f"Exam {exam_code}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 74
        exams_data = data.get("exams", [])
        for exam_data in exams_data:
            exam_code = exam_data.get("exam_code", f"EE_A1_FR")
            exam_name = exam_data.get("exam_name", f"Exam {exam_code}")
            level = exam_data.get("level", "A1").upper()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 75
        for exam_data in exams_data:
            exam_code = exam_data.get("exam_code", f"EE_A1_FR")
            exam_name = exam_data.get("exam_name", f"Exam {exam_code}")
            level = exam_data.get("level", "A1").upper()
            section_code = exam_data.get("section_code", "ee")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 76
            exam_code = exam_data.get("exam_code", f"EE_A1_FR")
            exam_name = exam_data.get("exam_name", f"Exam {exam_code}")
            level = exam_data.get("level", "A1").upper()
            section_code = exam_data.get("section_code", "ee")
            time_limit = exam_data.get("time_limit_minutes", 60)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 77
            exam_name = exam_data.get("exam_name", f"Exam {exam_code}")
            level = exam_data.get("level", "A1").upper()
            section_code = exam_data.get("section_code", "ee")
            time_limit = exam_data.get("time_limit_minutes", 60)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 78
            level = exam_data.get("level", "A1").upper()
            section_code = exam_data.get("section_code", "ee")
            time_limit = exam_data.get("time_limit_minutes", 60)

            # Créer l'exam
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 80
            time_limit = exam_data.get("time_limit_minutes", 60)

            # Créer l'exam
            exam, created = Exam.objects.get_or_create(
                code=exam_code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 81

            # Créer l'exam
            exam, created = Exam.objects.get_or_create(
                code=exam_code,
                defaults={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 82
            # Créer l'exam
            exam, created = Exam.objects.get_or_create(
                code=exam_code,
                defaults={
                    "name": exam_name,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 84
                code=exam_code,
                defaults={
                    "name": exam_name,
                    "level_code": level,
                    "section_code": section_code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 89
                    "time_limit_minutes": time_limit,
                    "language": language,
                    "description": f"{exam_name} - {level}",
                },
            )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 94

            status = "[OK]" if created else "[EXISTS]"
            self.stdout.write(f"  {status} Exam: {exam_name} ({exam_code})")
            exams_created += 1

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 95
            status = "[OK]" if created else "[EXISTS]"
            self.stdout.write(f"  {status} Exam: {exam_name} ({exam_code})")
            exams_created += 1

            # Importer les sections
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 98

            # Importer les sections
            sections_data = exam_data.get("sections", [])
            for section_data in sections_data:
                sec_code = section_data.get("section_code", "ee")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 105

                # Créer la section
                exam_section, _ = ExamSection.objects.get_or_create(
                    exam=exam,
                    code=sec_code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 106
                # Créer la section
                exam_section, _ = ExamSection.objects.get_or_create(
                    exam=exam,
                    code=sec_code,
                    defaults={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 127
                    # Créer la question
                    question, _ = Question.objects.get_or_create(
                        exam_section=exam_section,
                        question_number=q_num,
                        defaults={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 139
                    questions_created += 1

                    # Pour les exams écrits, créer une seule "choice" (réponse ouverte)
                    if q_type == "writing":
                        choice, _ = Choice.objects.get_or_create(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 153

            self.stdout.write(
                f"    [IMPORT] {len(questions_data)} questions for {exam_name}"
            )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 158
        # Résumé
        self.stdout.write("\n" + "=" * 60)
        self.stdout.write("[SUMMARY] EE Exams Import")
        self.stdout.write("=" * 60)
        self.stdout.write(f"[STAT] Exams created: {exams_created}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 160
        self.stdout.write("[SUMMARY] EE Exams Import")
        self.stdout.write("=" * 60)
        self.stdout.write(f"[STAT] Exams created: {exams_created}")
        self.stdout.write(f"[STAT] Exam sections created: {sections_created}")
        self.stdout.write(f"[STAT] Passages created: {passages_created}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 161
        self.stdout.write("=" * 60)
        self.stdout.write(f"[STAT] Exams created: {exams_created}")
        self.stdout.write(f"[STAT] Exam sections created: {sections_created}")
        self.stdout.write(f"[STAT] Passages created: {passages_created}")
        self.stdout.write(f"[STAT] Questions created: {questions_created}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\management\commands\import_writing_exams.py
LINE: 168
        self.stdout.write(f"[STAT] Language: {language}")
        self.stdout.write("=" * 60)
        self.stdout.write("\n[SUCCESS] EE exams ready for students!")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0001_initial.py
LINE: 31
        ),
        migrations.CreateModel(
            name='Exam',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0001_initial.py
LINE: 36
                ('code', models.SlugField(help_text='Code court: tcf, tef, ielts, celpip, goethe, testdaf', unique=True)),
                ('name', models.CharField(max_length=100)),
                ('language', models.CharField(choices=[('fr', 'Français'), ('en', 'Anglais'), ('de', 'Allemand')], help_text="Langue principale de l'examen", max_length=2)),
            ],
            options={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0001_initial.py
LINE: 39
            ],
            options={
                'verbose_name': 'Examen',
                'verbose_name_plural': 'Examens',
            },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0001_initial.py
LINE: 40
            options={
                'verbose_name': 'Examen',
                'verbose_name_plural': 'Examens',
            },
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0001_initial.py
LINE: 56
        ),
        migrations.CreateModel(
            name='ExamSection',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0001_initial.py
LINE: 62
                ('order', models.PositiveIntegerField(default=1)),
                ('duration_sec', models.PositiveIntegerField(default=600, help_text='Durée en secondes')),
                ('exam', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sections', to='preparation_tests.exam')),
            ],
            options={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0001_initial.py
LINE: 65
            ],
            options={
                'verbose_name': "Section d'examen",
                'verbose_name_plural': "Sections d'examen",
                'ordering': ['exam', 'order'],
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0001_initial.py
LINE: 66
            options={
                'verbose_name': "Section d'examen",
                'verbose_name_plural': "Sections d'examen",
                'ordering': ['exam', 'order'],
            },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0001_initial.py
LINE: 67
                'verbose_name': "Section d'examen",
                'verbose_name_plural': "Sections d'examen",
                'ordering': ['exam', 'order'],
            },
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0001_initial.py
LINE: 79
                ('asset', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='questions', to='preparation_tests.asset')),
                ('passage', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='questions', to='preparation_tests.passage')),
                ('section', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='questions', to='preparation_tests.examsection')),
            ],
            options={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0001_initial.py
LINE: 115
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('mode', models.CharField(choices=[('practice', 'Entraînement'), ('mock', 'Examen blanc')], default='practice', max_length=10)),
                ('started_at', models.DateTimeField(auto_now_add=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0001_initial.py
LINE: 118
                ('started_at', models.DateTimeField(auto_now_add=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('exam', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sessions', to='preparation_tests.exam')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='prep_sessions', to=settings.AUTH_USER_MODEL)),
            ],
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0001_initial.py
LINE: 135
                ('raw_score', models.FloatField(default=0.0)),
                ('total_items', models.PositiveIntegerField(default=0)),
                ('section', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='attempts', to='preparation_tests.examsection')),
                ('session', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='attempts', to='preparation_tests.session')),
            ],
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0002_courselesson.py
LINE: 15
    operations = [
        migrations.CreateModel(
            name='CourseLesson',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0002_courselesson.py
LINE: 26
                ('is_published', models.BooleanField(default=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('exam', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='course_lessons', to='preparation_tests.exam')),
            ],
            options={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0002_courselesson.py
LINE: 31
                'verbose_name': 'Leçon de cours',
                'verbose_name_plural': 'Leçons de cours',
                'ordering': ['exam', 'section', 'order', 'id'],
                'unique_together': {('exam', 'section', 'slug', 'locale')},
            },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0002_courselesson.py
LINE: 32
                'verbose_name_plural': 'Leçons de cours',
                'ordering': ['exam', 'section', 'order', 'id'],
                'unique_together': {('exam', 'section', 'slug', 'locale')},
            },
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0003_listeningexercise.py
LINE: 9

    dependencies = [
        ('preparation_tests', '0002_courselesson'),
    ]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0003_listeningexercise.py
LINE: 14
    operations = [
        migrations.CreateModel(
            name='ListeningExercise',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0003_listeningexercise.py
LINE: 17
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('exam', models.CharField(choices=[('TEF', 'TEF (tef)')], default='TEF', max_length=20)),
                ('section', models.CharField(choices=[('CO', 'Compréhension orale')], default='CO', max_length=5)),
                ('title', models.CharField(max_length=200, verbose_name="Titre de l'exercice")),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0004_coexercise.py
LINE: 9

    dependencies = [
        ('preparation_tests', '0003_listeningexercise'),
    ]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0004_coexercise.py
LINE: 14
    operations = [
        migrations.CreateModel(
            name='COExercise',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0005_courseexercise.py
LINE: 10

    dependencies = [
        ('preparation_tests', '0004_coexercise'),
    ]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0005_courseexercise.py
LINE: 15
    operations = [
        migrations.CreateModel(
            name='CourseExercise',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0005_courseexercise.py
LINE: 21
                ('instruction', models.TextField(blank=True, help_text="Ce que l'apprenant doit faire.", verbose_name='Consigne')),
                ('question_text', models.TextField(help_text='Texte de la question, dialogue, énoncé…', verbose_name='Texte / question')),
                ('audio', models.FileField(blank=True, null=True, upload_to='course_exercises/audio/', verbose_name='Fichier audio')),
                ('image', models.ImageField(blank=True, null=True, upload_to='course_exercises/images/', verbose_name='Image')),
                ('summary', models.TextField(blank=True, help_text="Explication affichée après l'exercice.", verbose_name='Résumé / correction')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0005_courseexercise.py
LINE: 22
                ('question_text', models.TextField(help_text='Texte de la question, dialogue, énoncé…', verbose_name='Texte / question')),
                ('audio', models.FileField(blank=True, null=True, upload_to='course_exercises/audio/', verbose_name='Fichier audio')),
                ('image', models.ImageField(blank=True, null=True, upload_to='course_exercises/images/', verbose_name='Image')),
                ('summary', models.TextField(blank=True, help_text="Explication affichée après l'exercice.", verbose_name='Résumé / correction')),
                ('order', models.PositiveIntegerField(default=1, help_text='Ordre d’affichage dans la leçon (1=haut).')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0005_courseexercise.py
LINE: 27
                ('is_active', models.BooleanField(default=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('lesson', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='exercises', to='preparation_tests.courselesson', verbose_name='Leçon')),
                ('passage', models.ForeignKey(blank=True, help_text='Texte support si nécessaire.', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='course_exercises', to='preparation_tests.passage', verbose_name='Passage lié')),
            ],
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0005_courseexercise.py
LINE: 28
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('lesson', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='exercises', to='preparation_tests.courselesson', verbose_name='Leçon')),
                ('passage', models.ForeignKey(blank=True, help_text='Texte support si nécessaire.', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='course_exercises', to='preparation_tests.passage', verbose_name='Passage lié')),
            ],
            options={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0005_courseexercise.py
LINE: 33
                'verbose_name': 'Exercice de cours',
                'verbose_name_plural': 'Exercices de cours',
                'ordering': ['lesson', 'order', 'id'],
            },
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0006_delete_coexercise_delete_listeningexercise_and_more.py
LINE: 9

    dependencies = [
        ('preparation_tests', '0005_courseexercise'),
    ]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0006_delete_coexercise_delete_listeningexercise_and_more.py
LINE: 14
    operations = [
        migrations.DeleteModel(
            name='COExercise',
        ),
        migrations.DeleteModel(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0006_delete_coexercise_delete_listeningexercise_and_more.py
LINE: 17
        ),
        migrations.DeleteModel(
            name='ListeningExercise',
        ),
        migrations.AddField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0006_delete_coexercise_delete_listeningexercise_and_more.py
LINE: 20
        ),
        migrations.AddField(
            model_name='courseexercise',
            name='correct_option',
            field=models.CharField(blank=True, choices=[('A', 'A'), ('B', 'B'), ('C', 'C'), ('D', 'D')], help_text='Lettre de la bonne réponse (A, B, C, D). Laisser vide pour une question ouverte.', max_length=1, verbose_name='Bonne réponse'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0006_delete_coexercise_delete_listeningexercise_and_more.py
LINE: 25
        ),
        migrations.AddField(
            model_name='courseexercise',
            name='option_a',
            field=models.CharField(blank=True, max_length=255, verbose_name='Option A'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0006_delete_coexercise_delete_listeningexercise_and_more.py
LINE: 30
        ),
        migrations.AddField(
            model_name='courseexercise',
            name='option_b',
            field=models.CharField(blank=True, max_length=255, verbose_name='Option B'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0006_delete_coexercise_delete_listeningexercise_and_more.py
LINE: 35
        ),
        migrations.AddField(
            model_name='courseexercise',
            name='option_c',
            field=models.CharField(blank=True, max_length=255, verbose_name='Option C'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0006_delete_coexercise_delete_listeningexercise_and_more.py
LINE: 40
        ),
        migrations.AddField(
            model_name='courseexercise',
            name='option_d',
            field=models.CharField(blank=True, max_length=255, verbose_name='Option D'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0007_exam_description.py
LINE: 10
        (
            "preparation_tests",
            "0006_delete_coexercise_delete_listeningexercise_and_more",
        ),
    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0007_exam_description.py
LINE: 19
            name="section",
            field=models.ForeignKey(
                to="preparation_tests.examsection",
                null=True,
                blank=True,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 10

    dependencies = [
        ('preparation_tests', '0007_exam_description'),
    ]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 23
        ),
        migrations.AlterModelOptions(
            name='courseexercise',
            options={'ordering': ['lesson', 'order', 'id']},
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 24
        migrations.AlterModelOptions(
            name='courseexercise',
            options={'ordering': ['lesson', 'order', 'id']},
        ),
        migrations.AlterModelOptions(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 27
        ),
        migrations.AlterModelOptions(
            name='courselesson',
            options={'ordering': ['exam', 'section', 'order', 'id']},
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 28
        migrations.AlterModelOptions(
            name='courselesson',
            options={'ordering': ['exam', 'section', 'order', 'id']},
        ),
        migrations.AlterUniqueTogether(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 31
        ),
        migrations.AlterUniqueTogether(
            name='courselesson',
            unique_together=set(),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 47
        ),
        migrations.RemoveField(
            model_name='courseexercise',
            name='updated_at',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 51
        ),
        migrations.AlterField(
            model_name='courseexercise',
            name='audio',
            field=models.FileField(blank=True, null=True, upload_to='course_exercises/audio/'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 53
            model_name='courseexercise',
            name='audio',
            field=models.FileField(blank=True, null=True, upload_to='course_exercises/audio/'),
        ),
        migrations.AlterField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 56
        ),
        migrations.AlterField(
            model_name='courseexercise',
            name='correct_option',
            field=models.CharField(blank=True, choices=[('A', 'A'), ('B', 'B'), ('C', 'C'), ('D', 'D')], max_length=1),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 61
        ),
        migrations.AlterField(
            model_name='courseexercise',
            name='image',
            field=models.ImageField(blank=True, null=True, upload_to='course_exercises/images/'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 63
            model_name='courseexercise',
            name='image',
            field=models.ImageField(blank=True, null=True, upload_to='course_exercises/images/'),
        ),
        migrations.AlterField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 66
        ),
        migrations.AlterField(
            model_name='courseexercise',
            name='instruction',
            field=models.TextField(blank=True),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 71
        ),
        migrations.AlterField(
            model_name='courseexercise',
            name='lesson',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='exercises', to='preparation_tests.courselesson'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 72
        migrations.AlterField(
            model_name='courseexercise',
            name='lesson',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='exercises', to='preparation_tests.courselesson'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 73
            model_name='courseexercise',
            name='lesson',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='exercises', to='preparation_tests.courselesson'),
        ),
        migrations.AlterField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 76
        ),
        migrations.AlterField(
            model_name='courseexercise',
            name='option_a',
            field=models.CharField(blank=True, max_length=255),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 81
        ),
        migrations.AlterField(
            model_name='courseexercise',
            name='option_b',
            field=models.CharField(blank=True, max_length=255),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 86
        ),
        migrations.AlterField(
            model_name='courseexercise',
            name='option_c',
            field=models.CharField(blank=True, max_length=255),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 91
        ),
        migrations.AlterField(
            model_name='courseexercise',
            name='option_d',
            field=models.CharField(blank=True, max_length=255),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 96
        ),
        migrations.AlterField(
            model_name='courseexercise',
            name='order',
            field=models.PositiveIntegerField(default=1),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 101
        ),
        migrations.AlterField(
            model_name='courseexercise',
            name='passage',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='preparation_tests.passage'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 106
        ),
        migrations.AlterField(
            model_name='courseexercise',
            name='question_text',
            field=models.TextField(),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 111
        ),
        migrations.AlterField(
            model_name='courseexercise',
            name='summary',
            field=models.TextField(blank=True),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 116
        ),
        migrations.AlterField(
            model_name='courseexercise',
            name='title',
            field=models.CharField(max_length=200),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 121
        ),
        migrations.AlterField(
            model_name='courselesson',
            name='content_html',
            field=models.TextField(),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 126
        ),
        migrations.AlterField(
            model_name='courselesson',
            name='order',
            field=models.PositiveIntegerField(default=1),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0008_alter_answer_options_alter_attempt_options_and_more.py
LINE: 131
        ),
        migrations.AlterField(
            model_name='examsection',
            name='code',
            field=models.CharField(choices=[('co', 'Compréhension orale'), ('ce', 'Compréhension écrite'), ('ee', 'Expression écrite'), ('eo', 'Expression orale')], max_length=2),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0009_alter_asset_options_alter_choice_options_and_more.py
LINE: 23
        ),
        migrations.AlterModelOptions(
            name='examsection',
            options={'ordering': ['exam', 'order']},
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0009_alter_asset_options_alter_choice_options_and_more.py
LINE: 24
        migrations.AlterModelOptions(
            name='examsection',
            options={'ordering': ['exam', 'order']},
        ),
        migrations.AlterModelOptions(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0009_alter_asset_options_alter_choice_options_and_more.py
LINE: 43
        ),
        migrations.RemoveField(
            model_name='courseexercise',
            name='passage',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0009_alter_asset_options_alter_choice_options_and_more.py
LINE: 64
            model_name='attempt',
            name='section',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='preparation_tests.examsection'),
        ),
        migrations.AlterField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0009_alter_asset_options_alter_choice_options_and_more.py
LINE: 72
        ),
        migrations.AlterField(
            model_name='exam',
            name='language',
            field=models.CharField(choices=[('fr', 'Français'), ('en', 'Anglais'), ('de', 'Allemand')], max_length=2),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0009_alter_asset_options_alter_choice_options_and_more.py
LINE: 77
        ),
        migrations.AlterField(
            model_name='examsection',
            name='duration_sec',
            field=models.PositiveIntegerField(default=600),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0009_alter_asset_options_alter_choice_options_and_more.py
LINE: 108
        migrations.AlterField(
            model_name='session',
            name='exam',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='preparation_tests.exam'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0009_alter_asset_options_alter_choice_options_and_more.py
LINE: 109
            model_name='session',
            name='exam',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='preparation_tests.exam'),
        ),
    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0010_userskillprogress.py
LINE: 17
    operations = [
        migrations.CreateModel(
            name='UserSkillProgress',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0010_userskillprogress.py
LINE: 20
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('exam_code', models.CharField(max_length=20)),
                ('skill', models.CharField(choices=[('co', 'Compréhension orale'), ('ce', 'Compréhension écrite'), ('ee', 'Expression écrite'), ('eo', 'Expression orale')], max_length=2)),
                ('score_percent', models.PositiveIntegerField(default=0)),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0010_userskillprogress.py
LINE: 25
                ('total_attempts', models.PositiveIntegerField(default=0)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='skill_progress', to=settings.AUTH_USER_MODEL)),
            ],
            options={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0010_userskillprogress.py
LINE: 28
            ],
            options={
                'unique_together': {('user', 'exam_code', 'skill')},
            },
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0011_userskillresult.py
LINE: 11

    dependencies = [
        ('preparation_tests', '0010_userskillprogress'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0011_userskillresult.py
LINE: 20
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('exam_code', models.CharField(choices=[('tef', 'TEF'), ('tcf', 'TCF')], max_length=10)),
                ('skill', models.CharField(choices=[('co', 'Compréhension orale'), ('ce', 'Compréhension écrite'), ('ee', 'Expression écrite'), ('eo', 'Expression orale')], max_length=2)),
                ('session_type', models.CharField(choices=[('training', 'Entraînement'), ('mock', 'Examen blanc')], max_length=10)),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0011_userskillresult.py
LINE: 22
                ('exam_code', models.CharField(choices=[('tef', 'TEF'), ('tcf', 'TCF')], max_length=10)),
                ('skill', models.CharField(choices=[('co', 'Compréhension orale'), ('ce', 'Compréhension écrite'), ('ee', 'Expression écrite'), ('eo', 'Expression orale')], max_length=2)),
                ('session_type', models.CharField(choices=[('training', 'Entraînement'), ('mock', 'Examen blanc')], max_length=10)),
                ('score_percent', models.PositiveIntegerField()),
                ('total_questions', models.PositiveIntegerField()),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0013_alter_courselesson_options_courselesson_level_and_more.py
LINE: 14
    operations = [
        migrations.AlterModelOptions(
            name='courselesson',
            options={'ordering': ['exam', 'level', 'section', 'order', 'id']},
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0013_alter_courselesson_options_courselesson_level_and_more.py
LINE: 15
        migrations.AlterModelOptions(
            name='courselesson',
            options={'ordering': ['exam', 'level', 'section', 'order', 'id']},
        ),
        migrations.AddField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0013_alter_courselesson_options_courselesson_level_and_more.py
LINE: 18
        ),
        migrations.AddField(
            model_name='courselesson',
            name='level',
            field=models.CharField(choices=[('A1', 'A1'), ('A2', 'A2'), ('B1', 'B1'), ('B2', 'B2'), ('C1', 'C1'), ('C2', 'C2')], db_index=True, default='A2', max_length=2),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0013_alter_courselesson_options_courselesson_level_and_more.py
LINE: 24
        migrations.AlterField(
            model_name='userskillresult',
            name='exam_code',
            field=models.CharField(max_length=20),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0014_cefrcertificate.py
LINE: 12

    dependencies = [
        ('preparation_tests', '0013_alter_courselesson_options_courselesson_level_and_more'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0014_cefrcertificate.py
LINE: 21
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('exam_code', models.CharField(max_length=20)),
                ('level', models.CharField(max_length=2)),
                ('certificate_id', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0014_cefrcertificate.py
LINE: 29
            options={
                'ordering': ['-issued_at'],
                'unique_together': {('user', 'exam_code', 'level')},
            },
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0015_userlessonprogress.py
LINE: 17
    operations = [
        migrations.CreateModel(
            name='UserLessonProgress',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0015_userlessonprogress.py
LINE: 20
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('completed_exercises', models.PositiveIntegerField(default=0)),
                ('total_exercises', models.PositiveIntegerField(default=0)),
                ('percent', models.PositiveIntegerField(default=0)),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0015_userlessonprogress.py
LINE: 21
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('completed_exercises', models.PositiveIntegerField(default=0)),
                ('total_exercises', models.PositiveIntegerField(default=0)),
                ('percent', models.PositiveIntegerField(default=0)),
                ('is_completed', models.BooleanField(default=False)),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0015_userlessonprogress.py
LINE: 25
                ('is_completed', models.BooleanField(default=False)),
                ('last_updated', models.DateTimeField(auto_now=True)),
                ('lesson', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='user_progress', to='preparation_tests.courselesson')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lesson_progress', to=settings.AUTH_USER_MODEL)),
            ],
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0015_userlessonprogress.py
LINE: 26
                ('last_updated', models.DateTimeField(auto_now=True)),
                ('lesson', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='user_progress', to='preparation_tests.courselesson')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lesson_progress', to=settings.AUTH_USER_MODEL)),
            ],
            options={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0015_userlessonprogress.py
LINE: 30
            options={
                'ordering': ['-last_updated'],
                'unique_together': {('user', 'lesson')},
            },
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0016_studyplanprogress.py
LINE: 11

    dependencies = [
        ('preparation_tests', '0015_userlessonprogress'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0016_studyplanprogress.py
LINE: 17
    operations = [
        migrations.CreateModel(
            name='StudyPlanProgress',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0016_studyplanprogress.py
LINE: 20
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('exam_code', models.CharField(max_length=20)),
                ('current_day', models.PositiveIntegerField(default=1)),
                ('total_days', models.PositiveIntegerField(default=30)),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0016_studyplanprogress.py
LINE: 29
            options={
                'ordering': ['-last_activity'],
                'unique_together': {('user', 'exam_code')},
            },
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 13

    dependencies = [
        ('preparation_tests', '0016_studyplanprogress'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 23
        ),
        migrations.AlterModelOptions(
            name='courseexercise',
            options={},
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 27
        ),
        migrations.AlterModelOptions(
            name='exam',
            options={},
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 31
        ),
        migrations.AlterModelOptions(
            name='examsection',
            options={},
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 35
        ),
        migrations.AlterModelOptions(
            name='userlessonprogress',
            options={},
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 55
        ),
        migrations.AlterUniqueTogether(
            name='userskillprogress',
            unique_together=set(),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 59
        ),
        migrations.RemoveField(
            model_name='courseexercise',
            name='audio',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 63
        ),
        migrations.RemoveField(
            model_name='courseexercise',
            name='image',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 67
        ),
        migrations.RemoveField(
            model_name='courseexercise',
            name='instruction',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 71
        ),
        migrations.RemoveField(
            model_name='courseexercise',
            name='summary',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 75
        ),
        migrations.RemoveField(
            model_name='courseexercise',
            name='title',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 79
        ),
        migrations.RemoveField(
            model_name='studyplanprogress',
            name='is_completed',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 83
        ),
        migrations.RemoveField(
            model_name='userlessonprogress',
            name='last_updated',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 95
        ),
        migrations.AddField(
            model_name='studyplanprogress',
            name='is_active',
            field=models.BooleanField(default=True),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 100
        ),
        migrations.AddField(
            model_name='studyplanprogress',
            name='started_at',
            field=models.DateTimeField(auto_now_add=True, default=django.utils.timezone.now),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 136
        ),
        migrations.AlterField(
            model_name='courseexercise',
            name='correct_option',
            field=models.CharField(blank=True, max_length=1),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 141
        ),
        migrations.AlterField(
            model_name='exam',
            name='code',
            field=models.SlugField(unique=True),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 163
            model_name='session',
            name='mode',
            field=models.CharField(choices=[('practice', 'Entraînement'), ('mock', 'Examen blanc')], max_length=10),
        ),
        migrations.AlterField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 168
            model_name='session',
            name='user',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='exam_sessions', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AlterField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 171
        ),
        migrations.AlterField(
            model_name='studyplanprogress',
            name='user',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 176
        ),
        migrations.AlterField(
            model_name='userlessonprogress',
            name='lesson',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='preparation_tests.courselesson'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 177
        migrations.AlterField(
            model_name='userlessonprogress',
            name='lesson',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='preparation_tests.courselesson'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 178
            model_name='userlessonprogress',
            name='lesson',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='preparation_tests.courselesson'),
        ),
        migrations.AlterField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 181
        ),
        migrations.AlterField(
            model_name='userlessonprogress',
            name='user',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 186
        ),
        migrations.AlterField(
            model_name='userskillprogress',
            name='skill',
            field=models.CharField(max_length=2),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 191
        ),
        migrations.AlterField(
            model_name='userskillprogress',
            name='user',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 210
        ),
        migrations.RemoveField(
            model_name='userskillprogress',
            name='total_attempts',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0017_alter_cefrcertificate_options_and_more.py
LINE: 214
        ),
        migrations.RemoveField(
            model_name='userskillprogress',
            name='updated_at',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 18
    operations = [
        migrations.AlterModelOptions(
            name='courselesson',
            options={'ordering': ['order'], 'verbose_name': 'Leçon', 'verbose_name_plural': 'Leçons'},
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 22
        ),
        migrations.AlterUniqueTogether(
            name='userlessonprogress',
            unique_together=set(),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 26
        ),
        migrations.AddField(
            model_name='courseexercise',
            name='audio',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='exercise_audios', to='preparation_tests.asset'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 28
            model_name='courseexercise',
            name='audio',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='exercise_audios', to='preparation_tests.asset'),
        ),
        migrations.AddField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 31
        ),
        migrations.AddField(
            model_name='courseexercise',
            name='image',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='exercise_images', to='preparation_tests.asset'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 33
            model_name='courseexercise',
            name='image',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='exercise_images', to='preparation_tests.asset'),
        ),
        migrations.AddField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 36
        ),
        migrations.AddField(
            model_name='courseexercise',
            name='instruction',
            field=models.TextField(blank=True),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 41
        ),
        migrations.AddField(
            model_name='courseexercise',
            name='summary',
            field=models.TextField(blank=True),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 46
        ),
        migrations.AddField(
            model_name='courseexercise',
            name='title',
            field=models.CharField(default='Exercice', max_length=255),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 52
        ),
        migrations.AddField(
            model_name='courselesson',
            name='created_at',
            field=models.DateTimeField(auto_now_add=True, default=django.utils.timezone.now),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 58
        ),
        migrations.AddField(
            model_name='userlessonprogress',
            name='updated_at',
            field=models.DateTimeField(auto_now=True),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 63
        ),
        migrations.AlterField(
            model_name='courseexercise',
            name='correct_option',
            field=models.CharField(choices=[('A', 'A'), ('B', 'B'), ('C', 'C'), ('D', 'D')], max_length=1),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 68
        ),
        migrations.AlterField(
            model_name='courseexercise',
            name='option_a',
            field=models.CharField(max_length=255),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 73
        ),
        migrations.AlterField(
            model_name='courseexercise',
            name='option_b',
            field=models.CharField(max_length=255),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 78
        ),
        migrations.AlterField(
            model_name='courselesson',
            name='exam',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lessons', to='preparation_tests.exam'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 79
        migrations.AlterField(
            model_name='courselesson',
            name='exam',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lessons', to='preparation_tests.exam'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 80
            model_name='courselesson',
            name='exam',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lessons', to='preparation_tests.exam'),
        ),
        migrations.AlterField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 83
        ),
        migrations.AlterField(
            model_name='courselesson',
            name='level',
            field=models.CharField(choices=[('A1', 'A1'), ('A2', 'A2'), ('B1', 'B1'), ('B2', 'B2'), ('C1', 'C1'), ('C2', 'C2')], max_length=2),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 88
        ),
        migrations.AlterField(
            model_name='courselesson',
            name='locale',
            field=models.CharField(default='fr', max_length=5),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 93
        ),
        migrations.AlterField(
            model_name='courselesson',
            name='section',
            field=models.CharField(choices=[('co', 'Compréhension Orale'), ('ce', 'Compréhension Écrite'), ('ee', 'Expression Écrite'), ('eo', 'Expression Orale')], max_length=2),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 98
        ),
        migrations.AlterField(
            model_name='courselesson',
            name='slug',
            field=models.SlugField(unique=True),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 103
        ),
        migrations.AlterField(
            model_name='courselesson',
            name='title',
            field=models.CharField(max_length=255),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 108
        ),
        migrations.AlterField(
            model_name='userlessonprogress',
            name='lesson',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='user_progress', to='preparation_tests.courselesson'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 109
        migrations.AlterField(
            model_name='userlessonprogress',
            name='lesson',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='user_progress', to='preparation_tests.courselesson'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 110
            model_name='userlessonprogress',
            name='lesson',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='user_progress', to='preparation_tests.courselesson'),
        ),
        migrations.AlterField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 113
        ),
        migrations.AlterField(
            model_name='userlessonprogress',
            name='user',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lesson_progress', to=settings.AUTH_USER_MODEL),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0018_alter_courselesson_options_and_more.py
LINE: 115
            model_name='userlessonprogress',
            name='user',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lesson_progress', to=settings.AUTH_USER_MODEL),
        ),
    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0019_remove_userskillresult_exam_code_and_more.py
LINE: 10

    dependencies = [
        ('preparation_tests', '0018_alter_courselesson_options_and_more'),
    ]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0019_remove_userskillresult_exam_code_and_more.py
LINE: 16
        migrations.RemoveField(
            model_name='userskillresult',
            name='exam_code',
        ),
        migrations.RemoveField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0019_remove_userskillresult_exam_code_and_more.py
LINE: 23
        ),
        migrations.AddField(
            model_name='exam',
            name='description',
            field=models.TextField(blank=True, null=True),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0019_remove_userskillresult_exam_code_and_more.py
LINE: 29
        migrations.AddField(
            model_name='userskillresult',
            name='exam',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='preparation_tests.exam'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0019_remove_userskillresult_exam_code_and_more.py
LINE: 30
            model_name='userskillresult',
            name='exam',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='preparation_tests.exam'),
        ),
        migrations.AddField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0019_remove_userskillresult_exam_code_and_more.py
LINE: 35
            model_name='userskillresult',
            name='section',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='preparation_tests.examsection'),
        ),
    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0020_remove_cefrcertificate_certificate_id_and_more.py
LINE: 10

    dependencies = [
        ('preparation_tests', '0019_remove_userskillresult_exam_code_and_more'),
    ]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0022_coachiareport.py
LINE: 20
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('exam_code', models.CharField(max_length=20)),
                ('scope', models.CharField(choices=[('global', 'Global'), ('co', 'Compréhension orale'), ('ce', 'Compréhension écrite'), ('ee', 'Expression écrite'), ('eo', 'Expression orale')], default='global', max_length=20)),
                ('data', models.JSONField()),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0023_alter_courselesson_options_courselesson_exams_and_more.py
LINE: 15
    operations = [
        migrations.AlterModelOptions(
            name='courselesson',
            options={'ordering': ['level', 'order'], 'verbose_name': 'Leçon', 'verbose_name_plural': 'Leçons'},
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0023_alter_courselesson_options_courselesson_exams_and_more.py
LINE: 19
        ),
        migrations.AddField(
            model_name='courselesson',
            name='exams',
            field=models.ManyToManyField(blank=True, help_text='Examens utilisant cette leçon (TEF, TCF, DELF, DALF)', related_name='lessons', to='preparation_tests.exam'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0023_alter_courselesson_options_courselesson_exams_and_more.py
LINE: 20
        migrations.AddField(
            model_name='courselesson',
            name='exams',
            field=models.ManyToManyField(blank=True, help_text='Examens utilisant cette leçon (TEF, TCF, DELF, DALF)', related_name='lessons', to='preparation_tests.exam'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0023_alter_courselesson_options_courselesson_exams_and_more.py
LINE: 21
            model_name='courselesson',
            name='exams',
            field=models.ManyToManyField(blank=True, help_text='Examens utilisant cette leçon (TEF, TCF, DELF, DALF)', related_name='lessons', to='preparation_tests.exam'),
        ),
        migrations.AlterField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0023_alter_courselesson_options_courselesson_exams_and_more.py
LINE: 24
        ),
        migrations.AlterField(
            model_name='courselesson',
            name='exam',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='legacy_lessons', to='preparation_tests.exam'),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0023_alter_courselesson_options_courselesson_exams_and_more.py
LINE: 25
        migrations.AlterField(
            model_name='courselesson',
            name='exam',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='legacy_lessons', to='preparation_tests.exam'),
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0023_alter_courselesson_options_courselesson_exams_and_more.py
LINE: 26
            model_name='courselesson',
            name='exam',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='legacy_lessons', to='preparation_tests.exam'),
        ),
    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0024_userexerciseprogress.py
LINE: 11

    dependencies = [
        ('preparation_tests', '0023_alter_courselesson_options_courselesson_exams_and_more'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0024_userexerciseprogress.py
LINE: 17
    operations = [
        migrations.CreateModel(
            name='UserExerciseProgress',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0024_userexerciseprogress.py
LINE: 25
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('exercise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='preparation_tests.courseexercise')),
                ('lesson', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='preparation_tests.courselesson')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0024_userexerciseprogress.py
LINE: 26
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('exercise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='preparation_tests.courseexercise')),
                ('lesson', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='preparation_tests.courselesson')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0024_userexerciseprogress.py
LINE: 30
            ],
            options={
                'indexes': [models.Index(fields=['user', 'lesson'], name='preparation_user_id_d78514_idx'), models.Index(fields=['user', 'exercise'], name='preparation_user_id_bcf4e0_idx')],
                'unique_together': {('user', 'exercise')},
            },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0024_userexerciseprogress.py
LINE: 31
            options={
                'indexes': [models.Index(fields=['user', 'lesson'], name='preparation_user_id_d78514_idx'), models.Index(fields=['user', 'exercise'], name='preparation_user_id_bcf4e0_idx')],
                'unique_together': {('user', 'exercise')},
            },
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0025_studyplanprogress_is_completed_and_more.py
LINE: 9

    dependencies = [
        ('preparation_tests', '0024_userexerciseprogress'),
    ]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0025_studyplanprogress_is_completed_and_more.py
LINE: 14
    operations = [
        migrations.AddField(
            model_name='studyplanprogress',
            name='is_completed',
            field=models.BooleanField(default=False),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0025_studyplanprogress_is_completed_and_more.py
LINE: 19
        ),
        migrations.AddField(
            model_name='userskillprogress',
            name='current_level',
            field=models.CharField(choices=[('A1', 'A1'), ('A2', 'A2'), ('B1', 'B1'), ('B2', 'B2'), ('C1', 'C1'), ('C2', 'C2')], default='A1', max_length=2),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\migrations\0025_studyplanprogress_is_completed_and_more.py
LINE: 24
        ),
        migrations.AddField(
            model_name='userskillprogress',
            name='total_attempts',
            field=models.PositiveIntegerField(default=0),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\ai_coach\coach_co.py
LINE: 35
            ]
        return [
            "Simuler les conditions réelles d’examen",
            "Travailler les pièges synonymes",
        ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\ai_coach\coach_global.py
LINE: 82
        if score < 80:
            return [
                "Accent sur les stratégies d’examen",
                "Simuler des examens complets",
                "Corriger systématiquement les erreurs",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\ai_coach\coach_global.py
LINE: 83
            return [
                "Accent sur les stratégies d’examen",
                "Simuler des examens complets",
                "Corriger systématiquement les erreurs",
            ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\__init__.py
LINE: 1

from .progression import try_unlock_next_level
from .certificates import generate_cefr_certificate
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\certificates.py
LINE: 10


def generate_cefr_certificate(*, user, exam_code, level, public_id):
    """
    🎓 Génère un certificat CECR premium avec QR code vérifiable
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\certificates.py
LINE: 18
    os.makedirs(output_dir, exist_ok=True)

    filename = f"{exam_code}_{level}_{public_id}.pdf"
    file_path = os.path.join(output_dir, filename)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\certificates.py
LINE: 59
        width / 2,
        height - 9.5 * cm,
        f"Examen : {exam_code.upper()}"
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\coach_ai_pdf.py
LINE: 21
    y = height - 100

    c.drawString(50, y, f"Examen : {report.exam_code}")
    y -= 20
    c.drawString(50, y, f"Section : {report.scope.upper()}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\feedback.py
LINE: 4

def build_smart_feedback(
    exam_code: str,
    global_pct: int,
    per_section: dict,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\feedback.py
LINE: 18
        global_message = (
            "🚀 Niveau excellent. Tu es très proche (ou déjà prêt) "
            "pour l’examen officiel."
        )
    elif global_pct >= 70:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\feedback.py
LINE: 36
        global_message = (
            "⚠️ Niveau fragile. Pas d’inquiétude : "
            "un parcours progressif va t’aider à remonter."
        )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\feedback.py
LINE: 76
        recommendation = (
            "👏 Très bon équilibre. "
            "Continue avec des examens blancs complets."
        )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 1

from django.db import transaction
import uuid

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 5

from core.constants import LEVEL_ORDER
from preparation_tests.models import UserSkillProgress, CEFRCertificate
from preparation_tests.services.certificates import generate_cefr_certificate

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 26
    *,
    user,
    exam_code: str,
    skill: str,
    score_percent: int,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 31
) -> dict:
    """
    🔓 Moteur CECR officiel – multi-examens / multi-compétences
    """

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 34
    """

    exam_code = exam_code.upper()
    skill = skill.lower()

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 37
    skill = skill.lower()

    progress, _ = UserSkillProgress.objects.get_or_create(
        user=user,
        exam_code=exam_code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 39
    progress, _ = UserSkillProgress.objects.get_or_create(
        user=user,
        exam_code=exam_code,
        skill=skill,
        defaults={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 48
    )

    current_level = progress.current_level
    current_index = CEFR_LEVELS.index(current_level)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 74
    certificate_generated = False

    # 🔒 TRANSACTION ATOMIQUE
    with transaction.atomic():
        # 📊 Progression
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 75

    # 🔒 TRANSACTION ATOMIQUE
    with transaction.atomic():
        # 📊 Progression
        progress.current_level = new_level
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 76
    # 🔒 TRANSACTION ATOMIQUE
    with transaction.atomic():
        # 📊 Progression
        progress.current_level = new_level
        progress.score_percent = score_percent
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 77
    with transaction.atomic():
        # 📊 Progression
        progress.current_level = new_level
        progress.score_percent = score_percent
        progress.total_attempts += 1
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 78
        # 📊 Progression
        progress.current_level = new_level
        progress.score_percent = score_percent
        progress.total_attempts += 1
        progress.save()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 79
        progress.current_level = new_level
        progress.score_percent = score_percent
        progress.total_attempts += 1
        progress.save()

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 80
        progress.score_percent = score_percent
        progress.total_attempts += 1
        progress.save()

        # 🎓 Certificat CECR (1 par niveau / examen)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 82
        progress.save()

        # 🎓 Certificat CECR (1 par niveau / examen)
        cert, created = CEFRCertificate.objects.get_or_create(
            user=user,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 85
        cert, created = CEFRCertificate.objects.get_or_create(
            user=user,
            exam_code=exam_code,
            level=new_level,
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 93
            generate_cefr_certificate(
                user=user,
                exam_code=exam_code,
                level=new_level,
                public_id=str(cert.public_id),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 110


def get_cefr_progress(*, user, exam_code: str, skill: str) -> dict:
    """
    📊 Données CECR prêtes pour l’UI (barre graphique)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 115
    """

    exam_code = exam_code.upper()
    skill = skill.lower()

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 118
    skill = skill.lower()

    progress = UserSkillProgress.objects.filter(
        user=user,
        exam_code=exam_code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 120
    progress = UserSkillProgress.objects.filter(
        user=user,
        exam_code=exam_code,
        skill=skill,
    ).first()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 124
    ).first()

    current_level = progress.current_level if progress else "A1"
    score = progress.score_percent if progress else 0

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 125

    current_level = progress.current_level if progress else "A1"
    score = progress.score_percent if progress else 0

    current_index = CEFR_LEVELS.index(current_level)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 128

    current_index = CEFR_LEVELS.index(current_level)
    global_progress = round(
        (current_index / (len(CEFR_LEVELS) - 1)) * 100
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\level_engine.py
LINE: 137
        "levels": CEFR_LEVELS,
        "current_index": current_index,
        "global_progress": global_progress,
    }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\levels.py
LINE: 3
# preparation_tests/services/levels.py

from django.db import transaction
from django.conf import settings

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\levels.py
LINE: 10


def try_unlock_next_level(*, user, exam_code, score_percent):
    """
    Tente de débloquer le niveau CECR suivant après un test blanc.
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\levels.py
LINE: 54
    new_level = levels[idx + 1]

    # 🔒 transaction sécurisée
    with transaction.atomic():
        profile.level = new_level
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\levels.py
LINE: 55

    # 🔒 transaction sécurisée
    with transaction.atomic():
        profile.level = new_level
        profile.save(update_fields=["level"])
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\progression.py
LINE: 4
from profiles.models import Profile

def try_unlock_next_level(user, exam_code, score_percent):
    """
    Débloque automatiquement le niveau CECRL supérieur
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\recommendations.py
LINE: 1

from preparation_tests.models import CourseLesson
from core.constants import LEVEL_ORDER

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\recommendations.py
LINE: 5


def recommend_lessons(
    *,
    user,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\recommendations.py
LINE: 8
    *,
    user,
    exam_code: str,
    per_section: dict,
    limit_per_skill: int = 2,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\recommendations.py
LINE: 34

        # leçons accessibles uniquement
        lessons = (
            CourseLesson.objects.filter(
                exams__code__iexact=exam_code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\recommendations.py
LINE: 35
        # leçons accessibles uniquement
        lessons = (
            CourseLesson.objects.filter(
                exams__code__iexact=exam_code,
                section=section_code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\recommendations.py
LINE: 36
        lessons = (
            CourseLesson.objects.filter(
                exams__code__iexact=exam_code,
                section=section_code,
                is_published=True,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\recommendations.py
LINE: 45
        added = 0

        for lesson in lessons:
            lesson_level_order = LEVEL_ORDER.get(lesson.level, 0)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\recommendations.py
LINE: 46

        for lesson in lessons:
            lesson_level_order = LEVEL_ORDER.get(lesson.level, 0)

            # 🔒 verrouillage CECRL
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\recommendations.py
LINE: 49

            # 🔒 verrouillage CECRL
            if lesson_level_order > user_level_order:
                continue

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\recommendations.py
LINE: 55
                {
                    "skill": skill,
                    "lesson": lesson,
                    "reason": f"Score {pct}% — renforcement recommandé",
                }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 4

from preparation_tests.models import (
    CourseLesson,
    StudyPlanProgress,
)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 5
from preparation_tests.models import (
    CourseLesson,
    StudyPlanProgress,
)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 44
# =====================================================

def build_study_plan(*, user, exam_code):
    """
    Génère OU récupère un plan d’étude personnalisé basé sur :
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 48
    Génère OU récupère un plan d’étude personnalisé basé sur :
    - le niveau CECRL de l’utilisateur
    - l’examen (TEF / TCF / DELF / DALF)
    - la progression sauvegardée
    """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 49
    - le niveau CECRL de l’utilisateur
    - l’examen (TEF / TCF / DELF / DALF)
    - la progression sauvegardée
    """

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 56
        return None

    exam_code = exam_code.lower()

    # 🎓 Niveau utilisateur (fallback sécurisé)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 65
    config = CEFR_PLAN.get(level, CEFR_PLAN["A1"])

    # 📌 Création ou récupération de la progression
    progress, _ = StudyPlanProgress.objects.get_or_create(
        user=user,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 66

    # 📌 Création ou récupération de la progression
    progress, _ = StudyPlanProgress.objects.get_or_create(
        user=user,
        exam_code=exam_code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 68
    progress, _ = StudyPlanProgress.objects.get_or_create(
        user=user,
        exam_code=exam_code,
        defaults={
            "current_day": 1,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 77

    # 📚 Leçons disponibles (filtrage strict & sûr)
    lessons_qs = (
        CourseLesson.objects.filter(
            exams__code__iexact=exam_code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 78
    # 📚 Leçons disponibles (filtrage strict & sûr)
    lessons_qs = (
        CourseLesson.objects.filter(
            exams__code__iexact=exam_code,
            level=level,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 79
    lessons_qs = (
        CourseLesson.objects.filter(
            exams__code__iexact=exam_code,
            level=level,
            section__in=config["focus"],
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 87
    )

    lessons = list(lessons_qs)

    # 🧩 Construction des jours
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 91
    # 🧩 Construction des jours
    days = []
    lesson_index = 0
    total_days = progress.total_days

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 92
    days = []
    lesson_index = 0
    total_days = progress.total_days

    for day in range(1, total_days + 1):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 96
    for day in range(1, total_days + 1):

        lesson = lessons[lesson_index] if lesson_index < len(lessons) else None

        days.append({
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 100
        days.append({
            "day": day,
            "is_current": day == progress.current_day,
            "is_completed": day < progress.current_day,
            "section": lesson.section.upper() if lesson else None,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 101
            "day": day,
            "is_current": day == progress.current_day,
            "is_completed": day < progress.current_day,
            "section": lesson.section.upper() if lesson else None,
            "lesson": lesson,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 102
            "is_current": day == progress.current_day,
            "is_completed": day < progress.current_day,
            "section": lesson.section.upper() if lesson else None,
            "lesson": lesson,
        })
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 103
            "is_completed": day < progress.current_day,
            "section": lesson.section.upper() if lesson else None,
            "lesson": lesson,
        })

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 106
        })

        if lesson:
            lesson_index += 1

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 107

        if lesson:
            lesson_index += 1

    # 📊 Résultat final pour l’UI
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 111
    # 📊 Résultat final pour l’UI
    return {
        "exam_code": exam_code,
        "level": level,
        "current_day": progress.current_day,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 113
        "exam_code": exam_code,
        "level": level,
        "current_day": progress.current_day,
        "total_days": total_days,
        "progress_percent": int(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 115
        "current_day": progress.current_day,
        "total_days": total_days,
        "progress_percent": int(
            (max(progress.current_day - 1, 0) / total_days) * 100
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 116
        "total_days": total_days,
        "progress_percent": int(
            (max(progress.current_day - 1, 0) / total_days) * 100
        ),
        "days": days,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 119
        ),
        "days": days,
        "is_completed": progress.is_completed,
        "is_active": progress.is_active,
    }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 120
        "days": days,
        "is_completed": progress.is_completed,
        "is_active": progress.is_active,
    }

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 128
# =====================================================

def advance_study_day(*, user, exam_code):
    """
    Passe au jour suivant du plan d’étude
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 136
        return None

    exam_code = exam_code.lower()

    plan = StudyPlanProgress.objects.filter(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 138
    exam_code = exam_code.lower()

    plan = StudyPlanProgress.objects.filter(
        user=user,
        exam_code=exam_code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 140
    plan = StudyPlanProgress.objects.filter(
        user=user,
        exam_code=exam_code,
        is_active=True,
    ).first()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 199

    for day in plan_data["days"]:
        lesson = day.get("lesson")

        if lesson:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 201
        lesson = day.get("lesson")

        if lesson:
            # 🔁 Priorité aux sections faibles
            if lesson.section.lower() in ordered_sections:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\study_plan.py
LINE: 203
        if lesson:
            # 🔁 Priorité aux sections faibles
            if lesson.section.lower() in ordered_sections:
                adapted_days.append(day)
            else:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services\tts_bridge.py
LINE: 6
BASE_DIR = Path(__file__).resolve().parent.parent.parent
AI_PYTHON = BASE_DIR / "ai_env" / "bin" / "python"
SCRIPT = BASE_DIR / "ai_engine" / "run_tts.py"

def generate_audio(text, lang):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\templatetags\secure_media.py
LINE: 29
    Usage template:
        {% load secure_media %}
        <source src="{% secure_asset_url exercise.audio %}" type="audio/mpeg">

    - Prend asset.secure_url si dispo
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 5

from .models import (
    Exam, ExamSection, Passage, Asset,
    Question, Choice, Explanation,
    Session, Attempt, Answer,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 8
    Question, Choice, Explanation,
    Session, Attempt, Answer,
    CourseLesson, CourseExercise,
)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 12

# =====================================================
# EXAM
# =====================================================

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 15
# =====================================================

@admin.register(Exam)
class ExamAdmin(admin.ModelAdmin):
    list_display = ("name", "code", "language")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 16

@admin.register(Exam)
class ExamAdmin(admin.ModelAdmin):
    list_display = ("name", "code", "language")
    search_fields = ("name", "code")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 21


@admin.register(ExamSection)
class ExamSectionAdmin(admin.ModelAdmin):
    list_display = ("exam", "code", "order", "duration_sec")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 22

@admin.register(ExamSection)
class ExamSectionAdmin(admin.ModelAdmin):
    list_display = ("exam", "code", "order", "duration_sec")
    list_filter = ("exam", "code")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 23
@admin.register(ExamSection)
class ExamSectionAdmin(admin.ModelAdmin):
    list_display = ("exam", "code", "order", "duration_sec")
    list_filter = ("exam", "code")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 24
class ExamSectionAdmin(admin.ModelAdmin):
    list_display = ("exam", "code", "order", "duration_sec")
    list_filter = ("exam", "code")


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 70
@admin.register(Session)
class SessionAdmin(admin.ModelAdmin):
    list_display = ("id", "user", "exam", "mode", "started_at", "completed_at")


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 84

# =====================================================
# COURSE LESSONS (🔥 ICI LA CORRECTION)
# =====================================================

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 87
# =====================================================

class CourseLessonAdminForm(forms.ModelForm):
    class Meta:
        model = CourseLesson
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 89
class CourseLessonAdminForm(forms.ModelForm):
    class Meta:
        model = CourseLesson
        fields = "__all__"  # 🔥 FORCE l’affichage de level

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 93


class CourseExerciseInline(admin.TabularInline):
    model = CourseExercise
    extra = 1
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 94

class CourseExerciseInline(admin.TabularInline):
    model = CourseExercise
    extra = 1

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 98


@admin.register(CourseLesson)
class CourseLessonAdmin(admin.ModelAdmin):
    form = CourseLessonAdminForm
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 99

@admin.register(CourseLesson)
class CourseLessonAdmin(admin.ModelAdmin):
    form = CourseLessonAdminForm

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 100
@admin.register(CourseLesson)
class CourseLessonAdmin(admin.ModelAdmin):
    form = CourseLessonAdminForm

    list_display = (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 104
    list_display = (
        "title",
        "exam",
        "section",
        "level",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 111
    )

    list_filter = ("exam", "section", "level", "locale", "is_published")
    ordering = ("order", "id")
    prepopulated_fields = {"slug": ("title",)}
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\admin.py
LINE: 114
    ordering = ("order", "id")
    prepopulated_fields = {"slug": ("title",)}
    inlines = [CourseExerciseInline]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 9

# =====================================================
# 📘 EXAMENS
# =====================================================

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 12
# =====================================================

class Exam(models.Model):
    code = models.SlugField(unique=True)
    name = models.CharField(max_length=100)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 25


class ExamSection(models.Model):
    class SectionCode(models.TextChoices):
        CO = "co", _("Compréhension orale")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 32
        EO = "eo", _("Expression orale")

    exam = models.ForeignKey(Exam, on_delete=models.CASCADE, related_name="sections")
    code = models.CharField(max_length=2, choices=SectionCode.choices)
    order = models.PositiveIntegerField(default=1)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 38

    def __str__(self):
        return f"{self.exam.code.upper()} - {self.code.upper()}"


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 108
    ]

    section = models.ForeignKey(ExamSection, on_delete=models.CASCADE, related_name="questions")
    stem = models.TextField()
    passage = models.ForeignKey(Passage, null=True, blank=True, on_delete=models.SET_NULL)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 137
    MODE_CHOICES = [
        ("practice", "Entraînement"),
        ("mock", "Examen blanc"),
    ]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 140
    ]

    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name="exam_sessions")
    exam = models.ForeignKey(Exam, on_delete=models.CASCADE)
    section = models.ForeignKey(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 141

    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name="exam_sessions")
    exam = models.ForeignKey(Exam, on_delete=models.CASCADE)
    section = models.ForeignKey(
        ExamSection,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 143
    exam = models.ForeignKey(Exam, on_delete=models.CASCADE)
    section = models.ForeignKey(
        ExamSection,
        on_delete=models.CASCADE,
        null=True,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 161
class Attempt(models.Model):
    session = models.ForeignKey(Session, on_delete=models.CASCADE, related_name="attempts")
    section = models.ForeignKey(ExamSection, on_delete=models.CASCADE)

    raw_score = models.PositiveIntegerField(default=0)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 183
from django.db import models

class CourseLesson(models.Model):
    """
    📘 Leçon CECR universelle (TRANSITION)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 189

    # 🔒 ANCIEN LIEN (NE PAS SUPPRIMER MAINTENANT)
    exam = models.ForeignKey(
        "preparation_tests.Exam",
        on_delete=models.CASCADE,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 190
    # 🔒 ANCIEN LIEN (NE PAS SUPPRIMER MAINTENANT)
    exam = models.ForeignKey(
        "preparation_tests.Exam",
        on_delete=models.CASCADE,
        related_name="legacy_lessons",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 192
        "preparation_tests.Exam",
        on_delete=models.CASCADE,
        related_name="legacy_lessons",
        null=True,
        blank=True,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 197
    )

    # 🆕 NOUVEAU LIEN MULTI-EXAMENS (PRO)
    exams = models.ManyToManyField(
        "preparation_tests.Exam",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 198

    # 🆕 NOUVEAU LIEN MULTI-EXAMENS (PRO)
    exams = models.ManyToManyField(
        "preparation_tests.Exam",
        related_name="lessons",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 199
    # 🆕 NOUVEAU LIEN MULTI-EXAMENS (PRO)
    exams = models.ManyToManyField(
        "preparation_tests.Exam",
        related_name="lessons",
        blank=True,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 200
    exams = models.ManyToManyField(
        "preparation_tests.Exam",
        related_name="lessons",
        blank=True,
        help_text="Examens utilisant cette leçon (TEF, TCF, DELF, DALF)",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 202
        related_name="lessons",
        blank=True,
        help_text="Examens utilisant cette leçon (TEF, TCF, DELF, DALF)",
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 245

    def __str__(self):
        exams = ", ".join(e.code.upper() for e in self.exams.all())
        return f"[{self.level}] {self.section.upper()} – {self.title} ({exams})"

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 246
    def __str__(self):
        exams = ", ".join(e.code.upper() for e in self.exams.all())
        return f"[{self.level}] {self.section.upper()} – {self.title} ({exams})"

    @property
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 258
###############################################################################

class CourseExercise(models.Model):
    lesson = models.ForeignKey(
        CourseLesson,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 259

class CourseExercise(models.Model):
    lesson = models.ForeignKey(
        CourseLesson,
        on_delete=models.CASCADE,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 260
class CourseExercise(models.Model):
    lesson = models.ForeignKey(
        CourseLesson,
        on_delete=models.CASCADE,
        related_name="exercises",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 262
        CourseLesson,
        on_delete=models.CASCADE,
        related_name="exercises",
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 274
        null=True,
        blank=True,
        related_name="exercise_audios",
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 282
        null=True,
        blank=True,
        related_name="exercise_images",
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 306

    def __str__(self):
        return f"{self.lesson.title} – Exercice {self.order}"

    @property
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 330

# =====================================================
# 📊 PROGRESSION & CERTIFICATS
# =====================================================

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 333
# =====================================================

class UserSkillProgress(models.Model):
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
    exam_code = models.CharField(max_length=20)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 335
class UserSkillProgress(models.Model):
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
    exam_code = models.CharField(max_length=20)
    skill = models.CharField(max_length=2)
    score_percent = models.PositiveIntegerField(default=0)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 351
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)

    exam = models.ForeignKey(
        Exam,
        on_delete=models.CASCADE,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 352

    exam = models.ForeignKey(
        Exam,
        on_delete=models.CASCADE,
        null=True,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 359

    section = models.ForeignKey(
        ExamSection,
        on_delete=models.CASCADE,
        null=True,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 369
    correct_answers = models.PositiveIntegerField()

class UserLessonProgress(models.Model):
    user = models.ForeignKey(
        "auth.User",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 373
        "auth.User",
        on_delete=models.CASCADE,
        related_name="lesson_progress",
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 376
    )

    lesson = models.ForeignKey(
        CourseLesson,
        on_delete=models.CASCADE,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 377

    lesson = models.ForeignKey(
        CourseLesson,
        on_delete=models.CASCADE,
        related_name="user_progress",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 379
        CourseLesson,
        on_delete=models.CASCADE,
        related_name="user_progress",
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 384
    percent = models.PositiveIntegerField(default=0)
    is_completed = models.BooleanField(default=False)
    completed_exercises = models.PositiveIntegerField(default=0)
    total_exercises = models.PositiveIntegerField(default=0)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 385
    is_completed = models.BooleanField(default=False)
    completed_exercises = models.PositiveIntegerField(default=0)
    total_exercises = models.PositiveIntegerField(default=0)

    updated_at = models.DateTimeField(auto_now=True)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 391
class CEFRCertificate(models.Model):
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
    exam_code = models.CharField(max_length=20)
    level = models.CharField(max_length=2)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 406
# =====================================================

class StudyPlanProgress(models.Model):
    """
    Suivi du plan d'étude personnalisé de l'utilisateur
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 411
    """
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
    exam_code = models.CharField(max_length=20)
    current_day = models.PositiveIntegerField(default=1)
    total_days = models.PositiveIntegerField(default=30)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 420

    class Meta:
        unique_together = ["user", "exam_code"]
        ordering = ["-last_activity"]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 424

    def __str__(self):
        return f"{self.user.username} - {self.exam_code} (Jour {self.current_day}/{self.total_days})"


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 434
    )

    exam_code = models.CharField(max_length=20)
    scope = models.CharField(
        max_length=20,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 456

    def __str__(self):
        return f"IA {self.exam_code} ({self.scope}) – {self.created_at:%Y-%m-%d}"


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 464


class UserExerciseProgress(models.Model):
    """
    1 ligne par (user, exercise).
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 466
class UserExerciseProgress(models.Model):
    """
    1 ligne par (user, exercise).
    Permet d’éviter le double comptage et d’avoir une progression fiable.
    """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 467
    """
    1 ligne par (user, exercise).
    Permet d’éviter le double comptage et d’avoir une progression fiable.
    """
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 470
    """
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
    lesson = models.ForeignKey("preparation_tests.CourseLesson", on_delete=models.CASCADE)
    exercise = models.ForeignKey("preparation_tests.CourseExercise", on_delete=models.CASCADE)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 471
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
    lesson = models.ForeignKey("preparation_tests.CourseLesson", on_delete=models.CASCADE)
    exercise = models.ForeignKey("preparation_tests.CourseExercise", on_delete=models.CASCADE)

    is_completed = models.BooleanField(default=False)  # completed = réponse correcte validée
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 480

    class Meta:
        unique_together = ("user", "exercise")
        indexes = [
            models.Index(fields=["user", "lesson"]),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 482
        unique_together = ("user", "exercise")
        indexes = [
            models.Index(fields=["user", "lesson"]),
            models.Index(fields=["user", "exercise"]),
        ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\models.py
LINE: 483
        indexes = [
            models.Index(fields=["user", "lesson"]),
            models.Index(fields=["user", "exercise"]),
        ]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\services.py
LINE: 4
from core.utils import get_next_level

def try_unlock_next_level(user, exam_code, score_percent):
    profile = getattr(user, "profile", None)
    if not profile:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_ai.py
LINE: 4
from django.contrib.auth import get_user_model

from ai_engine.agents import ContentAgentFactory


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_ai.py
LINE: 14
        self.user = User.objects.create_user(username="aiuser", password="x")

    def test_default_agent_generate_lesson(self):
        agent = ContentAgentFactory.get()
        res = agent.generate_lesson(level="A1", skill="co", topic="salutations")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_ai.py
LINE: 16
    def test_default_agent_generate_lesson(self):
        agent = ContentAgentFactory.get()
        res = agent.generate_lesson(level="A1", skill="co", topic="salutations")
        self.assertTrue(res.success)
        self.assertIn("title", res.data)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_unit.py
LINE: 9

from preparation_tests.models import (
    Exam,
    CourseLesson,
    CEFRCertificate,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_unit.py
LINE: 10
from preparation_tests.models import (
    Exam,
    CourseLesson,
    CEFRCertificate,
)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_unit.py
LINE: 15

from preparation_tests.services.level_engine import try_unlock_next_level
from preparation_tests.services.recommendations import recommend_lessons
from preparation_tests.services.study_plan import build_study_plan

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_unit.py
LINE: 31
        self.user = User.objects.create_user(username="tester", password="pass")

        self.exam = Exam.objects.create(code="TEF", name="TEF Exam", language="fr")

    def tearDown(self):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_unit.py
LINE: 41
    def test_try_unlock_next_level_unlocks_and_creates_certificate(self):
        # score below threshold -> no unlock
        res = try_unlock_next_level(user=self.user, exam_code="TEF", skill="co", score_percent=60)
        self.assertFalse(res.get("unlocked"))

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_unit.py
LINE: 45

        # score above threshold -> unlock
        res2 = try_unlock_next_level(user=self.user, exam_code="TEF", skill="co", score_percent=75)
        self.assertTrue(res2.get("unlocked"))

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_unit.py
LINE: 49

        # certificat créé for the new level
        certs = CEFRCertificate.objects.filter(user=self.user, exam_code__iexact="TEF")
        self.assertTrue(certs.exists())

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_unit.py
LINE: 52
        self.assertTrue(certs.exists())

    def test_recommend_lessons_returns_relevant_lessons(self):
        # crée une leçon liée à l'examen
        lesson = CourseLesson.objects.create(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_unit.py
LINE: 53

    def test_recommend_lessons_returns_relevant_lessons(self):
        # crée une leçon liée à l'examen
        lesson = CourseLesson.objects.create(
            title="Leçon 1",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_unit.py
LINE: 54
    def test_recommend_lessons_returns_relevant_lessons(self):
        # crée une leçon liée à l'examen
        lesson = CourseLesson.objects.create(
            title="Leçon 1",
            slug="lecon-1",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_unit.py
LINE: 62
            is_published=True,
        )
        lesson.exams.add(self.exam)

        per_section = {"CO": {"pct": 50}}
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_unit.py
LINE: 66
        per_section = {"CO": {"pct": 50}}

        recs = recommend_lessons(user=self.user, exam_code="TEF", per_section=per_section)

        self.assertTrue(len(recs) >= 1)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_unit.py
LINE: 69

        self.assertTrue(len(recs) >= 1)
        self.assertEqual(recs[0]["lesson"].slug, lesson.slug)

    def test_build_study_plan_returns_days(self):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_unit.py
LINE: 72

    def test_build_study_plan_returns_days(self):
        # crée plusieurs leçons A1 pour l'examen
        for i in range(3):
            l = CourseLesson.objects.create(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_unit.py
LINE: 74
        # crée plusieurs leçons A1 pour l'examen
        for i in range(3):
            l = CourseLesson.objects.create(
                title=f"L{i}",
                slug=f"l{i}",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_unit.py
LINE: 82
                is_published=True,
            )
            l.exams.add(self.exam)

        plan = build_study_plan(user=self.user, exam_code="TEF")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\tests_unit.py
LINE: 84
            l.exams.add(self.exam)

        plan = build_study_plan(user=self.user, exam_code="TEF")

        self.assertIsInstance(plan, dict)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 13

    # =====================================================
    # 📚 LISTE DES EXAMENS
    # =====================================================
    path("exams/", views.exam_list, name="exam_list"),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 15
    # 📚 LISTE DES EXAMENS
    # =====================================================
    path("exams/", views.exam_list, name="exam_list"),
    path("exams/<slug:exam_code>/", views.exam_detail, name="exam_detail"),
    path("exams-fr/", views.french_exams, name="french_exams"),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 16
    # =====================================================
    path("exams/", views.exam_list, name="exam_list"),
    path("exams/<slug:exam_code>/", views.exam_detail, name="exam_detail"),
    path("exams-fr/", views.french_exams, name="french_exams"),

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 17
    path("exams/", views.exam_list, name="exam_list"),
    path("exams/<slug:exam_code>/", views.exam_detail, name="exam_detail"),
    path("exams-fr/", views.french_exams, name="french_exams"),

    # =====================================================
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 40

    # =====================================================
    # 📘 SECTIONS DE COURS PAR EXAMEN (TEF / TCF / DELF)
    # ⚠️ DOIT RESTER APRÈS LES ROUTES CO/CE
    # =====================================================
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 43
    # ⚠️ DOIT RESTER APRÈS LES ROUTES CO/CE
    # =====================================================
    path("fr/<slug:exam_code>/<slug:section>/", views.course_section, name="course_section"),

    # =====================================================
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 49
    # =====================================================
    path(
        "fr/<slug:exam_code>/<slug:section>/lesson/<int:lesson_id>/",
        views.lesson_session,
        name="lesson_session",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 50
    path(
        "fr/<slug:exam_code>/<slug:section>/lesson/<int:lesson_id>/",
        views.lesson_session,
        name="lesson_session",
    ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 51
        "fr/<slug:exam_code>/<slug:section>/lesson/<int:lesson_id>/",
        views.lesson_session,
        name="lesson_session",
    ),

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 55

    # =====================================================
    # 📝 EXAMEN BLANC (NOUVEAU MOTEUR)
    # =====================================================
    path("mock/<slug:exam_code>/<slug:section_code>/start/", views.start_mock_exam, name="start_mock_exam"),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 57
    # 📝 EXAMEN BLANC (NOUVEAU MOTEUR)
    # =====================================================
    path("mock/<slug:exam_code>/<slug:section_code>/start/", views.start_mock_exam, name="start_mock_exam"),
    path("mock/<int:session_id>/", views.mock_exam_session, name="mock_exam_session"),
    path("mock/<int:session_id>/results/", views.mock_exam_results, name="mock_exam_results"),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 58
    # =====================================================
    path("mock/<slug:exam_code>/<slug:section_code>/start/", views.start_mock_exam, name="start_mock_exam"),
    path("mock/<int:session_id>/", views.mock_exam_session, name="mock_exam_session"),
    path("mock/<int:session_id>/results/", views.mock_exam_results, name="mock_exam_results"),

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 59
    path("mock/<slug:exam_code>/<slug:section_code>/start/", views.start_mock_exam, name="start_mock_exam"),
    path("mock/<int:session_id>/", views.mock_exam_session, name="mock_exam_session"),
    path("mock/<int:session_id>/results/", views.mock_exam_results, name="mock_exam_results"),

    # =====================================================
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 64
    # 🕒 ANCIEN MOTEUR (SESSIONS)
    # =====================================================
    path("session/start/<slug:exam_code>/", views.start_session, name="start_session"),
    path("session/start/<slug:exam_code>/<slug:section>/", views.start_session_with_section, name="start_session_with_section"),
    path("attempt/<int:attempt_id>/", views.take_section, name="take_section"),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 65
    # =====================================================
    path("session/start/<slug:exam_code>/", views.start_session, name="start_session"),
    path("session/start/<slug:exam_code>/<slug:section>/", views.start_session_with_section, name="start_session_with_section"),
    path("attempt/<int:attempt_id>/", views.take_section, name="take_section"),
    path("answer/<int:attempt_id>/<int:question_id>/", views.submit_answer, name="submit_answer"),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 79
    # 📜 CERTIFICATS
    # =====================================================
    path("certificate/<slug:exam_code>/<slug:level>/", views.download_certificate, name="download_certificate"),
    path("certificates/verify/<slug:public_id>/", views.verify_certificate, name="verify_certificate"),

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 93
    # 📅 PLAN D’ÉTUDE
    # =====================================================
    path("<slug:exam_code>/study-plan/", views.study_plan_view, name="study_plan"),
    path("exercise-progress/", views.exercise_progress, name="exercise_progress"),

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 94
    # =====================================================
    path("<slug:exam_code>/study-plan/", views.study_plan_view, name="study_plan"),
    path("exercise-progress/", views.exercise_progress, name="exercise_progress"),

    path("<slug:exam_code>/study-plan/complete/", views.complete_study_day, name="complete_study_day"),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\urls.py
LINE: 96
    path("exercise-progress/", views.exercise_progress, name="exercise_progress"),

    path("<slug:exam_code>/study-plan/complete/", views.complete_study_day, name="complete_study_day"),
]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 18
# =========================================================
from django.contrib import messages
from preparation_tests.services.level_engine import get_cefr_progress

from django.contrib.auth.decorators import login_required
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 38
# =========================================================
from .models import (
    Exam,
    ExamSection,
    Question,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 39
from .models import (
    Exam,
    ExamSection,
    Question,
    Choice,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 45
    Attempt,
    Answer,
    CourseLesson,
    CourseExercise,
    UserSkillResult,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 46
    Answer,
    CourseLesson,
    CourseExercise,
    UserSkillResult,
    UserSkillProgress,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 48
    CourseExercise,
    UserSkillResult,
    UserSkillProgress,
    UserLessonProgress,
)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 49
    UserSkillResult,
    UserSkillProgress,
    UserLessonProgress,
)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 57
from preparation_tests.services import try_unlock_next_level
from preparation_tests.services.feedback import build_smart_feedback
from preparation_tests.services.recommendations import recommend_lessons
from preparation_tests.services.badges import build_cefr_badges
from preparation_tests.services.certificates import generate_cefr_certificate
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 113

@login_required
def french_exams(request):
    return render(request, "preparation_tests/french_exams.html")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 114
@login_required
def french_exams(request):
    return render(request, "preparation_tests/french_exams.html")

@login_required
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 166

# =========================================================
# 📚 EXAMENS
# =========================================================
@login_required
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 169
# =========================================================
@login_required
def exam_list(request):
    exams = Exam.objects.all().order_by("language", "name")
    return render(request, "preparation_tests/exam_list.html", {"exams": exams})
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 170
@login_required
def exam_list(request):
    exams = Exam.objects.all().order_by("language", "name")
    return render(request, "preparation_tests/exam_list.html", {"exams": exams})

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 171
def exam_list(request):
    exams = Exam.objects.all().order_by("language", "name")
    return render(request, "preparation_tests/exam_list.html", {"exams": exams})

@login_required
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 174

@login_required
def exam_detail(request, exam_code):
    exam = get_object_or_404(
        Exam,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 175
@login_required
def exam_detail(request, exam_code):
    exam = get_object_or_404(
        Exam,
        code__iexact=exam_code
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 176
def exam_detail(request, exam_code):
    exam = get_object_or_404(
        Exam,
        code__iexact=exam_code
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 177
    exam = get_object_or_404(
        Exam,
        code__iexact=exam_code
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 181

    # prefetch sections for template
    sections = exam.sections.all().order_by("order").select_related()

    return render(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 185
    return render(
        request,
        "preparation_tests/exam_detail.html",
        {
            "exam": exam,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 187
        "preparation_tests/exam_detail.html",
        {
            "exam": exam,
            "sections": sections,
        },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 197
# =========================================================
@login_required
def course_section(request, exam_code, section):
    exam_code = exam_code.upper()

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 198
@login_required
def course_section(request, exam_code, section):
    exam_code = exam_code.upper()

    exam = get_object_or_404(Exam, code__iexact=exam_code)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 200
    exam_code = exam_code.upper()

    exam = get_object_or_404(Exam, code__iexact=exam_code)

    # Perf: filter via exams__code to avoid extra join object when possible
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 202
    exam = get_object_or_404(Exam, code__iexact=exam_code)

    # Perf: filter via exams__code to avoid extra join object when possible
    lessons = CourseLesson.objects.filter(
        exams__code__iexact=exam.code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 203

    # Perf: filter via exams__code to avoid extra join object when possible
    lessons = CourseLesson.objects.filter(
        exams__code__iexact=exam.code,
        section=section,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 204
    # Perf: filter via exams__code to avoid extra join object when possible
    lessons = CourseLesson.objects.filter(
        exams__code__iexact=exam.code,
        section=section,
        is_published=True
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 207
        section=section,
        is_published=True
    ).order_by("level", "order").prefetch_related("exams")

    cefr = get_cefr_progress(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 209
    ).order_by("level", "order").prefetch_related("exams")

    cefr = get_cefr_progress(
        user=request.user,
        exam_code=exam.code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 211
    cefr = get_cefr_progress(
        user=request.user,
        exam_code=exam.code,
        skill=section,
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 219
        "preparation_tests/course_section.html",
        {
            "exam": exam,
            "exam_code": exam.code,
            "section": section,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 220
        {
            "exam": exam,
            "exam_code": exam.code,
            "section": section,
            "lessons": lessons,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 222
            "exam_code": exam.code,
            "section": section,
            "lessons": lessons,
            "cefr": cefr,
        }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 240

@login_required
def start_session_generic(request, exam_code):
    exam = get_object_or_404(Exam, code__iexact=exam_code)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 241
@login_required
def start_session_generic(request, exam_code):
    exam = get_object_or_404(Exam, code__iexact=exam_code)

    section = exam.sections.order_by("order").first()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 243
    exam = get_object_or_404(Exam, code__iexact=exam_code)

    section = exam.sections.order_by("order").first()

    if not section:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 248
        messages.error(request, "Aucune section disponible.")
        return redirect(
            "preparation_tests:exam_detail",
            exam_code=exam.code
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 249
        return redirect(
            "preparation_tests:exam_detail",
            exam_code=exam.code
        )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 254
    session = Session.objects.create(
        user=request.user,
        exam=exam,
        mode="practice",
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 386
    # =====================================================
    feedback = build_smart_feedback(
        exam_code=session.exam.code,
        global_pct=global_pct,
        per_section=per_section,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 395
    # 📚 Leçons recommandées
    # =====================================================
    recommended_lessons = recommend_lessons(
        user=request.user,
        exam_code=session.exam.code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 397
    recommended_lessons = recommend_lessons(
        user=request.user,
        exam_code=session.exam.code,
        per_section=per_section,
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 423

        # -------------------------------
        # 🎯 Progression CECR
        # -------------------------------
        cefr = get_cefr_progress(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 425
        # 🎯 Progression CECR
        # -------------------------------
        cefr = get_cefr_progress(
            user=request.user,
            exam_code=session.exam.code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 427
        cefr = get_cefr_progress(
            user=request.user,
            exam_code=session.exam.code,
            skill=first_attempt.section.code,
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 444
            "global_analysis": global_analysis,
            "feedback": feedback,
            "recommended_lessons": recommended_lessons,
            "cefr": cefr,  # 🔥 CECR actif
        },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 454

@login_required
def download_certificate(request, exam_code, level):
    cert_dir = Path(settings.MEDIA_ROOT) / "certificates"

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 457
    cert_dir = Path(settings.MEDIA_ROOT) / "certificates"

    for file in cert_dir.glob(f"{exam_code}_{level}_*.pdf"):
        return FileResponse(
            open(file, "rb"),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 472


############ FINISH EXAM #######################################
@login_required
def finish_exam(session):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 474
############ FINISH EXAM #######################################
@login_required
def finish_exam(session):
    attempt = session.attempts.first()

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 489
    UserSkillResult.objects.update_or_create(
        user=session.user,
        exam=session.exam,
        section=attempt.section,
        defaults={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 501

@login_required
def start_session(request, exam_code):
    return start_session_generic(request, exam_code=exam_code)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 502
@login_required
def start_session(request, exam_code):
    return start_session_generic(request, exam_code=exam_code)


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 506

@login_required
def start_session_with_section(request, exam_code, section):
    return start_session_generic(request, exam_code=exam_code)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 507
@login_required
def start_session_with_section(request, exam_code, section):
    return start_session_generic(request, exam_code=exam_code)


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 544

@login_required
def save_lesson_progress(request):
    return JsonResponse({"status": "ok"})

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 549

@login_required
def complete_study_day(request, exam_code):
    messages.success(request, "✅ Journée validée.")
    return redirect("preparation_tests:session_review")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 560
from django.utils import timezone

from .models import Exam, ExamSection, Session, Attempt, Question


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 564

@login_required
def start_mock_exam(request, exam_code, section_code):
    exam = get_object_or_404(Exam, code=exam_code)
    section = get_object_or_404(ExamSection, exam=exam, code=section_code)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 565
@login_required
def start_mock_exam(request, exam_code, section_code):
    exam = get_object_or_404(Exam, code=exam_code)
    section = get_object_or_404(ExamSection, exam=exam, code=section_code)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 566
def start_mock_exam(request, exam_code, section_code):
    exam = get_object_or_404(Exam, code=exam_code)
    section = get_object_or_404(ExamSection, exam=exam, code=section_code)

    # 1️⃣ Session (maintenant OK car section existe en DB)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 571
    session = Session.objects.create(
        user=request.user,
        exam=exam,
        section=section,
        mode="mock",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 584
    # 3️⃣ Redirect
    return redirect(
        "preparation_tests:mock_exam_session",
        session_id=session.id,
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 590

@login_required
def mock_exam_session(request, session_id):
    session = get_object_or_404(
        Session,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 598
    )

    exam = session.exam           # ✅ CORRECTION CLÉ
    section = session.section

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 601
    section = session.section

    # Questions aléatoires (examen blanc)
    questions = Question.objects.filter(
        section=section
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 616
    )

    # 🔥 CECR PROGRESSION
    cefr = get_cefr_progress(
        user=request.user,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 617

    # 🔥 CECR PROGRESSION
    cefr = get_cefr_progress(
        user=request.user,
        exam_code=exam.code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 619
    cefr = get_cefr_progress(
        user=request.user,
        exam_code=exam.code,
        skill=section.code,
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 625
    context = {
        "session": session,
        "exam": exam,                  # ✅ maintenant défini
        "exam_code": exam.code,
        "section": section.code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 626
        "session": session,
        "exam": exam,                  # ✅ maintenant défini
        "exam_code": exam.code,
        "section": section.code,
        "questions": questions,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 635
    return render(
        request,
        "preparation_tests/mock_exam_session.html",
        context,
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 641

@login_required
def mock_exam_results(request, session_id):
    session = get_object_or_404(
        Session,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 665
    return render(
        request,
        "preparation_tests/mock_exam_results.html",
        {
            "session": session,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 692

from django.contrib.auth.decorators import login_required
from preparation_tests.models import UserSkillProgress, CEFRCertificate
from core.constants import LEVEL_ORDER

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 700
    user = request.user

    progresses = UserSkillProgress.objects.filter(user=user)

    # ==================================================
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 703

    # ==================================================
    # 📊 STATS PAR EXAMEN (TEF / TCF / DELF / DALF)
    # ==================================================
    exams = {}
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 705
    # 📊 STATS PAR EXAMEN (TEF / TCF / DELF / DALF)
    # ==================================================
    exams = {}
    for p in progresses:
        exams.setdefault(p.exam_code, []).append(p)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 706
    # ==================================================
    exams = {}
    for p in progresses:
        exams.setdefault(p.exam_code, []).append(p)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 707
    exams = {}
    for p in progresses:
        exams.setdefault(p.exam_code, []).append(p)

    exam_stats = []
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 709
        exams.setdefault(p.exam_code, []).append(p)

    exam_stats = []
    for exam_code, items in exams.items():
        avg_score = round(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 710

    exam_stats = []
    for exam_code, items in exams.items():
        avg_score = round(
            sum(i.score_percent for i in items) / len(items)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 720
        ).current_level

        exam_stats.append({
            "exam": exam_code.upper(),
            "avg_score": avg_score,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 721

        exam_stats.append({
            "exam": exam_code.upper(),
            "avg_score": avg_score,
            "level": max_level,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 727

    # ==================================================
    # 🌍 PROGRESSION CECR GLOBALE
    # ==================================================
    if progresses.exists():
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 729
    # 🌍 PROGRESSION CECR GLOBALE
    # ==================================================
    if progresses.exists():
        global_index = max(
            list(LEVEL_ORDER.keys()).index(p.current_level)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 732
        global_index = max(
            list(LEVEL_ORDER.keys()).index(p.current_level)
            for p in progresses
        )
    else:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 738

    global_level = list(LEVEL_ORDER.keys())[global_index]
    global_progress = round(
        global_index / (len(LEVEL_ORDER) - 1) * 100
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 748
    counts = {"co": 0, "ce": 0, "ee": 0, "eo": 0}

    for p in progresses:
        if p.skill in skills:
            skills[p.skill] += p.score_percent
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 788
            CoachIAReport.objects.create(
                user=user,
                exam_code=latest_sessions.first().exam.code.upper(),
                scope="global",
                data=global_ai_analysis,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 799
    context = {
        "global_level": global_level,
        "global_progress": global_progress,
        "exam_stats": exam_stats,
        "skills": skills,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 800
        "global_level": global_level,
        "global_progress": global_progress,
        "exam_stats": exam_stats,
        "skills": skills,
        "certificates": certificates,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 824

@login_required
def study_plan_view(request, exam_code):
    """
    📅 Affiche le plan d’étude personnalisé de l’utilisateur
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 832
    plan = build_study_plan(
        user=request.user,
        exam_code=exam_code,
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 837
    if not plan:
        messages.error(request, "Impossible de charger ton plan d’étude.")
        return redirect("preparation_tests:exam_detail", exam_code=exam_code)

    # 2️⃣ Optionnel : adaptation IA (si résultats disponibles)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 844
        last_results = UserSkillResult.objects.filter(
            user=request.user,
            exam__code__iexact=exam_code,
        )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 867
        "preparation_tests/study_plan.html",
        {
            "exam_code": exam_code,
            "plan": plan,
        },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 874

@login_required
def complete_study_day(request, exam_code):
    """
    ✅ Valider la journée d’étude en cours
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 881
    advance_study_day(
        user=request.user,
        exam_code=exam_code,
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 888
    return redirect(
        "preparation_tests:study_plan",
        exam_code=exam_code,
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 947
    # Tous les niveaux existants en CO
    levels = (
        CourseLesson.objects
        .filter(section="co", is_published=True)
        .values_list("level", flat=True)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 958
    for level in levels:
        # Total des leçons du niveau
        total_lessons = CourseLesson.objects.filter(
            section="co",
            level=level,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 965

        # Leçons complétées par l'utilisateur
        completed_lessons = UserLessonProgress.objects.filter(
            user=user,
            lesson__section="co",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 967
        completed_lessons = UserLessonProgress.objects.filter(
            user=user,
            lesson__section="co",
            lesson__level=level,
            is_completed=True
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 968
            user=user,
            lesson__section="co",
            lesson__level=level,
            is_completed=True
        ).count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 972
        ).count()

        progress_pct = int(
            (completed_lessons / total_lessons) * 100
        ) if total_lessons else 0
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 973

        progress_pct = int(
            (completed_lessons / total_lessons) * 100
        ) if total_lessons else 0

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 974
        progress_pct = int(
            (completed_lessons / total_lessons) * 100
        ) if total_lessons else 0

        levels_data.append({
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 978
        levels_data.append({
            "level": level,
            "completed": completed_lessons,
            "total": total_lessons,
            "progress_pct": progress_pct,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 979
            "level": level,
            "completed": completed_lessons,
            "total": total_lessons,
            "progress_pct": progress_pct,
        })
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 980
            "completed": completed_lessons,
            "total": total_lessons,
            "progress_pct": progress_pct,
        })

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 994
from django.contrib.auth.decorators import login_required
from django.shortcuts import render
from preparation_tests.models import CourseLesson, UserLessonProgress
from preparation_tests.services.level_engine import get_cefr_progress

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 995
from django.shortcuts import render
from preparation_tests.models import CourseLesson, UserLessonProgress
from preparation_tests.services.level_engine import get_cefr_progress


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1003
    user = request.user

    lessons = CourseLesson.objects.filter(
        section="co",
        level=level,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1011
    # ✅ Anti-500 : si CECR n'existe pas ou bug service, on ne casse pas la page
    try:
        cefr = get_cefr_progress(
            user=user,
            exam_code="CECR",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1013
        cefr = get_cefr_progress(
            user=user,
            exam_code="CECR",
            skill="co",
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1025
            "section": "co",
            "level": level,
            "lessons": lessons,
            "cefr": cefr,
        }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1037

    levels = (
        CourseLesson.objects
        .filter(section="ce", is_published=True)
        .values_list("level", flat=True)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1046
    levels_data = []
    for level in levels:
        total_lessons = CourseLesson.objects.filter(
            section="ce",
            level=level,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1052
        ).count()

        completed_lessons = UserLessonProgress.objects.filter(
            user=user,
            lesson__section="ce",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1054
        completed_lessons = UserLessonProgress.objects.filter(
            user=user,
            lesson__section="ce",
            lesson__level=level,
            is_completed=True
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1055
            user=user,
            lesson__section="ce",
            lesson__level=level,
            is_completed=True
        ).count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1059
        ).count()

        progress_pct = int((completed_lessons / total_lessons) * 100) if total_lessons else 0

        levels_data.append({
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1063
        levels_data.append({
            "level": level,
            "completed": completed_lessons,
            "total": total_lessons,
            "progress_pct": progress_pct,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1064
            "level": level,
            "completed": completed_lessons,
            "total": total_lessons,
            "progress_pct": progress_pct,
        })
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1065
            "completed": completed_lessons,
            "total": total_lessons,
            "progress_pct": progress_pct,
        })

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1079
    user = request.user

    lessons = CourseLesson.objects.filter(
        section="ce",
        level=level,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1086

    try:
        cefr = get_cefr_progress(
            user=user,
            exam_code="CECR",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1088
        cefr = get_cefr_progress(
            user=user,
            exam_code="CECR",
            skill="ce",
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1100
            "section": "ce",
            "level": level,
            "lessons": lessons,
            "cefr": cefr,
        },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1107

@login_required
def lesson_session(request, exam_code, section, lesson_id):
    """Affiche une leçon et ses exercices.

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1110
    """Affiche une leçon et ses exercices.

    - `exam_code` et `section` sont utilisés pour sécurité/SEO mais la clé
      principale est `lesson_id`.
    """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1111

    - `exam_code` et `section` sont utilisés pour sécurité/SEO mais la clé
      principale est `lesson_id`.
    """
    lesson = (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1113
      principale est `lesson_id`.
    """
    lesson = (
        CourseLesson.objects.select_related()
        .prefetch_related("exercises", "exams")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1114
    """
    lesson = (
        CourseLesson.objects.select_related()
        .prefetch_related("exercises", "exams")
        .filter(id=lesson_id, is_published=True)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1115
    lesson = (
        CourseLesson.objects.select_related()
        .prefetch_related("exercises", "exams")
        .filter(id=lesson_id, is_published=True)
        .first()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1116
        CourseLesson.objects.select_related()
        .prefetch_related("exercises", "exams")
        .filter(id=lesson_id, is_published=True)
        .first()
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1120
    )

    if not lesson:
        raise Http404("Leçon introuvable")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1123
        raise Http404("Leçon introuvable")

    # Vérification basique que la leçon appartient bien à l'examen/section
    if section and lesson.section != section:
        # ne pas divulguer trop d'information, on renvoie 404
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1124

    # Vérification basique que la leçon appartient bien à l'examen/section
    if section and lesson.section != section:
        # ne pas divulguer trop d'information, on renvoie 404
        raise Http404("Leçon introuvable")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1128
        raise Http404("Leçon introuvable")

    exercises = lesson.exercises.filter(is_active=True).order_by("order")

    return render(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1132
    return render(
        request,
        "preparation_tests/lesson_session.html",
        {
            "lesson": lesson,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1134
        "preparation_tests/lesson_session.html",
        {
            "lesson": lesson,
            "exercises": exercises,
        },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1135
        {
            "lesson": lesson,
            "exercises": exercises,
        },
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1143
# =========================================================
@login_required
def start_session_generic(request, exam_code):
    exam = get_object_or_404(Exam, code__iexact=exam_code)
    section = exam.sections.order_by("order").first()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1144
@login_required
def start_session_generic(request, exam_code):
    exam = get_object_or_404(Exam, code__iexact=exam_code)
    section = exam.sections.order_by("order").first()

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1145
def start_session_generic(request, exam_code):
    exam = get_object_or_404(Exam, code__iexact=exam_code)
    section = exam.sections.order_by("order").first()

    if not section:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1149
    if not section:
        messages.error(request, "Aucune section disponible.")
        return redirect("preparation_tests:exam_detail", exam_code=exam.code)

    session = Session.objects.create(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1153
    session = Session.objects.create(
        user=request.user,
        exam=exam,
        mode="practice",
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1250

    feedback = build_smart_feedback(
        exam_code=session.exam.code,
        global_pct=global_pct,
        per_section=per_section,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1256
    )

    recommended_lessons = recommend_lessons(
        user=request.user,
        exam_code=session.exam.code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1258
    recommended_lessons = recommend_lessons(
        user=request.user,
        exam_code=session.exam.code,
        per_section=per_section,
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1274
            analysis = coach.analyze_attempt(first_attempt)

        cefr = get_cefr_progress(
            user=request.user,
            exam_code=session.exam.code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1276
        cefr = get_cefr_progress(
            user=request.user,
            exam_code=session.exam.code,
            skill=first_attempt.section.code,
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1290
            "global_analysis": global_analysis,
            "feedback": feedback,
            "recommended_lessons": recommended_lessons,
            "cefr": cefr,
        },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1300
# =========================================================
@login_required
def download_certificate(request, exam_code, level):
    cert_dir = Path(settings.MEDIA_ROOT) / "certificates"
    for file in cert_dir.glob(f"{exam_code}_{level}_*.pdf"):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1302
def download_certificate(request, exam_code, level):
    cert_dir = Path(settings.MEDIA_ROOT) / "certificates"
    for file in cert_dir.glob(f"{exam_code}_{level}_*.pdf"):
        return FileResponse(open(file, "rb"), as_attachment=True, filename=file.name)
    raise Http404("Certificat introuvable")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1311
# =========================================================
@login_required
def start_session(request, exam_code):
    return start_session_generic(request, exam_code=exam_code)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1312
@login_required
def start_session(request, exam_code):
    return start_session_generic(request, exam_code=exam_code)


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1316

@login_required
def start_session_with_section(request, exam_code, section):
    return start_session_generic(request, exam_code=exam_code)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1317
@login_required
def start_session_with_section(request, exam_code, section):
    return start_session_generic(request, exam_code=exam_code)


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1346

@login_required
def save_lesson_progress(request):
    return JsonResponse({"status": "ok"})

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1354
# =========================================================
@login_required
def study_plan_view(request, exam_code):
    plan = build_study_plan(user=request.user, exam_code=exam_code)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1355
@login_required
def study_plan_view(request, exam_code):
    plan = build_study_plan(user=request.user, exam_code=exam_code)

    if not plan:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1359
    if not plan:
        messages.error(request, "Impossible de charger ton plan d’étude.")
        return redirect("preparation_tests:exam_detail", exam_code=exam_code)

    try:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1364
        last_results = UserSkillResult.objects.filter(
            user=request.user,
            exam__code__iexact=exam_code,
        )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1380
        request,
        "preparation_tests/study_plan.html",
        {"exam_code": exam_code, "plan": plan},
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1385

@login_required
def complete_study_day(request, exam_code):
    advance_study_day(user=request.user, exam_code=exam_code)
    messages.success(request, "✅ Journée validée. Continue comme ça 💪")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1386
@login_required
def complete_study_day(request, exam_code):
    advance_study_day(user=request.user, exam_code=exam_code)
    messages.success(request, "✅ Journée validée. Continue comme ça 💪")
    return redirect("preparation_tests:study_plan", exam_code=exam_code)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1388
    advance_study_day(user=request.user, exam_code=exam_code)
    messages.success(request, "✅ Journée validée. Continue comme ça 💪")
    return redirect("preparation_tests:study_plan", exam_code=exam_code)


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1418

    levels = (
        CourseLesson.objects.filter(section="co", is_published=True)
        .values_list("level", flat=True)
        .distinct()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1426
    levels_data = []
    for level in levels:
        total_lessons = CourseLesson.objects.filter(section="co", level=level, is_published=True).count()
        completed_lessons = UserLessonProgress.objects.filter(
            user=user, lesson__section="co", lesson__level=level, is_completed=True
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1427
    for level in levels:
        total_lessons = CourseLesson.objects.filter(section="co", level=level, is_published=True).count()
        completed_lessons = UserLessonProgress.objects.filter(
            user=user, lesson__section="co", lesson__level=level, is_completed=True
        ).count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1428
        total_lessons = CourseLesson.objects.filter(section="co", level=level, is_published=True).count()
        completed_lessons = UserLessonProgress.objects.filter(
            user=user, lesson__section="co", lesson__level=level, is_completed=True
        ).count()

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1431
        ).count()

        progress_pct = int((completed_lessons / total_lessons) * 100) if total_lessons else 0

        levels_data.append(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1436
            {
                "level": level,
                "completed": completed_lessons,
                "total": total_lessons,
                "progress_pct": progress_pct,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1437
                "level": level,
                "completed": completed_lessons,
                "total": total_lessons,
                "progress_pct": progress_pct,
            }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1438
                "completed": completed_lessons,
                "total": total_lessons,
                "progress_pct": progress_pct,
            }
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1450
    user = request.user

    lessons = CourseLesson.objects.filter(section="co", level=level, is_published=True).order_by("order")

    try:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1453

    try:
        cefr = get_cefr_progress(user=user, exam_code="CECR", skill="co")
    except Exception:
        cefr = None
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1463
            "section": "co",
            "level": level,
            "lessons": lessons,
            "cefr": cefr,
        },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1474

    levels = (
        CourseLesson.objects.filter(section="ce", is_published=True)
        .values_list("level", flat=True)
        .distinct()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1482
    levels_data = []
    for level in levels:
        total_lessons = CourseLesson.objects.filter(section="ce", level=level, is_published=True).count()
        completed_lessons = UserLessonProgress.objects.filter(
            user=user, lesson__section="ce", lesson__level=level, is_completed=True
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1483
    for level in levels:
        total_lessons = CourseLesson.objects.filter(section="ce", level=level, is_published=True).count()
        completed_lessons = UserLessonProgress.objects.filter(
            user=user, lesson__section="ce", lesson__level=level, is_completed=True
        ).count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1484
        total_lessons = CourseLesson.objects.filter(section="ce", level=level, is_published=True).count()
        completed_lessons = UserLessonProgress.objects.filter(
            user=user, lesson__section="ce", lesson__level=level, is_completed=True
        ).count()

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1487
        ).count()

        progress_pct = int((completed_lessons / total_lessons) * 100) if total_lessons else 0

        levels_data.append(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1492
            {
                "level": level,
                "completed": completed_lessons,
                "total": total_lessons,
                "progress_pct": progress_pct,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1493
                "level": level,
                "completed": completed_lessons,
                "total": total_lessons,
                "progress_pct": progress_pct,
            }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1494
                "completed": completed_lessons,
                "total": total_lessons,
                "progress_pct": progress_pct,
            }
        )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1506
    user = request.user

    lessons = CourseLesson.objects.filter(section="ce", level=level, is_published=True).order_by("order")

    try:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1509

    try:
        cefr = get_cefr_progress(user=user, exam_code="CECR", skill="ce")
    except Exception:
        cefr = None
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1519
            "section": "ce",
            "level": level,
            "lessons": lessons,
            "cefr": cefr,
        },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1529
from django.views.decorators.http import require_POST

from .models import CourseExercise, UserLessonProgress, UserExerciseProgress


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1534
@login_required
@require_POST
def exercise_progress(request):
    """
    Reçoit: {exercise_id: int, selected: "A", correct: true/false}
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1536
def exercise_progress(request):
    """
    Reçoit: {exercise_id: int, selected: "A", correct: true/false}
    Met à jour UserExerciseProgress + UserLessonProgress.
    """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1537
    """
    Reçoit: {exercise_id: int, selected: "A", correct: true/false}
    Met à jour UserExerciseProgress + UserLessonProgress.
    """
    try:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1544
        return JsonResponse({"ok": False, "error": "invalid_json"}, status=400)

    exercise_id = payload.get("exercise_id")
    selected = (payload.get("selected") or "").upper()
    correct = bool(payload.get("correct"))
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1548
    correct = bool(payload.get("correct"))

    if not exercise_id:
        return JsonResponse({"ok": False, "error": "missing_exercise_id"}, status=400)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1549

    if not exercise_id:
        return JsonResponse({"ok": False, "error": "missing_exercise_id"}, status=400)

    exercise = CourseExercise.objects.select_related("lesson").filter(id=exercise_id).first()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1551
        return JsonResponse({"ok": False, "error": "missing_exercise_id"}, status=400)

    exercise = CourseExercise.objects.select_related("lesson").filter(id=exercise_id).first()
    if not exercise:
        return JsonResponse({"ok": False, "error": "exercise_not_found"}, status=404)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1552

    exercise = CourseExercise.objects.select_related("lesson").filter(id=exercise_id).first()
    if not exercise:
        return JsonResponse({"ok": False, "error": "exercise_not_found"}, status=404)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1553
    exercise = CourseExercise.objects.select_related("lesson").filter(id=exercise_id).first()
    if not exercise:
        return JsonResponse({"ok": False, "error": "exercise_not_found"}, status=404)

    lesson = exercise.lesson
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1555
        return JsonResponse({"ok": False, "error": "exercise_not_found"}, status=404)

    lesson = exercise.lesson
    user = request.user

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1558
    user = request.user

    # 1) Progression exercice (idempotent)
    prog, _ = UserExerciseProgress.objects.get_or_create(
        user=user,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1559

    # 1) Progression exercice (idempotent)
    prog, _ = UserExerciseProgress.objects.get_or_create(
        user=user,
        exercise=exercise,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1561
    prog, _ = UserExerciseProgress.objects.get_or_create(
        user=user,
        exercise=exercise,
        defaults={"lesson": lesson},
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1562
        user=user,
        exercise=exercise,
        defaults={"lesson": lesson},
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1565
    )

    # si jamais lesson diffère (sécurité)
    if prog.lesson_id != lesson.id:
        prog.lesson = lesson
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1566

    # si jamais lesson diffère (sécurité)
    if prog.lesson_id != lesson.id:
        prog.lesson = lesson

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1567
    # si jamais lesson diffère (sécurité)
    if prog.lesson_id != lesson.id:
        prog.lesson = lesson

    # Enregistrer tentative
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1573
    prog.save()

    # 2) Calcul progression de la leçon
    total = lesson.exercises.filter(is_active=True).count()
    completed = UserExerciseProgress.objects.filter(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1574

    # 2) Calcul progression de la leçon
    total = lesson.exercises.filter(is_active=True).count()
    completed = UserExerciseProgress.objects.filter(
        user=user,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1575
    # 2) Calcul progression de la leçon
    total = lesson.exercises.filter(is_active=True).count()
    completed = UserExerciseProgress.objects.filter(
        user=user,
        lesson=lesson,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1577
    completed = UserExerciseProgress.objects.filter(
        user=user,
        lesson=lesson,
        is_completed=True
    ).count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1584
    is_completed = (total > 0 and completed >= total)

    ulp, _ = UserLessonProgress.objects.get_or_create(
        user=user,
        lesson=lesson,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1586
    ulp, _ = UserLessonProgress.objects.get_or_create(
        user=user,
        lesson=lesson,
        defaults={
            "percent": 0,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1590
            "percent": 0,
            "is_completed": False,
            "completed_exercises": 0,
            "total_exercises": total,
        }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1591
            "is_completed": False,
            "completed_exercises": 0,
            "total_exercises": total,
        }
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1595
    )

    ulp.total_exercises = total
    ulp.completed_exercises = completed
    ulp.percent = percent
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1596

    ulp.total_exercises = total
    ulp.completed_exercises = completed
    ulp.percent = percent
    ulp.is_completed = is_completed
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1603
    return JsonResponse({
        "ok": True,
        "lesson_id": lesson.id,
        "total_exercises": total,
        "completed_exercises": completed,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1604
        "ok": True,
        "lesson_id": lesson.id,
        "total_exercises": total,
        "completed_exercises": completed,
        "percent": percent,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1605
        "lesson_id": lesson.id,
        "total_exercises": total,
        "completed_exercises": completed,
        "percent": percent,
        "is_completed": is_completed,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\preparation_tests\views.py
LINE: 1608
        "percent": percent,
        "is_completed": is_completed,
        "exercise_completed": prog.is_completed,
        "attempts": prog.attempts,
    })
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\migrations\0003_alter_milestone_user_alter_userchecklist_user_and_more.py
LINE: 32
        ),
        migrations.CreateModel(
            name='UserProgress',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\migrations\0003_alter_milestone_user_alter_userchecklist_user_and_more.py
LINE: 40
                ('step_4_documents', models.BooleanField(default=False)),
                ('step_5_coach', models.BooleanField(default=False)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='visa_progress', to=settings.AUTH_USER_MODEL)),
            ],
            options={
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\migrations\0003_alter_milestone_user_alter_userchecklist_user_and_more.py
LINE: 43
            ],
            options={
                'verbose_name': 'Progression Visa Études',
                'verbose_name_plural': 'Progressions Visa Études',
            },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\migrations\0003_alter_milestone_user_alter_userchecklist_user_and_more.py
LINE: 44
            options={
                'verbose_name': 'Progression Visa Études',
                'verbose_name_plural': 'Progressions Visa Études',
            },
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\migrations\0005_remove_milestone_pays_remove_faq_pays_and_more.py
LINE: 33
        ),
        migrations.RemoveField(
            model_name='userprogress',
            name='user',
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\migrations\0005_remove_milestone_pays_remove_faq_pays_and_more.py
LINE: 141
        ),
        migrations.CreateModel(
            name='VisaProgress',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\migrations\0005_remove_milestone_pays_remove_faq_pays_and_more.py
LINE: 151
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='visa_progress', to=settings.AUTH_USER_MODEL)),
            ],
        ),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\migrations\0005_remove_milestone_pays_remove_faq_pays_and_more.py
LINE: 164
        ),
        migrations.DeleteModel(
            name='UserProgress',
        ),
        migrations.RemoveField(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\migrations\0006_userprogress.py
LINE: 17
    operations = [
        migrations.CreateModel(
            name='UserProgress',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\migrations\0007_rename_current_step_userprogress_step_2_country.py
LINE: 9

    dependencies = [
        ('visaetude', '0006_userprogress'),
    ]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\migrations\0007_rename_current_step_userprogress_step_2_country.py
LINE: 14
    operations = [
        migrations.RenameField(
            model_name='userprogress',
            old_name='current_step',
            new_name='step_2_country',
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\migrations\0008_userprogress_step_1_profile_and_more.py
LINE: 11

    dependencies = [
        ('visaetude', '0007_rename_current_step_userprogress_step_2_country'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\migrations\0008_userprogress_step_1_profile_and_more.py
LINE: 17
    operations = [
        migrations.AddField(
            model_name='userprogress',
            name='step_1_profile',
            field=models.BooleanField(default=False),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\migrations\0008_userprogress_step_1_profile_and_more.py
LINE: 22
        ),
        migrations.AddField(
            model_name='userprogress',
            name='step_5_coach',
            field=models.BooleanField(default=False),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\migrations\0008_userprogress_step_1_profile_and_more.py
LINE: 27
        ),
        migrations.AlterField(
            model_name='userprogress',
            name='step_2_country',
            field=models.BooleanField(default=False),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\migrations\0008_userprogress_step_1_profile_and_more.py
LINE: 32
        ),
        migrations.AlterField(
            model_name='userprogress',
            name='user',
            field=models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='user_progress', to=settings.AUTH_USER_MODEL),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\migrations\0008_userprogress_step_1_profile_and_more.py
LINE: 34
            model_name='userprogress',
            name='user',
            field=models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='user_progress', to=settings.AUTH_USER_MODEL),
        ),
        migrations.CreateModel(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\migrations\0009_alter_studentprofile_budget_range_and_more.py
LINE: 9

    dependencies = [
        ('visaetude', '0008_userprogress_step_1_profile_and_more'),
    ]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\context_processors.py
LINE: 1

from .models import UserProgress

TOTAL_STEPS = 5
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\context_processors.py
LINE: 6


def visa_progress(request):
    """
    Ajoute la progression Visa Études dans le contexte global des templates.
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\context_processors.py
LINE: 8
def visa_progress(request):
    """
    Ajoute la progression Visa Études dans le contexte global des templates.
    - Si l'utilisateur n'est pas connecté : progression = 0%.
    - Si l'utilisateur est connecté : on récupère/crée UserProgress.
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\context_processors.py
LINE: 9
    """
    Ajoute la progression Visa Études dans le contexte global des templates.
    - Si l'utilisateur n'est pas connecté : progression = 0%.
    - Si l'utilisateur est connecté : on récupère/crée UserProgress.
    """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\context_processors.py
LINE: 10
    Ajoute la progression Visa Études dans le contexte global des templates.
    - Si l'utilisateur n'est pas connecté : progression = 0%.
    - Si l'utilisateur est connecté : on récupère/crée UserProgress.
    """
    if not request.user.is_authenticated:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\context_processors.py
LINE: 14
    if not request.user.is_authenticated:
        return {
            "visa_progress": None,
            "visa_progress_percent": 0,
            "visa_progress_label": "Étape 1/5",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\context_processors.py
LINE: 15
        return {
            "visa_progress": None,
            "visa_progress_percent": 0,
            "visa_progress_label": "Étape 1/5",
        }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\context_processors.py
LINE: 16
            "visa_progress": None,
            "visa_progress_percent": 0,
            "visa_progress_label": "Étape 1/5",
        }

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\context_processors.py
LINE: 19
        }

    progress, _ = UserProgress.objects.get_or_create(user=request.user)
    completed = progress.completed_steps

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\context_processors.py
LINE: 20

    progress, _ = UserProgress.objects.get_or_create(user=request.user)
    completed = progress.completed_steps

    # Pour ne pas afficher 0/5, on met au moins étape 1.
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\context_processors.py
LINE: 28

    return {
        "visa_progress": progress,
        "visa_progress_percent": percent,
        "visa_progress_label": label,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\context_processors.py
LINE: 29
    return {
        "visa_progress": progress,
        "visa_progress_percent": percent,
        "visa_progress_label": label,
    }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\context_processors.py
LINE: 30
        "visa_progress": progress,
        "visa_progress_percent": percent,
        "visa_progress_label": label,
    }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\models.py
LINE: 182

# ==================================================
# PROGRESSION GLOBALE — VISA ÉTUDES (UNIQUE)
# ==================================================
class VisaProgress(models.Model):
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\models.py
LINE: 184
# PROGRESSION GLOBALE — VISA ÉTUDES (UNIQUE)
# ==================================================
class VisaProgress(models.Model):
    user = models.OneToOneField(
        settings.AUTH_USER_MODEL,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\models.py
LINE: 188
        settings.AUTH_USER_MODEL,
        on_delete=models.CASCADE,
        related_name="visa_progress"
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\models.py
LINE: 215

    def __str__(self):
        return f"Progress Visa Études – {self.user}"


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\models.py
LINE: 219

# ==================================================
# PROGRESSION UTILISATEUR — POUR LES ÉTAPES DANS LES VUES
# (Aligne avec ce que tes vues utilisent: step_1_profile, step_2_country, step_5_coach)
# ==================================================
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\models.py
LINE: 222
# (Aligne avec ce que tes vues utilisent: step_1_profile, step_2_country, step_5_coach)
# ==================================================
class UserProgress(models.Model):
    user = models.OneToOneField(
        settings.AUTH_USER_MODEL,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\models.py
LINE: 226
        settings.AUTH_USER_MODEL,
        on_delete=models.CASCADE,
        related_name="user_progress"
    )
    step_1_profile = models.BooleanField(default=False)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\models.py
LINE: 234

    def __str__(self):
        return f"UserProgress – {self.user}"


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\signals.py
LINE: 5
from django.contrib.auth import get_user_model

from .models import VisaProgress

User = get_user_model()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\signals.py
LINE: 11

@receiver(post_save, sender=User)
def create_visa_progress(sender, instance, created, **kwargs):
    """
    Crée automatiquement la progression Visa Études
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\signals.py
LINE: 13
def create_visa_progress(sender, instance, created, **kwargs):
    """
    Crée automatiquement la progression Visa Études
    pour chaque nouvel utilisateur.
    """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\signals.py
LINE: 17
    """
    if created:
        VisaProgress.objects.create(user=instance)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 9
from .models import (
    VisaCountry, VisaResource, UserProfile,
    VisaProgress, UserProgress, University,
    CountryAdvice, Scholarship, StudentProfile
)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 33
        if form.is_valid():
            form.save()
            # progression : étape 1 validée
            progress, _ = UserProgress.objects.get_or_create(user=user)
            if not progress.step_1_profile:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 34
            form.save()
            # progression : étape 1 validée
            progress, _ = UserProgress.objects.get_or_create(user=user)
            if not progress.step_1_profile:
                progress.step_1_profile = True
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 35
            # progression : étape 1 validée
            progress, _ = UserProgress.objects.get_or_create(user=user)
            if not progress.step_1_profile:
                progress.step_1_profile = True
                progress.save()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 36
            progress, _ = UserProgress.objects.get_or_create(user=user)
            if not progress.step_1_profile:
                progress.step_1_profile = True
                progress.save()
    else:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 37
            if not progress.step_1_profile:
                progress.step_1_profile = True
                progress.save()
    else:
        form = UserProfileForm(instance=instance)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 58
        if form.is_valid():
            form.save()
            # progression : étape 1 validée
            progress, _ = UserProgress.objects.get_or_create(user=user)
            if not progress.step_1_profile:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 59
            form.save()
            # progression : étape 1 validée
            progress, _ = UserProgress.objects.get_or_create(user=user)
            if not progress.step_1_profile:
                progress.step_1_profile = True
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 60
            # progression : étape 1 validée
            progress, _ = UserProgress.objects.get_or_create(user=user)
            if not progress.step_1_profile:
                progress.step_1_profile = True
                progress.save()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 61
            progress, _ = UserProgress.objects.get_or_create(user=user)
            if not progress.step_1_profile:
                progress.step_1_profile = True
                progress.save()
    else:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 62
            if not progress.step_1_profile:
                progress.step_1_profile = True
                progress.save()
    else:
        form = StudentProfileForm(instance=instance)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 77
    user = request.user if request.user.is_authenticated else None
    if user:
        progress, _ = UserProgress.objects.get_or_create(user=user)
        if not progress.step_2_country:
            progress.step_2_country = True
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 78
    if user:
        progress, _ = UserProgress.objects.get_or_create(user=user)
        if not progress.step_2_country:
            progress.step_2_country = True
            progress.save()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 79
        progress, _ = UserProgress.objects.get_or_create(user=user)
        if not progress.step_2_country:
            progress.step_2_country = True
            progress.save()

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 80
        if not progress.step_2_country:
            progress.step_2_country = True
            progress.save()

    db_countries = list(VisaCountry.objects.filter(is_active=True))
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 134
#################### roadmap ##########################
def roadmap(request):
    visa_progress = None
    progress_percent = 0
    progress_label = "Étape 1/5"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 135
def roadmap(request):
    visa_progress = None
    progress_percent = 0
    progress_label = "Étape 1/5"

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 136
    visa_progress = None
    progress_percent = 0
    progress_label = "Étape 1/5"

    if request.user.is_authenticated:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 139

    if request.user.is_authenticated:
        visa_progress, _ = VisaProgress.objects.get_or_create(user=request.user)
        total_steps = 5
        completed_steps = visa_progress.completed_steps
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 141
        visa_progress, _ = VisaProgress.objects.get_or_create(user=request.user)
        total_steps = 5
        completed_steps = visa_progress.completed_steps
        progress_percent = int((completed_steps / total_steps) * 100)
        progress_label = f"Étape {visa_progress.current_stage}/{total_steps}"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 142
        total_steps = 5
        completed_steps = visa_progress.completed_steps
        progress_percent = int((completed_steps / total_steps) * 100)
        progress_label = f"Étape {visa_progress.current_stage}/{total_steps}"

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 143
        completed_steps = visa_progress.completed_steps
        progress_percent = int((completed_steps / total_steps) * 100)
        progress_label = f"Étape {visa_progress.current_stage}/{total_steps}"

    return render(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 149
        "visaetude/roadmap.html",
        {
            "visa_progress": visa_progress,
            "visa_progress_percent": progress_percent,
            "visa_progress_label": progress_label,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 150
        {
            "visa_progress": visa_progress,
            "visa_progress_percent": progress_percent,
            "visa_progress_label": progress_label,
        },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 151
            "visa_progress": visa_progress,
            "visa_progress_percent": progress_percent,
            "visa_progress_label": progress_label,
        },
    )
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 160
    user = request.user if request.user.is_authenticated else None
    if user:
        progress, _ = UserProgress.objects.get_or_create(user=user)
        if not progress.step_5_coach:
            progress.step_5_coach = True
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 161
    if user:
        progress, _ = UserProgress.objects.get_or_create(user=user)
        if not progress.step_5_coach:
            progress.step_5_coach = True
            progress.save()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 162
        progress, _ = UserProgress.objects.get_or_create(user=user)
        if not progress.step_5_coach:
            progress.step_5_coach = True
            progress.save()
    return render(request, "visaetude/coach_ai.html")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 163
        if not progress.step_5_coach:
            progress.step_5_coach = True
            progress.save()
    return render(request, "visaetude/coach_ai.html")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 201
from django.contrib.auth.decorators import login_required
from .forms import StudentProfileForm
from .models import StudentProfile, UserProgress

@login_required
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 212
        if form.is_valid():
            form.save()
            progress, _ = UserProgress.objects.get_or_create(user=user)
            if not progress.step_1_profile:
                progress.step_1_profile = True
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 213
            form.save()
            progress, _ = UserProgress.objects.get_or_create(user=user)
            if not progress.step_1_profile:
                progress.step_1_profile = True
                progress.save()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 214
            progress, _ = UserProgress.objects.get_or_create(user=user)
            if not progress.step_1_profile:
                progress.step_1_profile = True
                progress.save()
    else:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\visaetude\views.py
LINE: 215
            if not progress.step_1_profile:
                progress.step_1_profile = True
                progress.save()
    else:
        form = StudentProfileForm(instance=instance)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 235

def _build_coach_message(
    profile: UserProfile, progress_percent: int, pays_prioritaire: str
) -> Dict[str, str]:
    """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 239
    """
    Génère un titre + message pour le coach en fonction :
    - de la progression globale
    - du pays prioritaire
    """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 244
    nom_affichage = profile.nom or "ton profil"

    if progress_percent == 0:
        title = "On démarre ton projet Visa Travail 🚀"
        message = (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 252
            "Commence par compléter au moins 2–3 étapes du plan pour lancer la dynamique."
        )
    elif progress_percent < 40:
        title = "Tu es en phase de lancement ✅"
        message = (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 259
            "adaptation du CV, préparation des preuves d’expérience et premières candidatures ciblées."
        )
    elif progress_percent < 80:
        title = "Très bonne dynamique, continue 💪"
        message = (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 302
    total_steps = steps.count()
    done_steps = steps.filter(statut=ActionStep.STATUT_TERMINE).count()
    progress_percent = int((done_steps / total_steps) * 100) if total_steps > 0 else 0

    # Label de progression
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 304
    progress_percent = int((done_steps / total_steps) * 100) if total_steps > 0 else 0

    # Label de progression
    if progress_percent == 0:
        progress_label = "Tu démarres ton parcours"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 305

    # Label de progression
    if progress_percent == 0:
        progress_label = "Tu démarres ton parcours"
    elif progress_percent < 40:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 306
    # Label de progression
    if progress_percent == 0:
        progress_label = "Tu démarres ton parcours"
    elif progress_percent < 40:
        progress_label = "Tu es en phase de lancement"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 307
    if progress_percent == 0:
        progress_label = "Tu démarres ton parcours"
    elif progress_percent < 40:
        progress_label = "Tu es en phase de lancement"
    elif progress_percent < 80:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 308
        progress_label = "Tu démarres ton parcours"
    elif progress_percent < 40:
        progress_label = "Tu es en phase de lancement"
    elif progress_percent < 80:
        progress_label = "Bonne progression"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 309
    elif progress_percent < 40:
        progress_label = "Tu es en phase de lancement"
    elif progress_percent < 80:
        progress_label = "Bonne progression"
    else:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 310
        progress_label = "Tu es en phase de lancement"
    elif progress_percent < 80:
        progress_label = "Bonne progression"
    else:
        progress_label = "Tu es proche de ton objectif"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 312
        progress_label = "Bonne progression"
    else:
        progress_label = "Tu es proche de ton objectif"

    # Pays prioritaire (premier pays coché)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 321

    # Coach IA (titre + message)
    coach = _build_coach_message(profile, progress_percent, pays_prioritaire)
    coach_title = coach["title"]
    coach_message = coach["message"]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 336
            "done_steps": done_steps,
            "total_steps": total_steps,
            "progress_percent": progress_percent,
            "progress_label": progress_label,
            "coach_title": coach_title,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 337
            "total_steps": total_steps,
            "progress_percent": progress_percent,
            "progress_label": progress_label,
            "coach_title": coach_title,
            "coach_message": coach_message,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 539


def compute_progress_score(profile: UserProfile) -> Dict[str, object]:
    """
    Score 0–20 basé sur la progression du plan d'action (ActionStep).
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 541
def compute_progress_score(profile: UserProfile) -> Dict[str, object]:
    """
    Score 0–20 basé sur la progression du plan d'action (ActionStep).
    """
    steps = profile.actions.all()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 570
    - profil (0–40)
    - matching offres (0–40)
    - progression (0–20)
    → Score global 0–100 + commentaires.
    """
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 575
    profile_part = compute_profile_score(profile)
    matching_part = compute_matching_score(profile)
    progress_part = compute_progress_score(profile)

    global_score = (
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 578

    global_score = (
        profile_part["score"] + matching_part["score"] + progress_part["score"]
    )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 620
        )

    # Progression
    if progress_part["score"] < 8:
        insights.append(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 621

    # Progression
    if progress_part["score"] < 8:
        insights.append(
            "La progression dans ton plan d’action est encore faible : fixe-toi des objectifs hebdomadaires concrets."
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 623
    if progress_part["score"] < 8:
        insights.append(
            "La progression dans ton plan d’action est encore faible : fixe-toi des objectifs hebdomadaires concrets."
        )
    elif progress_part["score"] < 14:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 625
            "La progression dans ton plan d’action est encore faible : fixe-toi des objectifs hebdomadaires concrets."
        )
    elif progress_part["score"] < 14:
        insights.append(
            "Tu avances, mais tu peux encore accélérer le rythme sur les étapes clés (CV, candidatures, tests de langue)."
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 631
    else:
        insights.append(
            "Très bonne progression dans ton plan d’action : continue sur cette dynamique jusqu’aux premières offres concrètes."
        )

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 639
        "profile_part": profile_part,
        "matching_part": matching_part,
        "progress_part": progress_part,
        "insights": insights,
    }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 685
    total_steps = steps.count()
    done_steps = steps.filter(statut=ActionStep.STATUT_TERMINE).count()
    progress_percent = int((done_steps / total_steps) * 100) if total_steps > 0 else 0

    context = {
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\views.py
LINE: 696
        "total_steps": total_steps,
        "done_steps": done_steps,
        "progress_percent": progress_percent,
    }

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\VisaTravailApp\visa_data.py
LINE: 217
            "Preuves de fonds.",
        ],
        lien_officiel="https://www.example.com/etudes-travail",
        difficulte="Variable",
        delai_approx="12–36 mois",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 4
# -*- coding: utf-8 -*-
"""
Script pour générer le curriculum de compréhension écrite (CE) A1-C2
Crée 6 fichiers JSON: reading_curriculum_{LEVEL}_fr.json
"""
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 5
"""
Script pour générer le curriculum de compréhension écrite (CE) A1-C2
Crée 6 fichiers JSON: reading_curriculum_{LEVEL}_fr.json
"""

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 13

# Configuration par niveau
CURRICULUM_CONFIG = {
    "A1": {
        "title": "Débutant absolu",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 16
    "A1": {
        "title": "Débutant absolu",
        "lessons": {
            1: ("Présentations simples", ["nom", "âge", "profession"], [
                "Salut! Je m'appelle Jean.",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 126
    "A2": {
        "title": "Élémentaire",
        "lessons": {
            1: ("Messages courts", ["email", "rdv", "confirmation"], [
                "Je confirme notre rendez-vous demain à 15h.",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 214
                "Tél: 01 23 45 67 89.",
                "Adresse: 10 rue du Centre.",
                "Email: info@example.com.",
                "Site: www.example.fr.",
                "Horaires sur demande."
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 215
                "Adresse: 10 rue du Centre.",
                "Email: info@example.com.",
                "Site: www.example.fr.",
                "Horaires sur demande."
            ]),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 236
    "B1": {
        "title": "Intermédiaire",
        "lessons": {
            i: (f"Leçon {i}: Thème variés", ["vocabulaire", "contexte"], [
                f"Texte exemple {i}.",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 248
    "B2": {
        "title": "Intermédiaire supérieur",
        "lessons": {
            i: (f"Leçon {i}: Sujets d'actualité", ["argument", "nuance"], [
                f"Article court topic {i}.",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 260
    "C1": {
        "title": "Avancé",
        "lessons": {
            i: (f"Leçon {i}: Textes complexes", ["critique", "subtilité"], [
                f"Essai analytique {i}.",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 272
    "C2": {
        "title": "Maîtrise",
        "lessons": {
            i: (f"Leçon {i}: Pensée critique", ["implicite", "ironie"], [
                f"Essai philosophique {i}.",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 284
}

def create_exercise(exercise_num, passage_text, base_question, passage_title=""):
    """Crée un exercice simple"""
    exercise_type = "multiple_choice" if exercise_num % 2 == 1 else "vrai_faux"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 286
def create_exercise(exercise_num, passage_text, base_question, passage_title=""):
    """Crée un exercice simple"""
    exercise_type = "multiple_choice" if exercise_num % 2 == 1 else "vrai_faux"
    
    if exercise_type == "multiple_choice":
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 288
    exercise_type = "multiple_choice" if exercise_num % 2 == 1 else "vrai_faux"
    
    if exercise_type == "multiple_choice":
        return {
            "exercise_number": exercise_num,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 290
    if exercise_type == "multiple_choice":
        return {
            "exercise_number": exercise_num,
            "type": "multiple_choice",
            "passage_title": passage_title or f"Passage {exercise_num}",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 292
            "exercise_number": exercise_num,
            "type": "multiple_choice",
            "passage_title": passage_title or f"Passage {exercise_num}",
            "passage_text": passage_text,
            "question": base_question,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 296
            "question": base_question,
            "options": {
                "A": f"Option A pour question {exercise_num}",
                "B": f"Option B pour question {exercise_num}",
                "C": f"Option C pour question {exercise_num}",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 297
            "options": {
                "A": f"Option A pour question {exercise_num}",
                "B": f"Option B pour question {exercise_num}",
                "C": f"Option C pour question {exercise_num}",
                "D": f"Option D pour question {exercise_num}"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 298
                "A": f"Option A pour question {exercise_num}",
                "B": f"Option B pour question {exercise_num}",
                "C": f"Option C pour question {exercise_num}",
                "D": f"Option D pour question {exercise_num}"
            },
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 299
                "B": f"Option B pour question {exercise_num}",
                "C": f"Option C pour question {exercise_num}",
                "D": f"Option D pour question {exercise_num}"
            },
            "correct_answer": ["A", "B", "C", "D"][exercise_num %4],
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 301
                "D": f"Option D pour question {exercise_num}"
            },
            "correct_answer": ["A", "B", "C", "D"][exercise_num %4],
            "explanation": f"Explication pour l'exercice {exercise_num}.",
            "difficulty_progression": 1 + (exercise_num % 3)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 302
            },
            "correct_answer": ["A", "B", "C", "D"][exercise_num %4],
            "explanation": f"Explication pour l'exercice {exercise_num}.",
            "difficulty_progression": 1 + (exercise_num % 3)
        }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 303
            "correct_answer": ["A", "B", "C", "D"][exercise_num %4],
            "explanation": f"Explication pour l'exercice {exercise_num}.",
            "difficulty_progression": 1 + (exercise_num % 3)
        }
    else:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 307
    else:
        return {
            "exercise_number": exercise_num,
            "type": "vrai_faux",
            "passage_title": passage_title or f"Passage {exercise_num}",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 309
            "exercise_number": exercise_num,
            "type": "vrai_faux",
            "passage_title": passage_title or f"Passage {exercise_num}",
            "passage_text": passage_text,
            "question": base_question,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 313
            "question": base_question,
            "options": {},
            "correct_answer": "Vrai" if exercise_num % 2 == 0 else "Faux",
            "explanation": f"Explication pour l'exercice {exercise_num}.",
            "difficulty_progression": 1 + (exercise_num % 3)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 314
            "options": {},
            "correct_answer": "Vrai" if exercise_num % 2 == 0 else "Faux",
            "explanation": f"Explication pour l'exercice {exercise_num}.",
            "difficulty_progression": 1 + (exercise_num % 3)
        }
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 315
            "correct_answer": "Vrai" if exercise_num % 2 == 0 else "Faux",
            "explanation": f"Explication pour l'exercice {exercise_num}.",
            "difficulty_progression": 1 + (exercise_num % 3)
        }

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 318
        }

def generate_curriculum(level, config):
    """Génère un curriculum complet pour un niveau"""
    curriculum = {
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 319

def generate_curriculum(level, config):
    """Génère un curriculum complet pour un niveau"""
    curriculum = {
        "level": level,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 320
def generate_curriculum(level, config):
    """Génère un curriculum complet pour un niveau"""
    curriculum = {
        "level": level,
        "language": "fr",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 323
        "level": level,
        "language": "fr",
        "total_lessons": 15,
        "exercises_per_lesson": 10,
        "cefr_standard": f"{level} - {config['title']}",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 324
        "language": "fr",
        "total_lessons": 15,
        "exercises_per_lesson": 10,
        "cefr_standard": f"{level} - {config['title']}",
        "lessons": []
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 326
        "exercises_per_lesson": 10,
        "cefr_standard": f"{level} - {config['title']}",
        "lessons": []
    }
    
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 329
    }
    
    for lesson_num, (title, vocab, passages) in config['lessons'].items():
        lesson = {
            "lesson_number": lesson_num,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 330
    
    for lesson_num, (title, vocab, passages) in config['lessons'].items():
        lesson = {
            "lesson_number": lesson_num,
            "title": title,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 331
    for lesson_num, (title, vocab, passages) in config['lessons'].items():
        lesson = {
            "lesson_number": lesson_num,
            "title": title,
            "slug": f"{level.lower()}-lecon-{lesson_num}-{title.lower().replace(' ', '-')}",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 333
            "lesson_number": lesson_num,
            "title": title,
            "slug": f"{level.lower()}-lecon-{lesson_num}-{title.lower().replace(' ', '-')}",
            "objective": f"Comprendre des textes de compréhension écrite niveau {level}",
            "vocabulary_focus": vocab,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 336
            "objective": f"Comprendre des textes de compréhension écrite niveau {level}",
            "vocabulary_focus": vocab,
            "exercises": []
        }
        
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 342
        for ex_num in range(1, 11):
            passage = passages[ex_num % len(passages)]
            exercise = create_exercise(
                ex_num,
                passage,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 348
                "Passage lecteur"
            )
            lesson["exercises"].append(exercise)
        
        curriculum["lessons"].append(lesson)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 350
            lesson["exercises"].append(exercise)
        
        curriculum["lessons"].append(lesson)
    
    return curriculum
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 352
        curriculum["lessons"].append(lesson)
    
    return curriculum

# Générer tous les fichiers
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 355

# Générer tous les fichiers
output_dir = Path("ai_engine/learning_content")
output_dir.mkdir(parents=True, exist_ok=True)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 359

for level in ["A1", "A2", "B1", "B2", "C1", "C2"]:
    if level in CURRICULUM_CONFIG:
        print(f"Generating {level} curriculum...")
        curriculum = generate_curriculum(level, CURRICULUM_CONFIG[level])
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 360
for level in ["A1", "A2", "B1", "B2", "C1", "C2"]:
    if level in CURRICULUM_CONFIG:
        print(f"Generating {level} curriculum...")
        curriculum = generate_curriculum(level, CURRICULUM_CONFIG[level])
        
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 361
    if level in CURRICULUM_CONFIG:
        print(f"Generating {level} curriculum...")
        curriculum = generate_curriculum(level, CURRICULUM_CONFIG[level])
        
        filename = output_dir / f"reading_curriculum_{level}_fr.json"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 363
        curriculum = generate_curriculum(level, CURRICULUM_CONFIG[level])
        
        filename = output_dir / f"reading_curriculum_{level}_fr.json"
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(curriculum, f, ensure_ascii=False, indent=2)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 365
        filename = output_dir / f"reading_curriculum_{level}_fr.json"
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(curriculum, f, ensure_ascii=False, indent=2)
        
        print(f"✅ Created: {filename}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 370
    else:
        # Pour B1-C2, utiliser une génération par défaut
        print(f"Generating {level} curriculum (template)...")
        curriculum = {
            "level": level,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 371
        # Pour B1-C2, utiliser une génération par défaut
        print(f"Generating {level} curriculum (template)...")
        curriculum = {
            "level": level,
            "language": "fr",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 374
            "level": level,
            "language": "fr",
            "total_lessons": 15,
            "exercises_per_lesson": 10,
            "cefr_standard": f"{level} - {CURRICULUM_CONFIG[level]['title']}",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 375
            "language": "fr",
            "total_lessons": 15,
            "exercises_per_lesson": 10,
            "cefr_standard": f"{level} - {CURRICULUM_CONFIG[level]['title']}",
            "lessons": [
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 376
            "total_lessons": 15,
            "exercises_per_lesson": 10,
            "cefr_standard": f"{level} - {CURRICULUM_CONFIG[level]['title']}",
            "lessons": [
                {
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 377
            "exercises_per_lesson": 10,
            "cefr_standard": f"{level} - {CURRICULUM_CONFIG[level]['title']}",
            "lessons": [
                {
                    "lesson_number": i,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 379
            "lessons": [
                {
                    "lesson_number": i,
                    "title": f"Leçon {i}: Thèmes variés",
                    "slug": f"{level.lower()}-lecon-{i}",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 384
                    "objective": f"Compréhension écrite niveau {level}",
                    "vocabulary_focus": ["vocabulaire", "contexte"],
                    "exercises": [
                        create_exercise(j, f"Passage de texte pour exercice {j}.", f"Question {j}?")
                        for j in range(1, 11)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 385
                    "vocabulary_focus": ["vocabulaire", "contexte"],
                    "exercises": [
                        create_exercise(j, f"Passage de texte pour exercice {j}.", f"Question {j}?")
                        for j in range(1, 11)
                    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 393
        }
        
        filename = output_dir / f"reading_curriculum_{level}_fr.json"
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(curriculum, f, ensure_ascii=False, indent=2)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 395
        filename = output_dir / f"reading_curriculum_{level}_fr.json"
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(curriculum, f, ensure_ascii=False, indent=2)
        
        print(f"✅ Created: {filename}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_curriculum.py
LINE: 399
        print(f"✅ Created: {filename}")

print("\n🎉 All 6 curriculum files generated!")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 4
# -*- coding: utf-8 -*-
"""
Script pour générer les exams de compréhension écrite (CE) A1-C2
Crée 2 fichiers JSON: exams_reading_<range>_fr.json
"""
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 5
"""
Script pour générer les exams de compréhension écrite (CE) A1-C2
Crée 2 fichiers JSON: exams_reading_<range>_fr.json
"""

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 12

def create_question(num, section_code="ce"):
    """Crée une question d'exam"""
    return {
        "question_number": num,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 36
    }

def create_exam(code, name, level, num_questions=25):
    """Crée un examen complet"""
    return {
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 37

def create_exam(code, name, level, num_questions=25):
    """Crée un examen complet"""
    return {
        "exam_code": code,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 39
    """Crée un examen complet"""
    return {
        "exam_code": code,
        "exam_name": name,
        "level": level,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 40
    return {
        "exam_code": code,
        "exam_name": name,
        "level": level,
        "language": "fr",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 45
        "duration_sec": 900,
        "total_questions": num_questions,
        "description": f"Examen {code} - Compréhension écrite niveau {level}",
        "sections": [
            {
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 66

# Fichier 1: A1-B2
exams_a_b = {
    "language": "fr",
    "exam_format": "DELF/DALF-inspired reading comprehension",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 68
exams_a_b = {
    "language": "fr",
    "exam_format": "DELF/DALF-inspired reading comprehension",
    "total_exams": 4,
    "exams": [
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 69
    "language": "fr",
    "exam_format": "DELF/DALF-inspired reading comprehension",
    "total_exams": 4,
    "exams": [
        create_exam("CE_A1_FR", "Examen A1 - Compréhension Écrite", "A1", 20),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 70
    "exam_format": "DELF/DALF-inspired reading comprehension",
    "total_exams": 4,
    "exams": [
        create_exam("CE_A1_FR", "Examen A1 - Compréhension Écrite", "A1", 20),
        create_exam("CE_A2_FR", "Examen A2 - Compréhension Écrite", "A2", 25),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 71
    "total_exams": 4,
    "exams": [
        create_exam("CE_A1_FR", "Examen A1 - Compréhension Écrite", "A1", 20),
        create_exam("CE_A2_FR", "Examen A2 - Compréhension Écrite", "A2", 25),
        create_exam("CE_B1_FR", "Examen B1 - Compréhension Écrite", "B1", 30),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 72
    "exams": [
        create_exam("CE_A1_FR", "Examen A1 - Compréhension Écrite", "A1", 20),
        create_exam("CE_A2_FR", "Examen A2 - Compréhension Écrite", "A2", 25),
        create_exam("CE_B1_FR", "Examen B1 - Compréhension Écrite", "B1", 30),
        create_exam("CE_B2_FR", "Examen B2 - Compréhension Écrite", "B2", 35)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 73
        create_exam("CE_A1_FR", "Examen A1 - Compréhension Écrite", "A1", 20),
        create_exam("CE_A2_FR", "Examen A2 - Compréhension Écrite", "A2", 25),
        create_exam("CE_B1_FR", "Examen B1 - Compréhension Écrite", "B1", 30),
        create_exam("CE_B2_FR", "Examen B2 - Compréhension Écrite", "B2", 35)
    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 74
        create_exam("CE_A2_FR", "Examen A2 - Compréhension Écrite", "A2", 25),
        create_exam("CE_B1_FR", "Examen B1 - Compréhension Écrite", "B1", 30),
        create_exam("CE_B2_FR", "Examen B2 - Compréhension Écrite", "B2", 35)
    ]
}
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 79

# Fichier 2: C1-C2
exams_c = {
    "language": "fr",
    "exam_format": "DALF reading comprehension",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 81
exams_c = {
    "language": "fr",
    "exam_format": "DALF reading comprehension",
    "total_exams": 2,
    "exams": [
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 82
    "language": "fr",
    "exam_format": "DALF reading comprehension",
    "total_exams": 2,
    "exams": [
        create_exam("CE_C1_FR", "Examen C1 - Compréhension Écrite", "C1", 40),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 83
    "exam_format": "DALF reading comprehension",
    "total_exams": 2,
    "exams": [
        create_exam("CE_C1_FR", "Examen C1 - Compréhension Écrite", "C1", 40),
        create_exam("CE_C2_FR", "Examen C2 - Compréhension Écrite", "C2", 45)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 84
    "total_exams": 2,
    "exams": [
        create_exam("CE_C1_FR", "Examen C1 - Compréhension Écrite", "C1", 40),
        create_exam("CE_C2_FR", "Examen C2 - Compréhension Écrite", "C2", 45)
    ]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 85
    "exams": [
        create_exam("CE_C1_FR", "Examen C1 - Compréhension Écrite", "C1", 40),
        create_exam("CE_C2_FR", "Examen C2 - Compréhension Écrite", "C2", 45)
    ]
}
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 89
}

output_dir = Path("ai_engine/learning_content")
output_dir.mkdir(parents=True, exist_ok=True)

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 94
# Générer fichiers
files = [
    (exams_a_b, "exams_reading_a_b_fr.json"),
    (exams_c, "exams_reading_c_fr.json")
]
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 95
files = [
    (exams_a_b, "exams_reading_a_b_fr.json"),
    (exams_c, "exams_reading_c_fr.json")
]

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ce_exams.py
LINE: 104
    print(f"✅ Created: {filepath}")

print(f"\n🎉 All 2 exam files generated! Total questions: {20+25+30+35+40+45} = 195 questions")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 3
#!/usr/bin/env python3
"""
Générateur de curriculum Expression Écrite (EE) A1-C2
Crée 900 exercices d'écriture (150 par niveau, 10 par leçon, 15 leçons par niveau)
"""
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 13
LEVELS_CONFIG = {
    "A1": {
        "file": "ai_engine/learning_content/writing_curriculum_A1_fr.json",
        "lessons": [
            ("Présentations écrites", "Écrire des phrases simples sur soi-même", 
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 14
    "A1": {
        "file": "ai_engine/learning_content/writing_curriculum_A1_fr.json",
        "lessons": [
            ("Présentations écrites", "Écrire des phrases simples sur soi-même", 
             ["vocabulaire de base", "pronoms simples", "verbe être/avoir"]),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 48
    },
    "A2": {
        "file": "ai_engine/learning_content/writing_curriculum_A2_fr.json",
        "lessons": [
            ("Courriers informels", "Écrire une lettre amicale",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 49
    "A2": {
        "file": "ai_engine/learning_content/writing_curriculum_A2_fr.json",
        "lessons": [
            ("Courriers informels", "Écrire une lettre amicale",
             ["structure informelle", "ton personnel", "détails pertinents"]),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 83
    },
    "B1": {
        "file": "ai_engine/learning_content/writing_curriculum_B1_fr.json",
        "lessons": [
            ("Lettres formelles", "Rédiger une lettre professionnelle",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 84
    "B1": {
        "file": "ai_engine/learning_content/writing_curriculum_B1_fr.json",
        "lessons": [
            ("Lettres formelles", "Rédiger une lettre professionnelle",
             ["structure formelle", "registre soutenu", "courtoisie"]),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 118
    },
    "B2": {
        "file": "ai_engine/learning_content/writing_curriculum_B2_fr.json",
        "lessons": [
            ("Essais développés", "Rédiger un véritable essai",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 119
    "B2": {
        "file": "ai_engine/learning_content/writing_curriculum_B2_fr.json",
        "lessons": [
            ("Essais développés", "Rédiger un véritable essai",
             ["thèse élaborée", "arguments multiples", "nuance"]),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 153
    },
    "C1": {
        "file": "ai_engine/learning_content/writing_curriculum_C1_fr.json",
        "lessons": [
            ("Dissertations complexes", "Rédiger une dissertation",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 154
    "C1": {
        "file": "ai_engine/learning_content/writing_curriculum_C1_fr.json",
        "lessons": [
            ("Dissertations complexes", "Rédiger une dissertation",
             ["problématique", "démonstration", "dépassement antithèse"]),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 188
    },
    "C2": {
        "file": "ai_engine/learning_content/writing_curriculum_C2_fr.json",
        "lessons": [
            ("Dissertations magistrales", "Dissertation expertise",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 189
    "C2": {
        "file": "ai_engine/learning_content/writing_curriculum_C2_fr.json",
        "lessons": [
            ("Dissertations magistrales", "Dissertation expertise",
             ["pensée critique avancée", "structures argumentatives", "dépassement catégories"]),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 224
}

def generate_exercise(level, lesson_num, exercise_num, objective_keywords):
    """Génère un exercice individuel"""
    return {
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 227
    """Génère un exercice individuel"""
    return {
        "lesson_number": lesson_num,
        "exercise_number": exercise_num,
        "objective": f"Exercice {exercise_num}: Développer l'expression écrite sur le thème",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 228
    return {
        "lesson_number": lesson_num,
        "exercise_number": exercise_num,
        "objective": f"Exercice {exercise_num}: Développer l'expression écrite sur le thème",
        "prompt": f"Écrivez un texte (ou plusieurs phrases) abordant l'aspect suivant: {', '.join(objective_keywords[:2])}",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 229
        "lesson_number": lesson_num,
        "exercise_number": exercise_num,
        "objective": f"Exercice {exercise_num}: Développer l'expression écrite sur le thème",
        "prompt": f"Écrivez un texte (ou plusieurs phrases) abordant l'aspect suivant: {', '.join(objective_keywords[:2])}",
        "word_count_min": 50 + (lesson_num * 20),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 231
        "objective": f"Exercice {exercise_num}: Développer l'expression écrite sur le thème",
        "prompt": f"Écrivez un texte (ou plusieurs phrases) abordant l'aspect suivant: {', '.join(objective_keywords[:2])}",
        "word_count_min": 50 + (lesson_num * 20),
        "word_count_max": 150 + (lesson_num * 30),
        "context": f"Contexte: Cette leçon {lesson_num} du niveau {level} vous demande de pratiquer l'écriture avec focus sur: {', '.join(objective_keywords)}",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 232
        "prompt": f"Écrivez un texte (ou plusieurs phrases) abordant l'aspect suivant: {', '.join(objective_keywords[:2])}",
        "word_count_min": 50 + (lesson_num * 20),
        "word_count_max": 150 + (lesson_num * 30),
        "context": f"Contexte: Cette leçon {lesson_num} du niveau {level} vous demande de pratiquer l'écriture avec focus sur: {', '.join(objective_keywords)}",
        "example_answer": f"Exemple: Un texte de {100 + exercise_num * 10} mots montrant les éléments clés...",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 233
        "word_count_min": 50 + (lesson_num * 20),
        "word_count_max": 150 + (lesson_num * 30),
        "context": f"Contexte: Cette leçon {lesson_num} du niveau {level} vous demande de pratiquer l'écriture avec focus sur: {', '.join(objective_keywords)}",
        "example_answer": f"Exemple: Un texte de {100 + exercise_num * 10} mots montrant les éléments clés...",
        "evaluation_criteria": {
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 234
        "word_count_max": 150 + (lesson_num * 30),
        "context": f"Contexte: Cette leçon {lesson_num} du niveau {level} vous demande de pratiquer l'écriture avec focus sur: {', '.join(objective_keywords)}",
        "example_answer": f"Exemple: Un texte de {100 + exercise_num * 10} mots montrant les éléments clés...",
        "evaluation_criteria": {
            "grammar_accuracy": "Grammaire correcte et appropriée",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 246
    }

def generate_lesson(level_code, lesson_num, lesson_title, lesson_objective, keywords):
    """Génère une leçon avec 10 exercices"""
    exercises = []
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 248
def generate_lesson(level_code, lesson_num, lesson_title, lesson_objective, keywords):
    """Génère une leçon avec 10 exercices"""
    exercises = []
    for ex_num in range(1, 11):
        exercises.append({
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 250
    exercises = []
    for ex_num in range(1, 11):
        exercises.append({
            "exercise": generate_exercise(level_code, lesson_num, ex_num, keywords)
        })
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 251
    for ex_num in range(1, 11):
        exercises.append({
            "exercise": generate_exercise(level_code, lesson_num, ex_num, keywords)
        })
    
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 255
    
    return {
        "lesson_number": lesson_num,
        "title": lesson_title,
        "slug": f"{level_code.lower()}-writing-lesson-{lesson_num}",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 256
    return {
        "lesson_number": lesson_num,
        "title": lesson_title,
        "slug": f"{level_code.lower()}-writing-lesson-{lesson_num}",
        "objective": lesson_objective,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 257
        "lesson_number": lesson_num,
        "title": lesson_title,
        "slug": f"{level_code.lower()}-writing-lesson-{lesson_num}",
        "objective": lesson_objective,
        "vocabulary_focus": keywords,
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 258
        "title": lesson_title,
        "slug": f"{level_code.lower()}-writing-lesson-{lesson_num}",
        "objective": lesson_objective,
        "vocabulary_focus": keywords,
        "exercises": exercises
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 260
        "objective": lesson_objective,
        "vocabulary_focus": keywords,
        "exercises": exercises
    }

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 263
    }

def generate_curriculum():
    """Génère tous les fichiers curriculum pour tous les niveaux"""
    for level_code, config in LEVELS_CONFIG.items():
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 264

def generate_curriculum():
    """Génère tous les fichiers curriculum pour tous les niveaux"""
    for level_code, config in LEVELS_CONFIG.items():
        print(f"\n[CURRICULUM] {level_code}...")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 266
    """Génère tous les fichiers curriculum pour tous les niveaux"""
    for level_code, config in LEVELS_CONFIG.items():
        print(f"\n[CURRICULUM] {level_code}...")
        
        lessons = []
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 268
        print(f"\n[CURRICULUM] {level_code}...")
        
        lessons = []
        for lesson_idx, (title, objective, keywords) in enumerate(config["lessons"], 1):
            lesson = generate_lesson(level_code, lesson_idx, title, objective, keywords)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 269
        
        lessons = []
        for lesson_idx, (title, objective, keywords) in enumerate(config["lessons"], 1):
            lesson = generate_lesson(level_code, lesson_idx, title, objective, keywords)
            lessons.append(lesson)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 270
        lessons = []
        for lesson_idx, (title, objective, keywords) in enumerate(config["lessons"], 1):
            lesson = generate_lesson(level_code, lesson_idx, title, objective, keywords)
            lessons.append(lesson)
            print(f"  [OK] Lesson {lesson_idx}: {title} ({len(lesson['exercises'])} exercises)")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 271
        for lesson_idx, (title, objective, keywords) in enumerate(config["lessons"], 1):
            lesson = generate_lesson(level_code, lesson_idx, title, objective, keywords)
            lessons.append(lesson)
            print(f"  [OK] Lesson {lesson_idx}: {title} ({len(lesson['exercises'])} exercises)")
        
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 272
            lesson = generate_lesson(level_code, lesson_idx, title, objective, keywords)
            lessons.append(lesson)
            print(f"  [OK] Lesson {lesson_idx}: {title} ({len(lesson['exercises'])} exercises)")
        
        # Sauvegarder le fichier
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 279
            "section": "ee",
            "locale": "fr",
            "lessons": lessons
        }
        
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 285
            json.dump(output, f, ensure_ascii=False, indent=2)
        
        total_exercises = len(lessons) * 10
        print(f"[SAVED] {config['file']} ({total_exercises} exercises)")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 286
        
        total_exercises = len(lessons) * 10
        print(f"[SAVED] {config['file']} ({total_exercises} exercises)")

if __name__ == "__main__":
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 289

if __name__ == "__main__":
    print("[GENERATION] Curriculum Expression Écrite (EE) A1-C2")
    print("=" * 60)
    generate_curriculum()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 291
    print("[GENERATION] Curriculum Expression Écrite (EE) A1-C2")
    print("=" * 60)
    generate_curriculum()
    print("\n" + "=" * 60)
    print("[SUCCESS] Generation complete! 900 EE exercises created")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_curriculum.py
LINE: 293
    generate_curriculum()
    print("\n" + "=" * 60)
    print("[SUCCESS] Generation complete! 900 EE exercises created")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 3
#!/usr/bin/env python3
"""
Générateur d'exams Expression Écrite (EE) A1-C2
Crée 195 questions d'examen répartis en 6 exams:
- A1: 20Q, A2: 25Q, B1: 30Q, B2: 35Q, C1: 40Q, C2: 45Q
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 4
"""
Générateur d'exams Expression Écrite (EE) A1-C2
Crée 195 questions d'examen répartis en 6 exams:
- A1: 20Q, A2: 25Q, B1: 30Q, B2: 35Q, C1: 40Q, C2: 45Q
"""
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 10
import json

EXAMS_AB = {
    "exams": [
        {
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 11

EXAMS_AB = {
    "exams": [
        {
            "exam_code": "EE_A1_FR",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 13
    "exams": [
        {
            "exam_code": "EE_A1_FR",
            "exam_name": "Examen A1 - Expression Écrite",
            "level": "A1",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 14
        {
            "exam_code": "EE_A1_FR",
            "exam_name": "Examen A1 - Expression Écrite",
            "level": "A1",
            "section_code": "ee",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 39
        },
        {
            "exam_code": "EE_A2_FR",
            "exam_name": "Examen A2 - Expression Écrite",
            "level": "A2",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 40
        {
            "exam_code": "EE_A2_FR",
            "exam_name": "Examen A2 - Expression Écrite",
            "level": "A2",
            "section_code": "ee",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 64
        },
        {
            "exam_code": "EE_B1_FR",
            "exam_name": "Examen B1 - Expression Écrite",
            "level": "B1",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 65
        {
            "exam_code": "EE_B1_FR",
            "exam_name": "Examen B1 - Expression Écrite",
            "level": "B1",
            "section_code": "ee",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 89
        },
        {
            "exam_code": "EE_B2_FR",
            "exam_name": "Examen B2 - Expression Écrite",
            "level": "B2",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 90
        {
            "exam_code": "EE_B2_FR",
            "exam_name": "Examen B2 - Expression Écrite",
            "level": "B2",
            "section_code": "ee",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 116
}

EXAMS_C = {
    "exams": [
        {
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 117

EXAMS_C = {
    "exams": [
        {
            "exam_code": "EE_C1_FR",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 119
    "exams": [
        {
            "exam_code": "EE_C1_FR",
            "exam_name": "Examen C1 - Expression Écrite",
            "level": "C1",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 120
        {
            "exam_code": "EE_C1_FR",
            "exam_name": "Examen C1 - Expression Écrite",
            "level": "C1",
            "section_code": "ee",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 144
        },
        {
            "exam_code": "EE_C2_FR",
            "exam_name": "Examen C2 - Expression Écrite",
            "level": "C2",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 145
        {
            "exam_code": "EE_C2_FR",
            "exam_name": "Examen C2 - Expression Écrite",
            "level": "C2",
            "section_code": "ee",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 171
}

def generate_exams():
    """Génère les fichiers exams"""
    
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 172

def generate_exams():
    """Génère les fichiers exams"""
    
    # A1-B2
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 175
    
    # A1-B2
    print("[EXAMS] A1-B2...")
    ab_output_file = "ai_engine/learning_content/exams_writing_a_b_fr.json"
    with open(ab_output_file, "w", encoding="utf-8") as f:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 176
    # A1-B2
    print("[EXAMS] A1-B2...")
    ab_output_file = "ai_engine/learning_content/exams_writing_a_b_fr.json"
    with open(ab_output_file, "w", encoding="utf-8") as f:
        json.dump(EXAMS_AB, f, ensure_ascii=False, indent=2)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 178
    ab_output_file = "ai_engine/learning_content/exams_writing_a_b_fr.json"
    with open(ab_output_file, "w", encoding="utf-8") as f:
        json.dump(EXAMS_AB, f, ensure_ascii=False, indent=2)
    total_ab = sum(e["total_questions"] for e in EXAMS_AB["exams"])
    print(f"  [OK] {ab_output_file} ({total_ab} questions)")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 179
    with open(ab_output_file, "w", encoding="utf-8") as f:
        json.dump(EXAMS_AB, f, ensure_ascii=False, indent=2)
    total_ab = sum(e["total_questions"] for e in EXAMS_AB["exams"])
    print(f"  [OK] {ab_output_file} ({total_ab} questions)")
    
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 183
    
    # C1-C2
    print("[EXAMS] C1-C2...")
    c_output_file = "ai_engine/learning_content/exams_writing_c_fr.json"
    with open(c_output_file, "w", encoding="utf-8") as f:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 184
    # C1-C2
    print("[EXAMS] C1-C2...")
    c_output_file = "ai_engine/learning_content/exams_writing_c_fr.json"
    with open(c_output_file, "w", encoding="utf-8") as f:
        json.dump(EXAMS_C, f, ensure_ascii=False, indent=2)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 186
    c_output_file = "ai_engine/learning_content/exams_writing_c_fr.json"
    with open(c_output_file, "w", encoding="utf-8") as f:
        json.dump(EXAMS_C, f, ensure_ascii=False, indent=2)
    total_c = sum(e["total_questions"] for e in EXAMS_C["exams"])
    print(f"  [OK] {c_output_file} ({total_c} questions)")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 187
    with open(c_output_file, "w", encoding="utf-8") as f:
        json.dump(EXAMS_C, f, ensure_ascii=False, indent=2)
    total_c = sum(e["total_questions"] for e in EXAMS_C["exams"])
    print(f"  [OK] {c_output_file} ({total_c} questions)")
    
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 193

if __name__ == "__main__":
    print("[GENERATION] Exams Expression Écrite (EE) A1-C2")
    print("=" * 60)
    total = generate_exams()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 195
    print("[GENERATION] Exams Expression Écrite (EE) A1-C2")
    print("=" * 60)
    total = generate_exams()
    print("=" * 60)
    print(f"[SUCCESS] {total} EE questions created (6 exams: A1-C2)")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\generate_ee_exams.py
LINE: 197
    total = generate_exams()
    print("=" * 60)
    print(f"[SUCCESS] {total} EE questions created (6 exams: A1-C2)")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 15

from preparation_tests.models import (
    CourseLesson, CourseExercise, Exam, ExamSection, 
    Question, Choice, Passage
)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 21
from django.db.models import Count

def validate_curriculum():
    """Valide le curriculum CE"""
    print("\n📘 VALIDATION CURRICULUM CE")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 22

def validate_curriculum():
    """Valide le curriculum CE"""
    print("\n📘 VALIDATION CURRICULUM CE")
    print("-" * 50)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 23
def validate_curriculum():
    """Valide le curriculum CE"""
    print("\n📘 VALIDATION CURRICULUM CE")
    print("-" * 50)
    
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 27
    
    levels = ["A1", "A2", "B1", "B2", "C1", "C2"]
    total_lessons = 0
    total_exercises = 0
    
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 28
    levels = ["A1", "A2", "B1", "B2", "C1", "C2"]
    total_lessons = 0
    total_exercises = 0
    
    for level in levels:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 31
    
    for level in levels:
        lessons = CourseLesson.objects.filter(level=level, section="ce")
        exercises = CourseExercise.objects.filter(lesson__level=level, lesson__section="ce")
        
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 32
    for level in levels:
        lessons = CourseLesson.objects.filter(level=level, section="ce")
        exercises = CourseExercise.objects.filter(lesson__level=level, lesson__section="ce")
        
        lesson_count = lessons.count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 34
        exercises = CourseExercise.objects.filter(lesson__level=level, lesson__section="ce")
        
        lesson_count = lessons.count()
        exercise_count = exercises.count()
        
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 35
        
        lesson_count = lessons.count()
        exercise_count = exercises.count()
        
        total_lessons += lesson_count
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 37
        exercise_count = exercises.count()
        
        total_lessons += lesson_count
        total_exercises += exercise_count
        
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 38
        
        total_lessons += lesson_count
        total_exercises += exercise_count
        
        status = "✅" if lesson_count == 15 and exercise_count == 150 else "⚠️"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 40
        total_exercises += exercise_count
        
        status = "✅" if lesson_count == 15 and exercise_count == 150 else "⚠️"
        print(f"  {status} {level}: {lesson_count} leçons, {exercise_count} exercices")
    
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 41
        
        status = "✅" if lesson_count == 15 and exercise_count == 150 else "⚠️"
        print(f"  {status} {level}: {lesson_count} leçons, {exercise_count} exercices")
    
    print(f"\n  📊 Total: {total_lessons} leçons, {total_exercises} exercices")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 43
        print(f"  {status} {level}: {lesson_count} leçons, {exercise_count} exercices")
    
    print(f"\n  📊 Total: {total_lessons} leçons, {total_exercises} exercices")
    
    expected = 1350  # 6 levels × 225 (15 lessons + 150 exercices)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 45
    print(f"\n  📊 Total: {total_lessons} leçons, {total_exercises} exercices")
    
    expected = 1350  # 6 levels × 225 (15 lessons + 150 exercices)
    actual = total_lessons + total_exercises
    return actual >= 1050  # Au moins le curriculum
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 46
    
    expected = 1350  # 6 levels × 225 (15 lessons + 150 exercices)
    actual = total_lessons + total_exercises
    return actual >= 1050  # Au moins le curriculum

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 47
    expected = 1350  # 6 levels × 225 (15 lessons + 150 exercices)
    actual = total_lessons + total_exercises
    return actual >= 1050  # Au moins le curriculum

def validate_exams():
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 49
    return actual >= 1050  # Au moins le curriculum

def validate_exams():
    """Valide les exams CE"""
    print("\n📋 VALIDATION EXAMS CE")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 50

def validate_exams():
    """Valide les exams CE"""
    print("\n📋 VALIDATION EXAMS CE")
    print("-" * 50)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 51
def validate_exams():
    """Valide les exams CE"""
    print("\n📋 VALIDATION EXAMS CE")
    print("-" * 50)
    
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 54
    print("-" * 50)
    
    exams = Exam.objects.filter(code__startswith="CE_")
    print(f"  Exams trouvés: {exams.count()}/6")
    
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 55
    
    exams = Exam.objects.filter(code__startswith="CE_")
    print(f"  Exams trouvés: {exams.count()}/6")
    
    for exam in exams:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 57
    print(f"  Exams trouvés: {exams.count()}/6")
    
    for exam in exams:
        sections = ExamSection.objects.filter(exam=exam, code="ce")
        questions = Question.objects.filter(section__exam=exam, section__code="ce")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 58
    
    for exam in exams:
        sections = ExamSection.objects.filter(exam=exam, code="ce")
        questions = Question.objects.filter(section__exam=exam, section__code="ce")
        choices = Choice.objects.filter(question__section__exam=exam, question__section__code="ce")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 59
    for exam in exams:
        sections = ExamSection.objects.filter(exam=exam, code="ce")
        questions = Question.objects.filter(section__exam=exam, section__code="ce")
        choices = Choice.objects.filter(question__section__exam=exam, question__section__code="ce")
        passages = Passage.objects.filter(question__section__exam=exam).distinct().count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 60
        sections = ExamSection.objects.filter(exam=exam, code="ce")
        questions = Question.objects.filter(section__exam=exam, section__code="ce")
        choices = Choice.objects.filter(question__section__exam=exam, question__section__code="ce")
        passages = Passage.objects.filter(question__section__exam=exam).distinct().count()
        
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 61
        questions = Question.objects.filter(section__exam=exam, section__code="ce")
        choices = Choice.objects.filter(question__section__exam=exam, question__section__code="ce")
        passages = Passage.objects.filter(question__section__exam=exam).distinct().count()
        
        print(f"  ✅ {exam.code}: {questions.count()} Q, {choices.count()} choix, {passages} passages")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 63
        passages = Passage.objects.filter(question__section__exam=exam).distinct().count()
        
        print(f"  ✅ {exam.code}: {questions.count()} Q, {choices.count()} choix, {passages} passages")
    
    total_questions = Question.objects.filter(section__code="ce").count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 73
    print("-" * 50)
    
    # CourseLesson > CourseExercise
    lessons_with_exercises = CourseLesson.objects.filter(
        section="ce", 
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 74
    
    # CourseLesson > CourseExercise
    lessons_with_exercises = CourseLesson.objects.filter(
        section="ce", 
        exercises__isnull=False
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 76
    lessons_with_exercises = CourseLesson.objects.filter(
        section="ce", 
        exercises__isnull=False
    ).distinct().count()
    print(f"  ✅ Leçons avec exercices: {lessons_with_exercises}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 78
        exercises__isnull=False
    ).distinct().count()
    print(f"  ✅ Leçons avec exercices: {lessons_with_exercises}")
    
    # Exam > ExamSection > Question > Choice
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 80
    print(f"  ✅ Leçons avec exercices: {lessons_with_exercises}")
    
    # Exam > ExamSection > Question > Choice
    questions_with_choices = Question.objects.filter(
        section__code="ce",
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 101
    
    # Vérifier pas d'options vides
    empty_options = CourseExercise.objects.filter(
        lesson__section="ce",
        option_a=""
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 102
    # Vérifier pas d'options vides
    empty_options = CourseExercise.objects.filter(
        lesson__section="ce",
        option_a=""
    ).count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 134
    
    checks = [
        ("Curriculum", validate_curriculum),
        ("Exams", validate_exams),
        ("Relations", validate_links),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 135
    checks = [
        ("Curriculum", validate_curriculum),
        ("Exams", validate_exams),
        ("Relations", validate_links),
        ("Intégrité", validate_data_integrity),
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 161
        print("\n📈 Contenu CE deployé:")
        
        lessons = CourseLesson.objects.filter(section="ce").count()
        exercises = CourseExercise.objects.filter(lesson__section="ce").count()
        exams = Exam.objects.filter(code__startswith="CE_").count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 162
        
        lessons = CourseLesson.objects.filter(section="ce").count()
        exercises = CourseExercise.objects.filter(lesson__section="ce").count()
        exams = Exam.objects.filter(code__startswith="CE_").count()
        questions = Question.objects.filter(section__code="ce").count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 163
        lessons = CourseLesson.objects.filter(section="ce").count()
        exercises = CourseExercise.objects.filter(lesson__section="ce").count()
        exams = Exam.objects.filter(code__startswith="CE_").count()
        questions = Question.objects.filter(section__code="ce").count()
        
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 166
        questions = Question.objects.filter(section__code="ce").count()
        
        print(f"  • {lessons} leçons")
        print(f"  • {exercises} exercices curriculum")
        print(f"  • {exams} exams")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 167
        
        print(f"  • {lessons} leçons")
        print(f"  • {exercises} exercices curriculum")
        print(f"  • {exams} exams")
        print(f"  • {questions} questions d'exams")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 168
        print(f"  • {lessons} leçons")
        print(f"  • {exercises} exercices curriculum")
        print(f"  • {exams} exams")
        print(f"  • {questions} questions d'exams")
        print(f"  • Total: {exercises + questions} items")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 169
        print(f"  • {exercises} exercices curriculum")
        print(f"  • {exams} exams")
        print(f"  • {questions} questions d'exams")
        print(f"  • Total: {exercises + questions} items")
        
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_deployment.py
LINE: 170
        print(f"  • {exams} exams")
        print(f"  • {questions} questions d'exams")
        print(f"  • Total: {exercises + questions} items")
        
        elapsed = (timezone.now() - start_time).total_seconds()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_quick.py
LINE: 12
django.setup()

from preparation_tests.models import CourseLesson, CourseExercise, Exam, Question, Choice

print("\n" + "="*60)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_quick.py
LINE: 18
print("="*60 + "\n")

# Curriculum
l = CourseLesson.objects.filter(section="ce").count()
e = CourseExercise.objects.filter(lesson__section="ce").count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_quick.py
LINE: 19

# Curriculum
l = CourseLesson.objects.filter(section="ce").count()
e = CourseExercise.objects.filter(lesson__section="ce").count()
print(f"📘 Curriculum CE: {l} leçons, {e} exercices")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_quick.py
LINE: 20
# Curriculum
l = CourseLesson.objects.filter(section="ce").count()
e = CourseExercise.objects.filter(lesson__section="ce").count()
print(f"📘 Curriculum CE: {l} leçons, {e} exercices")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_quick.py
LINE: 21
l = CourseLesson.objects.filter(section="ce").count()
e = CourseExercise.objects.filter(lesson__section="ce").count()
print(f"📘 Curriculum CE: {l} leçons, {e} exercices")

# Exams
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_quick.py
LINE: 23
print(f"📘 Curriculum CE: {l} leçons, {e} exercices")

# Exams
x = Exam.objects.filter(code__startswith="CE_").count()
q = Question.objects.filter(section__code="ce").count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_quick.py
LINE: 24

# Exams
x = Exam.objects.filter(code__startswith="CE_").count()
q = Question.objects.filter(section__code="ce").count()
c = Choice.objects.filter(question__section__code="ce").count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_quick.py
LINE: 27
q = Question.objects.filter(section__code="ce").count()
c = Choice.objects.filter(question__section__code="ce").count()
print(f"📋 Exams CE: {x} exams, {q} questions, {c} choix")

# Total
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_quick.py
LINE: 39
else:
    print("⚠️ Certains chiffres ne correspondent pas")
    print(f"  Expected: 90 leçons, 900 exos, 6 exams, 195 questions")
    print(f"  Got: {l} leçons, {e} exos, {x} exams, {q} questions\n")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ce_quick.py
LINE: 40
    print("⚠️ Certains chiffres ne correspondent pas")
    print(f"  Expected: 90 leçons, 900 exos, 6 exams, 195 questions")
    print(f"  Got: {l} leçons, {e} exos, {x} exams, {q} questions\n")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 13
django.setup()

from preparation_tests.models import CourseLesson, CourseExercise
from exam.models import Exam, Question, Choice

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 14

from preparation_tests.models import CourseLesson, CourseExercise
from exam.models import Exam, Question, Choice


---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 23
    print("=" * 60 + "\n")

    # Curriculum EE
    lessons = CourseLesson.objects.filter(section="ee")
    exercises = CourseExercise.objects.filter(lesson__section="ee")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 24

    # Curriculum EE
    lessons = CourseLesson.objects.filter(section="ee")
    exercises = CourseExercise.objects.filter(lesson__section="ee")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 25
    # Curriculum EE
    lessons = CourseLesson.objects.filter(section="ee")
    exercises = CourseExercise.objects.filter(lesson__section="ee")

    lessons_count = lessons.count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 27
    exercises = CourseExercise.objects.filter(lesson__section="ee")

    lessons_count = lessons.count()
    exercises_count = exercises.count()

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 28

    lessons_count = lessons.count()
    exercises_count = exercises.count()

    print(f"[CURRICULUM] EE: {lessons_count} lessons, {exercises_count} exercises")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 30
    exercises_count = exercises.count()

    print(f"[CURRICULUM] EE: {lessons_count} lessons, {exercises_count} exercises")

    # Exams EE
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 32
    print(f"[CURRICULUM] EE: {lessons_count} lessons, {exercises_count} exercises")

    # Exams EE
    exams = Exam.objects.filter(code__startswith="EE_")
    questions = Question.objects.filter(
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 33

    # Exams EE
    exams = Exam.objects.filter(code__startswith="EE_")
    questions = Question.objects.filter(
        exam_section__exam__code__startswith="EE_"
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 35
    exams = Exam.objects.filter(code__startswith="EE_")
    questions = Question.objects.filter(
        exam_section__exam__code__startswith="EE_"
    )
    choices = Choice.objects.filter(question__exam_section__exam__code__startswith="EE_")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 37
        exam_section__exam__code__startswith="EE_"
    )
    choices = Choice.objects.filter(question__exam_section__exam__code__startswith="EE_")

    exams_count = exams.count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 39
    choices = Choice.objects.filter(question__exam_section__exam__code__startswith="EE_")

    exams_count = exams.count()
    questions_count = questions.count()
    choices_count = choices.count()
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 43
    choices_count = choices.count()

    print(f"[EXAMS] EE: {exams_count} exams, {questions_count} questions, {choices_count} choices")

    # Total
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 46

    # Total
    total = lessons_count + exercises_count + exams_count + questions_count + choices_count
    print(f"\n[TOTAL] {total} items EE en base de donnees")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 50

    # Vérification
    expected_lessons = 90  # 15 par niveau x 6 niveaux
    expected_exercises = 900  # 150 par niveau x 6 niveaux
    expected_exams = 6
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 51
    # Vérification
    expected_lessons = 90  # 15 par niveau x 6 niveaux
    expected_exercises = 900  # 150 par niveau x 6 niveaux
    expected_exams = 6
    expected_questions = 195
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 52
    expected_lessons = 90  # 15 par niveau x 6 niveaux
    expected_exercises = 900  # 150 par niveau x 6 niveaux
    expected_exams = 6
    expected_questions = 195
    expected_choices = 780
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 59

    success = True
    if lessons_count != expected_lessons:
        print(f"[WARNING] Expected {expected_lessons} lessons, got {lessons_count}")
        success = False
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 60
    success = True
    if lessons_count != expected_lessons:
        print(f"[WARNING] Expected {expected_lessons} lessons, got {lessons_count}")
        success = False
    else:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 63
        success = False
    else:
        print(f"[OK] Lessons: {lessons_count}/{expected_lessons}")

    if exercises_count != expected_exercises:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 65
        print(f"[OK] Lessons: {lessons_count}/{expected_lessons}")

    if exercises_count != expected_exercises:
        print(f"[WARNING] Expected {expected_exercises} exercises, got {exercises_count}")
        success = False
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 66

    if exercises_count != expected_exercises:
        print(f"[WARNING] Expected {expected_exercises} exercises, got {exercises_count}")
        success = False
    else:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 69
        success = False
    else:
        print(f"[OK] Exercises: {exercises_count}/{expected_exercises}")

    if exams_count != expected_exams:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 71
        print(f"[OK] Exercises: {exercises_count}/{expected_exercises}")

    if exams_count != expected_exams:
        print(f"[WARNING] Expected {expected_exams} exams, got {exams_count}")
        success = False
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 72

    if exams_count != expected_exams:
        print(f"[WARNING] Expected {expected_exams} exams, got {exams_count}")
        success = False
    else:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\validate_ee_quick.py
LINE: 75
        success = False
    else:
        print(f"[OK] Exams: {exams_count}/{expected_exams}")

    if questions_count != expected_questions:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 9
django.setup()

from preparation_tests.models import CourseLesson, CourseExercise, Question, ExamSection, Exam

print("\n" + "="*60)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 15
print("="*60)

# Curriculum
lessons = CourseLesson.objects.filter(section="ce")
print(f"\n📘 CURRICULUM CE")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 16

# Curriculum
lessons = CourseLesson.objects.filter(section="ce")
print(f"\n📘 CURRICULUM CE")
print(f"  ✅ Leçons: {lessons.count()}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 17
# Curriculum
lessons = CourseLesson.objects.filter(section="ce")
print(f"\n📘 CURRICULUM CE")
print(f"  ✅ Leçons: {lessons.count()}")
print(f"  ✅ Exercices: {CourseExercise.objects.filter(lesson__section='ce').count()}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 18
lessons = CourseLesson.objects.filter(section="ce")
print(f"\n📘 CURRICULUM CE")
print(f"  ✅ Leçons: {lessons.count()}")
print(f"  ✅ Exercices: {CourseExercise.objects.filter(lesson__section='ce').count()}")
print(f"  Niveaux: {lessons.values_list('level', flat=True).distinct()}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 19
print(f"\n📘 CURRICULUM CE")
print(f"  ✅ Leçons: {lessons.count()}")
print(f"  ✅ Exercices: {CourseExercise.objects.filter(lesson__section='ce').count()}")
print(f"  Niveaux: {lessons.values_list('level', flat=True).distinct()}")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 20
print(f"  ✅ Leçons: {lessons.count()}")
print(f"  ✅ Exercices: {CourseExercise.objects.filter(lesson__section='ce').count()}")
print(f"  Niveaux: {lessons.values_list('level', flat=True).distinct()}")

# Exams
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 22
print(f"  Niveaux: {lessons.values_list('level', flat=True).distinct()}")

# Exams
exams = Exam.objects.filter(code__startswith="CE_")
print(f"\n📋 EXAMS CE")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 23

# Exams
exams = Exam.objects.filter(code__startswith="CE_")
print(f"\n📋 EXAMS CE")
print(f"  ✅ Exams: {exams.count()}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 24
# Exams
exams = Exam.objects.filter(code__startswith="CE_")
print(f"\n📋 EXAMS CE")
print(f"  ✅ Exams: {exams.count()}")
print(f"  ✅ Sections: {ExamSection.objects.filter(code='ce').count()}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 25
exams = Exam.objects.filter(code__startswith="CE_")
print(f"\n📋 EXAMS CE")
print(f"  ✅ Exams: {exams.count()}")
print(f"  ✅ Sections: {ExamSection.objects.filter(code='ce').count()}")
print(f"  ✅ Questions: {Question.objects.filter(section__code='ce').count()}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 26
print(f"\n📋 EXAMS CE")
print(f"  ✅ Exams: {exams.count()}")
print(f"  ✅ Sections: {ExamSection.objects.filter(code='ce').count()}")
print(f"  ✅ Questions: {Question.objects.filter(section__code='ce').count()}")
for exam in exams:
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 28
print(f"  ✅ Sections: {ExamSection.objects.filter(code='ce').count()}")
print(f"  ✅ Questions: {Question.objects.filter(section__code='ce').count()}")
for exam in exams:
    print(f"    - {exam.code}")

---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 29
print(f"  ✅ Questions: {Question.objects.filter(section__code='ce').count()}")
for exam in exams:
    print(f"    - {exam.code}")

print("\n" + "="*60)
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 34
print("✨ RÉSUMÉ PRODUCTION CE READY")
print("="*60)
total_ex_curriculum = CourseExercise.objects.filter(lesson__section='ce').count()
total_q_exams = Question.objects.filter(section__code='ce').count()
print(f"Total exercices curriculum: {total_ex_curriculum}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 35
print("="*60)
total_ex_curriculum = CourseExercise.objects.filter(lesson__section='ce').count()
total_q_exams = Question.objects.filter(section__code='ce').count()
print(f"Total exercices curriculum: {total_ex_curriculum}")
print(f"Total questions exams: {total_q_exams}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 36
total_ex_curriculum = CourseExercise.objects.filter(lesson__section='ce').count()
total_q_exams = Question.objects.filter(section__code='ce').count()
print(f"Total exercices curriculum: {total_ex_curriculum}")
print(f"Total questions exams: {total_q_exams}")
print(f"Total contenu CE: {total_ex_curriculum + total_q_exams}")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 37
total_q_exams = Question.objects.filter(section__code='ce').count()
print(f"Total exercices curriculum: {total_ex_curriculum}")
print(f"Total questions exams: {total_q_exams}")
print(f"Total contenu CE: {total_ex_curriculum + total_q_exams}")
print("="*60 + "\n")
---
FILE: C:\Users\USER\OneDrive - IMAGENAF\Documents\immigration97\verify_ce.py
LINE: 38
print(f"Total exercices curriculum: {total_ex_curriculum}")
print(f"Total questions exams: {total_q_exams}")
print(f"Total contenu CE: {total_ex_curriculum + total_q_exams}")
print("="*60 + "\n")
---
