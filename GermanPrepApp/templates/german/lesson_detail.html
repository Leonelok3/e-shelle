{% extends "base.html" %}
{% load static %}

{% block title %}{{ lesson.title }} – Cours allemand {{ exam.level }} – Immigration97{% endblock %}

{% block content %}
<main class="page page--german-lesson">
  <section class="section">
    <div class="container-narrow">

      <p class="hero-kicker">
        Préparation • Allemand • {{ exam.title }} • Niveau {{ exam.level }}
      </p>
      <h1 class="hero-title">
        {{ lesson.title }}
      </h1>
      <p class="hero-subtitle">
        Compétence principale : {{ lesson.get_skill_display }}
      </p>

      <div class="lesson-nav" style="margin: 12px 0 24px;">
        <a href="{% url 'germanprep:exam_detail' exam.slug %}" class="btn btn-ghost">
          ← Retour à l’espace de cours
        </a>
      </div>

      <section class="section">
        <h2 class="section-title">Cours</h2>
        <div class="lesson-content">
          {{ lesson.content|linebreaks }}
        </div>
      </section>

      <section class="section">
        <h2 class="section-title">Ressources pour cette leçon</h2>
        {% if resources %}
          <ul class="resource-list">
            {% for r in resources %}
              <li class="resource-item">
                <h3 class="resource-title">
                  {{ r.title }}
                  <span class="badge">
                    {% if r.resource_type == "PDF" %}PDF{% elif r.resource_type == "VIDEO" %}Vidéo{% elif r.resource_type == "LINK" %}Lien{% else %}Ressource{% endif %}
                  </span>
                </h3>
                {% if r.description %}
                  <p class="resource-desc">{{ r.description }}</p>
                {% endif %}
                <a href="{{ r.url }}" target="_blank" rel="noopener noreferrer" class="btn btn-ghost btn-soft">
                  Ouvrir la ressource
                </a>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="section-empty">
            Aucune ressource n’a encore été ajoutée pour cette leçon.
          </p>
        {% endif %}
      </section>

      <section class="section">
        <h2 class="section-title">Exercices liés à cette leçon</h2>

        {% if exercises %}
          <p class="section-subtitle">
            Utilise ces questions comme entraînement libre. Pour une simulation notée,
            utilise le bouton “Simulation type examen” dans l’espace de cours.
          </p>

          <ol class="question-list">
            {% for ex in exercises %}
              <li class="question-item">
                <p class="question-text">{{ ex.question_text }}</p>
                <ul class="list-clean">
                  <li>A. {{ ex.option_a }}</li>
                  <li>B. {{ ex.option_b }}</li>
                  {% if ex.option_c %}<li>C. {{ ex.option_c }}</li>{% endif %}
                  {% if ex.option_d %}<li>D. {{ ex.option_d }}</li>{% endif %}
                </ul>
                {% if ex.explanation %}
                  <p class="small">
                    <strong>Correction / explication :</strong> {{ ex.explanation }}
                  </p>
                {% endif %}
              </li>
            {% endfor %}
          </ol>
        {% else %}
          <p class="section-empty">
            Aucun exercice n’a encore été ajouté pour cette leçon.
          </p>
        {% endif %}
      </section>

    </div>
  </section>
</main>
{% endblock %}
