{% extends "base.html" %}
{% load static %}

{% block title %}
PrÃ©paration aux tests dâ€™allemand A1â€“C2 â€“ Immigration97
{% endblock %}

{% block meta %}
<meta name="description"
      content="PrÃ©pare les tests dâ€™allemand (Goethe, telc, TestDaF, DSH, visa) du niveau A1 Ã  C2 avec Immigration97. Cours, leÃ§ons, exercices et simulations dâ€™examen avec suivi de ta progression.">
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/germanprep.css' %}">
{% endblock %}

{% block content %}
<main class="page page-dark page-germanprep">

  <!-- HERO -->
  <section class="hero">
    <div class="hero-inner container-narrow">

      <p class="hero-kicker">PrÃ©paration â€¢ Langues â€¢ Allemand</p>

      <h1 class="hero-title">
        Apprends lâ€™allemand du niveau A1 Ã  C2<br>
        et prÃ©pare tes tests officiels pour lâ€™Allemagne
      </h1>

      <p class="hero-subtitle">
        Cours structurÃ©s, exercices interactifs, simulations dâ€™examen
        (Goethe, telc, TestDaF, DSH) et un coach intelligent qui suit ta progression.
      </p>

      <div class="hero-cta-row">
        <a href="#levels" class="btn btn-primary">
          ðŸš€ Choisir mon niveau et commencer
        </a>
        <a href="{% url 'germanprep:placement_test' %}" class="btn btn-secondary">
          ðŸŽ¯ Faire le test de niveau A1â€“C2
        </a>
        <a href="{% url 'germanprep:progress_dashboard' %}" class="btn btn-ghost">
          Voir ma progression
        </a>
      </div>

      <div class="hero-stats">
        <span>XP total : {{ profile.xp }} â€¢ Niveau interne : {{ profile.level }}</span>
        <span>Tests passÃ©s : {{ profile.total_tests }} â€¢ Meilleur score : {{ profile.best_score|default:0 }} %</span>
        {% if profile.placement_level %}
          <span>
            Niveau conseillÃ© : {{ profile.placement_level }}
            (â‰ˆ {{ profile.placement_score|default:0|floatformat:1 }} %)
          </span>
        {% endif %}
      </div>

    </div>
  </section>

  <!-- NIVEAUX -->
  <section id="levels" class="section section--levels">
    <div class="container-narrow">

      <h2 class="section-title">Choisis ton niveau de prÃ©paration</h2>
      <p class="section-subtitle">
        SÃ©lectionne le niveau correspondant Ã  ta situation actuelle.
      </p>

      {% for level, exams in exams_by_level.items %}
        <div class="level-block">

          <div class="level-header">
            <h3 class="level-title">Niveau {{ level }}</h3>
            <p class="level-tagline">
              {% if level == "A1" %}DÃ©but absolu : bases de la langue.{% endif %}
              {% if level == "A2" %}Communication simple du quotidien.{% endif %}
              {% if level == "B1" %}Niveau intermÃ©diaire pour immigration.{% endif %}
              {% if level == "B2" %}Expression fluide pour travail et Ã©tudes.{% endif %}
              {% if level == "C1" %}Niveau universitaire avancÃ©.{% endif %}
              {% if level == "C2" %}MaÃ®trise quasi native.{% endif %}
            </p>
          </div>

          <div class="level-actions">
            <a href="{% url 'germanprep:level_detail' level %}" class="btn btn-secondary btn-soft">
              Voir lâ€™espace Niveau {{ level }}
            </a>
          </div>

          {% if exams %}
            <div class="exam-cards-row">
              {% for exam in exams %}
                <article class="exam-card">
                  <h4 class="exam-title">{{ exam.title }}</h4>
                  <p class="exam-type">
                    {{ exam.get_exam_type_display }} â€¢ Niveau {{ exam.level }}
                  </p>
                  <p class="exam-desc">{{ exam.short_description }}</p>
                  <div class="exam-actions">
                    <a href="{% url 'germanprep:exam_detail' exam.slug %}" class="btn btn-secondary">
                      Voir le programme
                    </a>
                    <a href="{% url 'germanprep:take_practice_test' exam.id %}" class="btn btn-ghost">
                      Simulation rapide
                    </a>
                  </div>
                </article>
              {% endfor %}
            </div>
          {% else %}
            <p class="section-empty">Aucun examen configurÃ© pour ce niveau.</p>
          {% endif %}

        </div>
      {% endfor %}

    </div>
  </section>

  <!-- DERNIERS TESTS -->
  <section class="section section--latest-tests">
    <div class="container-narrow">

      <h2 class="section-title">Tes derniers tests dâ€™allemand</h2>

      {% if last_sessions %}
        <ul class="session-list">
          {% for s in last_sessions %}
            <li class="session-item">
              <div class="session-main">
                <p class="session-title">
                  {{ s.exam.title }} ({{ s.exam.level }})
                </p>
                <p class="session-meta">
                  {{ s.started_at|date:"d/m/Y H:i" }}
                </p>
              </div>
              <div class="session-score">
                {{ s.score|default:"0.0" }} %
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="section-empty">
          Tu nâ€™as pas encore lancÃ© de test dâ€™allemand.
        </p>
      {% endif %}

    </div>
  </section>

</main>
{% endblock %}
