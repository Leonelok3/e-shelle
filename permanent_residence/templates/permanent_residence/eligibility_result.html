{% extends "base.html" %}

{% block title %}immigration97 ¬∑ R√©sultat RP{% endblock %}

{% block content %}
<div class="min-h-screen bg-slate-950 text-slate-50 relative overflow-hidden">
  <!-- Ultra premium animated background -->
  <div class="absolute inset-0 overflow-hidden">
    <div class="absolute top-0 right-0 w-[800px] h-[800px] bg-gradient-to-br from-emerald-600/8 via-transparent to-transparent rounded-full blur-3xl animate-pulse"></div>
    <div class="absolute -bottom-40 -left-40 w-[600px] h-[600px] bg-gradient-to-tr from-blue-600/5 via-purple-600/5 to-transparent rounded-full blur-3xl" style="animation: float 20s ease-in-out infinite;"></div>
    <div class="absolute top-1/2 left-1/3 w-[500px] h-[500px] bg-gradient-to-br from-slate-600/3 to-transparent rounded-full blur-3xl" style="animation: float 25s ease-in-out infinite; animation-delay: 5s;"></div>
  </div>

  <div class="relative z-10">
    <!-- Premium header section -->
    <div class="min-h-screen flex flex-col justify-between">
      <!-- Top navigation bar - ultra clean -->
      <div class="border-b border-slate-800/30 backdrop-blur-xl sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-2.5 h-2.5 rounded-full bg-gradient-to-r from-emerald-400 to-emerald-500"></div>
            <span class="text-xs font-bold tracking-widest text-slate-300">IMMIGRATION97</span>
          </div>
          <div class="h-6 w-px bg-slate-700/50"></div>
          <span class="text-xs tracking-wide text-slate-400">R√©sidence Permanente</span>
        </div>
      </div>

      <!-- Main content area -->
      <div class="flex-1 flex flex-col justify-center">
        <div class="max-w-7xl mx-auto w-full px-6 py-20">
          <!-- Premium hero section -->
          <div class="mb-20">
            <div class="space-y-6 mb-12">
              <div>
                <p class="text-xs font-bold tracking-[0.2em] text-emerald-400/80 mb-4">ANALYSE DE PROFIL</p>
                <h1 class="text-6xl lg:text-7xl font-light tracking-tight leading-tight">
                  <span class="bg-gradient-to-r from-slate-50 via-emerald-100 to-slate-300 bg-clip-text text-transparent">R√©sultat</span>
                  <br />
                  <span class="bg-gradient-to-r from-emerald-400 via-emerald-300 to-emerald-500 bg-clip-text text-transparent font-semibold">Pr√©liminaire</span>
                </h1>
              </div>
              <p class="text-sm text-slate-400 max-w-xl leading-relaxed font-light">
                Analyse intelligente de ton profil d'immigration. Les conclusions pr√©sent√©es sont indicatives 
                et doivent toujours √™tre valid√©es sur les sites officiels (IRCC, provinces, Home Affairs, etc.).
              </p>
            </div>

            <!-- Key metrics bar -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6 pt-12 border-t border-slate-800/30">
              <div class="group">
                <p class="text-xs text-slate-500 font-semibold tracking-wide mb-2">DESTINATION</p>
                <p class="text-lg font-semibold text-emerald-300 group-hover:text-emerald-200 transition-colors">
                  {% if profile.country == "CA" or profile.country == "canada" or profile.country == "Canada" %}
                    Canada
                  {% elif profile.country == "AU" %}
                    Australie
                  {% else %}
                    -
                  {% endif %}
                </p>
              </div>
              <div class="group">
                <p class="text-xs text-slate-500 font-semibold tracking-wide mb-2">√ÇGE</p>
                <p class="text-lg font-semibold text-slate-200">{{ profile.age|default:"-" }}</p>
              </div>
              <div class="group">
                <p class="text-xs text-slate-500 font-semibold tracking-wide mb-2">EXP√âRIENCE</p>
                <p class="text-lg font-semibold text-slate-200">
                  {{ profile.years_experience|default:"-" }} ans
                </p>
              </div>
              <div class="group">
                <p class="text-xs text-slate-500 font-semibold tracking-wide mb-2">STATUT</p>
                <div class="flex gap-2">
                  <span class="px-2.5 py-1 text-xs font-semibold rounded-full {% if profile.has_job_offer %}bg-emerald-500/20 text-emerald-300 border border-emerald-500/40{% else %}bg-slate-700/30 text-slate-400 border border-slate-600/40{% endif %}">
                    {% if profile.has_job_offer %}‚úì Offre d'emploi{% else %}‚Äî{% endif %}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main content grid -->
    <div class="relative z-20 max-w-7xl mx-auto px-6 pb-20">
      <div class="grid grid-cols-1 xl:grid-cols-4 gap-8">
        <!-- Sidebar - Profile Card ULTRA PREMIUM -->
        <div class="xl:col-span-1">
          <div class="sticky top-32 space-y-6">
            <!-- Profile summary card -->
            <div class="group">
              <div class="absolute inset-0 bg-gradient-to-br from-emerald-600/10 to-transparent rounded-2xl blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
              <div class="relative bg-gradient-to-br from-slate-800/40 to-slate-900/40 border border-slate-700/50 rounded-2xl p-8 backdrop-blur-xl hover:border-emerald-500/40 transition-all duration-500 group-hover:shadow-2xl group-hover:shadow-emerald-500/5">
                <!-- Header with accent line -->
                <div class="flex items-center gap-3 mb-8 pb-8 border-b border-slate-700/30">
                  <div class="w-1 h-8 bg-gradient-to-b from-emerald-400 to-emerald-600 rounded-full"></div>
                  <div>
                    <p class="text-xs font-bold tracking-widest text-slate-400">PROFIL</p>
                    <p class="text-xs text-slate-500 font-light">R√©sum√©</p>
                  </div>
                </div>

                <!-- Profile fields -->
                <dl class="space-y-5">
                  <!-- Pays -->
                  <div class="group/field">
                    <dt class="text-xs font-semibold tracking-wide text-slate-500 mb-2">Pays cibl√©</dt>
                    <dd class="text-sm font-semibold text-emerald-300">
                      {% if profile.country == "CA" or profile.country == "canada" or profile.country == "Canada" %}
                        Canada
                      {% elif profile.country == "AU" %}
                        Australie
                      {% else %}
                        -
                      {% endif %}
                    </dd>
                  </div>

                  <!-- Age -->
                  <div class="group/field">
                    <dt class="text-xs font-semibold tracking-wide text-slate-500 mb-2">√Çge</dt>
                    <dd class="text-sm font-semibold text-slate-200">{{ profile.age|default:"-" }}</dd>
                  </div>

                  <!-- √âtudes -->
                  <div class="group/field">
                    <dt class="text-xs font-semibold tracking-wide text-slate-500 mb-2">Formation</dt>
                    <dd class="text-sm font-semibold text-slate-200">
                      {{ profile.get_education_level_display|default:profile.education_level|default:"-" }}
                    </dd>
                  </div>

                  <!-- Exp√©rience -->
                  <div class="group/field">
                    <dt class="text-xs font-semibold tracking-wide text-slate-500 mb-2">Exp√©rience</dt>
                    <dd class="text-sm font-semibold text-slate-200">
                      {{ profile.years_experience|default:"-" }} ann√©es
                    </dd>
                  </div>

                  <div class="h-px bg-slate-700/30"></div>

                  <!-- Langues -->
                  <div class="group/field">
                    <dt class="text-xs font-semibold tracking-wide text-slate-500 mb-2">Test de fran√ßais</dt>
                    <dd class="text-xs font-medium text-slate-300">
                      {{ profile.french_test|default:"‚Äî" }}
                    </dd>
                  </div>
                  <div class="group/field">
                    <dt class="text-xs font-semibold tracking-wide text-slate-500 mb-1">Niveau global de fran√ßais</dt>
                    <dd class="text-sm font-semibold text-slate-300">
                      {{ profile.get_french_level_display|default:profile.french_level|default:"-" }}
                    </dd>
                  </div>

                  <div class="group/field">
                    <dt class="text-xs font-semibold tracking-wide text-slate-500 mb-2">Test d'anglais</dt>
                    <dd class="text-xs font-medium text-slate-300">
                      {{ profile.english_test|default:"‚Äî" }}
                    </dd>
                  </div>
                  <div class="group/field">
                    <dt class="text-xs font-semibold tracking-wide text-slate-500 mb-1">Niveau global d'anglais</dt>
                    <dd class="text-sm font-semibold text-slate-300">
                      {{ profile.get_english_level_display|default:profile.english_level|default:"-" }}
                    </dd>
                  </div>

                  <div class="h-px bg-slate-700/30"></div>

                  <!-- Profession -->
                  <div class="group/field">
                    <dt class="text-xs font-semibold tracking-wide text-slate-500 mb-2">Profession principale</dt>
                    <dd class="text-sm font-semibold text-slate-200">
                      {{ profile.profession_title|default:"-" }}
                    </dd>
                  </div>

                  <!-- Famille -->
                  <div class="group/field">
                    <dt class="text-xs font-semibold tracking-wide text-slate-500 mb-2">Famille</dt>
                    <dd class="inline-flex items-center gap-2">
                      <span class="w-2 h-2 rounded-full {% if profile.has_family_in_country %}bg-emerald-400{% else %}bg-slate-600{% endif %}"></span>
                      <span class="text-sm font-semibold {% if profile.has_family_in_country %}text-emerald-300{% else %}text-slate-400{% endif %}">
                        {{ profile.has_family_in_country|yesno:"Oui,Non" }}
                      </span>
                    </dd>
                  </div>

                  <!-- Offre d'emploi -->
                  <div class="group/field">
                    <dt class="text-xs font-semibold tracking-wide text-slate-500 mb-2">Offre d'emploi</dt>
                    <dd class="inline-flex items-center gap-2">
                      <span class="w-2 h-2 rounded-full {% if profile.has_job_offer %}bg-emerald-400{% else %}bg-slate-600{% endif %}"></span>
                      <span class="text-sm font-semibold {% if profile.has_job_offer %}text-emerald-300{% else %}text-slate-400{% endif %}">
                        {{ profile.has_job_offer|yesno:"Oui,Non" }}
                      </span>
                    </dd>
                  </div>
                </dl>

                <!-- Badges orientation -->
                <div class="mt-6 flex flex-wrap gap-2">
                  {% if profile.country == "CA" or profile.country == "canada" or profile.country == "Canada" %}
                    <span class="px-2.5 py-1 rounded-full border border-emerald-500/50 bg-emerald-500/10 text-[11px] uppercase tracking-wide text-emerald-200">
                      Orientation Canada ¬∑ Entr√©e Express / PNP
                    </span>
                  {% elif profile.country == "AU" %}
                    <span class="px-2.5 py-1 rounded-full border border-sky-400/50 bg-sky-500/10 text-[11px] uppercase tracking-wide text-sky-200">
                      Orientation Australie ¬∑ Skilled / Sponsor
                    </span>
                  {% endif %}
                  {% if profile.has_family_in_country %}
                    <span class="px-2 py-1 rounded-full border border-slate-600/60 bg-slate-800/60 text-[11px] text-slate-200">
                      Lien familial dans le pays
                    </span>
                  {% endif %}
                  {% if profile.has_job_offer %}
                    <span class="px-2 py-1 rounded-full border border-emerald-500/60 bg-emerald-600/20 text-[11px] text-emerald-100">
                      Offre d'emploi confirm√©e
                    </span>
                  {% endif %}
                </div>

                <!-- Notes section -->
                {% if profile.notes %}
                  <div class="mt-8 pt-8 border-t border-slate-700/30">
                    <p class="text-xs font-bold tracking-widest text-slate-400 mb-3">NOTES ADDITIONNELLES</p>
                    <p class="text-xs text-slate-400 leading-relaxed font-light whitespace-pre-line">
                      {{ profile.notes }}
                    </p>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>

        <!-- Main content - Analysis ULTRA PREMIUM -->
        <div class="xl:col-span-3 space-y-8">
          <!-- Analysis card -->
          <div class="group">
            <div class="absolute inset-0 bg-gradient-to-br from-blue-600/5 to-transparent rounded-2xl blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
            <div class="relative bg-gradient-to-br from-slate-800/30 to-slate-900/30 border border-slate-700/40 rounded-2xl p-8 backdrop-blur-xl hover:border-blue-500/30 transition-all duration-500 group-hover:shadow-2xl group-hover:shadow-blue-500/5">
              <!-- Header -->
              <div class="flex items-center gap-3 mb-8 pb-8 border-b border-slate-700/30">
                <div class="w-1 h-8 bg-gradient-to-b from-blue-400 to-blue-600 rounded-full"></div>
                <div>
                  <p class="text-xs font-bold tracking-widest text-slate-400">√âVALUATION</p>
                  <p class="text-xs text-slate-500 font-light">Analyse g√©n√©rale de ton profil</p>
                </div>
              </div>

              <!-- Summary -->
              <p class="text-sm text-slate-300 leading-relaxed font-light mb-8 text-justify">
                {{ evaluation.summary }}
              </p>

              <!-- Two column grid for reasons and suggestions -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Points positifs -->
                <div>
                  <div class="flex items-center gap-2 mb-5">
                    <span class="w-2 h-2 rounded-full bg-emerald-400"></span>
                    <p class="text-xs font-bold tracking-widest text-slate-300">FORCES</p>
                  </div>
                  <ul class="space-y-3">
                    {% for r in evaluation.reasons %}
                      <li class="flex gap-3 items-start text-xs text-slate-400 leading-relaxed hover:text-slate-300 transition-colors group/item">
                        <span class="text-emerald-400 font-bold mt-1.5 text-base group-hover/item:scale-110 transition-transform">‚Üí</span>
                        <span>{{ r }}</span>
                      </li>
                    {% empty %}
                      <li class="text-xs text-slate-600 italic font-light">Aucun point identifi√© pour l'instant.</li>
                    {% endfor %}
                  </ul>
                </div>

                <!-- Pistes d'am√©lioration -->
                <div>
                  <div class="flex items-center gap-2 mb-5">
                    <span class="w-2 h-2 rounded-full bg-amber-400"></span>
                    <p class="text-xs font-bold tracking-widest text-slate-300">AXES DE D√âVELOPPEMENT</p>
                  </div>
                  <ul class="space-y-3">
                    {% for s in evaluation.suggestions %}
                      <li class="flex gap-3 items-start text-xs text-slate-400 leading-relaxed hover:text-slate-300 transition-colors group/item">
                        <span class="text-amber-400 font-bold mt-1.5 text-base group-hover/item:scale-110 transition-transform">‚óÜ</span>
                        <span>{{ s }}</span>
                      </li>
                    {% empty %}
                      <li class="text-xs text-slate-600 italic font-light">Pas de recommandation particuli√®re.</li>
                    {% endfor %}
                  </ul>
                </div>
              </div>

              <!-- Disclaimer card -->
              <div class="mt-8 pt-8 border-t border-slate-700/30">
                <div class="relative overflow-hidden rounded-xl bg-gradient-to-r from-amber-600/5 via-orange-600/5 to-amber-600/5 border border-amber-500/20 p-4">
                  <p class="text-xs text-amber-200/90 leading-relaxed font-light flex gap-3">
                    <span class="text-lg flex-shrink-0">‚ö†</span>
                    <span>
                      Ce r√©sultat n'est pas un calcul officiel (CRS, points australiens, etc.).
                      Utilise toujours les calculateurs officiels et les informations des sites gouvernementaux
                      avant de d√©poser une demande.
                    </span>
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Progress card -->
          <div class="group">
            <div class="absolute inset-0 bg-gradient-to-br from-emerald-600/10 to-transparent rounded-2xl blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
            <div class="relative bg-gradient-to-br from-slate-800/30 to-slate-900/30 border border-slate-700/40 rounded-2xl p-8 backdrop-blur-xl hover:border-emerald-500/30 transition-all duration-500 group-hover:shadow-2xl group-hover:shadow-emerald-500/5">
              <!-- Header -->
              <div class="flex items-center justify-between mb-8">
                <div class="flex items-center gap-3">
                  <div class="w-1 h-8 bg-gradient-to-b from-emerald-400 to-emerald-600 rounded-full"></div>
                  <div>
                    <p class="text-xs font-bold tracking-widest text-slate-400">PROGRESSION</p>
                    <p class="text-xs text-slate-500 font-light">√âtat d'avancement de ton projet</p>
                  </div>
                </div>
                <div class="text-right">
                  <p class="text-4xl font-bold text-transparent bg-gradient-to-r from-emerald-400 to-emerald-500 bg-clip-text">
                    {{ progress_percent }}<span class="text-2xl">%</span>
                  </p>
                </div>
              </div>

              <!-- Progress bar with glow -->
              <div class="mb-8">
                <div class="relative h-1.5 rounded-full bg-slate-800/50 overflow-hidden">
                  <div class="absolute inset-0 bg-gradient-to-r from-emerald-500/20 to-emerald-400/20"></div>
                  <div class="relative h-full rounded-full bg-gradient-to-r from-emerald-500 via-emerald-400 to-emerald-500 transition-all duration-1000 ease-out shadow-lg shadow-emerald-500/50" style="width: {{ progress_percent }}%; animation: pulse-width 2s ease-in-out infinite;"></div>
                </div>
              </div>

              <a href="{% url 'permanent_residence:plan' profile.id %}"
                 class="inline-flex items-center justify-center gap-2 text-sm font-bold text-slate-950 px-6 py-3 rounded-lg bg-gradient-to-r from-emerald-400 to-emerald-500 hover:from-emerald-300 hover:to-emerald-400 transition-all duration-200 shadow-lg shadow-emerald-500/40 hover:shadow-emerald-500/60 hover:scale-105 active:scale-95 group-hover:shadow-2xl">
                <span class="text-base">‚Üí</span>
                <span>Consulter le plan d'action d√©taill√©</span>
              </a>
            </div>
          </div>

          <!-- Programs section -->
          {% if program_results %}
          <div class="mt-12 pt-12 border-t border-slate-700/30">
            <div class="mb-10">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-1 h-8 bg-gradient-to-b from-purple-400 to-blue-600 rounded-full"></div>
                <div>
                  <p class="text-xs font-bold tracking-widest text-slate-400">OPPORTUNIT√âS</p>
                  <h2 class="text-3xl font-light tracking-tight">Programmes compatibles</h2>
                </div>
              </div>
              <p class="text-sm text-slate-400 font-light max-w-2xl">
                Orientation non-officielle bas√©e sur ton profil actuel. Chaque programme doit √™tre v√©rifi√©
                en d√©tail sur les sites gouvernementaux (IRCC, provinces, Home Affairs, etc.).
              </p>
                    <div class="mt-4">
        <a
          href="{% url 'permanent_residence:program_list' %}{% if profile.country == 'canada' %}?country=CA{% else %}?country=AU{% endif %}"
          class="inline-flex items-center gap-2 px-4 py-2 rounded-xl text-xs font-semibold bg-slate-900/80 border border-slate-700 text-slate-200 hover:border-emerald-500/60 hover:text-emerald-100 transition-all">
          <span>Ouvrir tous les guides programmes pour mon pays</span>
          <span>‚Üí</span>
        </a>
      </div>

            </div>

            <div class="grid grid-cols-1 gap-4">
              {% for item in program_results %}
                <div class="group rounded-2xl border border-slate-700/40 bg-gradient-to-br {% if item.eligible %}from-slate-800/50 to-slate-900/40{% else %}from-slate-800/30 to-slate-900/30{% endif %} p-6 backdrop-blur-xl hover:border-emerald-500/40 transition-all duration-500 hover:shadow-lg{% if item.eligible %} hover:shadow-emerald-500/10{% else %} hover:shadow-slate-500/5{% endif %}">
                  <div class="flex items-start justify-between gap-4 mb-3">
                    <div class="flex-1">
                      <h3 class="text-sm font-bold text-slate-100 mb-1">
                        {{ item.program.name }}
                      </h3>
                      <p class="text-[11px] uppercase tracking-wide text-slate-500 mb-1">
                        {% if item.program.get_country_display %}
                          {{ item.program.get_country_display }}
                        {% else %}
                          {% if item.program.country == "CA" %}
                            Canada
                          {% elif item.program.country == "AU" %}
                            Australie
                          {% else %}
                            -
                          {% endif %}
                        {% endif %}
                        ¬∑ {{ item.program.category|title }}
                      </p>
                      <p class="text-xs text-slate-500 font-light leading-relaxed">
                        {{ item.program.description }}
                      </p>
                    </div>
                    <span class="flex-shrink-0 px-3 py-1.5 text-xs font-bold rounded-full {% if item.eligible %}bg-emerald-500/20 text-emerald-300 border border-emerald-500/40{% else %}bg-amber-500/15 text-amber-300 border border-amber-500/30{% endif %} whitespace-nowrap">
                      {% if item.eligible %}‚úì Potentiel{% else %}‚óÜ √Ä renforcer{% endif %}
                    </span>
                  </div>
                  <ul class="space-y-2">
                    {% for r in item.reasons %}
                      <li class="flex gap-3 items-start text-xs text-slate-400">
                        <span class="w-1 h-1 rounded-full mt-1.5 {% if item.eligible %}bg-emerald-400{% else %}bg-amber-400{% endif %} flex-shrink-0"></span>
                        <span>{{ r }}</span>
                      </li>
                    {% endfor %}
                  </ul>
                </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}

        </div>
      </div>
    </div>
          <!-- COACH IA RP -->
          <div class="mt-12 pt-12 border-t border-slate-800/40">
            <div class="group">
              <div class="absolute inset-0 bg-gradient-to-br from-emerald-500/10 via-sky-500/5 to-transparent rounded-2xl blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
              <div class="relative bg-gradient-to-br from-slate-900/40 to-slate-950/40 border border-slate-700/50 rounded-2xl p-8 backdrop-blur-2xl hover:border-emerald-500/40 transition-all duration-500 group-hover:shadow-2xl group-hover:shadow-emerald-500/10">
                
                <!-- Header -->
                <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                  <div class="flex items-center gap-3">
                    <div class="w-9 h-9 rounded-full bg-gradient-to-br from-emerald-400 to-emerald-600 flex items-center justify-center text-slate-950 text-xs font-bold shadow-lg shadow-emerald-500/40">
                      IA
                    </div>
                    <div>
                      <p class="text-xs font-bold tracking-widest text-slate-400 uppercase">Coach IA ¬∑ R√©sidence Permanente</p>
                      <p class="text-xs text-slate-500">
                        Pose tes questions et re√ßois des conseils contextualis√©s selon ton profil.
                      </p>
                    </div>
                  </div>
                  <div class="flex items-center gap-2 text-[11px] text-slate-400">
                    <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-slate-800/70 border border-slate-700/70">
                      <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse"></span>
                      <span>Actif</span>
                    </span>
                    <span class="hidden sm:inline text-slate-500">
                      Bas√© sur ton profil : Canada / Australie, √©tudes, langues, exp√©rience, etc.
                    </span>
                  </div>
                </div>

                <!-- Thread -->
                <div id="rp-coach-thread" class="space-y-4 max-h-[360px] overflow-y-auto pr-1 text-sm">
                  <!-- Message d'accueil -->
                  <div class="flex gap-3 items-start">
                    <div class="w-7 h-7 rounded-full bg-gradient-to-br from-emerald-400 to-emerald-600 flex items-center justify-center text-[11px] font-bold text-slate-950 flex-shrink-0">
                      IA
                    </div>
                    <div class="flex-1 rounded-2xl bg-slate-900/80 border border-slate-700/70 px-4 py-3 shadow-md shadow-slate-950/50">
                      <p class="text-xs font-semibold text-emerald-300 mb-1">Bienvenue dans ton coach RP üëã</p>
                      <p class="text-xs text-slate-200 leading-relaxed">
                        Je peux t‚Äôaider √† comprendre tes chances g√©n√©rales, les programmes possibles (Entr√©e Express, PNP, Skilled visas, etc.),
                        et les actions concr√®tes √† faire en priorit√© pour renforcer ton profil. Pose-moi une question pr√©cise, par exemple :
                      </p>
                      <ul class="mt-2 space-y-1 text-xs text-slate-300 list-disc list-inside">
                        <li>¬´ Quels programmes semblent adapt√©s √† mon profil ? ¬ª</li>
                        <li>¬´ Comment am√©liorer mon score pour le Canada ? ¬ª</li>
                        <li>¬´ Quelles √©tapes faire en premier pour l‚ÄôAustralie ? ¬ª</li>
                      </ul>
                    </div>
                  </div>
                </div>

                <!-- Input + quick actions -->
                <div class="mt-5 space-y-4">
                  <!-- Quick prompts -->
                  <div class="flex flex-wrap gap-2">
                    <button
                      type="button"
                      class="px-3 py-1.5 rounded-full bg-slate-900/70 border border-slate-700/70 text-[11px] text-slate-200 hover:border-emerald-500/60 hover:text-emerald-100 hover:bg-slate-900 transition-all"
                      data-coach-preset="Donne-moi un plan d‚Äôaction prioris√© sur 90 jours pour am√©liorer mon profil de r√©sidence permanente.">
                      üìå Plan d‚Äôaction 90 jours
                    </button>
                    <button
                      type="button"
                      class="px-3 py-1.5 rounded-full bg-slate-900/70 border border-slate-700/70 text-[11px] text-slate-200 hover:border-emerald-500/60 hover:text-emerald-100 hover:bg-slate-900 transition-all"
                      data-coach-preset="Sur la base de mon profil, quels programmes Canada (Entr√©e Express, PNP) semblent r√©alistes et pourquoi ?">
                      üá®üá¶ Programmes Canada
                    </button>
                    <button
                      type="button"
                      class="px-3 py-1.5 rounded-full bg-slate-900/70 border border-slate-700/70 text-[11px] text-slate-200 hover:border-emerald-500/60 hover:text-emerald-100 hover:bg-slate-900 transition-all"
                      data-coach-preset="Sur la base de mon profil, quels visas australiens (Skilled, State nomination, sponsor) semblent les plus adapt√©s ?">
                      üá¶üá∫ Visas Australie
                    </button>
                    <button
                      type="button"
                      class="px-3 py-1.5 rounded-full bg-slate-900/70 border border-slate-700/70 text-[11px] text-slate-200 hover:border-emerald-500/60 hover:text-emerald-100 hover:bg-slate-900 transition-all"
                      data-coach-preset="Comment puis-je am√©liorer mes r√©sultats en langues pour maximiser mes points pour la RP ?">
                      üéß Booster les langues
                    </button>
                  </div>

                  <!-- Input zone -->
                  <div class="flex gap-3 items-end">
                    <div class="flex-1">
                      <label for="rp-coach-input" class="sr-only">Question au coach</label>
                      <textarea
                        id="rp-coach-input"
                        rows="2"
                        class="w-full rounded-2xl bg-slate-950/80 border border-slate-700/80 px-4 py-3 text-sm text-slate-50 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/70 focus:border-emerald-500/70 resize-none"
                        placeholder="Pose ta question au coach RP (ex : ¬´ Est-ce que mon profil est plut√¥t adapt√© au Canada ou √† l‚ÄôAustralie ? ¬ª)"></textarea>
                    </div>
                    <button
                      id="rp-coach-send"
                      type="button"
                      class="inline-flex items-center justify-center gap-2 px-5 py-3 rounded-xl bg-gradient-to-r from-emerald-400 to-emerald-500 text-sm font-semibold text-slate-950 shadow-lg shadow-emerald-500/40 hover:from-emerald-300 hover:to-emerald-400 hover:shadow-emerald-500/60 transition-all active:scale-95">
                      <span class="text-base">‚Üó</span>
                      <span>Envoyer</span>
                    </button>
                  </div>

                  <p class="text-[11px] text-slate-500 leading-relaxed">
                    ‚ÑπÔ∏è Le coach IA donne des conseils g√©n√©raux bas√©s sur ton profil.  
                    Il ne remplace pas l‚Äôavis d‚Äôun avocat ou consultant r√©glement√©, ni les informations officielles des gouvernements.
                  </p>
                </div>
              </div>
            </div>
          </div>

    <!-- Footer section -->
    <div class="relative z-20 border-t border-slate-800/30 backdrop-blur-xl">
      <div class="max-w-7xl mx-auto px-6 py-12">
        <p class="text-xs text-slate-500 text-center font-light leading-relaxed">
          üí° <span class="text-slate-400">
          Prochaine √©tape : connecter ce module √† un coach IA RP avanc√© pour r√©pondre √† tes questions
          sur les programmes (Entr√©e Express, PNP, Skilled visas, sponsor, etc.) et t‚Äôaider √† remplir
          chaque √©tape de ton plan d‚Äôaction.</span>
        </p>
      </div>
    </div>
  </div>

  <style>
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(20px); }
    }
    @keyframes pulse-width {
      0%, 100% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.5); }
      50% { box-shadow: 0 0 40px rgba(16, 185, 129, 0.8); }
    }
  </style>
    <script>
    (function () {
      const thread = document.getElementById("rp-coach-thread");
      const input = document.getElementById("rp-coach-input");
      const sendBtn = document.getElementById("rp-coach-send");
      const presetButtons = document.querySelectorAll("[data-coach-preset]");
      if (!thread || !input || !sendBtn) return;

      const endpoint = "{% url 'permanent_residence:coach_api' profile.id %}";

      function appendMessage(role, text) {
        const wrapper = document.createElement("div");
        wrapper.className = "flex gap-3 items-start";

        const avatar = document.createElement("div");
        avatar.className =
          "w-7 h-7 rounded-full flex items-center justify-center text-[11px] font-bold flex-shrink-0";

        const bubble = document.createElement("div");
        bubble.className =
          "flex-1 rounded-2xl px-4 py-3 text-xs leading-relaxed whitespace-pre-line";

        if (role === "user") {
          avatar.classList.add("bg-slate-100", "text-slate-900");
          avatar.textContent = "Toi";
          bubble.classList.add(
            "bg-slate-900/80",
            "border",
            "border-slate-600/70",
            "text-slate-100"
          );
        } else {
          avatar.classList.add(
            "bg-gradient-to-br",
            "from-emerald-400",
            "to-emerald-600",
            "text-slate-950"
          );
          avatar.textContent = "IA";
          bubble.classList.add(
            "bg-slate-900/90",
            "border",
            "border-emerald-500/40",
            "text-slate-100",
            "shadow-md",
            "shadow-emerald-500/10"
          );
        }

        bubble.textContent = text;
        wrapper.appendChild(avatar);
        wrapper.appendChild(bubble);
        thread.appendChild(wrapper);
        thread.scrollTop = thread.scrollHeight;
      }

      async function sendMessage(message) {
        const content = (message || input.value || "").trim();
        if (!content) return;

        appendMessage("user", content);
        input.value = "";
        input.style.height = "auto";

        sendBtn.disabled = true;
        sendBtn.classList.add("opacity-70", "cursor-wait");
        const originalLabel = sendBtn.innerHTML;
        sendBtn.innerHTML = '<span class="animate-pulse">Analyse...</span>';

        try {
          const res = await fetch(endpoint, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ message: content }),
          });

          const data = await res.json();
          if (data && data.answer) {
            appendMessage("assistant", data.answer);
          } else if (data && data.error) {
            appendMessage(
              "assistant",
              "Je n'ai pas pu traiter ta demande : " + data.error
            );
          } else {
            appendMessage(
              "assistant",
              "Je n'ai pas pu g√©n√©rer de r√©ponse. R√©essaie dans un instant."
            );
          }
        } catch (e) {
          appendMessage(
            "assistant",
            "Erreur technique pendant l'appel au coach IA. V√©rifie ta connexion ou r√©essaie plus tard."
          );
        } finally {
          sendBtn.disabled = false;
          sendBtn.classList.remove("opacity-70", "cursor-wait");
          sendBtn.innerHTML = originalLabel;
        }
      }

      // Bouton envoyer
      sendBtn.addEventListener("click", function () {
        sendMessage();
      });

      // Enter pour envoyer (Shift+Enter = nouvelle ligne)
      input.addEventListener("keydown", function (e) {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });

      // Auto-resize du textarea
      input.addEventListener("input", function () {
        this.style.height = "auto";
        this.style.height = this.scrollHeight + "px";
      });

      // Boutons presets
      presetButtons.forEach(function (btn) {
        btn.addEventListener("click", function () {
          const preset = btn.getAttribute("data-coach-preset") || "";
          if (preset) {
            sendMessage(preset);
          }
        });
      });
    })();
  </script>

</div>
    {% include "permanent_residence/components/coach_panel.html" %}
{% endblock %}

{% endblock %}
