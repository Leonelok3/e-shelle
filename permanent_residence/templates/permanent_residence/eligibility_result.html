{% extends "base.html" %}

{% block title %}
R√©sultat Diagnostic R√©sidence Permanente ‚Äì Canada / Australie | immigration97
{% endblock %}

{% block meta_description %}
Analyse intelligente de ton profil de R√©sidence Permanente (Canada / Australie) : points forts,
axes √† renforcer, programmes d‚Äôimmigration √† explorer et plan d‚Äôaction guid√© avec Immigration97.
{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto py-10 px-4">

  {# ---------------- HERO / R√âSUM√â GLOBAL ---------------- #}
  <div class="bg-[#0d1b24]/95 border border-[#0d2834] rounded-2xl p-8 shadow-xl shadow-black/60 mb-8 backdrop-blur-sm">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4">
      <div>
        <p class="text-sm text-emerald-300 mb-1">
          R√©sultat du diagnostic RP ¬∑ {{ profile.get_country_display }}
        </p>
        <h1 class="text-2xl md:text-3xl font-bold text-white mb-2">
          Ton profil de R√©sidence Permanente, analys√©.
        </h1>
        <p class="text-sm md:text-base text-gray-300 max-w-2xl">
          Voici une synth√®se de ton profil, les points forts, ce qui doit √™tre renforc√©
          et la progression de ton plan d‚Äôaction vers la R√©sidence Permanente.
        </p>
      </div>

      <div class="flex flex-col items-end gap-3">
        {# Badge statut profil #}
        {% if evaluation.status == "profil_potentiellement_interessant" %}
          <span class="inline-flex items-center px-3 py-1 rounded-full bg-emerald-700/20 text-emerald-300 text-xs font-semibold border border-emerald-500/60 shadow-sm shadow-emerald-500/30">
            ‚úÖ Profil potentiellement int√©ressant
          </span>
        {% elif evaluation.status == "profil_a_renforcer" %}
          <span class="inline-flex items-center px-3 py-1 rounded-full bg-amber-700/20 text-amber-300 text-xs font-semibold border border-amber-500/60 shadow-sm shadow-amber-500/30">
            ‚ö†Ô∏è Profil √† renforcer
          </span>
        {% elif evaluation.status == "profil_incomplet_ou_faible" %}
          <span class="inline-flex items-center px-3 py-1 rounded-full bg-rose-700/20 text-rose-300 text-xs font-semibold border border-rose-500/60 shadow-sm shadow-rose-500/30">
            üß© Profil incomplet / faible
          </span>
        {% else %}
          <span class="inline-flex items-center px-3 py-1 rounded-full bg-sky-700/20 text-sky-300 text-xs font-semibold border border-sky-500/60 shadow-sm shadow-sky-500/30">
            Profil analys√©
          </span>
        {% endif %}

        {# Progression globale #}
        <div class="w-full min-w-[220px]">
          <p class="text-xs text-gray-400 mb-1 text-right">
            Progression du plan d‚Äôaction
          </p>
          <div class="w-full h-2 rounded-full bg-slate-900 overflow-hidden">
            <div class="h-2 rounded-full bg-gradient-to-r from-emerald-400 via-emerald-500 to-emerald-300 transition-all"
                 style="width: {{ progress_percent }}%;"></div>
          </div>
          <p class="text-xs text-gray-300 mt-1 text-right">
            {{ progress_percent }}% compl√©t√©
          </p>
        </div>
      </div>
    </div>

    {# Boutons principaux #}
    <div class="mt-4 flex flex-wrap gap-3">
      <a href="{% url 'permanent_residence:plan' profile.id %}"
         class="px-5 py-2 rounded-xl bg-gradient-to-r from-emerald-500 to-emerald-400 hover:from-emerald-500 hover:to-emerald-300 text-white text-sm font-semibold shadow-lg shadow-emerald-600/40 transition transform hover:-translate-y-0.5">
        üìù Ouvrir mon plan d‚Äôaction RP
      </a>
      <a href="{% url 'permanent_residence:dashboard' %}"
         class="px-5 py-2 rounded-xl border border-emerald-500/60 text-emerald-200 text-sm font-semibold bg-[#071622] hover:bg-[#0b2230] shadow-md shadow-black/40 transition transform hover:-translate-y-0.5">
        üìä Voir le cockpit RP
      </a>
      <a href="{% url 'permanent_residence:coach' %}"
         class="px-5 py-2 rounded-xl border border-sky-500/60 text-sky-200 text-sm font-semibold bg-[#071725] hover:bg-[#0b2233] shadow-md shadow-black/40 transition transform hover:-translate-y-0.5">
        ü§ñ Parler au coach IA RP
      </a>
    </div>
  </div>

  {# ---------------- ZONE CENTRALE : SYNTH√àSE + R√âSUM√â TECHNIQUE ---------------- #}
  <div class="grid lg:grid-cols-3 gap-6">

    {# Synth√®se #}
    <section class="lg:col-span-2 bg-[#050d16]/95 border border-[#132336] rounded-2xl p-6 shadow-xl shadow-black/60 backdrop-blur-sm">
      <h2 class="text-lg font-semibold text-white mb-2">
        Synth√®se de ton profil
      </h2>
      <p class="text-sm text-gray-300 mb-4">
        {{ evaluation.summary }}
      </p>

      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h3 class="text-sm font-semibold text-emerald-300 mb-2">
            Points positifs
          </h3>
          {% if evaluation.reasons %}
            <ul class="space-y-2 text-sm text-gray-200">
              {% for reason in evaluation.reasons %}
                <li class="flex gap-2">
                  <span class="mt-1 text-emerald-400">‚óè</span>
                  <span>{{ reason }}</span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-xs text-gray-500">Les points positifs seront affich√©s ici.</p>
          {% endif %}
        </div>

        <div>
          <h3 class="text-sm font-semibold text-amber-300 mb-2">
            Axes √† renforcer / conseils
          </h3>
          {% if evaluation.suggestions %}
            <ul class="space-y-2 text-sm text-gray-200">
              {% for suggestion in evaluation.suggestions %}
                <li class="flex gap-2">
                  <span class="mt-1 text-amber-300">‚óè</span>
                  <span>{{ suggestion }}</span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-xs text-gray-500">Les pistes d‚Äôam√©lioration seront affich√©es ici.</p>
          {% endif %}
        </div>
      </div>
    </section>

    {# R√©sum√© technique #}
    <aside class="bg-[#050d16]/95 border border-[#132336] rounded-2xl p-6 shadow-xl shadow-black/60 backdrop-blur-sm">
      <h2 class="text-lg font-semibold text-white mb-3">
        R√©sum√© technique
      </h2>
      <dl class="space-y-2 text-sm text-gray-300">
        <div class="flex justify-between gap-4">
          <dt class="text-gray-400">Pays cibl√©</dt>
          <dd class="font-medium">
            {% if profile.country == "CA" %}üá®üá¶ Canada
            {% elif profile.country == "AU" %}üá¶üá∫ Australie
            {% else %}{{ profile.country }}{% endif %}
          </dd>
        </div>
        <div class="flex justify-between gap-4">
          <dt class="text-gray-400">√Çge</dt>
          <dd class="font-medium">{{ profile.age|default:"‚Äî" }}</dd>
        </div>
        <div class="flex justify-between gap-4">
          <dt class="text-gray-400">Exp√©rience (ann√©es)</dt>
          <dd class="font-medium">{{ profile.years_experience|default:"‚Äî" }}</dd>
        </div>
        <div class="flex justify-between gap-4">
          <dt class="text-gray-400">Niveau d‚Äô√©tudes</dt>
          <dd class="font-medium">
            {{ profile.get_education_level_display|default:"‚Äî" }}
          </dd>
        </div>
        <div class="flex justify-between gap-4">
          <dt class="text-gray-400">Fran√ßais</dt>
          <dd class="font-medium">
            {{ profile.get_french_level_display|default:"‚Äî" }}
          </dd>
        </div>
        <div class="flex justify-between gap-4">
          <dt class="text-gray-400">Anglais</dt>
          <dd class="font-medium">
            {{ profile.get_english_level_display|default:"‚Äî" }}
          </dd>
        </div>
        <div class="flex justify-between gap-4">
          <dt class="text-gray-400">Profession</dt>
          <dd class="font-medium text-right">
            {{ profile.profession_title|default:"‚Äî" }}
          </dd>
        </div>
        <div class="flex justify-between gap-4">
          <dt class="text-gray-400">Famille sur place</dt>
          <dd class="font-medium">
            {% if profile.has_family_in_country %}Oui{% else %}Non{% endif %}
          </dd>
        </div>
        <div class="flex justify-between gap-4">
          <dt class="text-gray-400">Offre d‚Äôemploi</dt>
          <dd class="font-medium">
            {% if profile.has_job_offer %}Oui{% else %}Non{% endif %}
          </dd>
        </div>
      </dl>
    </aside>
  </div>

  {# ---------------- PROGRAMMES RECOMMAND√âS ---------------- #}
  <div class="mt-8 bg-[#050d16]/95 border border-[#132336] rounded-2xl p-6 shadow-xl shadow-black/60 backdrop-blur-sm">
    <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
      <h2 class="text-lg font-semibold text-white">
        Programmes de R√©sidence Permanente √† explorer
      </h2>
      <a href="{% url 'permanent_residence:program_list' %}"
         class="text-sm text-emerald-300 hover:text-emerald-200 underline">
        Voir tous les programmes RP ‚Üí
      </a>
    </div>

    {% if program_results %}
      <div class="grid md:grid-cols-2 xl:grid-cols-3 gap-4">
        {% for item in program_results %}
          {% with prog=item.program|default:item %}
            <article class="bg-gradient-to-br from-[#07111b] via-[#050d16] to-[#071b24] border border-emerald-500/30 rounded-2xl p-4 flex flex-col justify-between shadow-lg shadow-black/60 transform hover:-translate-y-1 hover:shadow-2xl hover:shadow-emerald-500/35 transition">
              <div>
                <div class="flex items-start justify-between gap-2 mb-2">
                  <h3 class="text-sm font-semibold text-white leading-snug">
                    {{ prog.name|default:prog.code|default:"Programme RP" }}
                  </h3>
                  <span class="text-[0.7rem] px-2 py-1 rounded-full border border-emerald-400/40 bg-emerald-600/10 text-emerald-200">
                    {% if prog.country == 'CA' %}üá®üá¶ Canada
                    {% elif prog.country == 'AU' %}üá¶üá∫ Australie
                    {% else %}Programme RP{% endif %}
                  </span>
                </div>

                {% if prog.category %}
                  <p class="text-[0.75rem] text-emerald-300 mb-1 uppercase tracking-wide">
                    {{ prog.category }}
                  </p>
                {% elif item.strategy_label %}
                  <p class="text-[0.75rem] text-emerald-300 mb-1 uppercase tracking-wide">
                    {{ item.strategy_label }}
                  </p>
                {% endif %}

                {% if item.summary %}
                  <p class="text-xs text-gray-300 mb-2">
                    {{ item.summary }}
                  </p>
                {% elif prog.summary %}
                  <p class="text-xs text-gray-300 mb-2">
                    {{ prog.summary }}
                  </p>
                {% endif %}

                {% if item.score or item.priority %}
                  <p class="text-[0.7rem] text-gray-400">
                    {% if item.score %}
                      Score estim√© : <span class="text-emerald-300">{{ item.score }}</span>
                    {% endif %}
                    {% if item.priority %}
                      ¬∑ Priorit√© : {{ item.priority }}
                    {% endif %}
                  </p>
                {% endif %}
              </div>

              <div class="mt-3 flex items-center justify-between gap-2">
                {% if prog.slug %}
                  <a href="{% url 'permanent_residence:program_detail' prog.slug %}"
                     class="inline-flex items-center justify-center px-3 py-1.5 rounded-xl bg-emerald-500 hover:bg-emerald-400 text-[0.8rem] font-semibold text-white shadow-md shadow-emerald-500/40 transition">
                    Voir le programme ‚Üí 
                  </a>
                {% endif %}

                {% if prog.official_url %}
                  <a href="{{ prog.official_url }}" target="_blank" rel="noopener noreferrer"
                     class="text-[0.75rem] text-gray-400 hover:text-gray-200 underline">
                    Site officiel
                  </a>
                {% endif %}
              </div>
            </article>
          {% endwith %}
        {% endfor %}
      </div>
    {% else %}
      <p class="text-sm text-gray-400">
        Les r√©sultats d√©taill√©s par programme seront affich√©s ici lorsque la configuration
        des programmes sera compl√©t√©e.
      </p>
    {% endif %}
  </div>

</div>
{% endblock %}
