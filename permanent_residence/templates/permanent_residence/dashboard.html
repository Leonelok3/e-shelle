{% extends "base.html" %}
{% load static %}

{% block title %}
Cockpit R√©sidence Permanente | immigration97
{% endblock %}

{% block meta_description %}
Tableau de bord R√©sidence Permanente : score de pr√©paration, prochaines actions, suivi du plan,
strat√©gies RP personnalis√©es (Canada / Australie) avec Immigration97.
{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'css/pages/residence_permanente_nav.css' %}">
{% endblock %}

{% block content %}

{% include "permanent_residence/_rp_nav.html" %}

<div class="rp-dashboard">

  {% if not profile %}
  <!-- ===== CAS SANS PROFIL ===== -->
  <section class="rp-card rp-card--cta">
    <h1 class="rp-title">
      Commence par ton diagnostic R√©sidence Permanente.
    </h1>

    <p class="rp-text">
      Pour activer ton cockpit RP, remplis d‚Äôabord le diagnostic : pays cibl√©, √©tudes,
      exp√©rience, niveaux de langue. Tu obtiendras ensuite un plan d‚Äôaction guid√© et ce
      tableau de bord suivra ta progression.
    </p>

    <div class="rp-actions">
      <a href="{% url 'permanent_residence:eligibility' %}" class="rp-btn rp-btn--primary">
        üöÄ Lancer le diagnostic RP
      </a>
      <a href="{% url 'permanent_residence:program_list' %}" class="rp-btn rp-btn--secondary">
        üìö Voir les programmes RP
      </a>
    </div>
  </section>

  {% else %}

  <!-- ===== HERO DASHBOARD ===== -->
  <section class="rp-card rp-hero">
    <div class="rp-hero-content">
      <p class="rp-kicker">
        Cockpit R√©sidence Permanente ¬∑ {{ profile.get_country_display }}
      </p>

      <h1 class="rp-title">
        Suivi de ton projet de R√©sidence Permanente.
      </h1>

      <p class="rp-text">
        Ce tableau de bord regroupe ton score de pr√©paration, la compl√©tion de ton plan,
        ton niveau en langues et les prochaines actions √† r√©aliser.
      </p>

      <div class="rp-actions">
        <a href="{% url 'permanent_residence:plan' profile.id %}" class="rp-btn rp-btn--primary">
          üìù Ouvrir mon plan d‚Äôaction
        </a>
        <a href="{% url 'permanent_residence:eligibility' %}" class="rp-btn rp-btn--secondary">
          ‚úèÔ∏è Mettre √† jour mon diagnostic
        </a>
        <a href="{% url 'permanent_residence:coach' %}" class="rp-btn rp-btn--ai">
          ü§ñ Parler au coach IA RP
        </a>
      </div>
    </div>

    <!-- SCORE -->
    <div class="rp-score">
      <p class="rp-score-label">Score global de pr√©paration RP</p>

      <div class="rp-score-circle">
        <span>{{ readiness_score }}%</span>
      </div>

      <div class="rp-score-bars">
        <div>
          <span>Profil compl√©t√©</span>
          <strong>{{ profile_completion }}%</strong>
          <div class="rp-bar">
            <div style="width: {{ profile_completion }}%"></div>
          </div>
        </div>

        <div>
          <span>Plan d‚Äôaction</span>
          <strong>{{ plan_progress }}%</strong>
          <div class="rp-bar">
            <div style="width: {{ plan_progress }}%"></div>
          </div>
        </div>

        <div>
          <span>Score langues</span>
          <strong>{{ language_score }}/100</strong>
          <div class="rp-bar rp-bar--sky">
            <div style="width: {{ language_score }}%"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== GRILLE PRINCIPALE ===== -->
  <div class="rp-grid">

    <!-- PROCHAINES ACTIONS -->
    <section class="rp-card">
      <h2 class="rp-section-title">Prochaines actions √† r√©aliser</h2>

      {% if next_actions %}
      <ul class="rp-steps">
        {% for step in next_actions %}
        <li class="rp-step rp-step--{{ step.status }}">
          <div class="rp-step-content">
            <strong>{{ step.title }}</strong>
            {% if step.description %}
            <p>{{ step.description }}</p>
            {% endif %}
          </div>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="rp-muted">
        Les prochaines actions appara√Ætront ici une fois le plan g√©n√©r√©.
      </p>
      {% endif %}

      <a href="{% url 'permanent_residence:plan' profile.id %}" class="rp-link">
        Voir toutes les √©tapes ‚Üí
      </a>
    </section>

    <!-- STRAT√âGIES -->
    <aside class="rp-card">
      <h2 class="rp-section-title">Strat√©gies RP possibles</h2>

      {% if strategies %}
      <div class="rp-strategies">
        {% for strat in strategies %}
        <article class="rp-strategy">
          <h3>{{ strat.label }}</h3>
          {% if strat.summary %}<p>{{ strat.summary }}</p>{% endif %}
        </article>
        {% endfor %}
      </div>
      {% else %}
      <p class="rp-muted">
        Les strat√©gies RP appara√Ætront lorsque ton profil sera complet.
      </p>
      {% endif %}
    </aside>

  </div>

  {% endif %}
</div>

{% endblock %}
