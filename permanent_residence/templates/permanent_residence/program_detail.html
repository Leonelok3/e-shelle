{% extends "base.html" %}

{% block title %}
{{ program.name }} ‚Äì Programme R√©sidence Permanente | immigration97
{% endblock %}

{% block meta_description %}
{{ program.summary|default:"Fiche d√©taill√©e d‚Äôun programme de R√©sidence Permanente (Canada / Australie) : objectif, profil vis√© et liens officiels." }}
{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto py-10 px-4">

  {# ---------- HERO PROGRAMME ---------- #}
  <div class="bg-[#050d16]/95 border border-[#132336] rounded-2xl p-6 md:p-8 shadow-xl shadow-black/60 mb-8 backdrop-blur-sm">
    <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-6">
      <div class="flex-1">
        <p class="text-sm text-emerald-300 mb-1">
          Programme de R√©sidence Permanente
          ¬∑
          {% if program.country == "CA" %}üá®üá¶ Canada{% elif program.country == "AU" %}üá¶üá∫ Australie{% else %}{{ program.get_country_display }}{% endif %}
        </p>
        <h1 class="text-2xl md:text-3xl font-bold text-white mb-2">
          {{ program.name }}
        </h1>

        {% if program.short_label %}
          <p class="inline-flex items-center px-3 py-1 rounded-full bg-slate-900/90 border border-slate-600 text-[0.75rem] text-emerald-300 font-semibold mb-3">
            {{ program.short_label }}
          </p>
        {% endif %}

        {% if program.category %}
          <p class="text-[0.8rem] text-emerald-300 uppercase tracking-wide mb-2">
            {{ program.category }}
          </p>
        {% endif %}

        {% if program.summary %}
          <p class="text-sm md:text-base text-gray-300 max-w-2xl">
            {{ program.summary }}
          </p>
        {% else %}
          <p class="text-sm text-gray-300 max-w-2xl">
            Fiche d‚Äôinformation simplifi√©e pour ce programme de R√©sidence Permanente.
            R√©f√®re-toi toujours aux sites officiels pour les conditions √† jour.
          </p>
        {% endif %}
      </div>

      <div class="w-full md:w-64">
        <div class="bg-[#020814] rounded-2xl border border-[#132336] p-4 shadow-inner shadow-black/60 text-xs text-gray-300">
          <p class="text-gray-200 font-semibold mb-2">
            Bon r√©flexe : combiner fiche + diagnostic
          </p>
          <p class="mb-2">
            Utilise cette fiche pour comprendre la logique du programme, puis v√©rifie dans ton
            <strong>diagnostic RP</strong> si ton profil est align√© (points, langues, exp√©rience).
          </p>

          <div class="flex flex-col gap-2 mt-2">
            <a href="{% url 'permanent_residence:dashboard' %}"
               class="inline-flex items-center justify-center px-4 py-2 rounded-xl bg-emerald-500 hover:bg-emerald-400 text-white font-semibold text-[0.8rem] shadow-md shadow-emerald-600/40 transition">
              üìä Ouvrir mon cockpit RP
            </a>
            <a href="{% url 'permanent_residence:program_list' %}"
               class="inline-flex items-center justify-center px-4 py-2 rounded-xl border border-slate-600 bg-[#050d16] hover:bg-[#091320] text-gray-200 font-semibold text-[0.8rem] transition">
              ‚Üê Revenir √† la liste des programmes
            </a>
            {% if program.official_url %}
              <a href="{{ program.official_url }}" target="_blank" rel="noopener noreferrer"
                 class="inline-flex items-center justify-center px-4 py-2 rounded-xl border border-emerald-500/60 bg-[#041612] hover:bg-[#052018] text-emerald-200 font-semibold text-[0.8rem] shadow-sm shadow-emerald-600/30 transition">
                üîó Voir le site officiel
              </a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  {# ---------- CONTENU : STRUCTURE P√âDAGOGIQUE ---------- #}
  <div class="grid lg:grid-cols-3 gap-6">

    {# Colonne 1 & 2 : explications + sections cl√©s #}
    <section class="lg:col-span-2 space-y-6">

      {# Bloc "En r√©sum√©" #}
      <div class="bg-[#050d16]/95 border border-[#132336] rounded-2xl p-6 shadow-xl shadow-black/60 backdrop-blur-sm">
        <h2 class="text-lg font-semibold text-white mb-3">
          En r√©sum√© : √† quoi sert ce programme ?
        </h2>
        <p class="text-sm text-gray-300 mb-3">
          Utilise ce programme pour comprendre <strong>l‚Äôesprit g√©n√©ral</strong> de la voie :
          qui est vis√©, quel type de profil a le plus de chances, et comment il s‚Äôint√®gre dans une
          strat√©gie globale vers la R√©sidence Permanente.
        </p>
        <ul class="text-sm text-gray-200 space-y-1.5">
          <li>‚óè V√©rifie toujours les crit√®res officiels (points, niveaux de langue, listes de m√©tiers) sur le site du gouvernement.</li>
          <li>‚óè Garde en t√™te que les seuils peuvent changer (scores CRS, invitations, quotas, etc.).</li>
          <li>‚óè Combine ce programme avec ton plan d‚Äôaction RP et tes objectifs personnels (province, budget, d√©lais).</li>
        </ul>
      </div>

      {# Bloc ressources si dispo #}
      {% if grouped_resources %}
        <div class="bg-[#050d16]/95 border border-[#132336] rounded-2xl p-6 shadow-xl shadow-black/60 backdrop-blur-sm">
          <h2 class="text-lg font-semibold text-white mb-3">
            Ressources utiles pour ce programme
          </h2>

          <div class="space-y-5">
            {% for rtype, items in grouped_resources.items %}
              <div>
                {# Titre de section selon type #}
                <h3 class="text-sm font-semibold text-emerald-300 mb-2">
                  {% if rtype == "OFFICIAL" %}
                    Liens officiels et pages gouvernementales
                  {% elif rtype == "VIDEO" %}
                    Vid√©os explicatives
                  {% elif rtype == "SCREENSHOT" %}
                    Captures d‚Äô√©cran & visuels
                  {% elif rtype == "DOC" %}
                    Documents & PDF
                  {% elif rtype == "CHECKLIST" %}
                    Checklists & pas √† pas
                  {% elif rtype == "ARTICLE" %}
                    Articles & guides d√©taill√©s
                  {% else %}
                    Autres ressources
                  {% endif %}
                </h3>

                <div class="grid sm:grid-cols-2 gap-3">
                  {% for res in items %}
                    <article class="bg-[#040b14] border border-slate-700/80 rounded-xl p-3 text-xs text-gray-200 shadow-md shadow-black/50">
                      <div class="flex items-start justify-between gap-2 mb-1.5">
                        <p class="font-semibold text-white leading-snug">
                          {{ res.title }}
                        </p>
                        {% if rtype == "OFFICIAL" %}
                          <span class="px-2 py-0.5 rounded-full text-[0.65rem] bg-emerald-500/15 text-emerald-300 border border-emerald-500/40">
                            Officiel
                          </span>
                        {% elif rtype == "VIDEO" %}
                          <span class="px-2 py-0.5 rounded-full text-[0.65rem] bg-sky-500/15 text-sky-300 border border-sky-500/40">
                            Vid√©o
                          </span>
                        {% elif rtype == "CHECKLIST" %}
                          <span class="px-2 py-0.5 rounded-full text-[0.65rem] bg-amber-500/15 text-amber-300 border border-amber-500/40">
                            Checklist
                          </span>
                        {% elif rtype == "DOC" %}
                          <span class="px-2 py-0.5 rounded-full text-[0.65rem] bg-slate-500/15 text-slate-200 border border-slate-500/40">
                            Document
                          </span>
                        {% elif rtype == "ARTICLE" %}
                          <span class="px-2 py-0.5 rounded-full text-[0.65rem] bg-indigo-500/15 text-indigo-300 border border-indigo-500/40">
                            Article
                          </span>
                        {% endif %}
                      </div>

                      {% if res.description %}
                        <p class="text-[0.7rem] text-gray-300 mb-1.5">
                          {{ res.description }}
                        </p>
                      {% endif %}

                      {% if res.image %}
                        <div class="mb-1.5">
                          <img src="{{ res.image.url }}" alt="{{ res.title }}" class="w-full h-28 object-cover rounded-lg border border-slate-700/80">
                        </div>
                      {% endif %}

                      {% if res.embed_code %}
                        <div class="mt-1 mb-1.5">
                          {{ res.embed_code|safe }}
                        </div>
                      {% endif %}

                      <div class="flex items-center justify-between mt-1">
                        {% if res.url %}
                          <a href="{{ res.url }}" target="_blank" rel="noopener noreferrer"
                             class="text-[0.7rem] text-emerald-300 hover:text-emerald-200 underline">
                            Ouvrir la ressource ‚Üí
                          </a>
                        {% endif %}
                      </div>
                    </article>
                  {% endfor %}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      {% else %}
        <div class="bg-[#050d16]/95 border border-[#132336] rounded-2xl p-6 shadow-xl shadow-black/60 backdrop-blur-sm">
          <h2 class="text-lg font-semibold text-white mb-3">
            Ressources pour ce programme
          </h2>
          <p class="text-sm text-gray-300">
            Pas encore de ressources associ√©es dans la plateforme pour ce programme.
            Tu peux d√©j√† exploiter le site officiel et ton diagnostic RP pour construire
            ta strat√©gie.
          </p>
        </div>
      {% endif %}
    </section>

    {# Colonne 3 : encadr√© strat√©gie / conseils d‚Äôusage #}
    <aside class="space-y-4">
      <div class="bg-[#050d16]/95 border border-[#132336] rounded-2xl p-6 shadow-xl shadow-black/60 backdrop-blur-sm">
        <h2 class="text-lg font-semibold text-white mb-2">
          Comment utiliser cette fiche
        </h2>
        <p class="text-xs text-gray-300 mb-2">
          Cette page ne remplace pas un conseil juridique ou un site officiel. Elle t‚Äôaide √† :
        </p>
        <ul class="text-xs text-gray-200 space-y-1">
          <li>‚óè Rep√©rer rapidement si ce programme correspond √† ta strat√©gie (f√©d√©ral, province, sponsor, etc.).</li>
          <li>‚óè Lister les ressources cl√©s (guides, vid√©os, checklists) sans te perdre sur internet.</li>
          <li>‚óè Relier ce programme √† ton plan d‚Äôaction RP dans le cockpit Immigration97.</li>
        </ul>
      </div>

      <div class="bg-[#050d16]/95 border border-[#132336] rounded-2xl p-6 shadow-xl shadow-black/60 backdrop-blur-sm">
        <h3 class="text-sm font-semibold text-white mb-2">
          √âtapes suivantes possibles
        </h3>
        <ul class="text-xs text-gray-200 space-y-1.5">
          <li>1. Confirmer les crit√®res √† jour sur le site officiel (points, listes de m√©tiers, d√©lais).</li>
          <li>2. V√©rifier ton score potentiel avec ton diagnostic RP.</li>
          <li>3. Mettre √† jour ton plan d‚Äôaction (langues, EDE / skills assessment, documents, budget).</li>
          <li>4. Si besoin, comparer avec d‚Äôautres programmes de la m√™me cat√©gorie (PNP, visas Skilled, etc.).</li>
        </ul>
      </div>
    </aside>
  </div>

</div>
{% endblock %}
