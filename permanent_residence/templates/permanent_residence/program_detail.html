{% extends "base.html" %}

{% block title %}immigration97 Â· {{ program.name }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-slate-950 text-slate-50">
  <div class="max-w-6xl mx-auto px-4 lg:px-6 py-10 lg:py-14">

    <!-- Fil dâ€™Ariane -->
    <nav class="text-[11px] text-slate-500 mb-6 flex flex-wrap items-center gap-1">
      <a href="/" class="hover:text-slate-300">Accueil</a>
      <span>â€º</span>
      <a href="{% url 'permanent_residence:program_list' %}" class="hover:text-slate-300">Programmes RP</a>
      <span>â€º</span>
      <span class="text-slate-300">{{ program.name }}</span>
    </nav>

    <!-- Header programme -->
    <header class="mb-8">
      <p class="text-xs font-bold tracking-[0.2em] text-emerald-400/80 mb-3 uppercase">
        GUIDE PROGRAMME RP
      </p>
      <div class="flex flex-wrap items-start justify-between gap-4">
        <div>
          <h1 class="text-2xl md:text-3xl font-semibold tracking-tight mb-2">
            {{ program.name }}
          </h1>
          <div class="flex flex-wrap gap-2 items-center">
            <span class="px-2.5 py-1 rounded-full text-[11px] border border-slate-700 bg-slate-900/80 text-slate-200">
              {% if program.country == "CA" %}ðŸ‡¨ðŸ‡¦ Canada{% else %}ðŸ‡¦ðŸ‡º Australie{% endif %}
            </span>
            {% if program.category %}
              <span class="px-2.5 py-1 rounded-full text-[11px] border border-slate-700 bg-slate-900/80 text-slate-200 uppercase tracking-wide">
                {{ program.category }}
              </span>
            {% endif %}
            {% if program.short_label %}
              <span class="px-2.5 py-1 rounded-full text-[11px] border border-emerald-500/50 bg-emerald-500/10 text-emerald-100">
                {{ program.short_label }}
              </span>
            {% endif %}
          </div>
        </div>
        <div class="flex flex-col items-end gap-2">
          {% if program.official_url %}
            <a href="{{ program.official_url }}" target="_blank" rel="noopener"
               class="inline-flex items-center gap-2 text-xs text-slate-300 hover:text-emerald-200">
              <span>Consulter le site officiel</span>
              <span class="text-base">â†—</span>
            </a>
          {% endif %}
        </div>
      </div>
      {% if program.summary %}
        <p class="mt-4 text-sm text-slate-300 max-w-3xl leading-relaxed">
          {{ program.summary }}
        </p>
      {% endif %}
    </header>

    <!-- Navigation interne -->
    <div class="mb-8 border-b border-slate-800">
      <div class="flex flex-wrap gap-3 text-xs">
        <a href="#overview" class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700 text-slate-200 hover:border-emerald-500/60 hover:text-emerald-100">
          Vue dâ€™ensemble
        </a>
        <a href="#steps" class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700 text-slate-200 hover:border-emerald-500/60 hover:text-emerald-100">
          Ã‰tapes principales
        </a>
        <a href="#resources" class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700 text-slate-200 hover:border-emerald-500/60 hover:text-emerald-100">
          Ressources & guides
        </a>
      </div>
    </div>

    <!-- Vue dâ€™ensemble -->
    <section id="overview" class="mb-10">
      <div class="rounded-2xl border border-slate-800 bg-gradient-to-br from-slate-900/80 to-slate-950/90 px-4 py-4 md:px-6 md:py-6 shadow-lg shadow-slate-950/40">
        <h2 class="text-sm font-semibold text-slate-100 mb-3">Vue dâ€™ensemble</h2>
        <p class="text-xs md:text-sm text-slate-400 leading-relaxed">
          Cette fiche a pour objectif de centraliser les informations pratiques pour ce programme
          (rÃ©sumÃ©, liens officiels, vidÃ©os explicatives, captures dâ€™Ã©cran et checklists).  
          Tu pourras associer ici plus tard des vidÃ©os et captures depuis la base de donnÃ©es (modÃ¨le
          <code class="text-[11px] text-slate-300">ProgramResource</code>).
        </p>
      </div>
    </section>

    <!-- Ã‰tapes principales (placeholder text que tu pourras personnaliser par programme plus tard) -->
    <section id="steps" class="mb-10">
      <div class="rounded-2xl border border-slate-800 bg-gradient-to-br from-slate-900/80 to-slate-950/90 px-4 py-4 md:px-6 md:py-6 shadow-lg shadow-slate-950/40">
        <h2 class="text-sm font-semibold text-slate-100 mb-4">Ã‰tapes principales (Ã  adapter selon le programme)</h2>
        <ol class="space-y-2 text-xs md:text-sm text-slate-300 list-decimal list-inside">
          <li>VÃ©rifier les critÃ¨res dâ€™Ã©ligibilitÃ© sur le site officiel (Ã¢ge, Ã©tudes, expÃ©rience, langues, fonds, etc.).</li>
          <li>Faire Ã©valuer les diplÃ´mes si nÃ©cessaire (EDE pour le Canada, assessment pour lâ€™Australie).</li>
          <li>Passer les tests de langue (TEF/TCF/IELTS/PTEâ€¦) et viser les scores recommandÃ©s pour ce programme.</li>
          <li>PrÃ©parer les documents clÃ©s (passeport, casier judiciaire, preuves dâ€™expÃ©rience, relevÃ©s bancaires, etc.).</li>
          <li>CrÃ©er le profil en ligne / dÃ©poser une EOI / soumettre la demande complÃ¨te selon le programme.</li>
        </ol>
        <p class="mt-3 text-[11px] text-slate-500">
          ðŸ’¡ Tu pourras remplacer ce texte par des Ã©tapes spÃ©cifiques en fonction du programme et, plus tard,
          connecter ces Ã©tapes Ã  ton module de <strong>plan dâ€™action</strong>.
        </p>
      </div>
    </section>

    <!-- Ressources -->
    <section id="resources">
      <div class="mb-4 flex items-center justify-between gap-2">
        <h2 class="text-sm font-semibold text-slate-100">Ressources & guides associÃ©s</h2>
        <p class="text-[11px] text-slate-500">
          Ajoute des ressources dans lâ€™admin (ProgramResource) pour les afficher ici.
        </p>
      </div>

      {% if grouped_resources %}
        <div class="space-y-6">

          {% if grouped_resources.OFFICIAL %}
            <div>
              <h3 class="text-xs font-semibold text-slate-300 mb-2">Liens officiels</h3>
              <div class="space-y-2">
                {% for res in grouped_resources.OFFICIAL %}
                  <a href="{{ res.url }}" target="_blank" rel="noopener"
                     class="flex items-center justify-between gap-3 rounded-xl border border-slate-800 bg-slate-900/80 px-4 py-3 text-xs text-slate-200 hover:border-emerald-500/50 hover:text-emerald-100">
                    <span>{{ res.title }}</span>
                    <span class="text-[11px] text-slate-400">â†—</span>
                  </a>
                {% endfor %}
              </div>
            </div>
          {% endif %}

          {% if grouped_resources.VIDEO %}
            <div>
              <h3 class="text-xs font-semibold text-slate-300 mb-2">VidÃ©os explicatives</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                {% for res in grouped_resources.VIDEO %}
                  <article class="rounded-xl border border-slate-800 bg-slate-900/80 p-3 text-xs text-slate-200 flex flex-col gap-2">
                    {% if res.embed_code %}
                      <div class="aspect-video w-full overflow-hidden rounded-lg border border-slate-800 mb-2">
                        {{ res.embed_code|safe }}
                      </div>
                    {% endif %}
                    <div class="flex-1">
                      <p class="font-semibold mb-1">{{ res.title }}</p>
                      {% if res.description %}
                        <p class="text-[11px] text-slate-400">{{ res.description }}</p>
                      {% endif %}
                    </div>
                    {% if res.url %}
                      <a href="{{ res.url }}" target="_blank" rel="noopener"
                         class="inline-flex items-center gap-1 text-[11px] text-slate-300 hover:text-emerald-200">
                        Voir sur la plateforme vidÃ©o <span>â†—</span>
                      </a>
                    {% endif %}
                  </article>
                {% endfor %}
              </div>
            </div>
          {% endif %}

          {% if grouped_resources.SCREENSHOT or grouped_resources.DOC or grouped_resources.CHECKLIST or grouped_resources.ARTICLE or grouped_resources.OTHER %}
            <div>
              <h3 class="text-xs font-semibold text-slate-300 mb-2">Guides, captures & documents</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                {% for type, resources in grouped_resources.items %}
                  {% if type != "OFFICIAL" and type != "VIDEO" %}
                    {% for res in resources %}
                      <article class="rounded-xl border border-slate-800 bg-slate-900/80 p-3 text-xs text-slate-200 flex gap-3">
                        {% if res.image %}
                          <div class="w-20 h-16 flex-shrink-0 overflow-hidden rounded-lg border border-slate-800">
                            <img src="{{ res.image.url }}" alt="{{ res.title }}" class="w-full h-full object-cover">
                          </div>
                        {% endif %}
                        <div class="flex-1 flex flex-col gap-1">
                          <p class="font-semibold">{{ res.title }}</p>
                          {% if res.description %}
                            <p class="text-[11px] text-slate-400">{{ res.description }}</p>
                          {% endif %}
                          {% if res.url %}
                            <a href="{{ res.url }}" target="_blank" rel="noopener"
                               class="inline-flex items-center gap-1 text-[11px] text-slate-300 hover:text-emerald-200 mt-1">
                              Ouvrir la ressource <span>â†—</span>
                            </a>
                          {% endif %}
                        </div>
                      </article>
                    {% endfor %}
                  {% endif %}
                {% endfor %}
              </div>
            </div>
          {% endif %}

        </div>
      {% else %}
        <p class="text-sm text-slate-500">
          Aucune ressource nâ€™est encore associÃ©e Ã  ce programme.  
          Tu pourras ajouter des vidÃ©os, captures dâ€™Ã©cran, checklists et liens depuis lâ€™admin.
        </p>
      {% endif %}
    </section>
  </div>
</div>
{% endblock %}
