{% extends "base.html" %}
{% load static %}

{% block title %}Immigration97 Â· Plan d'action RP{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'css/pages/residence_permanente_nav.css' %}">
{% endblock %}

{% block content %}

<div class="rp-page-bg">
  <main class="rp-card">

    <!-- Header premium -->
    <div class="rp-header-section">
      <div class="rp-badge">ğŸ¯ Plan d'Action</div>
      <h1 class="rp-heading">
        Visa RÃ©sidence Permanente
      </h1>
      <p class="rp-subtitle">
        Voici les grandes Ã©tapes pour avancer vers ta rÃ©sidence permanente en
        {% if profile.country == "CA" %}Canada{% elif profile.country == "AU" %}Australie{% else %}Canada / Australie{% endif %}.
        Tu pourras suivre ici ton avancement et marquer les Ã©tapes terminÃ©es.
      </p>
    </div>

    <!-- Progress section -->
    <section class="rp-progress-box">
      <div class="rp-progress-label">Progression de ton projet</div>
      <div class="rp-progress-text">
        Chaque Ã©tape marquÃ©e comme "terminÃ©e" fera augmenter ton pourcentage
        d'avancement. Modifie le statut via le menu dÃ©roulant pour suivre ta progression.
      </div>

      <div class="rp-progress-bar">
        <div class="rp-progress-fill" style="width: {{ progress_pct }}%;"></div>
      </div>
      <div class="rp-progress-value">
        <strong>{{ progress_pct }}</strong> <span>% complÃ©tÃ©</span>
      </div>

      <!-- Onglets -->
      <div class="rp-tabs">
        {% with base="/pr/plan/"|add:profile.id|stringformat:"s"|add:"/" %}
          <a href="{{ base }}?category=all"
             class="rp-tab {% if category == 'all' %}rp-tab--active{% endif %}">ğŸ“‹ Toutes</a>
          <a href="{{ base }}?category=canada"
             class="rp-tab {% if category == 'canada' %}rp-tab--active{% endif %}">ğŸ‡¨ğŸ‡¦ Canada</a>
          <a href="{{ base }}?category=australia"
             class="rp-tab {% if category == 'australia' %}rp-tab--active{% endif %}">ğŸ‡¦ğŸ‡º Australie</a>
          <a href="{{ base }}?category=languages"
             class="rp-tab {% if category == 'languages' %}rp-tab--active{% endif %}">ğŸ—£ï¸ Langues</a>
          <a href="{{ base }}?category=documents"
             class="rp-tab {% if category == 'documents' %}rp-tab--active{% endif %}">ğŸ“„ Documents</a>
        {% endwith %}
      </div>
    </section>

    <!-- Steps -->
    <section>
      <h2 class="rp-steps-title">Tes Ã©tapes clÃ©s</h2>

      {% for step in steps %}
        <article class="rp-step-card status-{{ step.status }}">
          <header class="rp-step-header">
            <div>
              <div class="rp-step-meta">
                Ã‰tape {{ step.order }} Â·
                {% if step.category == "canada" %}ğŸ‡¨ğŸ‡¦ Canada
                {% elif step.category == "australia" %}ğŸ‡¦ğŸ‡º Australie
                {% elif step.category == "languages" %}ğŸ—£ï¸ Langues
                {% elif step.category == "documents" %}ğŸ“„ Documents
                {% else %}ğŸ“Œ GÃ©nÃ©ral{% endif %}
              </div>
              <h3 class="rp-step-title">{{ step.title }}</h3>
            </div>

            <div class="rp-step-actions">
              <a href="#" class="rp-step-btn">Ressources</a>

              <form method="post" class="rp-step-status-form">
                {% csrf_token %}
                <input type="hidden" name="step_id" value="{{ step.id }}">
                <select name="status" onchange="this.form.submit()">
                  <option value="todo" {% if step.status == 'todo' %}selected{% endif %}>Ã€ faire</option>
                  <option value="in_progress" {% if step.status == 'in_progress' %}selected{% endif %}>En cours</option>
                  <option value="done" {% if step.status == 'done' %}selected{% endif %}>âœ“ TerminÃ©</option>
                </select>
              </form>
            </div>
          </header>

          <p class="rp-step-desc">{{ step.description }}</p>
          <span class="rp-step-tag">{{ step.category|title }}</span>
        </article>
      {% empty %}
        <p class="rp-empty">Aucune Ã©tape n'est encore dÃ©finie pour ce profil.</p>
      {% endfor %}
    </section>

    <p class="rp-footer-hint">
      ğŸ’¡ <strong>Rappel :</strong> ce plan est une aide gÃ©nÃ©rale. VÃ©rifie toujours les exigences officielles
      avant toute soumission.
    </p>

  </main>
</div>

{% endblock %}
