{% extends "base.html" %}
{% load static %}

{% block title %}Analyse de tes comp√©tences en anglais ‚Äì Immigration97{% endblock %}

{% block meta %}
  <meta name="description" content="Analyse d√©taill√©e de tes comp√©tences en anglais (reading, grammaire, vocabulaire) apr√®s ton test sur Immigration97. Identifie tes faiblesses et relance un entra√Ænement cibl√©.">
  <meta name="keywords" content="analyse comp√©tences anglais, reading, grammaire, vocabulaire, IELTS, TOEFL, TOEIC, Immigration97">
  <meta property="og:title" content="Analyse de ton test d'anglais ‚Äì Immigration97">
  <meta property="og:description" content="D√©couvre tes points forts et faibles en anglais, comp√©tence par comp√©tence, et lance un nouvel entra√Ænement cibl√©.">
  <meta property="og:type" content="website">
{% endblock %}

{% block content %}
<div class="min-h-screen bg-slate-950 text-slate-50 relative overflow-hidden">

  {# üåà BACKGROUND PREMIUM #}
  <div class="absolute inset-0 overflow-hidden -z-10">
    <div class="absolute top-0 right-0 w-[700px] h-[700px] bg-gradient-to-br from-blue-600/16 via-transparent to-transparent rounded-full blur-3xl"></div>
    <div class="absolute -bottom-40 -left-40 w-[600px] h-[600px] bg-gradient-to-tr from-emerald-600/16 via-blue-600/8 to-transparent rounded-full blur-3xl"></div>
    <div class="absolute top-1/3 left-1/2 -translate-x-1/2 w-[480px] h-[480px] bg-gradient-to-t from-emerald-500/14 via-sky-500/10 to-transparent rounded-full blur-3xl opacity-70"></div>
  </div>

  <main class="relative z-10">
    {# TOP NAV CHIPS #}
    <section class="border-b border-slate-800/40">
      <div class="max-w-7xl mx-auto px-6 py-4 flex flex-wrap gap-3 justify-end">
        <a href="{% url 'englishprep:dashboard' %}" class="inline-flex items-center gap-2 px-4 py-1.5 text-xs rounded-full bg-slate-900/80 border border-slate-700/60 text-slate-200 shadow-sm shadow-slate-950/40 hover:bg-slate-800 transition-all">
          üè† Tableau de bord
        </a>
        <a href="{% url 'englishprep:exam_hub' %}" class="inline-flex items-center gap-2 px-4 py-1.5 text-xs rounded-full bg-slate-900/80 border border-slate-700/60 text-slate-200 shadow-sm shadow-slate-950/40 hover:bg-slate-800 transition-all">
          üåê Hub IELTS / TOEFL / TOEIC
        </a>
        <a href="{% url 'englishprep:exam_list' %}" class="inline-flex items-center gap-2 px-4 py-1.5 text-xs rounded-full bg-slate-900/80 border border-slate-700/60 text-slate-200 shadow-sm shadow-slate-950/40 hover:bg-slate-800 transition-all">
          üìö Tous les tests
        </a>
        <a href="{% url 'englishprep:test_history' %}" class="inline-flex items-center gap-2 px-4 py-1.5 text-xs rounded-full bg-slate-900/80 border border-slate-700/60 text-slate-200 shadow-sm shadow-slate-950/40 hover:bg-slate-800 transition-all">
          üìã Historique
        </a>
      </div>
    </section>

    {# HERO #}
    <section class="border-b border-slate-800/40">
      <div class="max-w-7xl mx-auto px-6 py-10 lg:py-16">
        <p class="text-[0.7rem] font-semibold tracking-[0.25em] text-blue-400 mb-3 uppercase">
          Immigration97 ¬∑ Analyse de tes comp√©tences
        </p>
        <h1 class="text-3xl md:text-4xl lg:text-5xl font-light tracking-tight mb-4">
          Analyse de tes comp√©tences ‚Äì
          <span class="bg-gradient-to-r from-blue-400 via-emerald-400 to-emerald-500 bg-clip-text text-transparent font-semibold">
            {{ session.test.name }}
          </span>
        </h1>
        <p class="text-sm md:text-base text-slate-300 max-w-2xl mb-6">
          Voici la d√©composition de ton test par comp√©tence. Utilise cette page pour comprendre exactement
          o√π progresser avant ton examen officiel (IELTS, TOEFL, TOEIC ou test g√©n√©ral).
        </p>

        <div class="flex flex-wrap gap-3 text-xs text-slate-400">
          <span class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/60">
            Score global :
            <span class="font-semibold text-emerald-400">{{ session.score|default:"0.0" }}%</span>
          </span>
          <span class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/60">
            Test : {{ session.test.exam_type }} ‚Ä¢ Niveau {{ session.test.level }}
          </span>
          <span class="px-3 py-1.5 rounded-full bg-slate-900/80 border border-slate-700/60">
            Pass√© le {{ session.started_at|date:"d/m/Y √† H:i" }}
          </span>
        </div>
      </div>
    </section>

    {# MAIN GRID #}
    <section class="py-10 lg:py-16">
      <div class="max-w-7xl mx-auto px-6 grid grid-cols-1 lg:grid-cols-3 gap-8">

        {# LEFT COLUMN : SUMMARY CARDS #}
        <div class="space-y-6 lg:col-span-1">
          {% with reading=skill_stats.READING use=skill_stats.USE_OF_ENGLISH %}

          {# Reading Card #}
          <div class="relative rounded-2xl bg-gradient-to-br from-slate-900/85 to-slate-900/95 border border-slate-700/60 p-6 backdrop-blur-xl shadow-xl shadow-black/60">
            <p class="text-xs font-bold tracking-widest text-slate-400 mb-1 uppercase">Comp√©tence</p>
            <h2 class="text-lg font-semibold text-slate-50 mb-3">Reading comprehension</h2>
            <p class="text-xs text-slate-400 mb-4">
              Compr√©hension de textes, rep√©rage d‚Äôinformations, vocabulaire dans le contexte.
            </p>

            <div class="flex items-end justify-between mb-3 gap-3">
              <div>
                <p class="text-xs text-slate-500 mb-1">Score Reading</p>
                <p class="text-3xl font-semibold text-blue-400">
                  {{ reading.pct|default:"0"|floatformat:0 }}%
                </p>
              </div>
              <p class="text-xs text-slate-400 text-right">
                {{ reading.correct }} bonnes r√©ponses<br>
                sur {{ reading.total }} questions
              </p>
            </div>

            <div class="relative h-2.5 rounded-full bg-slate-800 overflow-hidden mb-3">
              <div class="h-full rounded-full bg-gradient-to-r from-blue-500 to-emerald-400"
                   style="width: {{ reading.pct|default:'0' }}%;"></div>
            </div>

            <p class="text-xs text-slate-400">
              üí° Objectif : viser
              <span class="text-emerald-400 font-semibold">
                {{ reading.target|default:"75" }}%
              </span>
              ou plus pour √™tre √† l‚Äôaise sur les tests officiels.
            </p>
          </div>

          {# Grammar & Vocab Card #}
          <div class="relative rounded-2xl bg-gradient-to-br from-slate-900/85 to-slate-900/95 border border-slate-700/60 p-6 backdrop-blur-xl shadow-xl shadow-black/60">
            <p class="text-xs font-bold tracking-widest text-slate-400 mb-1 uppercase">Comp√©tence</p>
            <h2 class="text-lg font-semibold text-slate-50 mb-3">Grammaire & vocabulaire</h2>
            <p class="text-xs text-slate-400 mb-4">
              Structures, temps verbaux, pr√©positions, collocations, expressions fr√©quentes.
            </p>

            <div class="flex items-end justify-between mb-3 gap-3">
              <div>
                <p class="text-xs text-slate-500 mb-1">Score Grammar/Vocab</p>
                <p class="text-3xl font-semibold text-emerald-400">
                  {{ use.pct|default:"0"|floatformat:0 }}%
                </p>
              </div>
              <p class="text-xs text-slate-400 text-right">
                {{ use.correct }} bonnes r√©ponses<br>
                sur {{ use.total }} questions
              </p>
            </div>

            <div class="relative h-2.5 rounded-full bg-slate-800 overflow-hidden mb-3">
              <div class="h-full rounded-full bg-gradient-to-r from-emerald-500 to-blue-400"
                   style="width: {{ use.pct|default:'0' }}%;"></div>
            </div>

            <p class="text-xs text-slate-400">
              üí° Objectif : stabiliser la grammaire de base
              et √©largir ton vocabulaire utile pour les tests.
            </p>
          </div>
          {% endwith %}

          {# CTA : relancer entra√Ænement #}
          <div class="rounded-2xl bg-gradient-to-br from-slate-900/85 to-slate-900/95 border border-slate-700/70 p-6 backdrop-blur-xl shadow-lg shadow-black/60">
            <p class="text-xs font-bold tracking-widest text-slate-400 mb-2 uppercase">Prochaine √©tape</p>
            <p class="text-sm text-slate-200 mb-4">
              Utilise cette analyse pour relancer un entra√Ænement cibl√© :
            </p>
            <div class="flex flex-col gap-3">
              <a href="{% url 'englishprep:exam_list' %}"
                 class="inline-flex items-center justify-center gap-2 text-xs font-bold text-slate-950 px-4 py-2.5 rounded-lg bg-gradient-to-r from-blue-400 via-emerald-400 to-emerald-500 hover:from-emerald-400 hover:via-emerald-300 hover:to-blue-400 transition-all shadow-lg shadow-emerald-500/40 hover:shadow-emerald-500/60">
                üöÄ Lancer un nouvel examen
              </a>
              <a href="{% url 'englishprep:test_result' session.test.id %}"
                 class="inline-flex items-center justify-center gap-2 text-xs font-bold px-4 py-2.5 rounded-lg border border-slate-700/70 bg-slate-900/60 text-slate-300 hover:bg-slate-800/80 transition-all">
                üìä Revoir le r√©sultat du test
              </a>
            </div>
          </div>
        </div>

        {# RIGHT COLUMN : D√âTAIL PAR COMP√âTENCE #}
        <div class="lg:col-span-2 space-y-8">

          {# Tableau par comp√©tence #}
          <div class="rounded-2xl bg-slate-900/85 border border-slate-800/70 p-6 lg:p-8 backdrop-blur-xl shadow-xl shadow-black/60">
            <div class="flex items-center justify-between mb-6 gap-4">
              <div>
                <p class="text-xs font-bold tracking-widest text-slate-400 uppercase">Vision d‚Äôensemble</p>
                <h2 class="text-xl font-semibold text-slate-50 mt-1">R√©partition par comp√©tence</h2>
              </div>
              <span class="px-3 py-1.5 rounded-full text-xs bg-slate-900/80 border border-slate-700/60 text-slate-300">
                Score global :
                <span class="font-semibold text-emerald-400">{{ session.score|default:"0.0" }}%</span>
              </span>
            </div>

            <div class="space-y-5">
              {% for key, data in skill_stats.items %}
                <div class="rounded-xl bg-slate-950/90 border border-slate-800/80 p-4">
                  <div class="flex items-center justify-between gap-4 mb-2">
                    <div class="flex-1">
                      {% if key == "READING" %}
                        <p class="text-sm font-semibold text-slate-100">Reading comprehension</p>
                      {% elif key == "USE_OF_ENGLISH" %}
                        <p class="text-sm font-semibold text-slate-100">Grammaire & vocabulaire</p>
                      {% else %}
                        <p class="text-sm font-semibold text-slate-100">{{ key }}</p>
                      {% endif %}
                      <p class="text-xs text-slate-400">
                        {{ data.correct }} / {{ data.total }} bonnes r√©ponses
                      </p>
                    </div>
                    <div class="text-right">
                      <p class="text-xs text-slate-500">Score</p>
                      <p class="text-xl font-bold
                                {% if data.pct|floatformat:0 >= 75 %}
                                  text-emerald-400
                                {% elif data.pct|floatformat:0 >= 50 %}
                                  text-blue-400
                                {% else %}
                                  text-amber-400
                                {% endif %}">
                        {{ data.pct|default:"0"|floatformat:0 }}%
                      </p>
                    </div>
                  </div>
                  <div class="relative h-2.5 rounded-full bg-slate-800 overflow-hidden">
                    <div class="h-full rounded-full
                                {% if data.pct|floatformat:0 >= 75 %}
                                  bg-gradient-to-r from-emerald-500 to-emerald-300
                                {% elif data.pct|floatformat:0 >= 50 %}
                                  bg-gradient-to-r from-blue-500 to-emerald-400
                                {% else %}
                                  bg-gradient-to-r from-amber-500 to-orange-400
                                {% endif %}"
                         style="width: {{ data.pct|default:'0' }}%;"></div>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>

          {# Recommandations #}
          <div class="rounded-2xl bg-slate-900/85 border border-slate-800/70 p-6 lg:p-8 backdrop-blur-xl shadow-xl shadow-black/60">
            <p class="text-xs font-bold tracking-widest text-slate-400 mb-2 uppercase">Recommandations</p>
            <h2 class="text-xl font-semibold text-slate-50 mb-4">Comment exploiter cette analyse</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-xs text-slate-300">
              <div class="space-y-3">
                <p class="font-semibold text-slate-200">Si tes scores sont bas en Reading :</p>
                <ul class="space-y-2 text-slate-400">
                  <li>‚Ä¢ Refaire le m√™me test pour v√©rifier ta progression.</li>
                  <li>‚Ä¢ Lire les explications de chaque correction pour comprendre les pi√®ges.</li>
                  <li>‚Ä¢ T‚Äôentra√Æner √† rep√©rer les mots cl√©s dans les questions et les textes.</li>
                </ul>
              </div>
              <div class="space-y-3">
                <p class="font-semibold text-slate-200">Si tes scores sont bas en Grammaire/Vocabulaire :</p>
                <ul class="space-y-2 text-slate-400">
                  <li>‚Ä¢ Noter les structures ou mots que tu rates souvent.</li>
                  <li>‚Ä¢ Revoir les temps verbaux de base (present, past, conditionnel‚Ä¶).</li>
                  <li>‚Ä¢ Relancer un nouveau test et comparer tes r√©sultats.</li>
                </ul>
              </div>
            </div>

            <div class="mt-6 flex flex-wrap gap-3">
              <a href="{% url 'englishprep:review_incorrect' session.test.id %}"
                 class="inline-flex items-center justify-center gap-2 text-xs font-bold px-4 py-2.5 rounded-lg bg-emerald-500/15 text-emerald-300 border border-emerald-500/50 hover:bg-emerald-500/25 transition-all">
                üß† Revoir uniquement mes erreurs
              </a>
              <a href="{% url 'englishprep:take_test' session.test.id %}"
                 class="inline-flex items-center justify-center gap-2 text-xs font-bold px-4 py-2.5 rounded-lg bg-slate-900/80 text-slate-200 border border-slate-700/70 hover:bg-slate-800/80 transition-all">
                üîÅ Refaire ce test
              </a>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <style>
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(18px); }
    }
  </style>
</div>
{% endblock %}
