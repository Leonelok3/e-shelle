{% extends "base.html" %}

{% block title %}Historique des tests d'anglais ‚Äì Immigration97{% endblock %}

{% block content %}
<main class="relative min-h-screen overflow-hidden bg-slate-950 text-slate-50">

  <!-- üåà BACKGROUND -->
  <div class="pointer-events-none absolute inset-0 -z-10 overflow-hidden">
    <div class="absolute -top-40 -left-32 h-72 w-72 rounded-full bg-gradient-to-br from-blue-500/25 via-emerald-400/10 to-transparent blur-3xl opacity-60"></div>
    <div class="absolute top-1/3 -right-32 h-80 w-80 rounded-full bg-gradient-to-br from-purple-600/25 via-pink-500/10 to-transparent blur-3xl opacity-60"></div>
  </div>

  <div class="relative z-10 mx-auto max-w-7xl px-4 py-10 sm:px-6 lg:py-14">

    <!-- HEADER -->
    <header class="mb-10 border-b border-slate-800/70 pb-6">
      <p class="text-[0.7rem] font-semibold uppercase tracking-[0.22em] text-slate-400">
        Historique ‚Ä¢ Tests d‚Äôanglais
      </p>
      <h1 class="mt-3 bg-gradient-to-r from-blue-400 via-emerald-300 to-purple-400 bg-clip-text text-3xl font-light tracking-tight text-transparent sm:text-4xl">
        Ton historique de tests d‚Äôanglais
      </h1>
      <p class="mt-3 max-w-2xl text-sm text-slate-300">
        Suis ta progression, compare tes scores et ajuste ton entra√Ænement
        pour l‚Äôimmigration, les √©tudes ou ta carri√®re internationale.
      </p>

      <div class="mt-5 flex flex-wrap gap-3">
        <a href="{% url 'englishprep:test_list' %}"
           class="rounded-3xl bg-gradient-to-r from-blue-400 to-emerald-400 px-5 py-2.5 text-sm font-semibold text-slate-950">
          üöÄ Lancer un nouveau test
        </a>
        <a href="{% url 'englishprep:dashboard' %}"
           class="rounded-3xl border border-slate-700 bg-slate-900/70 px-5 py-2.5 text-sm text-slate-200">
          üè† Tableau de bord
        </a>
      </div>
    </header>

    <!-- GRID -->
    <section class="grid gap-6 lg:grid-cols-2">

      <!-- PROFIL -->
      <article class="rounded-2xl border border-slate-800/80 bg-slate-900/80 p-6 shadow-xl">
        <h2 class="text-sm font-semibold uppercase tracking-[0.18em] text-slate-400">
          R√©sum√© de ton profil
        </h2>
        <p class="mt-2 text-sm text-slate-300">
          Ton profil √©volue automatiquement √† chaque test.
        </p>

        <div class="mt-5 grid grid-cols-2 gap-4 text-sm">
          <div>
            <p class="text-xs text-slate-400">XP total</p>
            <p class="text-xl font-semibold text-emerald-300">{{ profile.xp|default:0 }}</p>
          </div>
          <div>
            <p class="text-xs text-slate-400">Niveau</p>
            <p class="text-xl font-semibold text-blue-300">{{ profile.level|default:"‚Äì" }}</p>
          </div>
          <div>
            <p class="text-xs text-slate-400">Tests pass√©s</p>
            <p class="text-lg font-semibold">{{ profile.total_tests|default:0 }}</p>
          </div>
          <div>
            <p class="text-xs text-slate-400">Meilleur score</p>
            <p class="text-lg font-semibold text-emerald-400">
              {{ profile.best_score|default:0 }} %
            </p>
          </div>
        </div>

        {% if profile.badges %}
          <div class="mt-6 border-t border-slate-800 pt-4">
            <p class="mb-2 text-xs font-semibold uppercase tracking-[0.16em] text-slate-400">
              Badges obtenus
            </p>
            <div class="flex flex-wrap gap-2">
              {% for badge in profile.badges %}
                <span class="rounded-full border border-emerald-500/40 bg-emerald-500/10 px-3 py-1 text-xs text-emerald-200">
                  üèÖ {{ badge }}
                </span>
              {% endfor %}
            </div>
          </div>
        {% endif %}
      </article>

      <!-- SESSIONS -->
      <article class="rounded-2xl border border-slate-800/80 bg-slate-900/80 p-6 shadow-xl">
        <h2 class="text-sm font-semibold uppercase tracking-[0.18em] text-slate-400">
          Derni√®res sessions
        </h2>
        <p class="mt-2 text-sm text-slate-300">
          Acc√®de au d√©tail de chaque test pass√©.
        </p>

        {% if sessions %}
          <div class="mt-4 overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="border-b border-slate-800 text-left text-xs uppercase tracking-wider text-slate-400">
                  <th class="py-2">Test</th>
                  <th>Date</th>
                  <th>Score</th>
                  <th class="text-right">Action</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-slate-800">
                {% for s in sessions %}
                  <tr class="hover:bg-slate-900/60">
                    <td class="py-3">{{ s.test.name }}</td>
                    <td>{{ s.started_at|date:"d/m/Y H:i" }}</td>
                    <td>
                      {% if s.score is not None %}
                        <span class="rounded-full bg-emerald-500/15 px-3 py-1 text-xs font-semibold text-emerald-300">
                          {{ s.score|floatformat:0 }} %
                        </span>
                      {% else %}
                        <span class="text-slate-500">‚Äì</span>
                      {% endif %}
                    </td>
                    <td class="text-right">
                      <a href="{% url 'englishprep:test_result' s.id %}"
                         class="text-sm font-medium text-blue-300 hover:text-blue-200">
                        üìÑ R√©sultat
                      </a>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="mt-4 text-sm text-slate-400">
            Aucun test pass√© pour le moment.
          </p>
        {% endif %}
      </article>

    </section>

  </div>
</main>
{% endblock %}
