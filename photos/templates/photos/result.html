{% extends "base.html" %}
{% load static %}

{% block title %}R√©sultat ‚Äî Photo Conforme Visa | Immigration97{% endblock %}
{% block meta_description %}
Aper√ßu et r√©sultat de votre photo conforme visa : cadrage, centrage du visage, fond homog√®ne et export optimis√© (DV Lottery, France, Canada, UK).
{% endblock %}

{% block body_class %}visa-photo{% endblock %}
{% block app_scope %}visa-photo{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/visa-photo.css' %}">
{% endblock %}

{% block content %}
<section class="vp-result">

  <!-- HEAD -->
  <header class="vp-rhead" aria-labelledby="vp-rtitle">
    {% if photo.photo_type == "dv_lottery" %}
      <h1 class="vp-rtitle" id="vp-rtitle">üéØ Photo conforme DV Lottery (600√ó600)</h1>
      <p class="vp-rsub">
        Aper√ßu pr√™t : cadrage carr√©, visage centr√© et export optimis√© pour d√©p√¥t en ligne.
      </p>
    {% else %}
      <h1 class="vp-rtitle" id="vp-rtitle">üì∏ Photo g√©n√©r√©e avec succ√®s</h1>
      <p class="vp-rsub">
        Aper√ßu pr√™t : cadrage, centrage du visage, fond homog√®ne et format adapt√© au type s√©lectionn√©.
      </p>
    {% endif %}

    <div class="vp-rmeta" role="list" aria-label="R√©sum√©">
      <div class="vp-pill" role="listitem">Format : JPEG</div>
      <div class="vp-pill" role="listitem">
        Taille : {{ photo.width|default:"600" }}√ó{{ photo.height|default:"600" }} px
      </div>
      <div class="vp-pill" role="listitem">Statut : Aper√ßu</div>
    </div>
  </header>

  <!-- PREVIEW -->
  <section class="vp-preview" aria-label="Comparaison avant apr√®s">
    <div class="vp-compare">
      <article class="vp-card2">
        <div class="vp-card2__t">Avant</div>
        <img class="vp-img"
             src="{{ photo.image.url }}"
             alt="Photo originale"
             loading="lazy">
      </article>

      <div class="vp-arrow" aria-hidden="true">‚Üí</div>

      <article class="vp-card2">
        <div class="vp-card2__t">Apr√®s</div>

        <div class="vp-processed">
          <img class="vp-img vp-img--processed"
               src="{% if photo.processed_image %}{{ photo.processed_image.url }}{% else %}{{ photo.image.url }}{% endif %}"
               alt="Photo trait√©e conforme"
               loading="lazy">

          {% if not has_access %}
            <div class="vp-watermark" aria-label="Aper√ßu">APER√áU</div>
          {% endif %}
        </div>

        <ul class="vp-check" aria-label="V√©rifications">
          <li>Recadrage ({{ photo.width|default:"600" }}√ó{{ photo.height|default:"600" }})</li>
          <li>Visage d√©tect√© & centr√©</li>
          <li>Fond clair & homog√®ne</li>
          <li>Export compress√© et propre</li>
        </ul>
      </article>
    </div>
  </section>

  <!-- CTA -->
  <section class="vp-cta-panel" aria-label="Actions">
    <div class="vp-cta-panel__copy">
      <h2 class="vp-cta-panel__title">Photo pr√™te</h2>
      <p class="vp-cta-panel__sub">
        T√©l√©charge la version HD sans filigrane. Si tu as d√©j√† un code, active-le en 10 secondes.
      </p>
    </div>

    {% if has_access %}
      <div class="vp-cta-panel__actions">
        <a class="c-btn c-btn--primary vp-action"
           href="{% url 'photos:download' pk=photo.pk %}">
          ‚¨áÔ∏è T√©l√©charger la photo HD
        </a>

        <a class="c-btn c-btn--outline vp-action"
           href="{% url 'photos:index' %}">
          Traiter une autre photo
        </a>

        <p class="vp-cta-panel__note">
          Acc√®s actif : t√©l√©chargement disponible sans filigrane.
        </p>
      </div>
    {% else %}
      <div class="vp-cta-panel__actions">
        <a class="c-btn c-btn--primary vp-action"
           href="{% url 'billing:buy' %}">
          üí≥ Obtenir un code d‚Äôacc√®s
        </a>

        <a class="c-btn c-btn--outline vp-action"
           href="{% url 'billing:redeem' %}?next={{ request.path|urlencode }}">
          üîë J‚Äôai d√©j√† un code
        </a>

        <a class="c-btn c-btn--ghost vp-action"
           href="{% url 'photos:index' %}">
          ‚Ü©Ô∏è Traiter une autre photo
        </a>

        <p class="vp-cta-panel__note">
          Paiement : Orange Money, MTN MoMo ou carte. Acc√®s valable 30 jours.
        </p>
      </div>
    {% endif %}
  </section>

  <!-- TECH SPECS -->
  <section class="vp-section vp-section--soft" aria-labelledby="vp-tech-title">
    <div class="vp-section__head">
      <h2 class="vp-h2" id="vp-tech-title">D√©tails techniques</h2>
      <p class="vp-sub">Informations utiles pour le d√©p√¥t (MVP).</p>
    </div>

    <div class="vp-specgrid" role="list">
      <div class="vp-spec" role="listitem">
        <div class="vp-spec__k">Taille finale</div>
        <div class="vp-spec__v">{{ photo.width|default:"600" }}√ó{{ photo.height|default:"600" }} px</div>
      </div>
      <div class="vp-spec" role="listitem">
        <div class="vp-spec__k">Format</div>
        <div class="vp-spec__v">JPEG optimis√©</div>
      </div>
      <div class="vp-spec" role="listitem">
        <div class="vp-spec__k">Fond</div>
        <div class="vp-spec__v">Clair, homog√®ne</div>
      </div>
      <div class="vp-spec" role="listitem">
        <div class="vp-spec__k">Poids</div>
        <div class="vp-spec__v">Optimis√© pour d√©p√¥t</div>
      </div>
    </div>
  </section>

  <!-- OPTIONAL: AFFILIATION (soft CTA) -->
  <section class="vp-section vp-section--seo" aria-labelledby="vp-share-title">
    <div class="vp-section__head">
      <h2 class="vp-h2" id="vp-share-title">Partager (optionnel)</h2>
      <p class="vp-sub">
        Si tu aides un proche √† pr√©parer sa photo, tu peux partager le service.
      </p>
    </div>

    <div class="vp-share">
      <p class="vp-share__text">
        Programme parrainage : cr√©dits utilisables sur photo, visa, documents.
      </p>
      <a href="#" class="c-btn c-btn--outline">ü§ù Voir le parrainage</a>
    </div>
  </section>

</section>
{% endblock %}
