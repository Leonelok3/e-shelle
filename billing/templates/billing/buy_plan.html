{% extends 'base.html' %}

{% block title %}Acheter {{ plan.name }} - Immigration97{% endblock %}

{% block extra_css %}
<style>
    .buy-container {
        max-width: 800px;
        margin: 0 auto;
    }

    .plan-summary {
        background: var(--card-bg);
        border: 2px solid var(--primary);
        border-radius: 16px;
        padding: 2rem;
        text-align: center;
        margin-bottom: 3rem;
    }

    .plan-summary h1 {
        font-size: 2rem;
        color: var(--primary);
        margin-bottom: 0.5rem;
    }

    .plan-summary .price {
        font-size: 3rem;
        font-weight: 800;
        color: var(--text-primary);
        margin: 1rem 0;
    }

    .plan-summary .price small {
        font-size: 1.2rem;
        color: var(--text-secondary);
    }

    .plan-summary .duration {
        color: var(--text-secondary);
        font-size: 1.1rem;
    }

    .payment-methods {
        display: grid;
        gap: 1.5rem;
    }

    .payment-methods h2 {
        color: var(--primary);
        margin-bottom: 1.5rem;
        text-align: center;
    }

    .payment-method {
        background: var(--card-bg);
        border: 2px solid var(--border);
        border-radius: 12px;
        padding: 2rem;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 1.5rem;
    }

    .payment-method:hover {
        border-color: var(--primary);
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(56, 189, 248, 0.2);
    }

    .payment-method input[type="radio"] {
        width: 24px;
        height: 24px;
        cursor: pointer;
    }

    .payment-info {
        flex: 1;
    }

    .payment-info h3 {
        font-size: 1.3rem;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
    }

    .payment-info p {
        color: var(--text-secondary);
        font-size: 0.95rem;
    }

    .payment-icon {
        font-size: 3rem;
    }

    .submit-section {
        margin-top: 2rem;
        text-align: center;
    }

    .btn-pay {
        width: 100%;
        max-width: 400px;
        padding: 1.2rem 2rem;
        font-size: 1.1rem;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 700;
        transition: all 0.3s;
    }

    .btn-pay:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 35px rgba(56, 189, 248, 0.4);
    }

    .btn-pay:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .security-note {
        margin-top: 2rem;
        padding: 1.5rem;
        background: rgba(34, 197, 94, 0.1);
        border: 1px solid rgba(34, 197, 94, 0.3);
        border-radius: 8px;
        text-align: center;
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .security-note strong {
        color: var(--secondary);
    }

    .back-link {
        display: inline-block;
        margin-bottom: 2rem;
        color: var(--text-secondary);
        text-decoration: none;
        transition: color 0.3s;
    }

    .back-link:hover {
        color: var(--primary);
    }
</style>
{% endblock %}

{% block content %}
<div class="buy-container">
    <a href="{% url 'billing:pricing' %}" class="back-link">‚Üê Retour aux plans</a>

    <div class="plan-summary">
        <h1>{{ plan.name }}</h1>
        <div class="price">
            ${{ plan.price_usd }}
            <small>USD</small>
        </div>
        <div class="duration">
            {{ plan.price_xaf|floatformat:0 }} FCFA ‚Ä¢ {{ plan.get_duration_display }}
        </div>
    </div>

    <form method="POST" action="{% url 'billing:initiate_payment' transaction.id %}">
        {% csrf_token %}

        <div class="payment-methods">
            <h2>Choisissez votre m√©thode de paiement</h2>

            {% if cinetpay_available %}
            <label class="payment-method">
                <input type="radio" name="payment_method" value="MOBILE_MONEY" required>
                <div class="payment-icon">üì±</div>
                <div class="payment-info">
                    <h3>Mobile Money</h3>
                    <p>MTN Mobile Money, Orange Money, et autres op√©rateurs africains</p>
                </div>
            </label>
            {% endif %}

            {% if stripe_available %}
            <label class="payment-method">
                <input type="radio" name="payment_method" value="CARD" required>
                <div class="payment-icon">üí≥</div>
                <div class="payment-info">
                    <h3>Carte Bancaire</h3>
                    <p>Visa, Mastercard, American Express (Paiement s√©curis√© par Stripe)</p>
                </div>
            </label>
            {% endif %}

            
            {% if not cinetpay_available and not stripe_available %}
<div style="background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; padding: 2rem; text-align: center;">
    <p style="color: var(--text-secondary); margin: 0.5rem 0;">
        Les syst√®mes de paiement sont en cours de configuration.
    </p>
    <p style="color: var(--text-secondary); margin: 0.5rem 0;">
        Pour le moment, utilisez un 
        <a href="{% url 'billing:redeem' %}" style="color: var(--primary); text-decoration: none; font-weight: 600;">
            code pr√©pay√©
        </a>.
    </p>
</div>
{% endif %}
        </div>

        {% if cinetpay_available or stripe_available %}
        <div class="submit-section">
            <button type="submit" class="btn-pay">
                Proc√©der au paiement üîí
            </button>
        </div>

        <div class="security-note">
            üîí <strong>Paiement 100% s√©curis√©</strong><br>
            Vos informations de paiement sont prot√©g√©es et crypt√©es
        </div>
        {% endif %}
    </form>
</div>
{% endblock %}