{% extends "base.html" %}
{% load static %}

{% block title %}G√©n√©rateur de Lettre IA | Immigration97{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/MotivationLetterApp.css' %}">
<style>
  .ml-wrap{max-width:1100px;margin:24px auto;padding:0 16px}
  .ml-panels{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  @media (max-width:900px){.ml-panels{grid-template-columns:1fr}}
  .ml-panel{background:rgba(0,0,0,.18);border:1px solid rgba(255,255,255,.12);border-radius:18px;padding:16px}
  .ml-title{font-weight:950;font-size:18px;margin:0 0 10px}
  .ml-help{color:rgba(255,255,255,.70);line-height:1.6;margin:0 0 12px}
  label{display:block;font-weight:850;margin:10px 0 6px}
  input,select,textarea{width:100%;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.14);background:rgba(0,0,0,.18);color:rgba(255,255,255,.92);outline:none}
  textarea{min-height:110px}
  .ml-actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
  .btn{border:0;border-radius:999px;padding:12px 16px;font-weight:900;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;gap:10px}
  .btn-primary{background:linear-gradient(135deg,#10b981,#059669);color:#fff;border:1px solid rgba(16,185,129,.35)}
  .btn-ghost{background:rgba(255,255,255,.03);color:rgba(255,255,255,.92);border:1px solid rgba(255,255,255,.16)}
  .ml-result{margin-top:16px}
  .ml-box{white-space:pre-wrap;background:rgba(0,0,0,.20);border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:14px;line-height:1.7}
  .ml-pill{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.14);background:rgba(0,0,0,.12);font-weight:900;font-size:12px}
</style>
{% endblock %}

{% block content %}
<div class="ml-wrap">

  <div class="ml-hero" style="margin-bottom:14px">
    <div class="ml-hero__badge">Studio Lettres IA</div>
    <h1 class="ml-hero__title">G√©n√©rateur de lettre de motivation</h1>
    <p class="ml-hero__subtitle">Choisis : remplir le formulaire OU importer ton CV (PDF/DOCX). Ensuite tu peux sauvegarder et t√©l√©charger en PDF.</p>
  </div>

  <div class="ml-panels">

    <!-- ===== PANEL 1: FORMULAIRE ===== -->
    <section class="ml-panel">
      <h2 class="ml-title">‚úçÔ∏è G√©n√©rer depuis formulaire</h2>
      <p class="ml-help">Remplis les infos essentielles. (Ta vue attend les champs du <b>FullCoverForm</b>.)</p>

      <form method="post" action="">
        {% csrf_token %}

        {{ form.non_field_errors }}

        <label for="{{ form.full_name.id_for_label }}">Nom complet</label>
        {{ form.full_name }}

        <label for="{{ form.email.id_for_label }}">Email</label>
        {{ form.email }}

        <label for="{{ form.phone.id_for_label }}">T√©l√©phone</label>
        {{ form.phone }}

        <label for="{{ form.target_role.id_for_label }}">Poste vis√©</label>
        {{ form.target_role }}

        <label for="{{ form.company.id_for_label }}">Entreprise</label>
        {{ form.company }}

        <label for="{{ form.experiences.id_for_label }}">Exp√©riences</label>
        {{ form.experiences }}

        <label for="{{ form.skills.id_for_label }}">Comp√©tences</label>
        {{ form.skills }}

        <label for="{{ form.keywords.id_for_label }}">Mots-cl√©s ATS (s√©par√©s par virgules)</label>
        {{ form.keywords }}

        <label for="{{ form.language.id_for_label }}">Langue</label>
        {{ form.language }}

        <label for="{{ form.tone.id_for_label }}">Ton</label>
        {{ form.tone }}

        <div class="ml-actions">
          <button class="btn btn-primary" type="submit" name="generate_from_form" value="1">‚ö° G√©n√©rer</button>
          <button class="btn btn-ghost" type="submit" name="save_letter" value="1">üíæ G√©n√©rer + Sauvegarder</button>
          <a class="btn btn-ghost" href="{% url 'motivation_letter:home' %}">‚¨Ö Retour</a>
        </div>
      </form>
    </section>

    <!-- ===== PANEL 2: UPLOAD CV ===== -->
    <section class="ml-panel">
      <h2 class="ml-title">üìé G√©n√©rer depuis un CV</h2>
      <p class="ml-help">Import PDF/DOCX. (Ta vue attend <b>CVUploadForm</b> et le champ <b>cv_file</b>.)</p>

      <form method="post" action="" enctype="multipart/form-data">
        {% csrf_token %}

        {{ cv_form.non_field_errors }}

        <label for="{{ cv_form.cv_file.id_for_label }}">Fichier CV</label>
        {{ cv_form.cv_file }}

        <div class="ml-actions">
          <button class="btn btn-primary" type="submit" name="generate_from_cv" value="1">‚ö° G√©n√©rer</button>
          <button class="btn btn-ghost" type="submit" name="save_letter" value="1">üíæ G√©n√©rer + Sauvegarder</button>
          <a class="btn btn-ghost" href="{% url 'motivation_letter:letter_list' %}">üìö Mes lettres</a>
        </div>
      </form>
    </section>

  </div>

  <!-- ===== RESULT ===== -->
  <div class="ml-result">
    {% if result %}
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:16px 0 10px">
        <span class="ml-pill">‚úÖ Source: {{ result.source }}</span>
        {% if result.ats %}
          <span class="ml-pill">üìä ATS: {{ result.ats.score }}%</span>
        {% endif %}
      </div>

      <div class="ml-box" id="letterBox">{{ result.letter }}</div>

      <div class="ml-actions" style="margin-top:12px">
        <!-- PDF DOWNLOAD -->
        <form method="post" action="{% url 'motivation_letter:download_pdf' %}">
          {% csrf_token %}
          <input type="hidden" name="letter" value="{{ result.letter|escape }}">
          <input type="hidden" name="filename" value="lettre_de_motivation.pdf">
          <button class="btn btn-primary" type="submit">üìÑ T√©l√©charger PDF</button>
        </form>

        <a class="btn btn-ghost" href="{% url 'motivation_letter:letter_list' %}">üìö Mes lettres</a>
      </div>
    {% endif %}
  </div>

</div>
{% endblock %}
