{% extends "base.html" %}
{% load static %}

{# ==================================================
   SCOPE STRICT APP
================================================== #}
{% block body_class %}preparation-tests{% endblock %}
{% block app_scope %}preparation-tests{% endblock %}

{# ==================================================
   SEO
================================================== #}
{% block title %}
Plan dâ€™Ã©tude {{ exam_code|upper }} â€” Progression CECR | Immigration97
{% endblock %}

{% block meta_description %}
Plan dâ€™Ã©tude personnalisÃ© {{ exam_code|upper }} :
progression quotidienne, leÃ§ons ciblÃ©es,
suivi intelligent et validation CECR avec Immigration97.
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/preparation_tests.css' %}?v=20260226">
{% endblock %}

{% block content %}

<!-- ==================================================
HERO â€” PLAN Dâ€™Ã‰TUDE
================================================== -->
<section class="pt-hero pt-hero--plan">
  <div class="container pt-fade-up">

    <span class="pt-badge">
      ğŸ“… Plan dâ€™Ã©tude personnalisÃ©
    </span>

    <h1 class="pt-title">
      Plan dâ€™Ã©tude
      <span class="pt-gradient-secondary">{{ exam_code|upper }}</span>
    </h1>

    <p class="pt-lead">
      Niveau <strong>{{ plan.level }}</strong>
      â€” Jour <strong>{{ plan.current_day }}</strong>
      sur {{ plan.total_days }}.
    </p>

    <!-- PROGRESSION -->
    <div class="pt-progress-wrapper">
      <div class="pt-progress-track">
        <div
          class="pt-progress-fill"
          style="width: {{ plan.progress_percent }}%;"
        ></div>
      </div>
      <span class="pt-progress-label">
        {{ plan.progress_percent }}%
      </span>
    </div>

  </div>
</section>

<!-- ==================================================
PLANNING JOURNALIER
================================================== -->
<section class="pt-section">
  <div class="container">

    <article class="pt-card">
      <h2>ğŸ—“ï¸ Programme jour par jour</h2>
      <p class="pt-muted">
        Suis ce planning dans lâ€™ordre recommandÃ©
        pour maximiser ta progression.
      </p>

      <div class="pt-study-grid">

        {% for day in plan.days %}
        <div
          class="pt-study-day
          {% if day.is_current %}pt-study-day--current{% endif %}
          {% if day.is_completed %}pt-study-day--done{% endif %}
          "
        >

          <div class="pt-study-header">
            Jour {{ day.day }}
          </div>

          <div class="pt-study-body">
            {% if day.lesson %}
              <strong>{{ day.section }}</strong><br>
              {{ day.lesson.title }}
            {% else %}
              <span class="pt-muted">
                RÃ©vision / repos actif
              </span>
            {% endif %}
          </div>

          {% if day.is_completed %}
            <div class="pt-study-status">
              âœ… TerminÃ©
            </div>
          {% elif day.is_current %}
            <div class="pt-study-status pt-study-status--current">
              â–¶ En cours
            </div>
          {% endif %}

        </div>
        {% endfor %}

      </div>
    </article>

  </div>
</section>

<!-- ==================================================
ACTION PRINCIPALE
================================================== -->
<section class="pt-section pt-section--cta">
  <div class="container text-center">

    {% if not plan.is_completed %}
      <a
        href="{% url 'preparation_tests:complete_study_day' exam_code %}"
        class="pt-btn-primary"
      >
        âœ… Marquer la journÃ©e comme terminÃ©e
      </a>
    {% else %}
      <div class="pt-success-box">
        ğŸ‰ Plan terminÃ© !
        Tu peux recommencer ou viser un niveau supÃ©rieur.
      </div>
    {% endif %}

  </div>
</section>

{% endblock %}
