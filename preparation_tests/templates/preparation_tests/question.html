{% extends "base.html" %}
{% load static %}

{% block title %}
Entra√Ænement {{ exam.code|upper }} {{ section.code|upper }} | Immigration97
{% endblock %}

{% block meta_description %}
Session d‚Äôentra√Ænement {{ exam.code|upper }} ‚Äì section {{ section.code|upper }} :
questions chronom√©tr√©es, QCM, expression √©crite/orale et correction intelligente.
{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'css/pages/preparation_tests.css' %}">
{% endblock %}

{% block content %}

{% if attempt.session.mode == "retry_errors" %}
<div class="retry-mode-banner">
  üéØ Mode correction cibl√©e ‚Äî tu retravailles uniquement tes erreurs.
</div>
{% endif %}

<section class="page page-language container">

  <section class="grid-main">

    <!-- =========================
         COLONNE GAUCHE ‚Äî SESSION
    ========================== -->
    <article class="card">

      <header class="session-header">
        <p class="hero-kicker">
          {{ exam.code|upper }} ‚Ä¢ Entra√Ænement ‚Äî {{ section.code|upper }}
        </p>

        <h1>
          Question {{ current_index }} / {{ total_questions }}
        </h1>

        <div class="mode-tag">
          {% if attempt.session.mode == "mock" %}
            üß™ Mode examen blanc
          {% elif attempt.session.mode == "retry_errors" %}
            üîÅ Correction cibl√©e
          {% else %}
            üéØ Entra√Ænement
          {% endif %}
        </div>

        <div class="stats-row">
          <span>Progression : <strong>{{ current_index }}</strong> / {{ total_questions }}</span>
          <span>Score : <strong>{{ attempt.raw_score|default:0 }}</strong></span>
          <span>Temps : <strong>--:--</strong></span>
        </div>
      </header>

      <!-- =========================
           QUESTION
      ========================== -->
      <section class="question-card">

        <header class="q-header">
          <div class="q-title">
            {{ section.name }}
          </div>
          <div class="q-sub">
            Temps recommand√© : {{ section.duration_sec }} s
          </div>
        </header>

        <form
          method="post"
          action="{% url 'preparation_tests:submit_answer' attempt.id question.id %}"
        >
          {% csrf_token %}

          {% if question.stem %}
            <div class="q-stem">
              {{ question.stem|linebreaksbr }}
            </div>
          {% endif %}

          {% if audio_url %}
            <div class="q-audio">
              <audio controls preload="none">
                <source src="{{ audio_url }}" type="audio/mpeg">
              </audio>
            </div>
          {% endif %}

          {% if choices %}
            <div class="choices">
              {% for choice in choices %}
                <label class="choice-label">
                  <input
                    type="radio"
                    name="choice"
                    value="{{ choice.id }}"
                    class="choice-input"
                  >
                  <span>{{ choice.text|linebreaksbr }}</span>
                </label>
              {% endfor %}
            </div>
          {% else %}
            <div class="open-text">
              <textarea
                name="text"
                placeholder="R√©dige ta r√©ponse ici‚Ä¶"
              ></textarea>
            </div>
          {% endif %}

          <footer class="card-footer">
            <button type="submit" class="btn btn--primary">
              Question suivante
            </button>

            <a
              href="{% url 'preparation_tests:exam_detail' exam.code %}"
              class="btn btn--soft"
            >
              Changer de mode
            </a>
          </footer>

        </form>

      </section>
    </article>

    <!-- =========================
         COLONNE DROITE ‚Äî CONSEILS
    ========================== -->
    <aside class="card side-card">
      <h3>Strat√©gies de r√©ussite</h3>
      <ul>
        <li>Lis toujours la consigne avant les choix.</li>
        <li>Rep√®re les mots cl√©s (dates, quantit√©s, exceptions).</li>
        <li>Ne r√©ponds jamais √† l‚Äôintuition.</li>
        <li>Relis la phrase exacte dans le texte ou l‚Äôaudio.</li>
      </ul>

      <h3>Erreurs fr√©quentes</h3>
      <ul>
        <li>Confusion ¬´ √† partir de ¬ª / ¬´ jusqu‚Äô√† ¬ª</li>
        <li>Mots pi√®ges : <em>sauf</em>, <em>uniquement</em>, <em>au moins</em></li>
        <li>R√©ponse hors contexte</li>
      </ul>
    </aside>

  </section>

</section>

{% endblock %}
