{% extends "base.html" %}
{% load static %}

{% block title %}
EntraÃ®nement {{ exam.code|upper }} {{ section.code|upper }} | Immigration97
{% endblock %}

{% block meta_description %}
Session dâ€™entraÃ®nement {{ exam.code|upper }} â€“ section {{ section.code|upper }} :
questions chronomÃ©trÃ©es, QCM, expression Ã©crite/orale et correction intelligente.
{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'css/pages/preparation_tests.css' %}">
{% endblock %}

{% block content %}

{% if attempt.session.mode == "retry_errors" %}
<div class="retry-mode-banner">
  ğŸ¯ Mode correction ciblÃ©e â€” tu retravailles uniquement tes erreurs.
</div>
{% endif %}

<section class="page page-language container">

  <section class="grid-main">

    <!-- =========================
         COLONNE GAUCHE â€” SESSION
    ========================== -->
    <article class="card">

      <header class="session-header">
        <p class="hero-kicker">
          {{ exam.code|upper }} â€¢ EntraÃ®nement â€” {{ section.code|upper }}
        </p>

        <h1>
          Question {{ current_index }} / {{ total_questions }}
        </h1>

        <div class="mode-tag">
          {% if attempt.session.mode == "mock" %}
            ğŸ§ª Mode examen blanc
          {% elif attempt.session.mode == "retry_errors" %}
            ğŸ” Correction ciblÃ©e
          {% else %}
            ğŸ¯ EntraÃ®nement
          {% endif %}
        </div>

        <div class="stats-row">
          <span>Progression : <strong>{{ current_index }}</strong> / {{ total_questions }}</span>
          <span>Score : <strong>{{ attempt.raw_score|default:0 }}</strong></span>
          <span>Temps : <strong>--:--</strong></span>
        </div>
      </header>

      <!-- =========================
           QUESTION
      ========================== -->
      <section class="question-card">

        <header class="q-header">
          <div class="q-title">
            {{ section.name }}
          </div>
          <div class="q-sub">
            Temps recommandÃ© : {{ section.duration_sec }} s
          </div>
        </header>

        <form
          method="post"
          action="{% url 'preparation_tests:submit_answer' attempt.id question.id %}"
        >
          {% csrf_token %}

          {% if question.stem %}
            <div class="q-stem">
              {{ question.stem|linebreaksbr }}
            </div>
          {% endif %}

          {% if audio_url %}
            <div class="q-audio">
              <audio controls preload="none">
                <source src="{{ audio_url }}" type="audio/mpeg">
              </audio>
            </div>
          {% endif %}

          {% if choices %}
            <div class="choices">
              {% for choice in choices %}
                <label class="choice-label">
                  <input
                    type="radio"
                    name="choice"
                    value="{{ choice.id }}"
                    class="choice-input"
                  >
                  <span>{{ choice.text|linebreaksbr }}</span>
                </label>
              {% endfor %}
            </div>
          {% else %}
            <div class="open-text">
              <textarea
                name="text"
                placeholder="RÃ©dige ta rÃ©ponse iciâ€¦"
              ></textarea>
            </div>
          {% endif %}

          <footer class="card-footer">
            <button type="submit" class="btn btn--primary">
              Question suivante
            </button>

            {% if attempt.session.exam %}
  <a href="{% url 'preparation_tests:exam_detail' attempt.session.exam.code %}">
    â† Retour Ã  lâ€™examen
  </a>
{% endif %}

          </footer>

        </form>

      </section>
    </article>

    <!-- =========================
         COLONNE DROITE â€” CONSEILS
    ========================== -->
    <aside class="card side-card">
      <h3>StratÃ©gies de rÃ©ussite</h3>
      <ul>
        <li>Lis toujours la consigne avant les choix.</li>
        <li>RepÃ¨re les mots clÃ©s (dates, quantitÃ©s, exceptions).</li>
        <li>Ne rÃ©ponds jamais Ã  lâ€™intuition.</li>
        <li>Relis la phrase exacte dans le texte ou lâ€™audio.</li>
      </ul>

      <h3>Erreurs frÃ©quentes</h3>
      <ul>
        <li>Confusion Â« Ã  partir de Â» / Â« jusquâ€™Ã  Â»</li>
        <li>Mots piÃ¨ges : <em>sauf</em>, <em>uniquement</em>, <em>au moins</em></li>
        <li>RÃ©ponse hors contexte</li>
      </ul>
    </aside>

  </section>

</section>

{% endblock %}
