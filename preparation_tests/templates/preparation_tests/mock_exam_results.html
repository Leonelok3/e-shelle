{% extends "base.html" %}
{% load static %}

{# ==================================================
   SCOPE STRICT APP
================================================== #}
{% block body_class %}preparation-tests{% endblock %}
{% block app_scope %}preparation-tests{% endblock %}

{# ==================================================
   SEO â€” TITLE & META
================================================== #}
{% block title %}
RÃ©sultats examen blanc â€“ {{ session.exam.name }} | Immigration97
{% endblock %}

{% block meta_description %}
RÃ©sultats de ton examen blanc {{ session.exam.name }} :
score, analyse et recommandations personnalisÃ©es Immigration97.
{% endblock %}

{# ==================================================
   CSS APP â€” VERSIONNÃ‰
================================================== #}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/preparation_tests.css' %}?v=20260226">
{% endblock %}

{% block content %}

<!-- ==================================================
HERO â€” RÃ‰SULTATS EXAMEN BLANC
================================================== -->
<section class="pt-hero pt-hero--result">
  <div class="container pt-fade-up">

    <span class="pt-badge pt-badge--result">
      ðŸ§ª RÃ©sultats â€” Examen blanc
    </span>

    <h1 class="pt-title">
      {{ session.exam.name }}
      {% if session.section %}
        <span class="pt-title-sub">â€” {{ session.section.code|upper }}</span>
      {% endif %}
    </h1>

    {% include "preparation_tests/partials/_cefr_bar.html" %}

    <p class="pt-lead">
      Session du {{ session.started_at|date:"d/m/Y" }}
      Ã  {{ session.started_at|time:"H:i" }}
    </p>

  </div>
</section>

<!-- ==================================================
SCORE GLOBAL
================================================== -->
<section class="pt-section">
  <div class="container">

    <article class="pt-card pt-card--score">

      <div class="pt-score-circle">
        <span>{{ score }}%</span>
      </div>

      <div class="pt-score-summary">
        <p class="pt-score-line">
          <strong>{{ correct }}</strong> bonne{{ correct|pluralize }} rÃ©ponse{{ correct|pluralize }}
          sur <strong>{{ total }}</strong>
        </p>

        <p class="pt-score-eval">
          {% if score >= 80 %}
            ðŸš€ Excellent niveau â€” prÃªt pour l'examen officiel !
          {% elif score >= 60 %}
            ðŸ’ª Bon niveau â€” quelques points Ã  consolider
          {% elif score >= 40 %}
            ðŸ“š Niveau intermÃ©diaire â€” poursuis l'entraÃ®nement
          {% else %}
            ðŸ§± Bases Ã  renforcer â€” retour aux fondamentaux conseillÃ©
          {% endif %}
        </p>

        <div class="pt-pill-row">
          <span class="pt-pill">
            Examen : {{ session.exam.name }}
          </span>
          <span class="pt-pill">
            Mode : Examen blanc
          </span>
          {% if session.section %}
          <span class="pt-pill">
            Section : {{ session.section.code|upper }}
          </span>
          {% endif %}
        </div>

      </div>

    </article>

  </div>
</section>

<!-- ==================================================
ANALYSE DETAILLÃ‰E
================================================== -->
<section class="pt-section">
  <div class="container">

    <article class="pt-card">
      <h2>ðŸ“Š DÃ©tail de la session</h2>

      <table class="pt-results-table">
        <thead>
          <tr>
            <th>MÃ©trique</th>
            <th>Valeur</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Bonnes rÃ©ponses</td>
            <td>
              <span class="pt-score-pill
                {% if score >= 80 %}is-good
                {% elif score >= 60 %}is-mid
                {% else %}is-low{% endif %}">
                {{ correct }} / {{ total }}
              </span>
            </td>
          </tr>
          <tr>
            <td>Score global</td>
            <td>
              <span class="pt-score-pill
                {% if score >= 80 %}is-good
                {% elif score >= 60 %}is-mid
                {% else %}is-low{% endif %}">
                {{ score }}%
              </span>
            </td>
          </tr>
          <tr>
            <td>Niveau CECR estimÃ©</td>
            <td>
              {% if score < 40 %}A1â€“A2
              {% elif score < 60 %}B1
              {% elif score < 80 %}B2
              {% else %}C1â€“C2{% endif %}
            </td>
          </tr>
        </tbody>
      </table>

    </article>

  </div>
</section>

<!-- ==================================================
ACTIONS UTILISATEUR
================================================== -->
<section class="pt-section pt-section--cta">
  <div class="container text-center">

    <div class="pt-cta-group">

      <a
        href="{% url "preparation_tests:session_result" session.id %}"
        class="pt-btn-primary"
      >
        ðŸ“‹ Analyse complÃ¨te
      </a>

      {% if session.section %}
      <a
        href="{% url "preparation_tests:start_mock_exam" session.exam.code session.section.code %}"
        class="pt-btn-secondary"
      >
        ðŸ”„ Recommencer
      </a>
      {% endif %}

      <a
        href="{% url "preparation_tests:dashboard_global" %}"
        class="pt-btn-ghost"
      >
        ðŸ“Š Mon tableau de bord
      </a>

    </div>

  </div>
</section>

{% endblock %}
