{% extends "base.html" %}
{% load static %}

{% block body_class %}preparation-tests{% endblock %}
{% block app_scope %}preparation-tests{% endblock %}

{% block title %}
Examen blanc {{ cfg.name }} ‚Äî Choisir le niveau | Immigration97
{% endblock %}

{% block meta_description %}
Examen blanc format officiel {{ cfg.name }} : timing r√©el, score officiel et correction IA.
S√©lectionne ton niveau CECR et commence la simulation.
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/preparation_tests.css' %}?v=20260301">
{% endblock %}

{% block content %}

<!-- HERO -->
<section class="pt-hero">
  <div class="container pt-fade-up">

    <span class="pt-badge">
      {{ cfg.badge }}
    </span>

    <h1 class="pt-title">
      Examen blanc <span class="pt-gradient-primary">{{ cfg.name }}</span>
    </h1>

    <p class="pt-lead">
      Simule les <strong>conditions r√©elles</strong> de l'examen avec
      le format officiel, le timing pr√©cis et un score calcul√© selon les bar√®mes authentiques.
    </p>

    <div class="pt-badges" role="list" aria-label="Avantages">
      <span class="pt-badge pt-badge--soft" role="listitem">‚è± Timing officiel</span>
      <span class="pt-badge pt-badge--soft" role="listitem">üìä Score {{ cfg.name }}</span>
      <span class="pt-badge pt-badge--soft" role="listitem">ü§ñ Correction IA (EE/EO)</span>
    </div>

  </div>
</section>

<!-- S√âLECTION DU NIVEAU -->
<section class="pt-section">
  <div class="container">

    {% if not has_premium and not has_temp_access %}
    <div style="
      background:rgba(245,158,11,.1);
      border:1px solid #f59e0b;
      border-radius:8px;
      padding:.9rem 1.25rem;
      margin-bottom:1.25rem;
      font-size:.92rem;
    ">
      üîí Les examens blancs format officiel sont r√©serv√©s aux abonn√©s Premium.
      <a href="{% url 'billing:access' %}"
         style="color:#f59e0b; font-weight:600; margin-left:.5rem;">
        ‚Üí Activer mon acc√®s Premium
      </a>
    </div>
    {% endif %}

    <div class="pt-grid-layout">

      <!-- MAIN -->
      <div class="pt-main">

        <article class="pt-card">
          <h2>Choisir le niveau</h2>
          <p class="pt-card-meta" style="margin-bottom:1.5rem;">
            {{ cfg.note }}
          </p>

          <div class="pt-level-grid" style="margin-top:1rem;">
            {% for ld in levels_data %}
            <div class="pt-level-card{% if not ld.can_start %}" style="opacity:.55{% endif %}">
              <span class="pt-level-badge pt-level-{{ ld.level|lower }}">{{ ld.level }}</span>

              <div style="margin:.5rem 0; font-size:.82rem; color:rgba(255,255,255,.6);">
                üéß {{ ld.co_exercises }} ex. CO &nbsp;¬∑&nbsp; üìñ {{ ld.ce_exercises }} ex. CE
              </div>

              {% if ld.can_start %}
                {% if has_premium or has_temp_access %}
                <a
                  href="{% url "preparation_tests:exam_format_exam" exam_code ld.level %}"
                  class="pt-btn-primary"
                  style="font-size:.85rem; margin-top:.5rem;"
                  aria-label="D√©marrer l'examen blanc {{ cfg.name }} niveau {{ ld.level }}"
                >
                  ‚ñ∂ D√©marrer {{ ld.level }}
                </a>
                {% else %}
                <a
                  href="{% url 'billing:access' %}?next={% url 'preparation_tests:exam_format_exam' exam_code ld.level %}"
                  class="pt-btn-primary"
                  style="font-size:.85rem; margin-top:.5rem;"
                  aria-label="Acc√®s Premium requis pour {{ cfg.name }} niveau {{ ld.level }}"
                >
                  üîí Premium ‚Äî {{ ld.level }}
                </a>
                {% endif %}
              {% else %}
                <span
                  class="pt-btn-ghost"
                  style="font-size:.82rem; cursor:not-allowed; opacity:.5; margin-top:.5rem; display:inline-block;"
                >
                  ‚è≥ Contenu en pr√©paration
                </span>
              {% endif %}
            </div>
            {% empty %}
            <p class="pt-empty">Aucun niveau configur√© pour cet examen.</p>
            {% endfor %}
          </div>
        </article>

        <!-- LIENS RETOUR -->
        <div class="pt-cta-group" style="margin-top:1rem;">
          <a href="{% url "preparation_tests:level_mock_hub" %}" class="pt-btn-ghost">
            üìã Examen blanc par niveau CECR
          </a>
          <a href="{% url "preparation_tests:dashboard_global" %}" class="pt-btn-secondary">
            üìä Ma progression
          </a>
        </div>

      </div>

      <!-- SIDEBAR -->
      <aside class="pt-side">

        <div class="pt-card pt-card--side">
          <h3>Format {{ cfg.name }}</h3>
          <p class="pt-card-meta" style="font-size:.88rem;">{{ cfg.note }}</p>
        </div>

        {% if exam_code == "tef" %}
        <div class="pt-card pt-card--side" style="margin-top:1rem;">
          <h3>Bar√®me TEF (0‚Äì450)</h3>
          <ul class="pt-side-list">
            <li>A1 : 0 ‚Äì 180</li>
            <li>A2 : 181 ‚Äì 241</li>
            <li>B1 : 242 ‚Äì 303</li>
            <li>B2 : 304 ‚Äì 365</li>
            <li>C1 : 366 ‚Äì 416</li>
            <li>C2 : 417 ‚Äì 450</li>
          </ul>
        </div>

        {% elif exam_code == "tcf" %}
        <div class="pt-card pt-card--side" style="margin-top:1rem;">
          <h3>Bar√®me TCF (0‚Äì699)</h3>
          <ul class="pt-side-list">
            <li>A1 : 0 ‚Äì 225</li>
            <li>A2 : 226 ‚Äì 299</li>
            <li>B1 : 300 ‚Äì 399</li>
            <li>B2 : 400 ‚Äì 499</li>
            <li>C1 : 500 ‚Äì 588</li>
            <li>C2 : 589 ‚Äì 699</li>
          </ul>
        </div>

        {% elif exam_code == "delf" or exam_code == "dalf" %}
        <div class="pt-card pt-card--side" style="margin-top:1rem;">
          <h3>Bar√®me {{ cfg.name }}</h3>
          <ul class="pt-side-list">
            <li>4 √©preuves √ó 25 pts</li>
            <li>Total : 100 pts</li>
            <li>Seuil : 50/100 global</li>
            <li>Min. 5/25 par √©preuve</li>
          </ul>
          <p class="pt-card-meta" style="font-size:.82rem; margin-top:.5rem;">
            CO + CE auto-not√©s. EE + EO √©valu√©s par IA.
          </p>
        </div>
        {% endif %}

        <div class="pt-card pt-card--side" style="margin-top:1rem;">
          <h3>Conseils</h3>
          <ul class="pt-side-list">
            <li>Pr√©pare-toi dans un endroit calme</li>
            <li>Respecte le temps imparti</li>
            <li>Ne consulte pas tes notes</li>
            <li>Parle √† voix haute pour l'EO</li>
          </ul>
        </div>

      </aside>

    </div>
  </div>
</section>

{% endblock %}
