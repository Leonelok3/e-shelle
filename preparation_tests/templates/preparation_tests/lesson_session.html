{% extends "base.html" %}
{% load static %}

{# ==================================================
   SCOPE STRICT APP
================================================== #}
{% block body_class %}preparation-tests{% endblock %}
{% block app_scope %}preparation-tests{% endblock %}

{# ==================================================
   SEO ‚Äî TITLE & META
================================================== #}
{% block title %}
{{ lesson.title }} ‚Äì {{ lesson.exam.code|upper }} {{ section|upper }} | Immigration97
{% endblock %}

{% block meta_description %}
Le√ßon {{ section|upper }} ‚Äì {{ lesson.exam.code|upper }} niveau {{ lesson.level }} :
audio, questions corrig√©es et entra√Ænement progressif CECR
avec Immigration97.
{% endblock %}

{# ==================================================
   CSS APP ‚Äî VERSIONN√â
================================================== #}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/preparation_tests.css' %}?v=20260104">
{% endblock %}

{% block content %}

<!-- ==================================================
HERO ‚Äî LE√áON
================================================== -->
<section class="pt-hero pt-hero--lesson">
  <div class="container pt-fade-up">

    <span class="pt-badge">
      {{ lesson.exam.code|upper }} ¬∑ {{ section|upper }} ¬∑ Niveau {{ lesson.level }}
    </span>

    <h1 class="pt-title">
      {{ lesson.title }}
    </h1>

    {% include "preparation_tests/partials/_cefr_bar.html" %}

    <p class="pt-lead">
      Entra√Ænement guid√© avec <strong>audio</strong>,
      <strong>questions interactives</strong> et
      <strong>correction imm√©diate</strong>.
    </p>

  </div>
</section>

<!-- ==================================================
NAVIGATION PARCOURS
================================================== -->
<section class="pt-section pt-section--nav">
  <div class="container">
    {% include "preparation_tests/partials/_prep_nav.html" %}
  </div>
</section>

<!-- ==================================================
CONTENU DE LA LE√áON (TEXTE UNIQUEMENT)
================================================== -->
<section class="pt-section">
  <div class="container">

    <div class="pt-grid-layout">

      <!-- ================= MAIN ================= -->
      <div class="pt-main">

        <article class="pt-card pt-card--lesson-content">
          {{ lesson.content_html|safe }}
        </article>

      </div>

      <!-- ================= SIDEBAR ================= -->
      <aside class="pt-side">

        <div class="pt-card pt-card--side">
          <h3>üéØ Objectif p√©dagogique</h3>
          <ul class="pt-side-list">
            <li>Comprendre les consignes</li>
            <li>Identifier les informations cl√©s</li>
            <li>R√©pondre efficacement sous contrainte de temps</li>
          </ul>
        </div>

      </aside>

    </div>

  </div>
</section>

<!-- ==================================================
EXERCICES (AUDIO + QCM)
================================================== -->
<section class="pt-section pt-section--exercises">
  <div class="container">

    <h2 class="pt-section-title text-center">
      üéß Exercices d‚Äôapplication
    </h2>

    <div class="pt-exercises-grid">

      {% for exercise in exercises %}
      <article class="pt-card pt-card--exercise">

        <header class="pt-exercise-header">
          <h3>Exercice {{ forloop.counter }}</h3>

          {% if exercise.instruction %}
            <p class="pt-exercise-instruction">
              {{ exercise.instruction }}
            </p>
          {% endif %}
        </header>

        <!-- AUDIO (EXERCICES UNIQUEMENT) -->
        {% if exercise.audio and exercise.audio.file %}
        <div class="pt-audio-box">
          <audio controls preload="metadata">
            <source src="{{ exercise.audio.file.url }}" type="audio/mpeg">
            Votre navigateur ne supporte pas l‚Äôaudio.
          </audio>
        </div>
        {% else %}
        <div class="pt-audio-box pt-audio-box--missing">
          ‚ö†Ô∏è Aucun audio disponible pour cet exercice
        </div>
        {% endif %}

        <!-- QUESTION -->
        <p class="pt-exercise-question">
          {{ exercise.question_text }}
        </p>

        <!-- FORMULAIRE -->
        <form
          class="pt-exercise-form"
          data-correct="{{ exercise.correct_option }}"
          data-exercise-id="{{ exercise.id }}"
        >

          {% if exercise.option_a %}
          <label class="pt-option">
            <input type="radio" name="q{{ exercise.id }}" value="A">
            <span>A.</span> {{ exercise.option_a }}
          </label>
          {% endif %}

          {% if exercise.option_b %}
          <label class="pt-option">
            <input type="radio" name="q{{ exercise.id }}" value="B">
            <span>B.</span> {{ exercise.option_b }}
          </label>
          {% endif %}

          {% if exercise.option_c %}
          <label class="pt-option">
            <input type="radio" name="q{{ exercise.id }}" value="C">
            <span>C.</span> {{ exercise.option_c }}
          </label>
          {% endif %}

          {% if exercise.option_d %}
          <label class="pt-option">
            <input type="radio" name="q{{ exercise.id }}" value="D">
            <span>D.</span> {{ exercise.option_d }}
          </label>
          {% endif %}

          <div class="pt-cta-group">
            <button type="button" class="pt-btn-primary pt-check-answer">
              V√©rifier la r√©ponse
            </button>
          </div>

          <p class="pt-feedback" hidden></p>

        </form>

      </article>
      {% empty %}
        <p class="pt-empty text-center">
          Aucun exercice disponible pour cette le√ßon.
        </p>
      {% endfor %}

    </div>

  </div>
</section>

{% endblock %}

{% block body_end %}
<script src="{% static 'js/preparation_tests.js' %}" defer></script>
{% endblock %}
