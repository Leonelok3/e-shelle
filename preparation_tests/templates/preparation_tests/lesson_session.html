{% extends "base.html" %}
{% load static %}

{% block title %}
{{ lesson.title }} ‚Äì {{ lesson.exam.code|upper }} {{ section|upper }}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/tef_co_session.css' %}">
{% endblock %}

{% block content %}
<main class="lesson-session">

  <!-- ========================= -->
  <!-- üéì HERO LE√áON -->
  <!-- ========================= -->
  <section class="lesson-hero">
    <h1 class="lesson-title">{{ lesson.title }}</h1>
    {% include "preparation_tests/partials/_cefr_bar.html" %}

    <p class="lesson-meta">
      Examen : {{ lesson.exam.code|upper }} ‚Ä¢
      Section : {{ section|upper }} ‚Ä¢
      Niveau : {{ lesson.level }}
    </p>
  </section>

  <!-- ========================= -->
  <!-- üß≠ NAVIGATION PARCOURS -->
  <!-- ========================= -->
  {% include "preparation_tests/partials/_prep_nav.html" %}

  <!-- ========================= -->
  <!-- üìò CONTENU DE LA LE√áON -->
  <!-- ========================= -->
  <section class="lesson-body">
    {{ lesson.content_html|safe }}
  </section>

  <div class="lesson-divider"></div>

  <!-- ========================= -->
  <!-- üéß EXERCICES -->
  <!-- ========================= -->
  <section class="lesson-exercises">
    <h2 class="exercises-title">üéß Exercices d'application</h2>

    {% for exercise in exercises %}
      <article class="exercise-card">

        <header class="exercise-header">
          <h3>Exercice {{ forloop.counter }}</h3>

          {% if exercise.instruction %}
            <p class="exercise-instruction">
              {{ exercise.instruction }}
            </p>
          {% endif %}
        </header>

        <!-- üîä AUDIO -->
        {% if exercise.audio and exercise.audio.file %}
          <div class="audio-box">
            <p class="audio-label">üéß √âcoutez attentivement l'audio</p>

            <audio controls preload="metadata">
              <source src="{{ exercise.audio.file.url }}" type="audio/mpeg">
              <source src="{{ exercise.audio.file.url }}" type="audio/mp3">
              Votre navigateur ne supporte pas l'audio.
            </audio>
          </div>
        {% else %}
          <div class="audio-box audio-box--missing">
            ‚ö†Ô∏è Aucun audio disponible pour cet exercice
          </div>
        {% endif %}

        <!-- ‚ùì QUESTION -->
        <p class="exercise-question">
          {{ exercise.question_text }}
        </p>

        <!-- ‚úÖ FORMULAIRE -->
        <form class="exercise-form" data-correct="{{ exercise.correct_option }}" data-exercise-id="{{ exercise.id }}">

          {% if exercise.option_a %}
          <label class="option">
            <input type="radio" name="q{{ exercise.id }}" value="A">
            <span class="option-letter">A.</span> 
            <span class="option-text">{{ exercise.option_a }}</span>
          </label>
          {% endif %}

          {% if exercise.option_b %}
          <label class="option">
            <input type="radio" name="q{{ exercise.id }}" value="B">
            <span class="option-letter">B.</span> 
            <span class="option-text">{{ exercise.option_b }}</span>
          </label>
          {% endif %}

          {% if exercise.option_c %}
          <label class="option">
            <input type="radio" name="q{{ exercise.id }}" value="C">
            <span class="option-letter">C.</span> 
            <span class="option-text">{{ exercise.option_c }}</span>
          </label>
          {% endif %}

          {% if exercise.option_d %}
          <label class="option">
            <input type="radio" name="q{{ exercise.id }}" value="D">
            <span class="option-letter">D.</span> 
            <span class="option-text">{{ exercise.option_d }}</span>
          </label>
          {% endif %}

          <button type="button" class="btn-check">
            V√©rifier la r√©ponse
          </button>

          <p class="feedback" style="display:none;"></p>
        </form>

      </article>
    {% empty %}
      <p class="no-exercises">Aucun exercice disponible pour cette le√ßon.</p>
    {% endfor %}
  </section>

</main>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/tef_co_session.js' %}"></script>
{% endblock %}