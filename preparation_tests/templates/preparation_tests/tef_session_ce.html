{% extends "base.html" %}
{% load static %}

{% block title %}
Session CE – TEF | Immigration97
{% endblock %}

{% block meta_description %}
Session d’entraînement TEF – Compréhension écrite (CE) avec QCM corrigé,
mode examen chronométré et analyse détaillée.
{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'css/pages/tef_ce_session.css' %}">
{% endblock %}

{% block content %}

<section class="page page-session-ce">

  <!-- ================= HEADER SESSION ================= -->
  <section class="session-header">
    <div class="session-label">TEF • SESSION D’ENTRAÎNEMENT — COMPRÉHENSION ÉCRITE</div>

    <h1 class="session-title">
      Session CE — <span>{{ lesson.title }}</span>
    </h1>

    <p class="session-sub">
      Entraîne ta lecture rapide et précise.
      Objectif : <strong>repérer les informations exactes</strong>
      et éviter les pièges classiques du TEF.
    </p>

    <div class="session-meta-row">
      <span class="chip">Leçon TEF • CE</span>
      <span class="chip">{{ total_exercises }} exercice(s)</span>

      <span class="chip" id="mode-pill">
        Mode : <strong id="mode-label">Entraînement</strong>
      </span>

      <button id="toggle-exam" class="btn btn-ghost btn-sm">
        ⏱ Activer le mode examen (15 min)
      </button>
    </div>
  </section>

  <!-- ================= GRID ================= -->
  <section class="session-grid">

    <!-- ===== QUESTIONS ===== -->
    <article class="card question-panel">

      <div class="question-header-row">
        <div>
          <div class="muted small">Compréhension écrite</div>
          <div class="question-intro">
            Lis le texte puis choisis la bonne réponse.
          </div>
        </div>

        <div class="question-kpis">
          <div class="kpi-pill">
            Question <span id="q-index">0</span> / {{ total_exercises }}
          </div>
          <div class="kpi-pill">
            ✅ <span id="good-count">0</span> |
            ❌ <span id="bad-count">0</span>
          </div>
          <div class="kpi-pill">
            <span id="timer-prefix">Temps :</span>
            <span id="timer">00:00</span>
          </div>
        </div>
      </div>

      <!-- Consigne -->
      <div class="question-consigne">
        <div class="consigne-label">Consigne</div>
        <div id="instruction">Chargement…</div>
      </div>

      <!-- Texte -->
      <div id="text" class="question-text"></div>

      <!-- Question -->
      <div id="question" class="question-title"></div>

      <!-- Options -->
      <div id="options" class="options-list"></div>

      <!-- Explication -->
      <div id="explanation" class="explanation hidden">
        <div class="explanation-title">Analyse de la réponse</div>
        <div id="explanation-body"></div>
      </div>

      <!-- Actions -->
      <div class="question-actions">
        <button id="next-btn" class="btn btn-primary">
          Question suivante
        </button>
        <button id="restart-btn" class="btn btn-ghost">
          ↻ Recommencer
        </button>
      </div>

      <div class="session-score muted small">
        Score : <strong id="score-bottom">0</strong> / {{ total_exercises }}
        • Répondu : <span id="answered-count">0</span>
      </div>

    </article>

    <!-- ===== CONSEILS ===== -->
    <aside class="session-side">

      <div class="side-card">
        <div class="side-title">Stratégies CE</div>
        <ul>
          <li>Lis d’abord la question avant le texte.</li>
          <li>Repère mots-clés, dates et montants.</li>
          <li>Attention aux mots pièges : <em>sauf, uniquement, cependant</em>.</li>
          <li>Vérifie toujours le passage exact.</li>
        </ul>
      </div>

      <div class="side-card">
        <div class="side-title">Erreurs fréquentes</div>
        <ul>
          <li>Répondre avec ses connaissances personnelles.</li>
          <li>Choisir une réponse trop vague.</li>
          <li>Ignorer un détail précis du texte.</li>
        </ul>
      </div>

    </aside>

  </section>

  <div class="footer-note">
    E-SHELLE • Préparation tests de langue — Discipline + méthode = score élevé.
  </div>

</section>

{% endblock %}

{% block scripts_extra %}
<script>
  const EXERCISES = JSON.parse('{{ exercises_json|escapejs }}');
  const TOTAL_EXERCISES = {{ total_exercises }};
</script>
<script src="{% static 'js/tef_ce_session.js' %}"></script>
{% endblock %}
