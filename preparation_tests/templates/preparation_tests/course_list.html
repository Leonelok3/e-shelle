{% extends "base.html" %}
{% load static %}

{% block title %}
Parcours {{ exam_code|upper }} â€“ {{ section|upper }} | Immigration97
{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'css/pages/preparation_tests.css' %}">
{% endblock %}

{% block content %}

<section class="page page-language">

  <!-- =========================
        EN-TÃŠTE DU PARCOURS
  ========================== -->
  <header class="page-title">
    <h1>
      Parcours {{ exam_code|upper }} â€“ {{ section|upper }}
    </h1>
    {% include "preparation_tests/partials/_cefr_bar.html" %}


    <p class="page-subtitle">
      Tous les cours sont accessibles ðŸš€  
      Suis lâ€™ordre recommandÃ© pour progresser plus vite
      et dÃ©bloquer tes certificats CECRL.
    </p>
  </header>

  <!-- =========================
        INFO UTILISATEUR (UX)
  ========================== -->
  <div class="info-box">
    ðŸ’¡ <strong>Conseil :</strong>
    Tu peux suivre toutes les leÃ§ons librement.
    Les niveaux, badges et certificats sont dÃ©bloquÃ©s
    uniquement via les tests blancs.
  </div>

  <!-- =========================
        LISTE DES LEÃ‡ONS
  ========================== -->
  <section class="lesson-section">
    <h2 class="section-title">
      ðŸ“˜ LeÃ§ons du parcours
    </h2>

    {% if accessible_lessons or locked_lessons %}
    <div class="lesson-grid">

      {% for lesson in accessible_lessons|default_if_none:locked_lessons %}
      <div class="lesson-card">

        <!-- ===== HEADER ===== -->
        <div class="lesson-header">
          <h3 class="lesson-title">
            {{ lesson.title }}
            <span class="lesson-level">
              Niveau {{ lesson.level }}
            </span>
          </h3>

          <!-- BADGE CECRL (VISUEL UNIQUEMENT) -->
          {% if lesson.level > request.user.profile.level %}
            <span class="badge badge-warning">
              ðŸ”’ Niveau recommandÃ© plus tard
            </span>
          {% else %}
            <span class="badge badge-success">
              âœ… Niveau recommandÃ©
            </span>
          {% endif %}
        </div>

        <!-- ===== DESCRIPTION ===== -->
        <p class="lesson-description">
          EntraÃ®nement ciblÃ© pour amÃ©liorer ta compÃ©tence
          <strong>{{ section|upper }}</strong>
          au niveau <strong>{{ lesson.level }}</strong>.
        </p>

        <!-- ===== PROGRESSION (SI DISPONIBLE) ===== -->
        {% if lesson.progress %}
          <div class="progress-bar">
            <div class="progress-fill"
                 style="width: {{ lesson.progress.percent }}%;">
            </div>
          </div>

          <div class="progress-text">
            Progression : {{ lesson.progress.percent }}%
            {% if lesson.progress.is_completed %}
              âœ” LeÃ§on terminÃ©e
            {% endif %}
          </div>
        {% else %}
          <div class="progress-text muted">
            Progression non commencÃ©e
          </div>
        {% endif %}

        <!-- ===== ACTION ===== -->
        <div class="lesson-actions">
          <a href="{% url 'preparation_tests:lesson_session_'|add:section lesson.id %}"
             class="btn btn-primary">
            Commencer la leÃ§on â†’
          </a>
        </div>

      </div>
      {% endfor %}

    </div>
    {% else %}
      <p class="empty-message">
        Aucune leÃ§on disponible pour le moment.
      </p>
    {% endif %}
  </section>

  <!-- =========================
        CONSEIL FINAL
  ========================== -->
  <section class="course-tip">
    <h3>ðŸŽ¯ Comment progresser efficacement ?</h3>
    <ul>
      <li>Commence par les niveaux proches de ton niveau actuel</li>
      <li>Refais les exercices jusquâ€™Ã  â‰¥ <strong>70%</strong></li>
      <li>Passe un test blanc pour valider ton niveau CECRL</li>
      <li>DÃ©bloque automatiquement badges et certificats ðŸŽ“</li>
    </ul>
  </section>

</section>

{% endblock %}
