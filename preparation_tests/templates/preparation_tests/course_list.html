{% extends "base.html" %}
{% load static %}

{# ==================================================
   SCOPE STRICT APP
================================================== #}
{% block body_class %}preparation-tests{% endblock %}
{% block app_scope %}preparation-tests{% endblock %}

{# ==================================================
   SEO â€” TITLE & META
================================================== #}
{% block title %}
Parcours {{ exam_code|upper }} â€“ {{ section|upper }} | Immigration97
{% endblock %}

{% block meta_description %}
Parcours complet {{ exam_code|upper }} â€“ {{ section|upper }}.
LeÃ§ons CECR, progression guidÃ©e et prÃ©paration aux tests blancs
pour rÃ©ussir les examens officiels avec Immigration97.
{% endblock %}

{# ==================================================
   CSS APP â€” VERSIONNÃ‰
================================================== #}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/preparation_tests.css' %}?v=20260226">
{% endblock %}

{% block content %}

<!-- ==================================================
HERO â€” PARCOURS {{ exam_code|upper }} / {{ section|upper }}
================================================== -->
<section class="pt-hero">
  <div class="container pt-fade-up">

    <span class="pt-badge">
      {{ exam_code|upper }} Â· {{ section|upper }}
    </span>

    <h1 class="pt-title">
      Parcours {{ exam_code|upper }}<br>
      <span class="pt-gradient-primary">{{ section|upper }}</span>
    </h1>

    <p class="pt-lead">
      AccÃ¨de Ã  toutes les <strong>leÃ§ons du parcours</strong>
      {{ exam_code|upper }} â€“ {{ section|upper }}.
      Suis lâ€™ordre recommandÃ© pour progresser efficacement
      et dÃ©bloquer tes <strong>badges et certificats CECR</strong>.
    </p>

    {% include "preparation_tests/partials/_cefr_bar.html" %}

  </div>
</section>

<!-- ==================================================
INFO UTILISATEUR
================================================== -->
<section class="pt-section">
  <div class="container">

    <div class="pt-card pt-card--info">
      ðŸ’¡ <strong>Conseil :</strong>
      Tu peux suivre toutes les leÃ§ons librement.
      Les <strong>niveaux, badges et certificats</strong>
      sont validÃ©s uniquement via les tests blancs officiels.
    </div>

  </div>
</section>

<!-- ==================================================
LEÃ‡ONS DU PARCOURS
================================================== -->
<section class="pt-section">
  <div class="container">

    <div class="pt-grid-layout">

      <!-- ================= MAIN ================= -->
      <div class="pt-main">

        <h2 class="pt-section-title">
          ðŸ“˜ LeÃ§ons du parcours
        </h2>

        {% if accessible_lessons or locked_lessons %}
        <div class="pt-modules-grid">

          {% for lesson in accessible_lessons|default_if_none:locked_lessons %}
          <article class="pt-card pt-card--lesson">

            <!-- HEADER -->
            <div class="pt-lesson-header">
              <h3 class="pt-lesson-title">
                {{ lesson.title }}
              </h3>

              <span class="pt-level-badge">
                Niveau {{ lesson.level }}
              </span>
            </div>

            <!-- BADGE RECOMMANDATION -->
            {% if lesson.level > request.user.profile.level %}
              <span class="pt-badge pt-badge--warning">
                ðŸ”’ Niveau recommandÃ© plus tard
              </span>
            {% else %}
              <span class="pt-badge pt-badge--success">
                âœ… Niveau recommandÃ©
              </span>
            {% endif %}

            <!-- DESCRIPTION -->
            <p class="pt-card-meta">
              EntraÃ®nement ciblÃ© pour amÃ©liorer la compÃ©tence
              <strong>{{ section|upper }}</strong>
              au niveau <strong>{{ lesson.level }}</strong>.
            </p>

            <!-- PROGRESSION -->
            {% if lesson.progress %}
              <div class="pt-progress">
                <div class="pt-progress-bar">
                  <div
                    class="pt-progress-fill"
                    style="width: {{ lesson.progress.percent }}%;"
                  ></div>
                </div>
                <span class="pt-progress-text">
                  {{ lesson.progress.percent }}%
                  {% if lesson.progress.is_completed %}
                    Â· LeÃ§on terminÃ©e âœ”
                  {% endif %}
                </span>
              </div>
            {% else %}
              <p class="pt-small">
                Progression non commencÃ©e
              </p>
            {% endif %}

            <!-- ACTION -->
            <div class="pt-cta-group">
              <a
                href="{% url 'preparation_tests:lesson_session' exam_code section lesson.id %}"
                class="pt-btn-primary"
              >
                Commencer la leÃ§on â†’
              </a>
            </div>

          </article>
          {% endfor %}

        </div>
        {% else %}
          <div class="pt-empty">
            Aucune leÃ§on disponible pour le moment.
          </div>
        {% endif %}

      </div>

      <!-- ================= SIDEBAR ================= -->
      <aside class="pt-side">

        <div class="pt-card pt-card--side">
          <h3>ðŸŽ¯ Comment progresser efficacement ?</h3>

          <ul class="pt-side-list">
            <li>Commence par les niveaux proches du tien</li>
            <li>Refais les exercices jusquâ€™Ã  â‰¥ <strong>70%</strong></li>
            <li>Passe un test blanc pour valider ton niveau</li>
            <li>DÃ©bloque badges et certificats CECR ðŸŽ“</li>
          </ul>
        </div>

      </aside>

    </div>

  </div>
</section>

{% endblock %}
