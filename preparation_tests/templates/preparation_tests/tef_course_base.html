{% extends "base.html" %}
{% load static %}

{% block title %}
Entra√Ænement TEF ‚Äî {{ lesson_type }} | Immigration97
{% endblock %}

{% block meta_description %}
Session d‚Äôentra√Ænement TEF interactive : compr√©hension,
analyse, rapidit√© et pr√©cision pour r√©ussir l‚Äôexamen.
{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'css/pages/training_engine.css' %}">
{% endblock %}

{% block content %}

<section class="page page-training-engine">

  <!-- ===== HEADER SESSION ===== -->
  <section class="engine-card">
    <div class="engine-path">
      TEF ‚Ä¢ Session d‚Äôentra√Ænement ‚Äî {{ lesson_type }}
    </div>

    <h1 class="engine-main-title">
      Session ‚Äî <span class="highlight">{{ lesson_type }}</span>
    </h1>

    <p class="muted">
      Tu es dans une session d‚Äôentra√Ænement interactive.
      Lis la consigne, analyse soigneusement, puis choisis ta r√©ponse.
      Objectif : <strong>compr√©hension, rapidit√© et pr√©cision</strong>.
    </p>

    <div class="engine-stats-header">
      <span>Exercices : <strong>{{ total_exercises }}</strong></span>
      <span>Score : <strong id="top-score">0</strong></span>
      <span>Temps : <strong id="top-timer">00:00</strong></span>
    </div>

    <label class="mode-toggle">
      <input type="checkbox" id="exam-mode">
      <span>Mode examen (temps limit√©, pas de retour arri√®re)</span>
    </label>
  </section>

  <!-- ===== MOTEUR D‚ÄôEXERCICES ===== -->
  <section class="engine-card" id="exercise-card">

    <div class="engine-q-header">
      <span>Question <span id="q-index">1</span> / {{ total_exercises }}</span>
      <span>Score : <span id="score">0</span></span>
      <span>Temps : <span id="timer">00:00</span></span>
    </div>

    <hr class="sep">

    <div id="instruction" class="instruction">Chargement de la consigne‚Ä¶</div>

    <div id="text-block" class="engine-text hidden"></div>

    <audio id="audio-player" class="hidden" controls></audio>

    <h3 id="question" class="engine-question">‚Ä¶</h3>

    <div id="options" class="engine-options"></div>

    <textarea id="writing-zone" class="writing-zone hidden"
      placeholder="√âcris ta r√©ponse ici‚Ä¶"></textarea>

    <div id="eo-controls" class="eo-controls hidden">
      <button class="btn-mic" id="eo-record">üéôÔ∏è Simulation EO</button>
      <div id="eo-status" class="muted"></div>
    </div>

    <div id="explanation-block" class="explanation hidden"></div>

    <div class="engine-nav">
      <button id="next-btn" class="btn-primary">Question suivante</button>
      <button id="restart-btn" class="btn-secondary">‚Üª Recommencer</button>
    </div>

    <hr class="sep">

    <div class="muted">
      Score total : <span id="score-bottom">0</span> / {{ total_exercises }}
    </div>

  </section>

  <!-- ===== PANNEAU LAT√âRAL ===== -->
  <aside class="engine-side">
    <section class="side-card">
      <h3>Strat√©gies de r√©ussite</h3>
      <ul>
        <li>Lis d‚Äôabord la consigne et la question.</li>
        <li>Rep√®re les mots-cl√©s importants.</li>
        <li>Base toujours ta r√©ponse sur le texte ou l‚Äôaudio.</li>
      </ul>
    </section>

    <section class="side-card">
      <h3>Erreurs fr√©quentes</h3>
      <ul>
        <li>Confondre les conditions.</li>
        <li>Ignorer les mots restrictifs.</li>
        <li>R√©pondre trop vite.</li>
      </ul>
    </section>
  </aside>

</section>

{% endblock %}

{% block scripts_extra %}
<script>
  const EXERCISES = JSON.parse('{{ exercises_json|escapejs }}');
</script>
<script src="{% static 'js/training_engine.js' %}"></script>
{% endblock %}
