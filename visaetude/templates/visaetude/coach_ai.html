{% extends "base.html" %}
{% block body_class %}visa-etude{% endblock %}
{% load static %}

{% block title %}
Coach IA Visa √âtudes ‚Äì Assistant Intelligent pour √âtudier √† l‚Äô√âtranger | Immigration97
{% endblock %}

{% block meta_description %}
Coach IA Visa √âtudes Immigration97 : assistant intelligent pour analyser ton profil √©tudiant,
choisir le bon pays, pr√©parer admission, bourses et visa √©tudiant.
Accompagnement structur√© pour √©tudier √† l‚Äô√©tranger l√©galement.
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/visa_etude.css' %}">
{% endblock %}

{% block content %}

<!-- ==================================================
HERO ‚Äî COACH IA VISA √âTUDES
================================================== -->
<section class="ve-dashboard-hero fade-in-up">
  <div class="container">

    <span class="ve-badge">
      ü§ñ Coach IA ¬∑ Visa √âtudes International
    </span>

    <h1 class="ve-title">
      Coach IA Visa √âtudes<br>
      <span class="ve-gradient">Ton assistant intelligent pour √©tudier √† l‚Äô√©tranger</span>
    </h1>

    <p class="ve-lead">
      Le <strong>Coach IA Visa √âtudes Immigration97</strong> t‚Äôaccompagne √† chaque √©tape de ton projet :
      analyse de profil √©tudiant, choix du pays et des universit√©s,
      strat√©gie de <strong>visa √©tudiant</strong>,
      pr√©paration des <strong>bourses d‚Äô√©tudes</strong> et plan d‚Äôadmission r√©aliste.
    </p>

  </div>
</section>

<!-- ==================================================
LAYOUT PRINCIPAL
================================================== -->
<section class="ve-dashboard-modules">
  <div class="container ve-modules-grid">

    <!-- =======================
    SIDEBAR EXPLICATION
    ======================= -->
    <aside class="ve-module-card" data-step="IA">

      <span class="ve-step">Assistant intelligent</span>
      <h2>Comment fonctionne le Coach IA Visa √âtudes ?</h2>

      <p>
        Le Coach IA Immigration97 est con√ßu pour aider les √©tudiants africains
        et internationaux √† <strong>√©tudier l√©galement √† l‚Äô√©tranger</strong>
        en √©vitant les erreurs co√ªteuses.
      </p>

      <ul>
        <li>Analyse personnalis√©e de ton profil acad√©mique</li>
        <li>Identification des pays et programmes accessibles</li>
        <li>Conseils pour admission universitaire</li>
        <li>Orientation <strong>bourses d‚Äô√©tudes</strong></li>
        <li>Pr√©paration strat√©gique du <strong>visa √©tudiant</strong></li>
      </ul>

      <p class="small">
        ‚ö†Ô∏è Les r√©ponses fournies sont informatives.
        V√©rifie toujours les exigences officielles
        (ambassades, universit√©s, gouvernements).
      </p>

      <div class="ve-cta-group">
        <a href="{% url 'visaetude:roadmap' %}" class="ve-btn-secondary">
          üìç Voir mon parcours Visa √âtudes
        </a>
        <a href="{% url 'visaetude:checklist' %}" class="ve-btn-secondary">
          ‚úÖ Ouvrir la checklist visa
        </a>
      </div>

    </aside>

    <!-- =======================
    CHAT COACH IA
    ======================= -->
    <div class="ve-module-card ve-module-highlight">

      <span class="ve-step">Conversation intelligente</span>
      <h2>Discute avec ton Coach IA Visa √âtudes</h2>

      <div class="chat-container">

        <div class="chat-messages" id="chatMessages">

          <div class="chat-message bot">
            <div class="bubble">
              üëã Bonjour, je suis ton <strong>Coach IA Visa √âtudes</strong>.<br><br>
              Explique-moi :
              <ul>
                <li>ton pays d‚Äôorigine</li>
                <li>ton niveau d‚Äô√©tudes</li>
                <li>ton domaine</li>
                <li>ton budget</li>
                <li>les pays vis√©s</li>
                <li>l‚Äôann√©e de d√©part souhait√©e</li>
              </ul>
              Je te proposerai un <strong>plan d‚Äôaction clair et r√©aliste</strong>.
            </div>
          </div>

        </div>

        <form class="chat-input" id="chatForm" onsubmit="return false;">
          <textarea id="chatText"
                    rows="2"
                    placeholder="Ex : Je suis titulaire d‚Äôune licence en informatique au Cameroun et je vise un master au Canada en 2026‚Ä¶"></textarea>

          <button id="chatSendBtn" type="submit" class="ve-btn-primary">
            Envoyer ma question
          </button>

          <small class="small">
            üí° Astuce SEO & pr√©cision :
            plus ton message est d√©taill√©, plus la r√©ponse sera pertinente.
          </small>
        </form>

      </div>

    </div>

  </div>
</section>

<!-- ==================================================
CTA FINAL ‚Äî CONVERSION
================================================== -->
<section class="ve-cta-final">
  <div class="container text-center">

    <h2>
      üéì Pr√™t √† r√©ussir ton projet d‚Äô√©tudes √† l‚Äô√©tranger ?
    </h2>

    <p>
      Immigration97 combine <strong>expertise humaine</strong>,
      <strong>intelligence artificielle</strong> et
      <strong>strat√©gies officielles</strong>
      pour maximiser tes chances d‚Äôobtenir un
      <strong>visa √©tudiant</strong>.
    </p>

    <div class="ve-cta-group center">
      <a href="{% url 'visaetude:profile' %}" class="ve-btn-primary">
        Compl√©ter mon profil √©tudiant
      </a>
      <a href="{% url 'billing:access' %}" class="ve-btn-premium">
        Activer l‚Äôaccompagnement Premium
      </a>
    </div>

  </div>
</section>

{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
(function () {
  const form = document.getElementById("chatForm");
  const textarea = document.getElementById("chatText");
  const messages = document.getElementById("chatMessages");

  if (!form || !textarea || !messages) return;

  form.addEventListener("submit", async function (e) {
    e.preventDefault();
    const text = textarea.value.trim();
    if (!text) return;

    addMessage("user", text);
    textarea.value = "";
    addLoader();

    try {
      const response = await fetch("{% url 'visaetude:coach_ai_api' %}", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ message: text }),
      });

      removeLoader();

      const data = await response.json();
      addMessage("bot", data.reply || "‚ö†Ô∏è Une r√©ponse sera bient√¥t disponible.");

    } catch (err) {
      removeLoader();
      addMessage("bot", "‚ùå Erreur de communication avec le coach.");
    }
  });

  function addMessage(type, text) {
    const wrap = document.createElement("div");
    wrap.className = "chat-message " + type;
    wrap.innerHTML = `<div class="bubble">${text}</div>`;
    messages.appendChild(wrap);
    messages.scrollTop = messages.scrollHeight;
  }

  function addLoader() {
    const loader = document.createElement("div");
    loader.id = "chatLoader";
    loader.className = "chat-message bot";
    loader.innerHTML = '<div class="bubble">‚è≥ Analyse en cours‚Ä¶</div>';
    messages.appendChild(loader);
  }

  function removeLoader() {
    const loader = document.getElementById("chatLoader");
    if (loader) loader.remove();
  }
})();
</script>
{% endblock %}
